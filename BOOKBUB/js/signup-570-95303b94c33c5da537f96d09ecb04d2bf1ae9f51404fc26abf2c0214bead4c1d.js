(self.webpackChunkLello=self.webpackChunkLello||[]).push([[570],{13042:function(e,t){t.o={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(e){for(var t=0;t<e.length;t++){var o=e[t].string,s=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,o){if(-1!=o.indexOf(e[t].subString))return e[t].identity}else if(s)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.userAgent,subString:"iPad",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}},28983:function(){$((()=>{$("form").on("submit",(function(e){const t=$.now(),o=$(this).data("submitted");return null!=o&&t-o<=1e4?e.preventDefault():$(this).data("submitted",t)})),$(".debounced").on("click",(function(e){const t=$.now(),o=$(this).data("submitted");return null!=o&&t-o<=1e4?(e.preventDefault(),!1):$(this).data("submitted",t)}))}))},24378:function(){const e=function(){function e(e){this.$el=e,this.isToggled=!1,this.initEvents()}return e.prototype.initEvents=function(){const e=$(window),t=this.$el.find("input"),o=this.$el.find(".clear-button");return t.keyup((()=>{const e=Boolean(t.val());return o.toggle(e)})),t.keyup(),o.click((()=>(t.val(""),o.hide()))),e.resize((s=this,()=>{if(e.width()>768)return s.hide()}));var s},e.prototype.toggleVisibility=function(){return this.$el.toggle(!this.isToggled),this.isToggled=!this.isToggled,this.isToggled},e.prototype.focusInput=function(){this.$el.find("input:visible[name='search']").focus()},e.prototype.hide=function(){return this.isToggled=!1,this.$el.hide()},e}();$((()=>{const t=new e($(".search-bar-mobile"));$(".header-search-nav-button").click((function(){t.toggleVisibility(),$(this).toggleClass("active"),t.isToggled&&t.focusInput()}))}))},24343:function(e,t,o){"use strict";var s=o(67294),r=o(73935),i=o(45697),a=o.n(i),n=o(96486),l=o.n(n),p=o(19755),c=o.n(p),d=o(44140),u=o.n(d),h=o(31955),m=o(42568),g=o.n(m),y=o(13042),b=o(42238),k=o.n(b);const T={hoverEnabled(){const e=new(k());return!_.includes(["mobile","tablet","wearable"],e.getDevice().type)},init(){this.hoverEnabled()&&document.documentElement.classList.add("hover-enabled")},nativeShareEnabled(){const e=_.get(this.userData(),"deviceType");return navigator.share&&"mobile"===e},userData(){return $("#user-store-data").length>0?JSON.parse($("#user-store-data").attr("data")):{}}};var S=o(57632),f=o(92204);const E=[{id:"0",displayName:"Free"},{id:"99",displayName:"$0.99 or less"},{id:"299",displayName:"$2.99 or less"},{id:"499",displayName:"$4.99 or less"},{id:"699",displayName:"$6.99 or less"},{id:"999",displayName:"$9.99 or less"}],R=new class{constructor(){this.parseData(),this.recommendedMajorVersion=2,this.recommendedMinorVersion=4,this.recommendedPatchVersion=0}parseData(){const e=c()("#strand-store-data").attr("data")||JSON.stringify({});this.strandData=JSON.parse(e)}versionString(){return this.strandData.versionString||"2.0.0"}majorVersion(){return _.parseInt(this.strandData.majorVersion)||2}minorVersion(){return _.parseInt(this.strandData.minorVersion)||0}patchVersion(){return _.parseInt(this.strandData.patchVersion)||0}isBelowVersion(e,t,o){return this.majorVersion()!==e?this.majorVersion()<e:this.minorVersion()!==t?this.minorVersion()<t:this.patchVersion()<o}isBelowRecommendedVersion(){return this.isBelowVersion(this.recommendedMajorVersion,this.recommendedMinorVersion,this.recommendedPatchVersion)}showExistingUsersModal(){return this.strandData.showExistingUsersModal}showPushNotificationsModal(){return this.strandData.showPushNotificationsModal}isFirstSession(){return this.strandData.isFirstSession}isReviewEligible(){return this.strandData.isReviewEligible}formattedPriceTiers(e){const t=E;return 2===e?_.map(t,(e=>({id:e.id,displayName:_.replace(e.displayName,"$","Â£")}))):t}setStrandData(e){this.strandData=e}getStrandData(){return this.strandData}},P={sessionTimeout:1800,pageVisitEventUuid:(0,S.Z)(),localStorageAvailable:void 0,trackingIndex(e){return(e=_.isUndefined(e)?0:e)+1},trackLanderReengagement(){const e=_.get(this.userData(),"landerReengagementData");return _.isEmpty(e)?null:this.track("Landers","Existing email submission",e)},trackSignInReroute(){const e=_.get(this.userData(),"signInRerouteData");return _.isEmpty(e)?null:this.track("Attempted Sign Up","Existing email submission",e)},trackSignInError(){const e=_.get(this.userData(),"signInErrorData");return _.isEmpty(e)?null:this.track("Attempted Sign In","Invalid email/password",e)},trackResubscriberSignIn(){const e=_.get(this.userData(),"resubscriberSignInData");return _.isEmpty(e)?null:this.track("Resubscription Alert","Magic Link Email Sent",e)},track(e,t,o){o=_.isUndefined(o)?{}:o;const s=this.trackingData(e,t,o,"bb_event"),r=this.storeEvent(s);return this.postTracking(r,s)},trackAppEvent(e,t,o){o=_.isUndefined(o)?{}:o,o=_.merge(this.expandAppBookData(o),{strandVersion:R.versionString()});const s=this.trackingData(e,t,o,"strand_event"),r=this.storeEvent(s);return this.postTracking(r,s)},trackUsingBeacon(e,t,o){if(_.isEmpty(window.bubEventsProcessingUrl))return null;o=_.isUndefined(o)?{}:o;const s=this.trackingData(e,t,o,"bb_event");try{return navigator.sendBeacon(window.bubEventsProcessingUrl,JSON.stringify(s))}catch(s){return this.track(e,t,o)}},trackPageVisit(e={}){const t=this.trackingData("Visit",null,e,"bb_page_visit"),o=this.storeEvent(t);return this.postTracking(o,t)},postTracking(e,t){return this.suspectedBot()||_.isEmpty(window.bubEventsProcessingUrl)?null:this.eventService(t).then((()=>{this.supportsLocalStorage()&&localStorage.removeItem(e)})).catch((e=>{0===e.status?console.warn(`bubEvents: likely clipped by onunload: ${JSON.stringify(e)}`):console.error(`bubEvents: unexpected error: ${JSON.stringify(e)}`)}))},eventService(e){return(0,f.a)((()=>$.ajax({method:"POST",contentType:"application/json",url:window.bubEventsProcessingUrl,data:JSON.stringify(e)})))},expandAppBookData(e){const t=_.get(e,"book",{}),o={bookId:t.id,promotionId:t.promotionId};return _.merge(_.omit(e,"book"),_.omitBy(o,_.isNil))},trackingData(e,t,o,s){const r=this.emailRefererData();return{admin_user_id:_.get(this.userData(),"admin.adminUserId"),browser_timestamp:this.timestamp(),category:s,client_event_uuid:this.getEventUuid(s),email_referer_fingerprint:r.fingerprint,email_referer_id:r.id,email_referer_type:r.type,email_referer_user_id:r.user_id,event_action:t,event_category:e,event_label:_.get(o,"label"),event_value:_.get(o,"value"),page:this.page(),page_referer:_.get(o,"pageReferer")||this.pageReferer(),page_visit_event_uuid:this.getPageVisitUuid(),properties:_.omit(o,["label","value","pageReferer"]),screensize:this.screensize(),session_id:this.fetchSessionId(),user_id:_.get(this.userData(),"user.userId"),user_tracking_id:_.get(this.userData(),"user.trackingId")}},getEventUuid(e){return"bb_page_visit"===e?this.getPageVisitUuid():this.generateClientEventUuid()},getMid(){return _.get(this.userData(),"user.mid")},emailRefererData(){const e=this.getMid(),t=_.split(e,"-",4);return{type:t[0]||null,id:t[1]||null,user_id:t[2]||null,fingerprint:t[3]||null}},userData(){return $("#user-store-data").length>0?JSON.parse($("#user-store-data").attr("data")):{}},fetchSessionId(){return this.checkSessionStatus(),Cookies.get("bub_events_session_id")},checkSessionStatus(){const e=Cookies.get("bub_events_session_id");return Cookies.get("bub_events_session_timestamp")&&this.sessionTime()-Cookies.get("bub_events_session_timestamp")<1e3*this.sessionTimeout&&e?this.extendSession():this.renewSession()},extendSession(){Cookies.set("bub_events_session_timestamp",this.sessionTime(),{path:"/"})},renewSession(){Cookies.set("bub_events_session_timestamp",this.sessionTime(),{path:"/"}),Cookies.set("bub_events_session_id",this.generateSessionId(),{path:"/"})},generateEventId(){return`bubEvent-${(0,S.Z)()}`},storeEvent(e){const t=JSON.stringify(e),o=this.generateEventId();if(this.supportsLocalStorage())try{localStorage.setItem(o,t)}catch(e){}return o},drainEvents(){this.supportsLocalStorage()&&_(localStorage).map(((e,t)=>localStorage.key(t))).filter((e=>_.startsWith(e,"bubEvent-"))).forEach((e=>{const t=JSON.parse(localStorage.getItem(e));this.postTracking(e,t)}))},suspectedBot(){return!_.get(this.userData(),"user.userId")&&(e=window.navigator.userAgent,new RegExp([/bot/,/spider/,/crawl/,/APIs-Google/,/AdsBot/,/Googlebot/,/mediapartners/,/FeedFetcher/,/yandex/,/baidu/,/ia_archiver/,/Bingbot/,/DuckDuckBot/,/Slurp/,/facebot/,/Exabot/,/Sogou/].map((e=>e.source)).join("|"),"i").test(e));var e},supportsLocalStorage(){if(void 0===this.localStorageAvailable)try{"localStorage"in window&&null!==window.localStorage?(localStorage.setItem("test","test"),localStorage.removeItem("test"),this.localStorageAvailable=!0):this.localStorageAvailable=!1}catch(e){this.localStorageAvailable=!1}return this.localStorageAvailable},page(){return window.location.href},pageQuery(){return window.location.search},pageReferer(){return document.referrer},getPageVisitUuid(){return this.pageVisitEventUuid},screensize(){return window.innerWidth},timestamp(){return(new Date).toUTCString()},sessionTime(){return(new Date).getTime()},generateSessionId(){return(0,S.Z)()},generateClientEventUuid(){return(0,S.Z)()}};document.addEventListener("click",(()=>{P.checkSessionStatus()})),document.addEventListener("DOMContentLoaded",(()=>P.drainEvents())),window.jQuery=c(),window.$=c(),window._=l(),window.React=s,window.ReactDOM=r,window.PropTypes=a(),window.jstz=u(),window.Cookies=h.Z,window.BrowserAbilities=T,window.BrowserDetect=y.o,window.bubEvents=P,window.memoize=e=>g()(e,{maxSize:200}),T.init(),y.o.init()},51143:function(){$((()=>{bubEvents.trackLanderReengagement(),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"lander-reengagement"})}))},69188:function(e,t,o){"use strict";o.d(t,{x:function(){return s}});const s={scrollTopCached:void 0,setScrollTop(){const e=$(window).scrollTop();return 0!==e&&(this.scrollTopCached=e),e},restoreScrollTop(){0===$(window).scrollTop()&&$(window).scrollTop(this.scrollTopCached)},onModalOpen(){const e=this.setScrollTop();$("#page-viewport").css({position:"fixed",top:`-${e}px`})},onModalHide(){$("#page-viewport").css({position:"",top:""}),this.restoreScrollTop()}};$("body").on("show.bs.modal",(()=>{s.onModalOpen()})),$("body").on("hide.bs.modal",(()=>{s.onModalHide()}))},88604:function(e,t,o){"use strict";if(_.forEach({Firefox:20,Explorer:11,Safari:5.1,Chrome:22},((e,t)=>{BrowserDetect.browser===t&&BrowserDetect.version<=e&&(document.getElementById("browser-notice").style.display="block",document.getElementsByTagName("body")[0].style.paddingTop="74px")})),window.console||(window.console={},window.console.log=_.noop),"test"!==window.bubEnv&&"development"!==window.bubEnv){const e=e=>{const t=_(e).join(" ").trim();return _.isEmpty(t)?Rollbar.error(new Error(`Console error with empty message, args: ${JSON.stringify(e)}`)):Rollbar.error(new Error(t))},t=console.error;console.error=function(...o){return e(o),t.apply(this,o)};const o=console.assert;console.assert=function(...t){return e(t),o.apply(this,t)}}$((()=>{$(".biscuit-notice")[0]&&(Cookies.set("test_cookie","cookie_value",{path:"/"}),"cookie_value"!==Cookies.get("test_cookie")&&($("#biscuit-notice").show(),$("body").css("padding-top","96px")));const e=jstz.determine();Cookies.set("time_zone",e.name(),{path:"/"})}));var s=o(70136),r=o(88251),i=o(15176);class a{constructor(e,t){const o=_.noop;this.onSuccessFn=[],this.onFailureFn=[],this.onExecuteFn=[],this.executeFn=e,this.cancelFn=t||o,this.executeContext={},this.callCount=0,this.state=0}onSuccess(e){this.onSuccessFn.push(e)}onFailure(e){this.onFailureFn.push(e)}onExecute(e){this.onExecuteFn.push(e)}applyFns(e,t,o){const s=this;return(...r)=>{t===s.callCount&&(e.forEach((e=>{try{e.apply({},r)}catch(e){}})),s.state=o)}}execute(...e){this.callCount+=1;const t=this.callCount;return 1===this.state&&this.cancelFn.apply(this.executeContext,e),this.applyFns(this.onExecuteFn,t,1).apply(this,e),this.executeFn.apply(this.executeContext,e).then(this.applyFns(this.onSuccessFn,t,0),this.applyFns(this.onFailureFn,t,0))}}var n=o(53943),l=o.n(n),p=o(88485);const c=(e=>{const t=(0,p.F)("www","/search-autocomplete/user-authors.json?search_text=%QUERY");return new(l())({datumTokenizer:l().tokenizers.obj.whitespace,queryTokenizer:l().tokenizers.whitespace,identify:e=>e.payload.id,remote:{url:t,wildcard:"%QUERY"}})})(),d={searchBooks(e,t,o){const s=(e=>new(l())({datumTokenizer:l().tokenizers.obj.whitespace,queryTokenizer:l().tokenizers.whitespace,identify:e=>e.payload.id,remote:{url:(0,p.F)("www",`/search-autocomplete/books.json?search_text=%QUERY&num_results=${e}`),wildcard:"%QUERY"}}))(t);s.search(e,_.noop,(e=>{const t=_.map(e,(e=>({id:e.id,bookListSlug:e.list_slug,slug:e.slug,coverImageUrl:e.cover_image,browseImageUrl:e.browse_image,title:e.title,authors:e.authors})));o(t)}))},searchAuthors(e,t){c.search(e,_.noop,(e=>{const o=_.map(e,"profile");t(o)}))}};var u=o(75073),h=o(75820),m=o(93513);const g="navSearch",y=(0,h.hp)(g,["SET_PROFILES","SET_BOOKS","SET_QUERY","SET_BOOK_SEARCH_COMPLETED","SET_AUTHOR_SEARCH_COMPLETED"]);(0,h.fn)(g,(0,m.Uy)(((e,t)=>{switch(t.type){case y.SET_PROFILES:return e.profileIds=_.map(t.payload.profiles,"id"),e;case y.SET_BOOKS:return e.books=t.payload.books,e;case y.SET_QUERY:return e.query=t.payload.query,e;case y.SET_BOOK_SEARCH_COMPLETED:return e.bookSearchCompleted=t.payload.completed,e;case y.SET_AUTHOR_SEARCH_COMPLETED:return e.authorSearchCompleted=t.payload.completed,e;default:return e}}),{profileIds:[],books:[],query:"",authorSearchCompleted:!1,bookSearchCompleted:!1}));const b=e=>e[g],k={actionTypes:y,getSelector:e=>({...b(e)})};var T=o(87679);const S=new class{constructor(){this.bookSearchProxy=new a(((e,t)=>new i.ZP.Promise((o=>d.searchBooks(e,t,o))))),this.bookSearchProxy.onSuccess((e=>{T.Z.addBooks({books:e}),S.setBooks(e),S.setBookSearchCompleted(!0)})),this.authorSearchProxy=new a((e=>new i.ZP.Promise((t=>d.searchAuthors(e,t))))),this.authorSearchProxy.onSuccess((e=>{u.d.addProfiles({profiles:e}),S.setProfiles(e),S.setAuthorSearchCompleted(!0)}))}setProfiles(e){h.tO.dispatch({type:k.actionTypes.SET_PROFILES,payload:{profiles:e}})}setBooks(e){h.tO.dispatch({type:k.actionTypes.SET_BOOKS,payload:{books:e}})}setQuery(e){h.tO.dispatch({type:k.actionTypes.SET_QUERY,payload:{query:e}})}setBookSearchCompleted(e){h.tO.dispatch({type:k.actionTypes.SET_BOOK_SEARCH_COMPLETED,payload:{completed:e}})}setAuthorSearchCompleted(e){h.tO.dispatch({type:k.actionTypes.SET_AUTHOR_SEARCH_COMPLETED,payload:{completed:e}})}getAuthorsSearch(e){return this.setAuthorSearchCompleted(!1),this.authorSearchProxy.execute(e),!0}getBooksSearch(e,t){return this.setBookSearchCompleted(!1),this.bookSearchProxy.execute(e,t),!0}};var f=o(94480),E=o(18674),R=o(83141),P=o(64538),C=o(88426),I=o(69923),O=o(76397),v=o(9971);class B extends React.Component{constructor(e){super(e);const t="test"===window.bubEnv?0:300;this.handleFocus=this.handleFocus.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.pageClick=this.pageClick.bind(this),this.renderMenu=this.renderMenu.bind(this),this.renderProfile=this.renderProfile.bind(this),this.runSearch=_.debounce(this.runSearch.bind(this),t),this.state={focused:!1,loaded:!1},this.initialQuery=_.get(document.querySelector("#nav-search-app"),"dataset.query")}componentDidMount(){window.addEventListener("mousedown",this.pageClick,!1),S.setQuery(this.initialQuery)}componentWillUnmount(){window.removeEventListener("mousedown",this.pageClick,!1)}handleInputChange(e){S.setQuery(e.target.value),e.target.value.length>=2&&this.runSearch()}handleFocus(){this.setState({focused:!0}),!this.state.loaded&&this.initialQuery&&this.initialQuery.length>=2&&(S.setQuery(this.initialQuery),S.getAuthorsSearch(this.initialQuery),S.getBooksSearch(this.initialQuery,this.props.bookResultCount),this.setState({loaded:!0}))}handleMouseDown(){this.mouseIsDownOnTypeahead=!0}handleMouseUp(){this.mouseIsDownOnTypeahead=!1}pageClick(){this.mouseIsDownOnTypeahead||this.setState({focused:!1})}runSearch(){S.getAuthorsSearch(this.props.query),S.getBooksSearch(this.props.query,this.props.bookResultCount)}renderProfile(e){return React.createElement("div",{key:e.authorId,id:`tt-author-${e.authorId}`,className:"tt-author-suggestion tt-suggestion tt-selectable"},React.createElement(f.j,{profile:e,isFollowing:e.isFollowing,secondaryInfo:"followerCount",size:"small",wrapAuthorPill:!0}))}renderBook(e){const t=_.merge({},e,{url:`/books/${e.slug}`,coverUrl:e.coverImageUrl});return React.createElement("div",{key:e.id,className:"tt-book-suggestion tt-suggestion tt-selectable"},React.createElement(E.E,{book:t,buttonType:"bookmark",hideRating:!0,size:"small",trackingId:C.f.NAV_SEARCH_TYPEAHEAD}))}renderMenu(){if(this.props.query&&this.props.query.length>=2&&this.state.focused){let e=null;const t=this.props.windowMatchesXs||this.props.windowMatchesSm?"tt-search-label small":"tt-search-label";if(this.props.bookSearchCompleted){const o=_.map(this.props.books,(e=>this.renderBook(e)));if(o.length>0){const s=React.createElement("div",{className:t},React.createElement("p",null,"Books"));e=React.createElement("div",{className:"tt-dataset tt-dataset-book-results"},s,o)}}let o=null;if(this.props.authorSearchCompleted){const e=_.map(this.props.profiles,(e=>this.renderProfile(e)));if(e.length>0){const s=React.createElement("div",{className:t},React.createElement("p",null,"Authors"));o=React.createElement("div",{className:"tt-dataset tt-dataset-author-results"},s,e)}}const s=this.props.windowMatchesXs||this.props.windowMatchesSm?"tt-search-type-link-tall":"",r=[React.createElement("p",{key:"books"},React.createElement("a",{className:s,href:`/search?search=${encodeURIComponent(this.props.query)}`},React.createElement("span",{className:"quoted-search-result"},'"',this.props.query,'"')," in Books")),React.createElement("p",{key:"authors"},React.createElement("a",{className:s,href:`/search/authors?search=${encodeURIComponent(this.props.query)}`},React.createElement("span",{className:"quoted-search-result"},'"',this.props.query,'"')," in Authors"))];this.props.currentUserIsUs&&r.push(React.createElement("p",{className:"profile-search-typeahead-link",key:"users"},React.createElement("a",{className:s,href:`/search/profiles?search=${encodeURIComponent(this.props.query)}`},React.createElement("span",{className:"quoted-search-result"},'"',this.props.query,'"')," in Members")));const i=React.createElement("div",{className:"tt-dataset"},React.createElement("div",{className:"tt-search-type-links"},r));return React.createElement("div",{className:"tt-menu tt-open"},i,e,o)}return null}render(){const e=this.renderMenu(),t=React.createElement("span",{className:"input-group-btn"},React.createElement("button",{type:"submit",className:"btn search-button"},React.createElement("span",{className:"sr-only"},"Submit Search"),React.createElement(R.J,{name:"search",className:"search-icon"}))),o=React.createElement("div",{className:"input-group nav"},React.createElement("span",{className:"twitter-typeahead"},React.createElement("input",{type:"text",id:this.props.inputName,name:this.props.inputName,className:"form-control search-bar typeahead",placeholder:this.props.placeholder,autoComplete:"off",defaultValue:this.initialQuery,onChange:this.handleInputChange,onFocus:this.handleFocus,"aria-labelledby":"nav-search-title"}),React.createElement("title",{id:"nav-search-title"},"Search for books and authors on BookBub"),e),t),s=React.createElement("form",{className:"book-search-form",action:"/search"},o);return React.createElement("div",{className:"nav-search-vc",onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp},s)}}const w=(0,r.$j)((e=>{const t=k.getSelector(e),o=I.C.getSelector(e);return{authorSearchCompleted:t.authorSearchCompleted,books:t.books,bookSearchCompleted:t.bookSearchCompleted,currentUserIsUs:v.I.countryCodeIsUs(),profiles:o.getProfilesForIds(t.profileIds),query:t.query}}))((0,P.$)(B));B.propTypes={profiles:O._.profiles,authorSearchCompleted:PropTypes.bool,bookResultCount:PropTypes.number,books:O._.books,bookSearchCompleted:PropTypes.bool,currentUserIsUs:PropTypes.bool,inputName:PropTypes.string,placeholder:PropTypes.string,query:PropTypes.string},B.defaultProps={profiles:[],authorSearchCompleted:!1,bookResultCount:4,books:[],bookSearchCompleted:!1,currentUserIsUs:!1,inputName:"search",placeholder:"Search...",query:""};var L=o(85924);class A extends React.Component{constructor(e){super(e),this.state={initialQuery:document.querySelector("#nav-search-app").dataset.query}}render(){return React.createElement(w,{initialQuery:this.state.initialQuery})}}const N=(0,L.Z)(A,{hideOverlay:!0});class M extends React.Component{render(){return React.createElement(w,null)}}const D=(0,L.Z)(M,{hideOverlay:!0});o(42077),(0,s.L)("#nav-search-app",React.createElement(N,null)),(0,s.L)("#nav-search-app-mobile",React.createElement(D,null)),o(24343);var F=o(94184),x=o.n(F),U=o(28312);class H extends React.PureComponent{renderSignUpButton(e){return this.props.hideSignupButton?null:React.createElement("div",{className:"sign-up-button"},React.createElement(U.G,{label:"Sign Up",bubStyle:"lava",full:e,href:"/users/sign_up"}))}render(){const e="mobile"!==this.props.size;return React.createElement("div",{className:x()("auth-buttons",this.props.size)},React.createElement("div",{className:"sign-in-button"},React.createElement(U.G,{label:"Sign In",bubStyle:"white",full:e,href:"/users/sign_in"})),this.renderSignUpButton(e))}}H.propTypes={size:PropTypes.string,hideSignupButton:PropTypes.bool};var K=o(28628);const z={get(e,t={}){return K.B.request({method:"GET",url:"/profile/social_alerts",data:{before:t.prevAlertId}})},getUnreadCount(){return K.B.request({method:"GET",url:"/profile/social_alerts/unread_count",cache:!1})}};var j=o(68697);const G="socialAlerts",q=(0,h.hp)(G,["SET_LOADING","SET_LOADING_MORE","SET_ACTIVE_ALERTS","SET_ALERT_AS_READ","SET_UNREAD_COUNT"]);(0,h.fn)(G,(0,m.Uy)(((e,t)=>{switch(t.type){case q.SET_LOADING:return e.loading=t.payload.loading,e;case q.SET_LOADING_MORE:return e.loadingMore=t.payload.loading,e;case q.SET_ACTIVE_ALERTS:return _.merge(e,{moreAlertsExist:t.payload.alerts.hasMoreAlerts,unreadCount:t.payload.alerts.unreadCount,lastNotificationReadAt:t.payload.alerts.lastNotificationReadAt,alerts:_.merge({},e.alerts,_.keyBy(t.payload.alerts.socialAlerts,"id")),alertIds:_.uniq(e.alertIds.concat(_.map(t.payload.alerts.socialAlerts,"id"))),loading:!1,loadingMore:!1}),e;case q.SET_ALERT_AS_READ:return e.alerts[t.payload.alertId].unread=!1,e;case q.SET_UNREAD_COUNT:return e.unreadCount=t.payload.unreadCount,e;default:return e}}),{loading:!0,alerts:{},alertIds:[],moreAlertsExist:!0,loadingMore:!1,unreadCount:void 0}));const V=e=>e[G],W=(0,j.P1)(V,(e=>_.map(e.alertIds,(t=>e.alerts[t])))),Y=(0,j.P1)(V,(e=>e.alerts[_.last(e.alertIds)])),Q={actionTypes:q,getSelector:e=>{const t={getActiveAlerts:_.partial(W,e),getLastAlert:_.partial(Y,e)};return{...V(e),...t}},getAlertFeedIndex:(e,t)=>{const o=_.map(e,"createdAt"),s=_.sortedIndex(_.reverse(o),t);return o.length-s},ALL_ALERTS_FEED_TYPE:"all",RECOMMENDATION_ALERTS_FEED_TYPE:"recommendations"},J=new class{setActiveAlerts(e){h.tO.dispatch({type:Q.actionTypes.SET_ACTIVE_ALERTS,payload:{alerts:e}})}setLoading(e){h.tO.dispatch({type:Q.actionTypes.SET_LOADING,payload:{loading:e}})}setLoadingMore(e){h.tO.dispatch({type:Q.actionTypes.SET_LOADING_MORE,payload:{loading:e}})}setAlertAsRead(e){h.tO.dispatch({type:Q.actionTypes.SET_ALERT_AS_READ,payload:{alertId:e}})}setUnreadCount(e){h.tO.dispatch({type:Q.actionTypes.SET_UNREAD_COUNT,payload:e})}getAlerts(e){return this.setLoading(!0),z.get(e).then(this.setActiveAlerts)}loadMoreAlerts(e,t){return this.setLoadingMore(!0),z.get(e,{prevAlertId:t}).then(this.setActiveAlerts)}getUnreadCount(){return z.getUnreadCount().then(this.setUnreadCount)}};class Z extends React.PureComponent{renderCount(){const e=this.props.unreadCount||0;if(0===e)return null;let t,o=`${e}`;return e>=100?(o="99+",t="huge-count"):e>=10&&(t="large-count"),React.createElement("div",{className:`social-alert-count ${t}`,"data-testid":"social-alert-unread-count"},o)}render(){return React.createElement("a",{href:"/notifications",className:"social-notification-alert","aria-label":"Notifications"},React.createElement(R.J,{name:"bell",size:"28px",color:"grey-30"}),React.createElement("span",{className:"sr-only"},"See your notifications"),this.renderCount())}}Z.propTypes={unreadCount:PropTypes.number};class X extends React.PureComponent{componentDidMount(){J.getUnreadCount()}render(){return React.createElement(Z,{unreadCount:this.props.unreadCount})}}X.propTypes={unreadCount:PropTypes.number};const ee=(0,r.$j)((e=>({unreadCount:Q.getSelector(e).unreadCount})))(X);class te extends React.Component{renderHeader(){return React.createElement("div",{className:"fullscreen-menu-header"},React.createElement("h1",{className:"fullscreen-menu-title"},this.props.title),React.createElement("div",{className:"dismiss-button",onClick:this.props.hideDropdown,role:"button",tabIndex:"0","aria-label":"Dismiss Menu"},React.createElement(R.J,{name:"x",className:"x-icon",size:"24px"})))}render(){const e=x()("fullscreen-menu",this.props.className);return React.createElement("div",{className:e,"data-testid":"fullscreen-menu"},React.createElement("div",{className:"container"},this.renderHeader(),this.props.children))}}te.propTypes={hideDropdown:PropTypes.func.isRequired,title:PropTypes.string.isRequired,className:PropTypes.string};class oe{constructor(e,t={}){this.category="nav",this.trackingProps=_.merge({label:e},t)}click(e,t={}){const o=_.merge(this.trackingProps,t);bubEvents.track(this.category,e,o)}}class se extends React.PureComponent{constructor(e){super(e),this.navTracking=new oe("user menu"),this.renderMenuItem=this.renderMenuItem.bind(this)}renderNotificationBadge(e){return!e.notificationCount||_.isEqual(e.notificationCount,"0")?null:React.createElement("span",{className:"notification-badge","data-testid":"notification-badge"},e.notificationCount)}renderBookListCount(e){return e.bookListCount?React.createElement("span",{className:x()("book-list-count",{"key-book-list-count":e.isKeyMenuItem}),"data-testid":"book-list-count"},e.bookListCount):null}renderMenuItem(e,t){return"divider"===e.label?React.createElement("li",{key:_.kebabCase(e.label+String(t)),className:"header-user-nav-divider",role:"separator"}):React.createElement("li",{key:_.kebabCase(e.label),role:"presentation"},React.createElement("a",{className:"dropdown-menu-item",href:e.url,target:e.target?e.target:"_self",onClick:()=>{this.navTracking.click(_.snakeCase(e.label),{value:e.url})}},React.createElement("span",{className:x()("user-link",{"key-menu-item":e.isKeyMenuItem}),role:"menuitem"},e.label),this.renderNotificationBadge(e),this.renderBookListCount(e)))}render(){return React.createElement("ol",{className:"header-user-nav-options","aria-label":"User Menu"},_.map(this.props.menuOptions,this.renderMenuItem))}}se.propTypes={menuOptions:PropTypes.arrayOf(PropTypes.shape({url:PropTypes.string,label:PropTypes.string.isRequired,notificationCount:PropTypes.string}))};const re="socialFeed",ie=(0,h.hp)(re,["SET_UNREAD_ALERT_COUNT","SET_SELECTED_FILTERS"]);(0,h.fn)(re,(0,m.Uy)(((e,t)=>{switch(t.type){case ie.SET_UNREAD_ALERT_COUNT:return e.unreadCount=t.payload.unreadCount,e;case ie.SET_SELECTED_FILTERS:return e.selectedFilters=t.payload.selectedFilters,e;default:return e}}),{unreadCount:void 0,selectedFilters:[]}));const ae=e=>e[re],ne=(e,t=1)=>_.union(["social-feed"],e,[t]).join("-"),le=(0,j.P1)(ae,(e=>memoize((t=>ne(e.selectedFilters,t))))),pe={actionTypes:ie,getSelector:e=>{const t={getListType:t=>le(e)(t)};return{...ae(e),...t}},generateListType:ne};var ce=o(92613),de=o(27783);const ue={getUnreadCount(){return K.B.request({method:"GET",url:"/social_feed/unread_count",cache:!1})}},he=new class{setUnreadCount(e){h.tO.dispatch({type:pe.actionTypes.SET_UNREAD_ALERT_COUNT,payload:e})}setSelectedFilters(e){h.tO.dispatch({type:pe.actionTypes.SET_SELECTED_FILTERS,payload:e})}getUnreadCount(){return ue.getUnreadCount().then(this.setUnreadCount)}};var me=o(30845);class ge extends React.PureComponent{constructor(e){super(e),this.bookLists=[{label:me.F1.headerNavLabel,internalName:me.F1.internalName,slug:me.F1.slug},{label:me.JR.headerNavLabel,internalName:me.JR.internalName,slug:me.JR.slug},{label:me.Wz.headerNavLabel,internalName:me.Wz.internalName,slug:me.Wz.slug},{label:me.EG.headerNavLabel,internalName:me.EG.internalName,slug:me.EG.slug}]}componentDidMount(){this.props.isBookDataEnabled&&(he.getUnreadCount(),de.E.initBookListCounts())}bookListMenuOptions(){return _.map(this.bookLists,(e=>({url:`/lists?list=${e.slug}`,label:e.label,isKeyMenuItem:"Wishlist"===e.label,bookListCount:this.props.bookListCountMapping[e.internalName]})))}menuOptions(){return this.props.isBookDataEnabled?[{url:this.props.profile.profileUrl,label:"My Profile",isKeyMenuItem:!0},{label:"divider"},...this.bookListMenuOptions(),{label:"divider"},{url:"/social-feed",label:"My Social Feed",notificationCount:this.props.socialFeedUnreadCount,isKeyMenuItem:!0},{url:"/profile?list=following",label:"My Authors"},{url:"/discover-authors",label:"Discover Authors"},{url:"/deals/invite",label:"Invite Friends"},{label:"divider"},{url:"/settings",label:"My Account",isKeyMenuItem:!0},v.I.getPartner()?{url:"https://partners.bookbub.com/?pd_source=settings_menu_partner-dashboard",label:"Partner Dashboard",target:"_blank"}:null,{url:"https://help.bookbub.com/",label:"Help Center"},{label:"divider"},{url:"/users/sign_out",label:"Sign Out"}].filter((e=>null!==e)):[{url:this.props.profile.profileUrl,label:"My Profile",isKeyMenuItem:!0},{label:"divider"},{url:"/profile?list=following",label:"My Authors",isKeyMenuItem:!0},{url:"/discover-authors",label:"Discover Authors"},{label:"divider"},{url:"/settings",label:"My Account",isKeyMenuItem:!0},v.I.getPartner()?{url:"https://partners.bookbub.com/?pd_source=settings_menu_partner-dashboard",label:"Partner Dashboard",target:"_blank"}:null,{url:"https://help.bookbub.com/",label:"Help Center"},{label:"divider"},{url:"/users/sign_out",label:"Sign Out"}].filter((e=>null!==e))}render(){const e=this.menuOptions();return this.props.isFullWidth&&e.unshift({label:"divider"}),React.createElement("div",{className:"header-user-nav-options-vc"},React.createElement(se,{menuOptions:e}))}}ge.propTypes={isBookDataEnabled:PropTypes.bool,isFullWidth:PropTypes.bool,profile:O._.profile,socialFeedUnreadCount:PropTypes.string,bookListCountMapping:PropTypes.object};const ye=(0,r.$j)((e=>{const t=I.C.getSelector(e),o=pe.getSelector(e),s=ce.C.getSelector(e);return{profile:t.getCurrentUserProfile(),socialFeedUnreadCount:o.unreadCount,bookListCountMapping:s.getBookListCountMappings()}}))(ge);class be extends React.PureComponent{render(){return React.createElement(te,{className:"header-user-nav-modal",hideDropdown:this.props.hideDropdown,title:this.props.profileName},React.createElement(ye,{isBookDataEnabled:this.props.isBookDataEnabled,isFullWidth:this.props.isFullWidth}))}}be.propTypes={profileName:PropTypes.string,hideDropdown:PropTypes.func.isRequired,isBookDataEnabled:PropTypes.bool,isFullWidth:PropTypes.bool},be.defaultProps={profileName:"User Menu"},be.trackingName="Header User Nav Modal";class ke extends React.PureComponent{render(){return React.createElement("div",{className:"header-user-nav-dropdown","aria-labelledby":this.props.ariaLabelledBy,"data-testid":"header-user-nav-dropdown"},React.createElement(ye,{isBookDataEnabled:this.props.isBookDataEnabled,isFullWidth:this.props.isFullWidth}))}}ke.propTypes={ariaLabelledBy:PropTypes.string,isBookDataEnabled:PropTypes.bool,isFullWidth:PropTypes.bool},ke.trackingName="Header User Nav Dropdown";var Te=o(51321),Se=o(74718),_e=o(91013);class fe extends React.Component{constructor(e){super(e),this.navTracking=new oe("header"),this.hideDropdown=this.hideDropdown.bind(this),this.showDropdown=this.showDropdown.bind(this),this.toggleDropdown=this.toggleDropdown.bind(this),this.isMobile=Se.c.matchesSm,this.closeListener=this.closeListener.bind(this),$(document).on("click",this.closeListener)}closeListener(e){this.props.dropdownVisible&&($(e.target).closest(".header-explore-dropdown").length||$(e.target).closest(".header-user-nav-dropdown").length||$(e.target).closest(".header-user-nav-modal").length||$(e.target).closest(".nav-dropdown-button").length||this.hideDropdown())}hideDropdown(){this.props.dropdownVisible&&(document.activeElement.blur(),Te.P.hide())}showDropdown(){const e=_.merge({ariaLabelledBy:this.props.id,hideDropdown:this.hideDropdown},this.props.overlayProps);Te.P.showResponsively(this.props.overlayElement,this.props.overlayElement,e,this.isMobile)}toggleDropdown(){this.props.dropdownVisible?(this.navTracking.click(this.props.trackingName,{value:"close"}),this.hideDropdown()):(this.navTracking.click(this.props.trackingName,{value:"open"}),this.showDropdown())}renderIcon(){if(!this.props.showIcon)return null;const e=this.props.dropdownVisible?"arrow_up":"arrow_down";return React.createElement("div",{className:"nav-dropdown-icon"},React.createElement(R.J,{name:e,className:"down-arrow",color:"grey-70",size:"12px"}))}render(){return React.createElement("button",{className:x()("nav-dropdown-button",this.props.showIcon?"show-icon":""),id:this.props.id,"aria-haspopup":"true",type:"button",tabIndex:"0","aria-expanded":this.props.dropdownVisible,onClick:this.toggleDropdown},this.props.buttonContent,this.renderIcon())}}fe.propTypes={buttonContent:PropTypes.element,id:PropTypes.string.isRequired,overlayElement:PropTypes.func.isRequired,overlayProps:PropTypes.object,showIcon:PropTypes.bool,dropdownVisible:PropTypes.bool,trackingName:PropTypes.string.isRequired},fe.defaultProps={dropdownVisible:!1,overlayProps:{},showIcon:!0};const Ee=(0,r.$j)(((e,t)=>{const o=_e.I.getSelector(e);return{dropdownVisible:o.show&&_.get(o,["component","propsToRenderWith","ariaLabelledBy"])===t.id}}))(fe);var Re=o(89219);class Pe extends React.PureComponent{renderProfileImage(){return React.createElement(Re.m,{profile:this.props.profile,size:"xsmall",hyperlink:!1})}renderButton(){const e=this.props.profile.name||this.props.profile.username;return React.createElement(React.Fragment,null,this.renderProfileImage(),React.createElement("div",{className:"header-profile-name",name:e},e))}render(){const e=x()("header-profile-info-vc",this.props.size);if("default"!==this.props.size){const t={hideDropdown:this.hideDropdown,profileName:this.props.profile.name||this.props.profile.username,isFullWidth:!0,isBookDataEnabled:this.props.isBookDataEnabled};return React.createElement("div",{className:e},React.createElement(Ee,{buttonContent:this.renderProfileImage(),id:"nav-profile-info",overlayElement:be,overlayProps:t,showIcon:!1,trackingName:"profile"}))}return React.createElement("div",{className:e},React.createElement(Ee,{buttonContent:this.renderButton(),id:"nav-profile-info",overlayProps:{isBookDataEnabled:this.props.isBookDataEnabled},overlayElement:ke,trackingName:"profile"}))}}Pe.propTypes={isBookDataEnabled:PropTypes.bool,profile:O._.profile,size:PropTypes.oneOf(["mobile","tablet","default"])};const Ce=(0,r.$j)((e=>({profile:I.C.getSelector(e).getCurrentUserProfile()})))((0,P.$)(Pe));class Ie extends React.PureComponent{renderBookDataEnabledInteractions(){return this.props.isBookDataEnabled?React.createElement(React.Fragment,null,this.renderSearch(),React.createElement("div",{className:"notification-icon-wrapper"},React.createElement(ee,null))):null}renderSearch(){return"default"!==this.props.size?React.createElement("div",{className:"search-icon-wrapper","data-testid":"header-nav-search",onClick:this.props.handleSearchClick},React.createElement(R.J,{name:"search",size:"17px",color:"grey-50"})):React.createElement("div",{className:"nav-search-wrapper"},React.createElement(w,null))}render(){const e=x()("header-action-items",this.props.size);return React.createElement("div",{className:e},this.renderBookDataEnabledInteractions(),React.createElement("div",{className:"user-menu"},React.createElement(Ce,{isBookDataEnabled:this.props.isBookDataEnabled,size:this.props.size})))}}Ie.propTypes={isBookDataEnabled:PropTypes.bool,handleSearchClick:PropTypes.func,size:PropTypes.oneOf(["mobile","tablet","default"])},Ie.defaultProps={handleSearchClick:_.noop};var Oe=o(96772);class ve extends React.PureComponent{render(){const e=x()("header-explore-link",this.props.compact?"compact":"");return React.createElement(Oe.r,{className:e,href:this.props.href,role:"menuitem",onClick:this.props.onClick},React.createElement(R.J,{className:"link-icon",size:"20px",name:this.props.iconName,color:"red-110"}),React.createElement("div",{className:"link-text"},React.createElement("div",{className:"link-title"},this.props.displayText),React.createElement("div",{className:"link-subtext"},this.props.subText)))}}ve.propTypes={compact:PropTypes.bool,displayText:PropTypes.string.isRequired,href:PropTypes.string.isRequired,iconName:PropTypes.string.isRequired,subText:PropTypes.string.isRequired,onClick:PropTypes.func};class Be extends React.PureComponent{constructor(e){super(e),this.navTracking=new oe("browse menu"),this.defaultExploreLinks=[{href:"/ebook-deals/free",displayText:"Free Ebooks",iconName:"free_books",subText:"A full selection of free reads."},{href:"/new-releases-for-less",displayText:"New Releases for Less",iconName:"calendar-2",subText:"Recently released books at unbeatable prices."},{href:"/ebook-deals",displayText:"All Deals",iconName:"all_deals",subText:"Our full catalog of ebook bargains."}],this.authenticatedExploreLinks=_.compact([{href:"/ebook-deals/recommended",displayText:"Deals In Your Categories",iconName:"my_deals",subText:"Ebook deals tailored to your reading taste."},{href:"/popular-and-trending",displayText:"Popular & Trending",iconName:"popular",subText:"Best of the week according to our members."}]),this.wishlistSectionLinks=[{href:"/blog",displayText:"Our Blog",iconName:"blog",subText:"Book lists and articles from our resident experts."}],this.exploreLinks=this.defaultExploreLinks,this.wishlistLinks=this.wishlistSectionLinks,this.props.isLoggedIn&&(this.exploreLinks=_.concat(this.authenticatedExploreLinks,this.exploreLinks),this.wishlistLinks=_.concat([{href:"/for-your-wishlist",displayText:"This Week's Suggestions",iconName:"double_ribbons",subText:"Curated by our expert editors and readers. Grow your wishlist today."}],this.wishlistLinks)),this.onDropdownClick=this.onDropdownClick.bind(this)}onDropdownClick(e){e.stopPropagation()}renderExploreLinks(){const e="default"!==this.props.size;return _.map(this.exploreLinks,(t=>React.createElement("li",{key:t.href,role:"presentation"},React.createElement(ve,{compact:e,displayText:t.displayText,href:t.href,iconName:t.iconName,subText:t.subText,onClick:()=>{this.navTracking.click("explore link",{value:_.snakeCase(t.displayText)})}}))))}renderBrowseLinks(){return _.map(this.props.categories,(e=>React.createElement("li",{className:"link-wrapper",key:e.internalName,role:"presentation"},React.createElement(Oe.r,{className:"browse-link",href:e.categoryPagePath,role:"menuitem",onClick:()=>{this.navTracking.click("browse link",{value:_.snakeCase(e.displayName)})}},e.displayName))))}renderWishlistLinks(){const e="default"!==this.props.size;return _.map(this.wishlistLinks,(t=>React.createElement("li",{key:t.href,role:"presentation"},React.createElement(ve,{compact:e,displayText:t.displayText,href:t.href,iconName:t.iconName,subText:t.subText,onClick:()=>{this.navTracking.click("wishlist link",{value:_.snakeCase(t.displayText)})}}))))}renderExploreSection(){return React.createElement("div",{className:"explore-section"},React.createElement("h2",{className:"explore-section-subheader"},"Current Deals:"),React.createElement("title",{className:"sr-only",id:"nav-explore-section"},"Explore current deals on the site"),React.createElement("ul",{className:"explore-links",role:"menu","aria-labelledby":"nav-explore-section"},this.renderExploreLinks()))}renderBrowseSection(){return React.createElement("div",{className:"browse-section"},React.createElement("h2",{className:"browse-section-subheader",id:"nav-browse-section"},"Browse by Category:"),React.createElement("ul",{className:"browse-links",role:"menu","aria-labelledby":"nav-browse-section"},this.renderBrowseLinks(),React.createElement("li",{className:"link-wrapper",key:"explore-all",role:"presentation"},React.createElement(Oe.r,{className:"browse-link explore-all-link",href:"/categories",role:"menuitem",onClick:()=>{this.navTracking.click("browse link",{value:"explore_all"})}},"Explore all >"))))}renderWishlistSection(){return React.createElement("div",{className:"wishlist-section"},React.createElement("div",{className:"wishlist-section-content"},React.createElement("h2",{className:"wishlist-section-subheader"},"For Your Wishlist:"),React.createElement("title",{className:"sr-only",id:"nav-wishlist-section"},"Find books for your wishlist on the site"),React.createElement("ul",{className:"wishlist-links",role:"menu","aria-labelledby":"nav-wishlist-section"},this.renderWishlistLinks())))}render(){const e=x()(this.props.size,"header-explore-dropdown");return"default"===this.props.size?React.createElement("div",{className:e,"aria-labelledby":this.props.ariaLabelledBy},React.createElement("div",{className:"container",onClick:this.onDropdownClick},React.createElement("nav",{className:"dropdown-content","aria-label":"Browse BookBub"},this.renderExploreSection(),this.renderBrowseSection(),this.renderWishlistSection()))):React.createElement(te,{title:"Browse",hideDropdown:this.props.hideDropdown,className:e,onDropdownClick:this.onDropdownClick},React.createElement("nav",{className:"dropdown-content","aria-label":"Browse BookBub"},this.renderExploreSection(),this.renderWishlistSection(),this.renderBrowseSection()))}}Be.propTypes={ariaLabelledBy:PropTypes.string,categories:PropTypes.arrayOf(O._.category),hideDropdown:PropTypes.func,isLoggedIn:PropTypes.bool,size:PropTypes.oneOf(["default","tablet","mobile"])},Be.defaultProps={categories:[],isLoggedIn:!1,size:"default"},Be.trackingName="Header Explore Dropdown";const we=new class{constructor(){const e=$("#category-store-data").attr("data")||JSON.stringify([]);this.categories=JSON.parse(e)}findByInternalName(e){return _.find(this.categories,["internalName",e])}getCategories(){return this.categories}};class Le extends React.PureComponent{constructor(e){super(e),this.state={categories:[]}}componentDidMount(){const e=we.getCategories(),t=_.sortBy(_.take(e,7),"displayName");this.setState({categories:t})}getSize(){return this.props.windowMatchesXs?"mobile":this.props.windowMatchesSm?"tablet":"default"}render(){return React.createElement(Be,{categories:this.state.categories,hideDropdown:this.props.hideDropdown,isLoggedIn:this.props.isLoggedIn,size:this.getSize()})}}Le.propTypes={hideDropdown:PropTypes.func.isRequired,isLoggedIn:PropTypes.bool};const Ae=(0,P.$)(Le);Ae.trackingName="Header Explore Dropdown";class Ne extends React.PureComponent{constructor(e){super(e),this.navTracking=new oe("header"),this.state={onHomePage:"/launch"===window.location.pathname||"/"===window.location.pathname||"/ebook-deals/recommended"===window.location.pathname,onFreeEbooks:"/ebook-deals/free-ebooks"===window.location.pathname,onAllDeals:"/ebook-deals"===window.location.pathname},this.onLinkClick=this.onLinkClick.bind(this)}onLinkClick(e){const t=e.target.textContent.toLowerCase();return this.navTracking.click(t)}renderHome(){const e=x()("home-link",this.state.onHomePage?"active":"");return React.createElement(Oe.r,{className:e,href:"/",onClick:this.onLinkClick},React.createElement("div",null,"Home"))}renderBrowse(){return this.props.isBookDataEnabled?React.createElement("div",{className:"browse-link"},React.createElement(Ee,{id:"browse-button",buttonContent:React.createElement("div",null,"Browse"),overlayElement:Ae,overlayProps:{isLoggedIn:this.props.isLoggedIn},trackingName:"browse"})):null}renderFreeEbooks(){if(this.props.isLoggedIn)return null;const e=x()("free-ebooks-link",this.state.onFreeEbooks?"active":"");return React.createElement(Oe.r,{className:e,href:"/ebook-deals/free-ebooks",onClick:this.onLinkClick},React.createElement("div",null,"Free Ebooks"))}renderAllDeals(){if(this.props.isLoggedIn)return null;const e=x()("all-deals-link",this.state.onAllDeals?"active":"");return React.createElement(Oe.r,{className:e,href:"/ebook-deals",onClick:this.onLinkClick},React.createElement("div",null,"All Deals"))}render(){return React.createElement("div",{className:"header-explore-options"},this.renderHome(),this.renderBrowse(),this.renderFreeEbooks(),this.renderAllDeals())}}Ne.propTypes={isBookDataEnabled:PropTypes.bool,isLoggedIn:PropTypes.bool};var Me=o(86376);class De extends React.PureComponent{render(){return React.createElement(Me.P,{color:"red",width:"110px",height:"22px"})}}class Fe extends React.PureComponent{renderExplore(){return this.props.hideNavLinks?React.createElement("div",null):React.createElement(Ne,{isBookDataEnabled:this.props.isBookDataEnabled,isLoggedIn:this.props.isLoggedIn})}renderActionItems(){const e=this.props.compact?"tablet":"default";return this.props.isLoggedIn?React.createElement(Ie,{isBookDataEnabled:this.props.isBookDataEnabled,handleSearchClick:this.props.handleSearchClick,size:e}):React.createElement(H,{size:e,hideSignupButton:this.props.hideSignupButton})}renderNavSearch(){return this.props.searchToggleEnabled?React.createElement(w,null):null}render(){return React.createElement("div",{className:"desktop-header-nav"},React.createElement("div",{className:"desktop-header-section"},React.createElement("div",{className:"container"},React.createElement("div",{className:"desktop-header-content"},React.createElement(De,null),this.renderExplore(),this.renderActionItems()),this.renderNavSearch())))}}Fe.propTypes={hideNavLinks:PropTypes.bool,isLoggedIn:PropTypes.bool,isBookDataEnabled:PropTypes.bool,compact:PropTypes.bool,handleSearchClick:PropTypes.func,searchToggleEnabled:PropTypes.bool,hideSignupButton:PropTypes.bool},Fe.defaultProps={hideNavLinks:!1,hideSignupButton:!1};class xe extends React.PureComponent{renderExplore(){return!this.props.isBookDataEnabled&&this.props.isLoggedIn||this.props.hideNavLinks?null:React.createElement("div",{className:"mobile-explore-section"},React.createElement("div",{className:"container"},React.createElement("div",{className:"mobile-explore-content"},React.createElement(Ne,{isBookDataEnabled:this.props.isBookDataEnabled,isLoggedIn:this.props.isLoggedIn}))))}renderActionItems(){return this.props.isLoggedIn?React.createElement(Ie,{isBookDataEnabled:this.props.isBookDataEnabled,size:"mobile",handleSearchClick:this.props.handleSearchClick}):React.createElement(H,{size:"mobile",hideSignupButton:this.props.hideSignupButton})}renderNavSearch(){return this.props.searchToggleEnabled?React.createElement(w,null):null}render(){return React.createElement("div",{className:`mobile-header-nav ${this.props.isBookDataEnabled&&!this.props.hideNavLinks&&"mobile-book-data-enabled"} ${this.props.searchToggleEnabled&&"search-expanded"}`},React.createElement("div",{className:"mobile-header-primary"},React.createElement("div",{className:"container"},React.createElement("div",{className:"mobile-header-primary-content"},React.createElement(De,null),this.renderActionItems()))),this.renderNavSearch(),this.renderExplore())}}xe.propTypes={isLoggedIn:PropTypes.bool,isBookDataEnabled:PropTypes.bool,handleSearchClick:PropTypes.func,searchToggleEnabled:PropTypes.bool,hideNavLinks:PropTypes.bool,hideSignupButton:PropTypes.bool};const Ue={isLoggedIn:v.I.isAuthed(),bookDataEnabled:v.I.bookDataEnabled()},He="navigationHeaderNav",$e=(0,h.hp)(He,["SET_LOGGED_IN","SET_BOOK_DATA_ENABLED"]);(0,h.fn)(He,(0,m.Uy)(((e,t)=>{switch(t.type){case $e.SET_BOOK_DATA_ENABLED:return _.merge(e,{bookDataEnabled:t.payload.bookDataEnabled});case $e.SET_LOGGED_IN:return _.merge(e,{isLoggedIn:t.payload.isLoggedIn});default:return e}}),Ue));const Ke=e=>e[He];class ze extends React.PureComponent{constructor(e){super(e),this.state={showSearch:!1},this.toggleSearch=this.toggleSearch.bind(this)}componentDidUpdate(e,t){this.state.showSearch&&!t.showSearch&&$("#search").focus()}toggleSearch(){this.setState((e=>({showSearch:!e.showSearch})))}renderResponsiveNav(){return this.props.windowMatchesXs?React.createElement(xe,{hideNavLinks:this.props.hideNavLinks,isLoggedIn:this.props.isLoggedIn,isBookDataEnabled:this.props.isBookDataEnabled,handleSearchClick:this.toggleSearch,searchToggleEnabled:this.state.showSearch,hideSignupButton:this.props.hideSignupButton}):this.props.windowMatchesSm?React.createElement(Fe,{hideNavLinks:this.props.hideNavLinks,isLoggedIn:this.props.isLoggedIn,isBookDataEnabled:this.props.isBookDataEnabled,handleSearchClick:this.toggleSearch,searchToggleEnabled:this.state.showSearch,compact:!0,hideSignupButton:this.props.hideSignupButton}):React.createElement(Fe,{hideNavLinks:this.props.hideNavLinks,isLoggedIn:this.props.isLoggedIn,isBookDataEnabled:this.props.isBookDataEnabled,initialQuery:this.initialQuery,hideSignupButton:this.props.hideSignupButton})}render(){return React.createElement("div",{className:"header-nav-vc "+(this.props.impersonating?"impersonating":"")},this.renderResponsiveNav())}}ze.propTypes={hideNavLinks:PropTypes.bool,hideSignupButton:PropTypes.bool,isLoggedIn:PropTypes.bool,isBookDataEnabled:PropTypes.bool,impersonating:PropTypes.bool},ze.defaultProps={hideNavLinks:!1,hideSignupButton:!1,impersonating:!1};const je=(0,r.$j)((e=>{const t=(e=>({...Ke(e)}))(e);return{isLoggedIn:t.isLoggedIn,isBookDataEnabled:t.bookDataEnabled}}))((0,P.$)(ze));class Ge extends React.Component{constructor(e){super(e),this.state={}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?this.props.fallbackUI:this.props.children}}Ge.propTypes={fallbackUI:PropTypes.element},Ge.defaultProps={fallbackUI:null};class qe extends React.PureComponent{constructor(e){super(e);const t=document.getElementById("header-nav-app");this.hideNavLinks="true"===t.dataset.hideNavLinks,this.hideSignupButton="true"===t.dataset.hideSignupButton,this.impersonating="true"===t.dataset.impersonating}fallbackUI(){return React.createElement("div",{className:""},React.createElement("div",{className:"container fallback-header-nav"},React.createElement(De,null)))}render(){return React.createElement(Ge,{fallbackUI:this.fallbackUI()},React.createElement(r.zt,{store:h.tO},React.createElement(je,{hideNavLinks:this.hideNavLinks,hideSignupButton:this.hideSignupButton,impersonating:this.impersonating})))}}(0,s.L)("#header-nav-app",React.createElement(qe,null)),o(24378),o(10579),o(60024),o(28983),o(26602),o(69188),o(51143),o(13962),o(30005),o(99668);const Ve=(e,t=5)=>{if("test"===window.bubEnv&&window.mockRecaptchaInitDisabled)return null;let o=150;return"test"===window.bubEnv&&(o=10),t<=0?null:_.get(window,["grecaptcha","render"])?e():_.delay((()=>Ve(e,t-1)),o)};if(window.loadRecaptchaV2=function(e){e.endpoint&&e.buttonId&&(e.formId||e.onSubmit)||console.error("Missing required recaptcha helper argument");const t=_(e).keys().difference(["endpoint","buttonId","formId","onSubmit","initCallback","validationFunc","trackingFunc"]).value();if(_.isEmpty(t)||console.error(`Unknown arguments passed to loadRecaptchaV2: ${_.join(t,",")}`),!v.I.showCaptcha("v2",e.endpoint))return;const o=e.trackingFunc?e.trackingFunc:_.noop,s=e.initCallback?e.initCallback:_.noop,r=e.validationFunc?e.validationFunc:_.noop,i=t=>{if(!1!==r()){o();const s=document.getElementById(e.buttonId);s.disabled=!0,_.delay((()=>{s.disabled=!1}),1e3),e.onSubmit?e.onSubmit(t):document.getElementById(e.formId).submit()}};Ve((()=>{const t=grecaptcha.render(e.buttonId,{sitekey:v.I.captchaSitekey(),size:"invisible",callback:i,endpoint:e.endpoint});s&&s(t)}))},window.loadRecaptchaV3=function(e,t){v.I.showCaptcha("v3")&&Ve((()=>{grecaptcha.ready((()=>{grecaptcha.execute(v.I.captchaV3Sitekey(),{action:e}).then((e=>{document.getElementsByName("recaptcha_v3_token").forEach((t=>{t.value=e})),t&&t(e)}))}))}))},document.getElementById("static-page")){class e extends React.PureComponent{render(){return null}}const t=(0,L.Z)(e);(0,s.L)("#static-page",React.createElement(t,null))}var We=o(54728),Ye=o(7520),Qe=o(14611),Je=o(49987),Ze=o(55093),Xe=o(5700);class et extends React.Component{constructor(e){super(e),this.state={captchaLoaded:!1,emailValue:"",errorMessages:[]},this.onSubmit=this.onSubmit.bind(this),this.onSubmitCaptcha=this.onSubmitCaptcha.bind(this),this.onInitCaptchaV2=this.onInitCaptchaV2.bind(this),this.submitForm=this.submitForm.bind(this),this.handleChange=this.handleChange.bind(this),this.dismissModal=this.dismissModal.bind(this),this.emailForm=React.createRef()}componentDidMount(){this.trackSignup().show(),this.enableCaptcha()}handleChange(e){this.setState({emailValue:e.value,hasError:!1})}onInitCaptchaV2(){this.setState({captchaLoaded:!0})}onSubmit(){return this.state.captchaLoaded?null:this.submitForm()}onSubmitCaptcha(e){return document.getElementById("recaptcha-token-input").value=e,this.submitForm()}getUserSourceParam(){return Ze.x.queryParams.source}enableCaptcha(){this.state.captchaLoaded||(window.loadRecaptchaV2({buttonId:"join-overlay-popup-button",formId:"join-overlay-popup-form",endpoint:"user_signups#create_onsite",initCallback:this.onInitCaptchaV2,onSubmit:this.onSubmitCaptcha}),window.loadRecaptchaV3("join_overlay_popup"))}dismissModal(){this.trackSignup().dismiss(),Cookies.set("join-overlay-dismissed",!0,{path:"/",expires:999}),Te.P.hide()}trackSignup(){return new Qe.Z("JoinOverlayPopup")}submitForm(){const e=this.state.emailValue;return Xe.z.isValidEmail({value:e})?(this.setState({errorMessages:[]}),this.trackSignup().signup(e),this.emailForm.current.submit()):this.setState({errorMessages:["Please enter a valid email address."],hasError:!0})}renderPopupHeader(){const e=this.props.bookTitle?`like "${this.props.bookTitle}"`:"";return React.createElement("div",null,React.createElement("div",{className:"popup-header-section"},React.createElement("p",{className:"popup-header-text"},"Never miss a deal!"),React.createElement("img",{className:"popup-image",src:Je.a.getOptimizedImage("/bookbub/image/Charcoal_Stroke.png"),alt:"charcoal stroke"})),React.createElement("p",{className:"popup-subheader-text"},"Join BookBub to get alerts about free and bargain books ",e," in your inbox."))}renderFormSection(){return React.createElement("form",{action:"/user_signups/onsite",method:"post",className:"form-section",id:"join-overlay-popup-form",ref:this.emailForm},React.createElement("input",{type:"hidden",name:"utf8",value:"â"}),React.createElement("input",{type:"hidden",name:"authenticity_token",value:v.I.csrfToken()}),React.createElement("input",{type:"hidden",name:"return_after_onboarding",value:"true"}),React.createElement("input",{type:"hidden",name:"source",value:this.getUserSourceParam()}),React.createElement("input",{type:"hidden",name:"g-recaptcha-response",id:"recaptcha-token-input"}),React.createElement("input",{type:"hidden",name:"recaptcha_v3_token"}),React.createElement(Ye.II,{name:"user[email_address]",inputId:"user_email_address",type:"email",placeholder:"Enter your email address...",value:this.state.emailValue,onChange:this.handleChange,hasChanged:this.state.hasError,errorMessages:this.state.errorMessages}),React.createElement(U.G,{bubStyle:"lava",full:!0,size:"large",label:"Get Started",onClick:this.onSubmit,id:"join-overlay-popup-button"}))}render(){return React.createElement(We.O,{show:!0,headerDismissButton:!0,hideClose:!0,onHide:this.dismissModal,id:"join-overlay-popup-modal",modalStyle:"unstyled",dialogClassName:"modal-md"},React.createElement("div",{className:"join-overlay-popup"},React.createElement("div",{className:"popup-details"},this.renderPopupHeader(),React.createElement("div",{className:"input-section"},this.renderFormSection()),React.createElement("div",{className:"external-links"},"Already a member? ",React.createElement("a",{className:"signin-link",href:"/users/sign_in"},"Sign In")))))}}et.propTypes={bookTitle:PropTypes.string},et.trackingName="Join Overlay Modal";const tt=et;$((()=>{const e="enabled"!==Cookies.get("optmnstr"),t=function(){const t=(e||!window.optInMonsterCampaignsPresent)&&!Cookies.get("om-sign-up-overlay");if(_.isEmpty($(".deals-signup-gate"))&&_.isEmpty($(".sign-up-overlay-vc"))&&!_.isEmpty($("#join-overlay-modal"))&&_.isEmpty($(".deal-modal-container"))&&t&&_.isEmpty($(".bub-auth-modal"))){const e=document.querySelector("#join-overlay-modal"),t=JSON.parse(e.getAttribute("bookTitle"));Te.P.setAndShow(tt,{bookTitle:t})}},o=$("body").data("user-id"),s=Cookies.get("BookBubOverbox")||Cookies.get("BookBubSub")||Cookies.get("join-overlay-dismissed"),r=document.location.search.match(/no_overlay=true/)||document.location.search.match(/email_share/)&&!document.location.search.match(/source=email_share/)||document.location.search.match(/social_share/)||document.location.search.match(/email=other_retailers/)||document.location.search.match(/email=buy/)||document.location.search.match(/hsc=t/);if(!o&&!s&&!r){const e="test"===window.bubEnv?0:15e3;window.setTimeout(t,e)}})),o(51545)},26602:function(){$((()=>{bubEvents.trackPageVisit()}))},30005:function(){$((()=>{bubEvents.trackSignInError()}))},13962:function(){$((()=>{bubEvents.trackSignInReroute()}))},60024:function(){if(bb_use_external_scripts){const e=document.createElement("div");e.id="fb-root",document.body.appendChild(e),window.fbAsyncInit=function(){FB.init({appId:window.facebookAppId,xfbml:!1,version:"v18.0"})};const t=document.createElement("script");t.async=!0,t.defer=!0,t.crossOrigin="anonymous",t.src="https://connect.facebook.net/en_US/sdk.js",document.head.appendChild(t)}},10579:function(){var e,t,o,s,r,i;bb_use_external_scripts&&(window.twttr=(t="script",o="twitter-wjs",r=(e=document).getElementsByTagName(t)[0],i=window.twttr||{},e.getElementById(o)||((s=e.createElement(t)).id=o,s.src="https://platform.twitter.com/widgets.js",r.parentNode.insertBefore(s,r),i._e=[],i.ready=function(e){i._e.push(e)}),i))},26076:function(e,t,o){"use strict";o.d(t,{t:function(){return d}});var s=o(27783),r=o(87679),i=o(43912),a=o(76189),n=o(48049),l=o(43371),p=o(75820),c=o(22430);const d=new class{fetchOnboardingNotificationSuccess(){return p.tO.dispatch({type:c.h.actionTypes.FETCH_ONBOARDING_NOTIFICATION_SUCCESS,payload:{}})}fetchBooksForPageSuccess(e){return p.tO.dispatch({type:c.h.actionTypes.FETCH_BOOKS_FOR_PAGE_SUCCESS,payload:e})}initialBooksForListSuccess(e){return p.tO.dispatch({type:c.h.actionTypes.INITIAL_BOOKS_FOR_LIST_SUCCESS,payload:e})}movedBookToList(e){return p.tO.dispatch({type:c.h.actionTypes.MOVED_BOOK_TO_LIST,payload:e})}movedBookFromSuggestions(e){return p.tO.dispatch({type:c.h.actionTypes.MOVED_BOOK_FROM_SUGGESTIONS,payload:e})}removedBookFromList(e){return p.tO.dispatch({type:c.h.actionTypes.REMOVED_BOOK_FROM_LIST,payload:e})}firstTimeInitFetch(e,t=!1){return n.$.initBookmarks(e,t).then((t=>{const o="uncategorized"===e.list?_.merge(t,{listSlug:"uncategorized"}):t;this.firstTimeInitSuccess(o)}))}firstTimeInitSuccess(e){return s.E.setAdditionalBookListData(e.additionalBookListData),s.E.initialBooksForListSuccess(e),p.tO.dispatch({type:c.h.actionTypes.FIRST_TIME_INIT_SUCCESS,payload:e})}fetchOnboardingNotification(e){const t=`book-list-${e}-onboarding`;return a.c.getNotificationView({id:t}).then(this.fetchOnboardingNotificationSuccess),p.tO.dispatch({type:c.h.actionTypes.FETCH_ONBOARDING_NOTIFICATION,payload:{}})}fetchNextBookForPage(e,t){return n.$.fetchNextBookForPage(e,t).then(this.fetchNextBookForPageSuccess.bind(this,t))}fetchNextBookForPageSuccess(e,t){return t&&(t.page_number=e,r.Z.appendBook(t)),p.tO.dispatch({type:c.h.actionTypes.FETCH_NEXT_BOOK_FOR_PAGE_SUCCESS,payload:{book:t}})}queryUpdated(e){const t=e.list;return s.E.initialBooksForListFetch(t,e.page,e.sort),this.setFlashMessageData(void 0),i.$.setMessages([]),p.tO.dispatch({type:c.h.actionTypes.QUERY_UPDATED,payload:{query:e}})}fetchBookSuggestions(){return l.M.getWishlistSuggestions()}setFlashMessageData(e){p.tO.dispatch({type:c.h.actionTypes.SET_FLASH_MESSAGE_DATA,payload:{messageData:e}})}}},22430:function(e,t,o){"use strict";o.d(t,{h:function(){return c}});var s=o(93513),r=o(30845),i=o(75820);const a="bookmarks",n=(0,i.hp)(a,["FIRST_TIME_INIT_SUCCESS","INITIAL_BOOKS_FOR_LIST_SUCCESS","FETCH_BOOKS_FOR_PAGE_SUCCESS","FETCH_NEXT_BOOK_FOR_PAGE_SUCCESS","FETCH_ONBOARDING_NOTIFICATION","FETCH_ONBOARDING_NOTIFICATION_SUCCESS","QUERY_UPDATED","MOVED_BOOK_TO_LIST","REMOVED_BOOK_FROM_LIST","MOVED_BOOK_FROM_SUGGESTIONS","SET_FLASH_MESSAGE_DATA"]);(0,i.fn)(a,(0,s.Uy)(((e,t)=>{switch(t.type){case n.FIRST_TIME_INIT_SUCCESS:return e.didFirstTimeLoad=!0,e.query.list=t.payload.listSlug,e.pageSize=t.payload.pageSize,e.uncategorizedCount=t.payload.uncategorizedCount,e;case n.INITIAL_BOOKS_FOR_LIST_SUCCESS:return e.currentPage=t.payload.page,e.bookIds=_.map(t.payload.books,"id"),e.booksWithInitialSlugs=_.filter(t.payload.books,"bookListSlug"),e.originalBookIds=_.map(t.payload.books,"id"),e;case n.FETCH_BOOKS_FOR_PAGE_SUCCESS:return e.currentPage=t.payload.page,e.query.list=t.payload.listSlug,e.bookIds=_.map(t.payload.books,"id"),e.originalBookIds=_.map(t.payload.books,"id"),e.booksWithInitialSlugs=_.filter(t.payload.books,"bookListSlug"),e;case n.FETCH_NEXT_BOOK_FOR_PAGE_SUCCESS:return t.payload.book&&_.merge(e,{bookIds:t.payload.book}),e;case n.FETCH_ONBOARDING_NOTIFICATION:return e.fetchingOnboardingNotification=!0,e;case n.FETCH_ONBOARDING_NOTIFICATION_SUCCESS:return e.fetchingOnboardingNotification=!1,e;case n.QUERY_UPDATED:return e.currentPage=1,e.query=t.payload.query,e;case n.MOVED_BOOK_TO_LIST:return t.payload.addToBookIds?e.bookIds=_.concat([t.payload.bookId],e.bookIds):e.bookIds=_.without(e.bookIds,t.payload.bookId),e;case n.MOVED_BOOK_FROM_SUGGESTIONS:return e.bookIds=_.concat([t.payload.bookId],e.bookIds),e;case n.REMOVED_BOOK_FROM_LIST:return e.bookIds=_.without(e.bookIds,t.payload.bookId),e;case n.SET_FLASH_MESSAGE_DATA:return e.messageData=t.payload.messageData,e;default:return e}}),{query:{},bookIds:[],originalBookIds:[],currentPage:1,didFirstTimeLoad:!1,fetchingOnboardingNotification:!0,uncategorizedCount:0}));const l=e=>e[a],p=e=>_.some(e,(e=>e.collectionCount>0)),c={actionTypes:n,getSelector:e=>{const t={anyBookmarksExist:p};return{...l(e),...t}},defaultOrderForList:e=>e===r.yY.DEFAULT_LIST_SLUG?r.yY.DEFAULT_LIST_SORT_WISHLIST:r.yY.DEFAULT_LIST_SORT_ALL,DEFAULT_LIST_SLUG:r.yY.DEFAULT_LIST_SLUG}},95130:function(e,t,o){"use strict";o.d(t,{M:function(){return l}});var s=o(28628);const r={getReactions(){return s.B.request({method:"GET",url:"/reactions"})},getBookReactions(e,t){return s.B.request({method:"GET",url:"/book_reactions",data:{book_id:t,user_id:e}})},getBookReactionsSummaries(e){return s.B.request({method:"GET",url:"/book_reactions/summaries",data:{book_id:e}})},create(e,t,o){return s.B.request({method:"POST",url:"/book_reactions",data:JSON.stringify({book_id:e,reaction_id:t,review_text:o})})},delete(e,t){return s.B.request({method:"DELETE",url:"/book_reactions",data:JSON.stringify({book_id:e,reaction_id:t})})}};var i=o(87679),a=o(75820),n=o(6055);const l=new class{constructor(){this.storeBookReaction=this.storeBookReaction.bind(this),this.storeBookReactions=this.storeBookReactions.bind(this)}storeBookReaction(e){a.tO.dispatch({type:n.v.actionTypes.STORE_BOOK_REACTION,payload:{bookReaction:e}})}removeBookReaction(e){a.tO.dispatch({type:n.v.actionTypes.REMOVE_BOOK_REACTION,payload:{bookReaction:e}})}storeReactions(e){const{reactions:t}=e;a.tO.dispatch({type:n.v.actionTypes.STORE_REACTIONS,payload:{reactions:t}})}storeBookReactionsSummaries(e){const{bookReactionsSummaries:t}=e;a.tO.dispatch({type:n.v.actionTypes.STORE_BOOK_REACTIONS_SUMMARIES,payload:{bookReactionsSummaries:t}})}storeBookReactions(e){a.tO.dispatch({type:n.v.actionTypes.STORE_BOOK_REACTIONS,payload:{bookReactions:e.bookReactions}})}clearBookReactions(e){a.tO.dispatch({type:n.v.actionTypes.CLEAR_BOOK_REACTIONS,payload:{userBook:e}})}getReactions(){return r.getReactions().then(this.storeReactions)}getBookReactions(e,t){return r.getBookReactions(e,t).then(this.storeBookReactions)}getBookReactionsSummaries(e){return r.getBookReactionsSummaries(e).then(this.storeBookReactionsSummaries)}create(e){return r.create(e.bookId,e.reactionId).then((t=>(this.storeBookReaction(t),i.Z.movedBookToList({bookId:t.bookId,prevListSlug:_.get(e,"bookListSlug"),newListSlug:"finished"}),t)))}delete({bookId:e,reactionId:t,userId:o}){return r.delete(e,t).then((s=>{this.removeBookReaction(_.merge({bookId:e,reactionId:t,userId:o},s))}))}}},76197:function(e,t,o){"use strict";o.d(t,{t:function(){return c}});var s=o(28628);const r={get(e){return s.B.request({method:"GET",url:`/book_recommendations/${e}`})},create(e){return s.B.request({method:"POST",url:`/book_recommendations/${e}`})},delete(e){return s.B.request({method:"DELETE",url:`/book_recommendations/${e}`})}};var i=o(87679),a=o(57997),n=o(16174),l=o(75820),p=o(66055);const c=new class{constructor(){this.storeBookRecommendation=this.storeBookRecommendation.bind(this),this.toggledCheckbox=this.toggledCheckbox.bind(this)}storeBookRecommendation(e){l.tO.dispatch({type:p.R.actionTypes.STORE_BOOK_RECOMMENDATION,payload:{bookRecommendation:e}})}storeBookRecommendations(e){l.tO.dispatch({type:p.R.actionTypes.STORE_BOOK_RECOMMENDATIONS,payload:{bookRecommendations:e.bookRecommendations}})}clearBookRecommendation(e){const{userId:t,bookId:o}=e;l.tO.dispatch({type:p.R.actionTypes.CLEAR_BOOK_RECOMMENDATION,payload:{userId:t,bookId:o}})}togglingCheckbox(e){l.tO.dispatch({type:p.R.actionTypes.TOGGLING_CHECKBOX,payload:{bookId:e}})}toggledCheckbox(e){l.tO.dispatch({type:p.R.actionTypes.TOGGLED_CHECKBOX,payload:{bookId:e.bookId}})}getBookRecommendation(e){return this.togglingCheckbox(e),r.get(e).then((e=>{this.toggledCheckbox(e),this.storeBookRecommendation(e)}))}toggleCheckbox(e,t,o){return this.togglingCheckbox(e),(t?r.create:r.delete)(e).then((s=>{t&&i.Z.movedBookToList({bookId:e,prevListSlug:o,newListSlug:"finished"}),this.toggledCheckbox(s),this.storeBookRecommendation(s)}))}prepOpenRecommendBookModal(e,t){n.Q.featureBookMention(t,e),a.H.activeBookStoryForm(t),a.H.prepEdit(t,e)}}},75073:function(e,t,o){"use strict";o.d(t,{d:function(){return k}});var s=o(75820),r=o(69923),i=o(6846),a=o(71407);const n={authenticationParams(e){const t={timestamp:Math.floor(Date.now()/1e3)};return _.merge(t,e),(0,a.t)({method:"GET",url:"/cloudinary_param",data:t})},upload(e,t){return(0,a.t)({method:"POST",url:"https://api.cloudinary.com/v1_1/bookbub/image/upload",data:_.merge({file:e},t)})},coverImageThumbnailURL(e,t){let o;return o="undefined"===t?`https://res.cloudinary.com/bookbub/image/upload/c_fit,f_auto,h_100,q_45,w_100/${e}`:`https://res.cloudinary.com/bookbub/image/upload/${t}/${e}`,o}},l=new class{uploadImage(e){return n.authenticationParams().then((t=>n.upload(e,t)))}};var p=o(93513);const c="imageEditor",d=(0,s.hp)(c,["SET_SCALE","SET_TEMP_IMAGE","SET_IMAGE_EDITING","SET_IMAGE_UPLOADING"]);(0,s.fn)(c,(0,p.Uy)(((e,t)=>{switch(t.type){case d.SET_SCALE:return e.scale=t.payload.scale,e;case d.SET_TEMP_IMAGE:return e.tempImage=t.payload.image,e;case d.SET_IMAGE_EDITING:return e.imageEditing=t.payload.editing,e;case d.SET_IMAGE_UPLOADING:return e.imageUploading=t.payload.uploading,e;default:return e}}),{scale:1.2,tempImage:null,imageUploading:!1,imageEditing:!1}));const u=e=>e[c],h={actionTypes:d,getSelector:e=>({...u(e)})},m=new class{constructor(){this.setImageUploading=this.setImageUploading.bind(this)}setScale(e){s.tO.dispatch({type:h.actionTypes.SET_SCALE,payload:{scale:e}})}setTempImage(e){s.tO.dispatch({type:h.actionTypes.SET_TEMP_IMAGE,payload:{image:e}})}setImageUploading(e){s.tO.dispatch({type:h.actionTypes.SET_IMAGE_UPLOADING,payload:{uploading:e}})}setImageEditing(e){s.tO.dispatch({type:h.actionTypes.SET_IMAGE_EDITING,payload:{editing:e}})}resetImage(){return this.setImageEditing(!1),this.setScale(1.2),this.setTempImage(null),$("input#file-upload").val(""),!0}};var g=o(10141),y=o(17966),b=o(53893);const k=new class{init(e){return i.H.get(e).then(this.initSuccess)}updateProfile(e){const t=_.pick(e,["id","name","username","tagline","biography","private"]);return this.setIsSaving(!0),i.H.update(t).then((e=>(this.setIsSaving(!1),this.setCurrentUserProfile(e),this.setActiveProfile(e),e)),(e=>(this.setIsSaving(!1),this.handleErrors(e),e)))}uploadImage(e){return l.uploadImage(e.image.toDataURL()).then((t=>this.saveImage({id:e.id,image:t})))}saveImage(e){return i.H.update({id:e.id,imageUrl:e.image.secure_url}).then(this.setImageUrl).then(m.setImageUploading(!1))}getAuthorFollowSuggestions(e){return i.H.suggestions(e).then((t=>{this.addProfileCollection({[e.collectionName]:t}),this.setCollectionMetadata({[e.collectionName]:t})}))}getMoreAuthorFollowSuggestions(e){this.setLoadingMore(!0),this.getAuthorFollowSuggestions(e).then(this.getMoreAuthorFollowSuggestionsSuccess.bind(this))}getMoreAuthorFollowSuggestionsSuccess(){this.setLoadingMore(!1)}searchProfiles(e,t){const o={};o[t]="loading",this.setCollectionStatus(o);const s={};return i.H.search(e).then((o=>{s[t]=o,e.from&&e.from>0?this.addProfileCollection(s):this.setProfileCollection(s),this.setCollectionMetadata(s);let r=1;e.from&&e.size&&e.from>0&&e.size>0&&(r=e.from/e.size+1),bubEvents.track("Profile","Search",{label:"Query",value:e.search,page:r,relationType:t,totalResults:o.profiles.length})}),(()=>{o[t]="failed",this.setCollectionStatus(o)}))}handleErrors(e,t){return 409===e.status?g.i.setErrorMessage({name:"username",errorMessage:e.responseJSON.errors,formId:t}):g.i.setErrorMessage({name:"username",errorMessage:"Oops! We encountered an error. Please try again."})}getTopRecommenders(e){return i.H.getTopRecommenders(e).then((e=>{this.addProfileCollection({topRecommenders:e}),this.setCollectionMetadata({topRecommenders:e})}))}loadFollowerCount(e){return y.K.followerCount(e).then(this.followerCountLoaded)}fetchSimilarAuthors(e){return b.S.similarAuthors(e).then((e=>(this.addSimilarAuthorProfiles(e),e.profiles)))}removeAuthorProfileSuggestion(e,t){return b.S.removeAuthorSuggestion(t).then((()=>{this.removeProfile(e)}))}fetchAuthorsForBook(e){return b.S.fetchAuthorsForBook({bookId:e}).then((e=>(this.addProfiles(e),e.profiles)))}initSuccess(){s.tO.dispatch({type:r.C.actionTypes.INIT_SUCCESS,payload:{}})}setImageUrl(e){s.tO.dispatch({type:r.C.actionTypes.SET_IMAGE_URL,payload:{profile:e}})}setCurrentUserProfile(e){s.tO.dispatch({type:r.C.actionTypes.SET_CURRENT_USER_PROFILE,payload:{profile:e}})}setActiveProfile(e){s.tO.dispatch({type:r.C.actionTypes.SET_ACTIVE_PROFILE,payload:{profile:e}})}setProfileCollection(e){s.tO.dispatch({type:r.C.actionTypes.SET_PROFILE_COLLECTION,payload:{result:e}})}updateProfileCollection(e){s.tO.dispatch({type:r.C.actionTypes.UPDATE_PROFILE_COLLECTION,payload:{profile:e}})}setCollectionStatus(e){s.tO.dispatch({type:r.C.actionTypes.SET_COLLECTION_STATUS,payload:{status:e}})}setCollectionMetadata(e){s.tO.dispatch({type:r.C.actionTypes.SET_COLLECTION_METADATA,payload:{result:e}})}addProfiles(e){s.tO.dispatch({type:r.C.actionTypes.ADD_PROFILES,payload:{profiles:e.profiles}})}addProfileCollection(e){s.tO.dispatch({type:r.C.actionTypes.ADD_PROFILE_COLLECTION,payload:{result:e}})}addSimilarAuthorProfiles(e){s.tO.dispatch({type:r.C.actionTypes.ADD_SIMILAR_AUTHOR_PROFILES,payload:{profiles:e.profiles}})}setProfileSearchQuery(e){s.tO.dispatch({type:r.C.actionTypes.SET_PROFILE_SEARCH_QUERY,payload:{profileSearchQuery:e}})}setIsSaving(){s.tO.dispatch({type:r.C.actionTypes.SET_IS_SAVING,payload:{}})}followerCountLoaded(e){s.tO.dispatch({type:r.C.actionTypes.FOLLOWER_COUNT_LOADED,payload:{profileWithFollowerCount:e}})}followingCountLoaded(e){s.tO.dispatch({type:r.C.actionTypes.FOLLOWING_COUNT_LOADED,payload:{profileWithFollowingCount:e}})}postCountLoaded(e){s.tO.dispatch({type:r.C.actionTypes.POST_COUNT_LOADED,payload:{profileWithPostCount:e}})}removeProfile(e){s.tO.dispatch({type:r.C.actionTypes.REMOVE_PROFILE,payload:{profileId:e}})}bookStoryCreated(){s.tO.dispatch({type:r.C.actionTypes.BOOK_STORY_CREATED,payload:{}})}bookStoryDeleted(){s.tO.dispatch({type:r.C.actionTypes.BOOK_STORY_DELETED,payload:{}})}triggeringFollow(e){s.tO.dispatch({type:r.C.actionTypes.TRIGGERING_FOLLOW,payload:{profileId:e}})}toggledFollow(e){s.tO.dispatch({type:r.C.actionTypes.TOGGLED_FOLLOW,payload:{profileId:e}})}setLoadingMore(e){return s.tO.dispatch({type:r.C.actionTypes.SET_LOADING_MORE,payload:{loadingMore:e}})}}},94480:function(e,t,o){"use strict";o.d(t,{j:function(){return A}});var s=o(88251),r=o(57632),i=o(69923),a=o(93513),n=o(75820);const l="recaptcha",p=(0,n.hp)(l,["SET_PASSED","SET_TOKEN"]);(0,n.fn)(l,(0,a.Uy)(((e,t)=>{switch(t.type){case p.SET_PASSED:return e.passedEndpoints[t.payload.endpoint]=t.payload.passed,e;case p.SET_TOKEN:return e.endpointTokens[t.payload.endpoint]=t.payload.token,e;default:return e}}),{passedEndpoints:{},endpointTokens:{}}));const c=e=>e[l],d={actionTypes:p,getSelector:e=>({...c(e)})};var u=o(78405),h=o(83141);class m extends React.PureComponent{render(){return this.props.recaptchaEnabled?React.createElement("div",null,this.props.children):this.props.children}}function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},g.apply(this,arguments)}m.propTypes={recaptchaEnabled:PropTypes.bool};class y extends React.PureComponent{constructor(e){super(e),this.state={recaptchaLoaded:!1},this.onClick=this.onClick.bind(this),this.triggerFollow=this.triggerFollow.bind(this),this.onRecaptchaSubmit=this.onRecaptchaSubmit.bind(this),this.initRecaptcha=this.initRecaptcha.bind(this)}componentDidMount(){this.enableCaptcha()}onClick(){return(this.props.userAuthed||this.props.triggerSignIn)&&this.triggerFollow(),null}onRecaptchaSubmit(e){return this.props.triggerFollow(e)}initRecaptcha(){this.setState({recaptchaLoaded:!0})}enableCaptcha(){this.props.userAuthed&&this.props.recaptchaEnabled&&window.loadRecaptchaV2({buttonId:this.props.buttonId,endpoint:this.props.recaptchaEndpoint,initCallback:this.initRecaptcha,onSubmit:this.onRecaptchaSubmit})}triggerFollow(){return this.props.userAuthed?this.props.recaptchaEnabled&&this.state.recaptchaLoaded?null:this.props.triggerFollow():this.props.triggerSignIn()}label(){return this.props.iconOnly?null:this.props.isFollowing?"Following":"Follow"}hoverLabel(){return this.props.iconOnly?null:this.props.isFollowing?"Unfollow":"Follow"}icon(){return this.props.isFollowing?React.createElement(h.J,{name:"check",color:"grey-70"}):React.createElement(h.J,{name:"plus",color:"white"})}hoverIcon(){return this.props.isFollowing?React.createElement(h.J,{name:"x",color:"red-110"}):React.createElement(h.J,{name:"plus",color:"white"})}actionProps(){const e={};return this.props.userAuthed||this.props.triggerSignIn?e.onClick=this.onClick:e.href=this.props.signinUrl,e}bubStyle(){return this.props.isFollowing?"lava-white":"lava"}renderButton(){const e=this.props.isFollowing?"following":"follow";return React.createElement("span",{className:`follow-button ${e}`},React.createElement(u.Q,g({active:this.props.isFollowing,onClick:this.onClick,label:this.label(),hoverLabel:this.hoverLabel(),icon:this.icon(),hoverIcon:this.hoverIcon(),tooltipText:this.props.tooltipText,tooltipPlacement:"right",bubStyle:this.bubStyle(),isLoading:this.props.isLoading,id:this.props.buttonId,ariaLabel:this.props.ariaLabel},this.actionProps())))}render(){return React.createElement(m,{recaptchaEnabled:this.props.recaptchaEnabled},this.renderButton())}}y.propTypes={buttonId:PropTypes.string,iconOnly:PropTypes.bool,isFollowing:PropTypes.bool,triggerFollow:PropTypes.func.isRequired,triggerSignIn:PropTypes.func,userAuthed:PropTypes.bool,signinUrl:PropTypes.string,hideTooltip:PropTypes.bool,isLoading:PropTypes.bool,recaptchaEnabled:PropTypes.bool,recaptchaEndpoint:PropTypes.string,tooltipText:PropTypes.string,ariaLabel:PropTypes.string},y.defaultProps={iconOnly:!1,isFollowing:!1,userAuthed:!1,signinUrl:"/users/sign_in_and_return",hideTooltip:!1};var b=o(66227),k=o(43912),T=o(75073),S=o(17966),f=o(96772);const E=new class{triggeringFollow(e){return T.d.triggeringFollow(e),e}toggledFollow(e){return T.d.toggledFollow(e),e}loadMoreFollowers(e,t,o){this.loadMoreFollows(e,t,o,S.K.listProfileFollowers)}loadMoreFollowings(e,t,o){this.loadMoreFollows(e,t,o,S.K.listProfileFollowings)}loadMoreFollows(e,t,o,s){const r={};return r[o]="loading",T.d.setCollectionStatus(r),s(e,t).then((e=>{const t={};return t[o]=e,T.d.addProfileCollection(t),T.d.setCollectionMetadata(t)}))}followProfile(e,t){return S.K.followProfile(e,t).then((e=>{T.d.updateProfileCollection(e)})).catch((e=>{const t=React.createElement(f.r,{href:"/contact/new",target:"_blank",rel:"noopener noreferrer"},"contact our Support team");let o;_.get(e,["responseJSON","tooManyFollows"])?o=React.createElement(React.Fragment,null,"You can follow up to 5,000 people on BookBub. If you'd like to follow this profile, we'd recommend unfollowing another account first. For more assistance, please ",t,"."):_.get(e,["responseJSON","newAccountFollowLimit"])?o=React.createElement(React.Fragment,null,"You've reached your daily limit for following accounts. If you think there's been an error, please ",t,"."):(bubEvents.track("Recaptcha Enforced Warning","profile-follow"),o=React.createElement(React.Fragment,null,"Oops, something went wrong! Please refresh the page and try again. For more assistance, please ",t,".")),k.$.setMessages([{level:"warning",text:o}])}))}unfollowProfile(e){return S.K.unfollowProfile(e).then((t=>(T.d.updateProfileCollection(_.merge({id:e},t)),t)))}};var R=o(51321);const P=new class{setPassed(e,t){n.tO.dispatch({type:d.actionTypes.SET_PASSED,payload:{endpoint:e,passed:t}})}setToken(e,t){n.tO.dispatch({type:d.actionTypes.SET_TOKEN,payload:{endpoint:e,token:t}})}};var C=o(9971),I=o(76397);class O extends React.PureComponent{constructor(e){super(e),this.buttonId=`profile-follow-button-${_.get(e,"targetProfile.id")}-${(0,r.Z)()}`,this.toggleFollow=this.toggleFollow.bind(this),this.triggerFollow=this.triggerFollow.bind(this),this.defaultTriggerSignIn=this.defaultTriggerSignIn.bind(this),this.triggerSignIn=this.triggerSignIn.bind(this),this.tooltipText=this.tooltipText.bind(this)}toggleFollow(e){return this.props.isFollowing?E.unfollowProfile(this.props.targetProfile.id).then(this.props.onFollowCallback):E.followProfile(this.props.targetProfile.id,e).then(this.props.onFollowCallback)}trackFollowToggle(){const e=this.props.isFollowing?"Unfollow":"Follow";return bubEvents.track("Follow Button",e,this.trackingEventProps())}trackingEventProps(){const e={authorId:_.get(this.props,"authorId"),profileId:_.get(this.props,"targetProfile.id")};return _.merge({},e,this.props.trackingEventProps)}triggerFollow(e){E.triggeringFollow(this.props.targetId),e&&P.setToken(O.RECAPTCHA_ENDPOINT,e);const t=e||this.props.gRecaptchaResponse;return this.trackFollowToggle(),this.toggleFollow(t).then((()=>{P.setPassed(O.RECAPTCHA_ENDPOINT,!0),E.toggledFollow(this.props.targetId)}))}defaultTriggerSignIn(){return R.P.setAndShow(b.P)}triggerSignIn(){return(this.props.triggerSignIn||this.defaultTriggerSignIn)()}tooltipText(){if(this.props.hideTooltip||!BrowserAbilities.hoverEnabled())return"";let e=this.props.isFollowing?"Unfollow":"Follow";return _.get(this.props.targetProfile,"username")?e=`${e} @${this.props.targetProfile.username}`:_.get(this.props.targetProfile,"name")&&(e=`${e} ${this.props.targetProfile.name}`),e}render(){const e=this.props.authorId||_.get(this.props.targetProfile,"authorId");if(this.props.userAuthorId&&this.props.userAuthorId===e)return null;const t=`${this.props.isFollowing?"Unfollow":"Follow"} ${this.props.targetProfile.displayName}`;return React.createElement(y,{iconOnly:this.props.iconOnly,isFollowing:this.props.isFollowing,triggerFollow:this.triggerFollow,triggerSignIn:this.triggerSignIn,userAuthed:this.props.userAuthed,signinUrl:this.props.signinUrl,hideTooltip:this.props.hideTooltip,isLoading:this.props.isLoading,recaptchaEnabled:this.props.recaptchaEnabled,buttonId:this.buttonId,recaptchaEndpoint:O.RECAPTCHA_ENDPOINT,tooltipText:this.tooltipText(),ariaLabel:t})}}O.propTypes={authorId:PropTypes.number,hideTooltip:PropTypes.bool,iconOnly:PropTypes.bool,isFollowing:PropTypes.bool,isLoading:PropTypes.bool,signinUrl:PropTypes.string,targetId:PropTypes.number,targetProfile:I._.profile,triggerSignIn:PropTypes.func,userAuthed:PropTypes.bool,userAuthorId:PropTypes.number,trackingEventProps:PropTypes.object,onFollowCallback:PropTypes.func,recaptchaEnabled:PropTypes.bool,gRecaptchaResponse:PropTypes.string},O.defaultProps={authorId:void 0,hideTooltip:!1,iconOnly:!1,isFollowing:!1,isLoading:!1,signinUrl:"/users/sign_in_and_return",targetId:null,targetProfile:null,userAuthed:!1,userAuthorId:void 0,onFollowCallback:_.noop},O.RECAPTCHA_ENDPOINT="social_api/profile_follows#create";const v=(0,s.$j)(((e,t)=>{const o=i.C.getSelector(e),s=o.getCurrentUserProfile(),r=d.getSelector(e),a=_.get(t.targetProfile,"id")||t.authorId,n=C.I.showCaptcha("v2",O.RECAPTCHA_ENDPOINT),l=r.passedEndpoints[O.RECAPTCHA_ENDPOINT];return{targetId:a,recaptchaEnabled:n&&!l,gRecaptchaResponse:r.endpointTokens[O.RECAPTCHA_ENDPOINT],userAuthed:C.I.isAuthed(),userAuthorId:_.get(s,"authorId"),isLoading:o.isLoading(a)}}))(O);var B=o(353),w=o(64538);class L extends React.Component{constructor(e){super(e),this.onClickCallback=this.onClickCallback.bind(this)}onClickCallback(){return this.props.onClickCallback?this.props.onClickCallback(this.props.profile.id):_.noop}renderFollowButton(){return C.I.isLoggedInUser(this.props.profile.userId)||this.props.hideFollowButton?null:React.createElement(v,{targetProfile:this.props.profile,isFollowing:this.props.isFollowing,iconOnly:this.props.windowMatchesXs||"small"===this.props.size,hideTooltip:this.props.hideTooltip,trackingEventProps:this.props.trackingEventProps,authorId:this.props.profile.authorId,onFollowCallback:this.onClickCallback})}render(){const e=this.props.profile.private?null:this.renderFollowButton(),t=this.props.showSecondaryInfo?this.props.secondaryInfo:null,o=this.props.linkToProfile?"a":"div";return React.createElement("div",{className:`profile-follow profile-follow-id-${this.props.profile.id}`},React.createElement(o,{"data-testid":"profile-tile-wrapper",href:this.props.linkToProfile?this.props.profile.profileUrl:null,className:"profile-tile-wrapper"},React.createElement(B.m,{linkToProfile:!1,profile:this.props.profile,borderedProfileImage:this.props.borderedProfileImage,renderAuthorPill:this.props.renderAuthorPill,secondaryInfo:t,size:"small"===this.props.size?"small":"medium",onProfileClick:this.props.onProfileClick,wrapAuthorPill:this.props.wrapAuthorPill,wrapText:this.props.wrapText})),React.createElement("div",{className:"follow-button-wrapper"},e))}}L.propTypes={hideFollowButton:PropTypes.bool,hideTooltip:PropTypes.bool,isFollowing:PropTypes.bool.isRequired,linkToProfile:PropTypes.bool,onClickCallback:PropTypes.func,onProfileClick:PropTypes.func,profile:I._.profile.isRequired,showSecondaryInfo:PropTypes.bool,secondaryInfo:PropTypes.oneOf(["username","followerCount","category"]),trackingEventProps:PropTypes.object,size:PropTypes.oneOf(["small","medium"]),wrapAuthorPill:PropTypes.bool,wrapText:PropTypes.bool,borderedProfileImage:PropTypes.bool,renderAuthorPill:PropTypes.bool},L.defaultProps={hideFollowButton:!1,hideTooltip:!1,linkToProfile:!0,onClickCallback:null,onProfileClick:_.noop,showSecondaryInfo:!0,secondaryInfo:"username",size:"medium",wrapAuthorPill:!1};const A=(0,w.$)(L)},6055:function(e,t,o){"use strict";o.d(t,{v:function(){return h}});var s=o(68697),r=o(93513),i=o(75820);const a="bookReactions",n=(0,i.hp)(a,["STORE_BOOK_REACTION","REMOVE_BOOK_REACTION","CLEAR_BOOK_REACTIONS","STORE_BOOK_REACTIONS","STORE_BOOK_REACTIONS_SUMMARIES","STORE_REACTIONS"]),l=(e,t)=>{const{userId:o,bookId:s}=t;_.has(e.userBookReactions,[o,s])||_.set(e,["userBookReactions",o,s],[]);const r=_.unionBy(e.userBookReactions[o][s],[t],"reactionId");return _.set(e,["userBookReactions",o,s],r),e};(0,i.fn)(a,(0,r.Uy)(((e,t)=>{switch(t.type){case n.STORE_BOOK_REACTION:return l(e,t.payload.bookReaction);case n.REMOVE_BOOK_REACTION:return((e,t)=>{const{userId:o,bookId:s,reactionId:r}=t,i=_.reject(e.userBookReactions[o][s],{reactionId:r});return _.set(e,["userBookReactions",o],{[s]:i})})(e,t.payload.bookReaction);case n.STORE_BOOK_REACTIONS:return((e,t)=>_.reduce(t,l,e))(e,t.payload.bookReactions);case n.CLEAR_BOOK_REACTIONS:return _.unset(e,["userBookReactions",t.payload.userBook.userId,t.payload.userBook.bookId]),e;case n.STORE_REACTIONS:return _.assignIn(e,{reactions:t.payload.reactions});case n.STORE_BOOK_REACTIONS_SUMMARIES:return((e,t)=>{const o=_.groupBy(t,"bookId");return _.assignIn(e,{bookReactionsSummaries:_.merge({},e.bookReactionsSummaries,o,_.union)})})(e,t.payload.bookReactionsSummaries);default:return e}}),{userBookReactions:{},bookReactionsSummaries:{},reactions:[]}));const p=e=>e[a],c=(0,s.P1)(p,(e=>memoize(((t,o)=>_.get(e.userBookReactions,[t,o],[]))))),d=(0,s.P1)(p,(e=>memoize(((t,o,s)=>{const r=_.get(e.userBookReactions,[t,o],[]);return _.some(r,{reactionId:s})})))),u=(0,s.P1)(p,(e=>t=>_.get(e.bookReactionsSummaries,t))),h={actionTypes:n,getSelector:e=>{const t={getBookReactions:(t,o)=>c(e)(t,o),getBookReaction:(t,o,s)=>d(e)(t,o,s),getBookReactionsSummaries:u(e)};return{...p(e),...t}}}},66055:function(e,t,o){"use strict";o.d(t,{R:function(){return u}});var s=o(68697),r=o(93513),i=o(75820);const a="book_recommendations",n=(0,i.hp)(a,["STORE_BOOK_RECOMMENDATION","STORE_BOOK_RECOMMENDATIONS","CLEAR_BOOK_RECOMMENDATION","TOGGLING_CHECKBOX","TOGGLED_CHECKBOX"]),l=(e,t)=>{const{userId:o}=t;let s=e;return _.has(e.bookRecommendations,o)||(s=((e,t)=>_.set(e,["bookRecommendations",t],{}))(s,o)),((e,t)=>{const{userId:o,bookId:s}=t;return _.set(e,["bookRecommendations",o,s],t)})(s,t)};(0,i.fn)(a,(0,r.Uy)(((e,t)=>{switch(t.type){case n.STORE_BOOK_RECOMMENDATION:return l(e,t.payload.bookRecommendation);case n.STORE_BOOK_RECOMMENDATIONS:return((e,t)=>_.reduce(t,l,e))(e,t.payload.bookRecommendations);case n.CLEAR_BOOK_RECOMMENDATION:return _.unset(e,["bookRecommendations",t.payload.userId,t.payload.bookId]),e;case n.TOGGLING_CHECKBOX:return _.assignIn(e,{togglingCheckbox:{[t.payload.bookId]:!0}});case n.TOGGLED_CHECKBOX:return _.assignIn(e,{togglingCheckbox:_.omit(e.togglingCheckbox,t.payload.bookId)});default:return e}}),{bookRecommendations:{},togglingCheckbox:{}}));const p=e=>e[a],c=(0,s.P1)(p,(e=>t=>_.get(e.togglingCheckbox,t))),d=(0,s.P1)(p,(e=>(t,o)=>_.get(e.bookRecommendations,[t,o]))),u={actionTypes:n,getSelector:e=>{const t={isToggling:t=>c(e)(t),getBookRecommendation:(t,o)=>d(e)(t,o)};return{...p(e),...t}}}},69923:function(e,t,o){"use strict";o.d(t,{C:function(){return v}});var s=o(68697),r=o(93513),i=o(75820);const a=o(9971).I.getUserStoreData().profile,n={activeUserProfileId:null,currentUserProfileId:null,didFirstTimeLoad:!1,isSaving:!1,profileFollowsCollection:{},profileMap:{},collectionStatus:{},collectionMetadata:{},profileSearchQuery:null,similarAuthorProfileIds:[],loadingState:{},recommendations:{},isLoadingMoreAuthors:!1};a&&(n.profileMap[a.id]=a,n.currentUserProfileId=a.id);const l="profile",p=(0,i.hp)(l,["SET_ACTIVE_PROFILE","SET_CURRENT_USER_PROFILE","SET_IMAGE_URL","SET_PROFILE_COLLECTION","UPDATE_PROFILE_COLLECTION","SET_COLLECTION_STATUS","SET_COLLECTION_METADATA","ADD_PROFILES","ADD_PROFILE_COLLECTION","ADD_SIMILAR_AUTHOR_PROFILES","SET_PROFILE_SEARCH_QUERY","SET_LOADING_MORE","FOLLOWER_COUNT_LOADED","FOLLOWING_COUNT_LOADED","POST_COUNT_LOADED","BOOK_STORY_CREATED","BOOK_STORY_DELETED","INIT_SUCCESS","SET_IS_SAVING","REMOVE_PROFILE","TRIGGERING_FOLLOW","TOGGLED_FOLLOW"]),c=(e,t)=>_.assignIn(e,{[t.id]:_.merge(e[t.id]||{},t)}),d=(e,t)=>_.merge(e,_.keyBy(t,(e=>e.id))),u=e=>e.profileMap[e.currentUserProfileId],h=(e,t)=>{const o=(e=>e.profileMap[e.activeUserProfileId])(e);return o&&_.get(o,"userId")===_.get(t,"userId")},m=e=>h(e,u(e));(0,i.fn)(l,(0,r.Uy)(((e,t)=>{switch(t.type){case p.SET_ACTIVE_PROFILE:return _.assignIn(e,{activeUserProfileId:t.payload.profile.id,profileMap:c(e.profileMap,t.payload.profile)});case p.SET_CURRENT_USER_PROFILE:return _.assignIn(e,{currentUserProfileId:t.payload.profile.id,profileMap:c(e.profileMap,t.payload.profile)});case p.SET_IMAGE_URL:return _.assignIn(e,{profileMap:c(e.profileMap,_.merge(t.payload.profile,{imageUrl:`${t.payload.profile.imageUrl}?${Date.now()}`}))});case p.SET_PROFILE_COLLECTION:{const[o,s]=_.toPairs(t.payload.result)[0];return _.assignIn(e,{collectionStatus:_.assignIn(e.collectionStatus,{[o]:"loaded"}),profileFollowsCollection:_.assignIn(e.profileFollowsCollection,{[o]:_.uniq(_.map(s.profiles,"id"))}),profileMap:d(e.profileMap,s.profiles)})}case p.UPDATE_PROFILE_COLLECTION:{let o=t.payload.profile,s=u(e);const r=o.isFollowing,i=r?s.followingCount+1:s.followingCount-1,a=r?o.followerCount+1:o.followerCount-1;let n=e.profileFollowsCollection;return h(e,o)&&o.userId!==_.get(s,"userId")&&(o=_.merge(o,{followerCount:a}),s=_.merge(s,{isFollowing:r,followingCount:i}),n=((e,t)=>{let o=e.profileFollowsCollection.followers||[];return o=t.isFollowing?_.uniq(_.concat(o,t.id)):_.without(o,t.id),_.assignIn(e.profileFollowsCollection,{followers:o})})(e,s)),_.assignIn(e,{profileFollowsCollection:n,profileMap:c(c(e.profileMap,o),_.merge(s,{isFollowing:r}))})}case p.ADD_PROFILE_COLLECTION:{const[o,s]=_.toPairs(t.payload.result)[0];return _.assignIn(e,{collectionStatus:_.assignIn(e.collectionStatus,{[o]:"loaded"}),profileFollowsCollection:_.assignIn(e.profileFollowsCollection,{[o]:_.union(_.get(e.profileFollowsCollection,o)||[],_.uniq(_.map(s.profiles,"id")))}),profileMap:d(e.profileMap,s.profiles)})}case p.SET_COLLECTION_STATUS:{const[o,s]=_.toPairs(t.payload.status)[0];return _.assignIn(e,{collectionStatus:_.assignIn(e.collectionStatus,{[o]:s})})}case p.SET_COLLECTION_METADATA:{const[o,s]=_.toPairs(t.payload.result)[0];return _.assignIn(e,{collectionMetadata:_.assignIn(e.collectionMetadata,{[o]:{moreProfileFollowsExist:s.hasMoreProfileCollection,page:s.page}})})}case p.ADD_PROFILES:return _.assignIn(e,{profileMap:d(e.profileMap,t.payload.profiles)});case p.SET_PROFILE_SEARCH_QUERY:return _.assignIn(e,{profileSearchQuery:t.payload.profileSearchQuery});case p.FOLLOWER_COUNT_LOADED:{const o=t.payload.profileWithFollowerCount;return _.merge(e,{profileMap:{[o.id]:{followerCount:o.followerCount}}})}case p.FOLLOWING_COUNT_LOADED:{const o=t.payload.profileWithFollowingCount;return _.merge(e,{profileMap:{[o.id]:{followingCount:o.followingCount}}})}case p.POST_COUNT_LOADED:{const o=t.payload.profileWithPostCount;return _.merge(e,{profileMap:{[o.id]:{postCount:o.postCount}}})}case p.BOOK_STORY_CREATED:if(m(e)){const t=u(e);return _.assignIn(e,{profileMap:c(e.profileMap,_.merge(t,{postCount:t.postCount+1}))})}return e;case p.BOOK_STORY_DELETED:if(m(e)){const t=u(e);return _.assignIn(e,{profileMap:c(e.profileMap,_.merge(t,{postCount:t.postCount-1}))})}return e;case p.INIT_SUCCESS:return _.assignIn(e,{didFirstTimeLoad:!0});case p.SET_IS_SAVING:return _.assignIn(e,{isSaving:t.payload.isSaving});case p.REMOVE_PROFILE:return _.assignIn(e,{profileMap:(o=e,s=t.payload.profileId,_.omit(o.profileMap,s))});case p.TRIGGERING_FOLLOW:return _.assignIn(e,{loadingState:_.assignIn(e.loadingState,{[t.payload.profileId]:!0})});case p.TOGGLED_FOLLOW:return _.assignIn(e,{loadingState:_.omit(e.loadingState,[t.payload.profileId])});case p.ADD_SIMILAR_AUTHOR_PROFILES:return _.assignIn(e,{profileMap:d(e.profileMap,t.payload.profiles),similarAuthorProfileIds:_.map(t.payload.profiles,"id")});case p.SET_LOADING_MORE:return e.isLoadingMoreAuthors=t.payload.loadingMore,e;default:return e}var o,s}),n));const g=e=>e[l],y=(0,s.P1)(g,(e=>_.get(e.profileMap,e.activeUserProfileId))),b=(0,s.P1)(g,(e=>_.get(e.profileMap,e.currentUserProfileId))),k=(0,s.P1)(g,(e=>memoize((t=>_.at(e.profileMap,t))))),T=(0,s.P1)((e=>g(e).profileMap),(e=>g(e).profileFollowsCollection),((e,t)=>memoize((o=>_.compact(_.map(t[o],(t=>e[t]))))))),S=(0,s.P1)(g,(e=>memoize((t=>{const o=e.profileMap[t];return void 0!==o&&null!=o?o.isFollowing:null})))),f=(0,s.P1)(g,(e=>memoize((t=>e.loadingState[t]||!1)))),E=(0,s.P1)(g,(e=>memoize((t=>_.get(e.collectionMetadata[t],"moreProfileFollowsExist"))))),R=(0,s.P1)(g,(e=>memoize((t=>_.get(e.collectionMetadata[t],"page")||0)))),P=(0,s.P1)(g,(e=>memoize((t=>"loaded"===e.collectionStatus[t])))),C=(0,s.P1)(g,(e=>memoize((t=>"loading"===e.collectionStatus[t])))),I=(0,s.P1)(g,(e=>memoize((t=>"failed"===e.collectionStatus[t])))),O=(0,s.P1)(g,k,((e,t)=>memoize((e=>t([e])[0])))),v={actionTypes:p,getSelector:e=>{const t={getActiveUserProfile:_.partial(y,e),getCurrentUserProfile:_.partial(b,e),getProfilesForIds:t=>k(e)(t),getProfileCollection:t=>T(e)(t),getProfile:t=>O(e)(t),getFollowStatus:t=>S(e)(t),isLoading:t=>f(e)(t),getMoreProfileFollowsExist:t=>E(e)(t),getCollectionPage:t=>R(e)(t),isCollectionLoaded:t=>P(e)(t),isCollectionLoading:t=>C(e)(t),isCollectionFailed:t=>I(e)(t)};return{...g(e),...t}}}},17966:function(e,t,o){"use strict";o.d(t,{K:function(){return r}});var s=o(28628);const r={listProfileFollowers(e,t){return s.B.request({method:"GET",url:`/profile_follows/${e}/followers`,data:t})},listProfileFollowings(e,t){return s.B.request({method:"GET",url:`/profile_follows/${e}/followings`,data:t})},followProfile(e,t){return s.B.request({method:"POST",url:`/profile_follows/${e}`,data:JSON.stringify({"g-recaptcha-response":t})})},unfollowProfile(e){return s.B.request({method:"DELETE",url:`/profile_follows/${e}`})},followerCount(e){return s.B.request({method:"GET",url:`/profile_follows/${e}/followers/count`})},followingCount(e){return s.B.request({method:"GET",url:`/profile_follows/${e}/followings/count`})}}},6846:function(e,t,o){"use strict";o.d(t,{H:function(){return r}});var s=o(28628);const r={get(e){return s.B.request({method:"GET",url:`/profiles/${e}`})},update(e){return s.B.request({method:"PATCH",url:`/profiles/${e.id}`,data:JSON.stringify({profile:e})})},suggestions(e){return s.B.request({method:"GET",url:"/profiles/suggested_authors",data:e})},postCount(e){return s.B.request({method:"GET",url:"/profiles/post_count",data:{id:e}})},editorFollowSuggestions(e){return s.B.request({method:"GET",url:"/profiles/recommended_editors",data:e})},percentageMatch(e){return s.B.request({method:"GET",url:"/profiles/percentage_match",data:{profile_id:e}})},youMayKnow(e){return s.B.request({method:"GET",url:"/profiles/you_may_know",data:e})},search(e){return s.B.request({method:"GET",url:"/profiles",data:e})},getTags(e){return s.B.request({method:"GET",url:`/profiles/${e}/tags`})},getTopRecommenders(e){return s.B.request({method:"GET",url:"/profiles/top_recommenders",data:e})},getRecommendations(e){return s.B.request({method:"GET",url:`/profile/${e}/book_stories/recommendations`})},getRelatedBlogPosts(e){return s.B.request({method:"GET",url:"/profiles/related_blog_posts",cache:!1,data:{profile_id:e}})}}},19710:function(e,t,o){"use strict";o.d(t,{s:function(){return h}});var s=o(88251),r=o(84860),i=o(83842),a=o(53114),n=o(57997),l=o(5449);class p extends React.PureComponent{constructor(e){super(e),this.onClose=this.onClose.bind(this),this.onCancel=this.onCancel.bind(this)}onClose(){const e=_.get(this.props.formValues,"book_story[text]"),t=!_.isEmpty(e),o=_.get(this.props,"bookStoryEditing.text")!==e,s=this.props.currentStep,r="recommendation"===s||"missing"===s;bubEvents.track("Review Modal","Navigate",{label:`${_.capitalize(s)} Step`,value:"Close",willShowDiscard:r}),t&&o&&r?n.H.closeConfirmStep():n.H.resetRecommendBookFlow(this.props.formId)}onCancel(){return n.H.clearDiscard(),n.H.activeBookStoryForm(this.props.formId),n.H.focusBookStoryForm(this.props.formId)}render(){return React.createElement("div",null,React.createElement(i.a,{show:this.props.show,onHide:this.onClose,isDismissible:this.props.isDismissible,closeText:"Close",id:"recommend-book-modal"},React.createElement(a.T,{defaultList:this.props.defaultList,formId:this.props.formId,onWisdomAdded:this.props.onWisdomAdded,displaySavedMessage:this.props.displaySavedMessage,searchSelectionAction:this.props.searchSelectionAction})))}}p.propTypes={formId:PropTypes.string.isRequired,currentStep:PropTypes.string,defaultList:PropTypes.string,formValues:PropTypes.object,show:PropTypes.bool,onWisdomAdded:PropTypes.func,displaySavedMessage:PropTypes.bool,isDismissible:PropTypes.bool,searchSelectionAction:PropTypes.func},p.defaultProps={show:!1,onWisdomAdded:_.noop};const c=(0,s.$j)(((e,t)=>{const o=l.c.getSelector(e);return{currentStep:r.h.getSelector(e).recommendationStep,formValues:o.getFormValues(t.formId)}}))(p);var d=o(76397);class u extends React.PureComponent{isDismissible(){return!_.includes(["delete-confirm","close-confirm"],this.props.recommendationStep)}renderModal(){return this.props.showFormId===this.props.formId?React.createElement(c,{defaultList:this.props.defaultList,formId:this.props.showFormId,show:!0,noSummary:this.props.noSummary,onWisdomAdded:this.props.onWisdomAdded,bookStory:this.props.bookStory,displaySavedMessage:this.props.displaySavedMessage,isDismissible:this.isDismissible(),searchSelectionAction:this.props.searchSelectionAction}):null}render(){return React.createElement("div",{className:this.props.className},this.renderModal())}}u.propTypes={bookStory:d._.bookStory,className:PropTypes.string,defaultList:PropTypes.string,displaySavedMessage:PropTypes.bool,formId:PropTypes.oneOfType([PropTypes.string,PropTypes.number]).isRequired,searchSelectionAction:PropTypes.func,showFormId:PropTypes.string,noSummary:PropTypes.bool,onWisdomAdded:PropTypes.func,recommendationStep:PropTypes.string},u.defaultProps={displaySavedMessage:!1,showFormId:null,noSummary:!1,onWisdomAdded:void 0},u.trackingName="Review Modal";const h=(0,s.$j)((e=>{const t=r.h.getSelector(e),o=t.getBookStoryForId(t.activeBookStoryId);return{showFormId:t.activeBookStoryForm,recommendationStep:t.recommendationStep,bookStory:o}}))(u)},53114:function(e,t,o){"use strict";o.d(t,{T:function(){return _o}});var s=o(88251),r=o(95130),i=o(57997),a=o(84860),n=o(31563),l=o(49065),p=o(69923),c=o(5449),d=o(68697),u=o(93513),h=o(75820);const m="modal",g=(0,h.hp)(m,["OPEN","CLOSE"]);(0,h.fn)(m,(0,u.Uy)(((e,t)=>{switch(t.type){case g.OPEN:return _.merge(e,{modals:{[t.payload.key]:!0}});case g.CLOSE:return _.merge(e,{modals:{[t.payload.key]:!1}});default:return e}}),{modals:{}}));const y=e=>e[m],b=(0,d.P1)(y,(e=>memoize((t=>!!e.modals[t])))),k=(0,d.P1)(y,(e=>!!Object.keys(e.modals).length));var T=o(9971),S=o(71407);const f={getAutoFollowAuthors(){return(0,S.t)({method:"GET",url:this._path("/auto_follow_author")})},enableAutoFollowAuthors(){return(0,S.t)({method:"POST",url:this._path("/auto_follow_author")})},disableAutoFollowAuthors(){return(0,S.t)({method:"DELETE",url:this._path("/auto_follow_author")})},_path(e){return`/settings/features/${e}`}},E="userFeaturePreferences",R=(0,h.hp)(E,["UPDATE_FEATURE_PREFERENCE","UPDATE_FEATURE_PREFERENCE_LOADING_STATE"]);(0,h.fn)(E,(0,u.Uy)(((e,t)=>{switch(t.type){case R.UPDATE_FEATURE_PREFERENCE:{const{featureName:o,preference:s}=t.payload.featurePreferenceInfo;return e.featurePreferences[o]=s,e}case R.UPDATE_FEATURE_PREFERENCE_LOADING_STATE:return _.merge(e.featurePreferenceLoadingStates,t.payload.loadingInfo),e;default:return e}}),{featurePreferences:{},featurePreferenceLoadingStates:{}}));const P=e=>e[E],C=(0,d.P1)(P,(e=>t=>_.get(e.featurePreferences,t))),I=(0,d.P1)(P,(e=>memoize((t=>_.get(e.featurePreferenceLoadingStates,t))))),O={actionTypes:R,getSelector:e=>{const t={getFeaturePreferenceLoadingState:t=>I(e)(t),getFeaturePreference:t=>C(e)(t)};return{...P(e),...t}}},v=new class{constructor(){this.updateFeaturePreference=this.updateFeaturePreference.bind(this),this.updateFeaturePreferenceLoadingState=this.updateFeaturePreferenceLoadingState.bind(this)}updateFeaturePreference(e){h.tO.dispatch({type:O.actionTypes.UPDATE_FEATURE_PREFERENCE,payload:{featurePreferenceInfo:e}})}updateFeaturePreferenceLoadingState(e){h.tO.dispatch({type:O.actionTypes.UPDATE_FEATURE_PREFERENCE_LOADING_STATE,payload:{loadingInfo:e}})}setAutoFollowAuthors(){return this.updateFeaturePreferenceLoadingState({autoFollowAuthors:"loading"}),f.getAutoFollowAuthors().then((e=>{this.updateFeaturePreferenceLoadingState({autoFollowAuthors:"loaded"}),this.updateFeaturePreference(_.merge(e,{featureName:"autoFollowAuthors"}))}))}enableAutoFollowAuthors(){return this.updateFeaturePreference({featureName:"autoFollowAuthors",preference:"enabled"}),f.enableAutoFollowAuthors()}disableAutoFollowAuthors(){return this.updateFeaturePreference({featureName:"autoFollowAuthors",preference:"disabled"}),f.disableAutoFollowAuthors()}};var B=o(28312);class w extends React.PureComponent{constructor(e){super(e),this.enableAutoFollowAuthors=this.enableAutoFollowAuthors.bind(this),this.disableAutoFollowAuthors=this.disableAutoFollowAuthors.bind(this)}componentDidMount(){$(document).scrollTop(0),bubEvents.track("Auto Follow Authors Prompt","View Modal")}enableAutoFollowAuthors(){return v.enableAutoFollowAuthors(),i.H.autoFollowAuthorsStep()}disableAutoFollowAuthors(){return v.disableAutoFollowAuthors(),i.H.autoFollowAuthorsStep()}render(){return React.createElement("div",{className:"auto-follow-authors-prompt-step-vc"},React.createElement("h1",{className:"prompt-step-header"},"Don't miss updates from authors you love!"),React.createElement("p",{className:"prompt-step-text"},"Would you like to ",React.createElement("span",{className:"prompt-step-emphasis"},"automatically follow")," authors of the books you recommend to get notifications on their deals, new releases, and book recommendations?"),React.createElement("div",{className:"yes-button-wrapper"},React.createElement(B.G,{bubStyle:"lava",full:!0,label:"Yes, automatically follow authors",onClick:this.enableAutoFollowAuthors})),React.createElement("div",{className:"no-button-wrapper"},React.createElement(B.G,{bubStyle:"stone",label:"No, thanks",onClick:this.disableAutoFollowAuthors,renderAs:"link"})))}}var L=o(11184),A=o.n(L),N=o(76530),M=o(27192),D=o(73350),F=o(94480),x=o(76397),U=o(64538);function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},H.apply(this,arguments)}class K extends React.Component{renderUser(){const e=_.omit(this.props,"profileFollows"),t=this.props.profileFollows.map((t=>React.createElement(M.Z,{key:t.id,classNames:"forward",exit:!1,timeout:300},React.createElement("div",{className:"profile-follow-collection-item"},React.createElement(F.j,H({},e,{profile:t,isFollowing:t.isFollowing,trackingEventProps:this.props.trackingEventProps}))))));return React.createElement(D.Z,null,t)}render(){return React.createElement("div",{className:"profile-follow-collection"},this.renderUser())}}K.propTypes={fullWidth:PropTypes.bool,profileFollows:PropTypes.arrayOf(x._.profile).isRequired,trackingEventProps:PropTypes.object};const z=(0,U.$)(K);var j=o(94184),G=o.n(j),q=o(74855);const V={shareFacebook(e){const t=e.facebook.shareLink;"test"!==window.bubEnv&&FB.ui({method:"share",href:t},_.noop)},sharePinterest(e){const t=e.pinterest;window.open(`//www.pinterest.com/pin/create/button/?url=${t.shareLink}&media=${t.imageUrl}&description=${t.message}`,"","width=750,height=288")},shareTwitter(e){const t=e.twitter.shareLink;window.open(`${t}&original_referer=${window.location.href}`,"","width=550,height=520")}};var W=o(83141),Y=o(9763);class Q extends React.Component{constructor(e){super(e),this.state={shareLinkClicked:!1,tooltipText:"",tooltipClearTimeout:null},this.socialIconSize=e.useLargeSocialIcon?"3.5em":"2.3em",this.onFacebookClick=this.onFacebookClick.bind(this),this.onPinterestClick=this.onPinterestClick.bind(this),this.onTwitterClick=this.onTwitterClick.bind(this),this.onEmailClick=this.onEmailClick.bind(this),this.onCopyLinkClick=this.onCopyLinkClick.bind(this)}componentWillUnmount(){this.state.tooltipClearTimeout&&clearTimeout(this.state.tooltipClearTimeout)}onFacebookClick(){this.trackClick("Facebook"),V.shareFacebook(this.props.socialSharingDetails)}onPinterestClick(){this.trackClick("Pinterest"),V.sharePinterest(this.props.socialSharingDetails)}onTwitterClick(){this.trackClick("Twitter"),V.shareTwitter(this.props.socialSharingDetails)}onEmailClick(){this.trackClick("Email")}onCopyLinkClick(){this.trackClick("Link")}getButtonInfo(e){let t="share-button "+(this.props.useLargeSocialIcon?"large":""),o=!1,s="",r="";switch(this.props.buttonType.includes("icon-grey")&&(t="social-cta-button",o=!0),!0){case"twitter"===e&&!o:case"facebook"===e&&!o:s=e;break;case"twitter"===e&&o:s=`${e}-bird`;break;case"facebook"===e&&o:s=`${e}-f`;break;case"email"===e&&!o:s="envelope",r="share-icon";break;case"email"===e&&o:s="mail",r="social-icon email-icon";break;case"link"===e&&!o:s="link",r="share-icon";break;case"link"===e&&o:s="link",r="social-icon link-icon";break;default:s="pinterest"}return{buttonClass:t,iconName:s,iconClass:r}}displayContentType(){switch(this.props.contentType){case"blogPost":return"article";case"bookStory":return"review";case"bookStoryRec":return"recommendation";default:return"book"}}emailBody(){return _.isNil(this.props.socialSharingDetails.email.message)?`I thought you might like this ${this.displayContentType()} I found on BookBub%0D%0A%0D%0A${this.props.socialSharingDetails.email.shareLink}`:`${this.props.socialSharingDetails.email.message}%0D%0A%0D%0A${this.props.socialSharingDetails.email.shareLink}`}maybeRenderLabel(e){return"labeled-pill"===this.props.buttonType?React.createElement(React.Fragment,null,React.createElement("p",{className:"share-label"},e),React.createElement("div",{className:"placeholder"})):null}trackClick(e){const t=this.props.position||null;bubEvents.track(this.props.trackingCategory,"Click",_.merge({label:e,value:t},this.props.trackingValues))}tooltipRenderHelper(e){return this.state.tooltipText?React.createElement(Y.L,{tooltipText:this.state.tooltipText,tooltipPlacement:this.props.tooltipPlacement,delay:200,showOnMobile:this.props.showOnMobile},e):e}tooltipTextHelper(){const e=_.delay((()=>this.setState({tooltipText:"",shareLinkClicked:!1})),3e3);this.setState({shareLinkClicked:!0,tooltipText:"Copied to clipboard",tooltipClearTimeout:e})}renderFacebookButton(){const{buttonClass:e,iconName:t}=this.getButtonInfo("facebook");return React.createElement("button",{"aria-label":"Share to Facebook",className:`${e} facebook-share`,onClick:this.onFacebookClick},React.createElement("div",{className:"icon-bg"}),React.createElement(W.J,{size:this.socialIconSize,className:"social-icon facebook-icon",name:t}),this.maybeRenderLabel("Facebook"))}renderTwitterButton(){const{buttonClass:e,iconName:t}=this.getButtonInfo("twitter");return React.createElement("button",{"aria-label":"Share to Twitter",className:`${e} twitter-share`,onClick:this.onTwitterClick},React.createElement("div",{className:"icon-bg"}),React.createElement(W.J,{size:this.socialIconSize,className:"social-icon twitter-icon",name:t}),this.maybeRenderLabel("Twitter"))}renderPinterestButton(){const{buttonClass:e,iconName:t}=this.getButtonInfo("pinterest");return React.createElement("button",{"aria-label":"Share to Pinterest",className:`${e} pinterest-share`,onClick:this.onPinterestClick},React.createElement("div",{className:"icon-bg"}),React.createElement(W.J,{size:this.socialIconSize,className:"social-icon pinterest-icon",name:t}),this.maybeRenderLabel("Pinterest"))}renderEmailButton(){const e=this.props.socialSharingDetails.email.subject||`Check out this ${this.displayContentType()} on BookBub`,t=this.emailBody(),o=this.props.enableGmailDeepLink?`https://mail.google.com/mail/u/0?view=cm&su=${e}&body=${t}`:`mailto:?subject=${e}&body=${t}`,{buttonClass:s,iconName:r,iconClass:i}=this.getButtonInfo("email");return React.createElement("a",{"aria-label":"Share via email",href:o,rel:"noreferrer",target:this.props.enableGmailDeepLink?"_blank":"_self",className:`${s} email-share`,onClick:this.onEmailClick},React.createElement(W.J,{className:i,name:r}),this.maybeRenderLabel("Email"))}renderCopyLinkButton(){if(!this.props.socialSharingDetails.link)return null;const{buttonClass:e,iconName:t,iconClass:o}=this.getButtonInfo("link");return React.createElement(q.CopyToClipboard,{text:this.props.socialSharingDetails.link.shareLink,onCopy:()=>this.tooltipTextHelper()},React.createElement("button",{"aria-label":"Share Link",className:G()(e,"link-share",{"button-active":this.state.shareLinkClicked}),onClick:this.onCopyLinkClick},React.createElement(W.J,{className:o,name:t}),this.maybeRenderLabel("Link")))}render(){return null==this.props.socialSharingDetails?null:React.createElement("div",{className:G()("sharing-links",`${this.props.buttonType}-buttons`,{stacked:this.props.stacked,"left-align":this.props.leftAlign,large:this.props.useLargeSocialIcon}),"data-testid":"social-sharing-buttons"},this.props.showFacebook&&this.renderFacebookButton(),this.props.showTwitter&&this.renderTwitterButton(),this.props.showPinterest&&this.renderPinterestButton(),this.props.showEmail&&this.renderEmailButton(),this.props.showCopyLink&&this.tooltipRenderHelper(this.renderCopyLinkButton()))}}Q.propTypes={buttonType:PropTypes.oneOf(["pill","icon","stacked","labeled-pill","icon-grey-stacked","icon-grey"]).isRequired,contentType:PropTypes.oneOf(["book","blogPost","bookStory","bookStoryRec"]).isRequired,position:PropTypes.string,socialSharingDetails:x._.socialSharingDetails,tooltipPlacement:PropTypes.string,trackingValues:PropTypes.object,showPinterest:PropTypes.bool,showFacebook:PropTypes.bool,showTwitter:PropTypes.bool,showEmail:PropTypes.bool,showCopyLink:PropTypes.bool,enableGmailDeepLink:PropTypes.bool,showOnMobile:PropTypes.bool,stacked:PropTypes.bool,trackingCategory:PropTypes.string,leftAlign:PropTypes.bool,useLargeSocialIcon:PropTypes.bool},Q.defaultProps={showPinterest:!0,showFacebook:!0,showTwitter:!0,showEmail:!0,showCopyLink:!0,enableGmailDeepLink:!1,stacked:!1,tooltipPlacement:"bottom",trackingCategory:"Social Sharing Component",leftAlign:!1,useLargeSocialIcon:!1};var J=o(38047),Z=o(92564),X=o.n(Z);class ee extends React.Component{baseShareLink(e){return e?`${this.props.bookStory.bookStoryUrl}?source=${e}`:this.props.bookStory.bookStoryUrl}facebookShareLink(){return this.baseShareLink("facebook_share")}twitterShareLink(){const e=this.baseShareLink("twitter_share");return`https://twitter.com/intent/tweet?url=${_.escape(e)}&via=Bookbub&text=${_.escape(this.twitterMessage())}`}pinterestShareLink(){return this.baseShareLink("pinterest_share")}emailShareLink(){return this.baseShareLink("email_share")}linkShareLink(){return this.baseShareLink("link_share")}emailMessage(){const e=this.props.isRecommended?"recommendation":"review";return this.props.isCurrentUser?`I thought you might like my ${e} of ${encodeURIComponent(this.props.bookStory.book.title)}`:`I thought you might like this ${e} by ${this.props.bookStory.profile.name} that I found on BookBub`}pinterestMessage(){return this.props.isRecommended?`${this.props.bookStory.profile.name} recommends ${this.props.bookStory.book.title}`:`${this.props.bookStory.profile.name} reviews ${this.props.bookStory.book.title}`}twitterMessage(){const e=this.props.isRecommended?"recommendation":"review";return this.props.isCurrentUser?`Check out my ${e}: `:`Check out this book ${e} from ${this.props.bookStory.profile.name}: `}bookCoverUrl(){return _.isNil(this.props.bookStory.book)?J.J.fixedAspectRatio(X(),null):this.props.bookStory.book.coverUrl}socialSharingDetails(){return{facebook:{shareLink:this.facebookShareLink()},twitter:{shareLink:this.twitterShareLink()},pinterest:{shareLink:this.pinterestShareLink(),message:this.pinterestMessage(),imageUrl:this.bookCoverUrl()},email:{shareLink:this.emailShareLink(),message:this.emailMessage()},link:{shareLink:this.linkShareLink()}}}render(){const e=this.props.isRecommended?"bookStoryRec":"bookStory",t=this.socialSharingDetails(),o={bookStoryId:this.props.bookStory.id};return React.createElement("div",{className:"book-story-social-sharing-buttons"},React.createElement(Q,{buttonType:this.props.buttonStyle,contentType:e,position:this.props.location,socialSharingDetails:t,trackingValues:o}))}}ee.propTypes={bookStory:x._.bookStory.isRequired,isRecommended:PropTypes.bool.isRequired,isCurrentUser:PropTypes.bool.isRequired,location:PropTypes.string,buttonStyle:PropTypes.string},ee.defaultProps={buttonStyle:"pill"};var te=o(66055);class oe extends React.PureComponent{componentDidMount(){$(document).scrollTop(0),_.defer((()=>{i.H.autoFollowAuthors("auto-followed-authors",this.props.bookStory.id).then((e=>this.trackAutoFollowResponse(e))),i.H.suggestedRecommenders("suggested-recommenders",this.props.bookStory.id,{limit:3}).then((e=>{this.trackProfileImpressions(e.profiles,"Suggested Profile Impression")}))}))}trackAutoFollowResponse(e){return _.forEach(e.autoFollowedProfileIds,(e=>{bubEvents.track("After Share Follow Prompt","Auto Followed Profile",{value:e})})),this.trackProfileImpressions(e.profiles,"Book Author Impression"),e}trackProfileImpressions(e,t){return _.forEach(e,((o,s)=>{const r={total:_.size(e),position:s,value:o.id};bubEvents.track("After Share Follow Prompt",t,r)})),e}showSuggestedRecommenders(){return!_.isEmpty(this.props.suggestedRecommenderProfiles)&&this.props.isRecommended}renderAuthorsOfBook(){return _.isEmpty(this.props.authorProfiles)?null:React.createElement("div",{className:"auto-follow-profiles-authors"},React.createElement("div",{className:"auto-follow-profiles-section-header"},"Follow the ",A().pluralize(_.size(this.props.authorProfiles),"author")," to get deals and updates:"),React.createElement("div",{className:"auto-follow-profiles-section"},React.createElement(z,{currentUserId:this.props.currentUserId,profileFollows:this.props.authorProfiles,imageSize:"xxsmall",secondaryInfo:"followerCount",trackingEventProps:{source:"after-share-follow-authors-of-book"}})))}renderSuggestedRecommenders(){return this.showSuggestedRecommenders()?React.createElement("div",{className:"auto-follow-profiles-suggested-recommenders"},React.createElement("div",{className:"auto-follow-profiles-section-header"},"Check out these other readers who also recommended this book:"),React.createElement("div",{className:"auto-follow-profiles-section"},React.createElement(z,{currentUserId:this.props.currentUserId,profileFollows:this.props.suggestedRecommenderProfiles,imageSize:"xxsmall",secondaryInfo:"followerCount",trackingEventProps:{source:"after-share-follow-suggested-profiles"}}))):null}renderSocialSharing(){return React.createElement("div",{className:"auto-follow-social-sharing"},React.createElement("div",{className:"auto-follow-profiles-section-header"},"Share this post: "),React.createElement("div",{className:"auto-follow-social-sharing-buttons"},React.createElement(ee,{bookStory:this.props.bookStory,isRecommended:this.props.isRecommended,isCurrentUser:!0,location:"Post Review Prompt"})))}render(){return this.props.isLoaded?React.createElement("div",{className:"auto-follow-authors-step-vc","data-testid":"auto-follow-authors-step"},React.createElement("div",{className:"auto-follow-header"},"Thanks for your review!"),this.renderSocialSharing(),this.renderAuthorsOfBook(),this.renderSuggestedRecommenders()):React.createElement("div",{className:"auto-follow-authors-step-vc","data-testid":"auto-follow-authors-step"},React.createElement(N.m,null))}}oe.propTypes={authorProfiles:PropTypes.arrayOf(x._.profile),bookStory:x._.bookStory.isRequired,currentUserId:PropTypes.number.isRequired,isLoaded:PropTypes.bool,isRecommended:PropTypes.bool,suggestedRecommenderProfiles:PropTypes.arrayOf(x._.profile)};const se=(0,s.$j)(((e,t)=>{const o=p.C.getSelector(e),s=te.R.getSelector(e),r=T.I.currentUserId(),i=s.getBookRecommendation(r,t.bookStory.bookId||_.get(t.bookStory,"book.id"));return{authorProfiles:o.getProfileCollection("auto-followed-authors"),currentUserId:r,isLoaded:o.isCollectionLoaded("auto-followed-authors")&&o.isCollectionLoaded("suggested-recommenders"),isRecommended:_.get(i,"isRecommended",!1),suggestedRecommenderProfiles:o.getProfileCollection("suggested-recommenders")}}))(oe);var re=o(87679),ie=o(92613),ae=o(26076),ne=o(78405),le=o(21453),pe=o(88426);class ce extends React.PureComponent{constructor(e){super(e),this.state={selectedBookListSlug:void 0},this.handleBookListChange=this.handleBookListChange.bind(this),this.handleMoveBookToList=this.handleMoveBookToList.bind(this),this.handleRemoveBookFromList=this.handleRemoveBookFromList.bind(this),this.handleUpdateButton=this.handleUpdateButton.bind(this)}handleBookListChange(e){return this.setState({selectedBookListSlug:e.target.value})}handleMoveBookToList(){const e=this.props.featuredBook.bookListSlug,t=this.getBookListSlug();return re.Z.moveBookToList(this.props.featuredBook,t).then((()=>(ae.t.movedBookToList({addToBookIds:this.props.defaultList===t,bookId:this.props.featuredBook.id}),this.trackBookmark(e,t,this.props.featuredBook),"finished"!==t||this.props.hasRatedBook?this.props.onClose():this.props.currentUserProfile.authorId?i.H.createBookStoryPermission(this.props.featuredBook.id).then((()=>i.H.selectedRecommendedBookStep())).catch((()=>this.props.onClose())):i.H.selectedRecommendedBookStep())))}handleRemoveBookFromList(){return re.Z.removeBookFromList(this.props.featuredBook,this.props.featuredBook.bookListSlug).then((()=>(pe.f.remove(this.props.featuredBook,this.props.featuredBook.bookListSlug,pe.f.SEARCH_MODAL_TRACKING_ID),this.props.onClose)))}handleUpdateButton(){this.handleMoveBookToList()}getBookListSlug(){return this.state.selectedBookListSlug||this.props.featuredBook.bookListSlug||this.props.defaultList}trackBookmark(e,t,o){return _.isNil(e)?pe.f.add(o,t,pe.f.SEARCH_MODAL_TRACKING_ID):pe.f.move(o,t,pe.f.SEARCH_MODAL_TRACKING_ID)}renderActionButtons(){return null!=this.props.featuredBook.bookListSlug?React.createElement("div",{className:"manage-book-actions"},React.createElement("span",{className:"remove-bookmark"},React.createElement(ne.Q,{bubStyle:"mist",loadingText:"Removing",isLoading:this.props.isRemoving,onClick:this.handleRemoveBookFromList,full:!0},"Remove")),React.createElement("span",{className:"update"},React.createElement(ne.Q,{loadingText:"Updating",isLoading:this.props.isUpdating,onClick:this.handleUpdateButton,bubStyle:"lava",full:!0},"Update"))):React.createElement("div",{className:"add-to-list"},React.createElement(ne.Q,{className:"update",loadingText:"Adding",isLoading:this.props.isUpdating,onClick:this.handleUpdateButton,bubStyle:"lava",full:!0},"Add to List"))}renderBookLists(){const e=this.props.bookLists.map((e=>{const t=`book-list-${e.slug}`;return React.createElement("li",{key:e.slug},React.createElement("input",{id:t,type:"radio",name:"book-list",value:e.slug,defaultChecked:this.getBookListSlug()===e.slug,onChange:this.handleBookListChange}),React.createElement("label",{htmlFor:t},e.description))}));return React.createElement("ul",{className:"book-lists","aria-label":"Book Lists"},e)}render(){return React.createElement("div",{className:"bookmark-step-vc"},React.createElement("div",{className:"prompt"},"Save to Book List"),React.createElement("div",{className:"book-details"},React.createElement("div",{className:"book-cover"},React.createElement(le.y,{coverUrl:this.props.featuredBook.coverUrl,bookTitle:this.props.featuredBook.title})),this.renderBookLists()),this.renderActionButtons())}}ce.propTypes={bookLists:PropTypes.array,currentUserProfile:x._.profile,defaultList:PropTypes.string,featuredBook:x._.book.isRequired,formId:PropTypes.string,hasRatedBook:PropTypes.bool,isUpdating:PropTypes.bool,isRemoving:PropTypes.bool,onClose:PropTypes.func.isRequired},ce.defaultProps={defaultList:"wanted"};const de=(0,s.$j)(((e,t)=>{const o=n.G.getSelector(e),s=ie.C.getSelector(e);return{isUpdating:o.isUpdating(t.featuredBook),isRemoving:o.isRemoving(t.featuredBook),hasRatedBook:!!o.hasRated(t.featuredBook.id),bookLists:s.getBookListsWithoutSkipped()}}))(ce);var ue=o(9052);class he extends React.PureComponent{renderLabel(){return _.isEmpty(this.props.label)?null:React.createElement("div",{className:"section-label"},this.props.label)}render(){return React.createElement("div",{id:"reaction-section"},React.createElement("div",{className:`reactions-section ${this.props.labelStyle}`},this.renderLabel(),React.createElement("div",{className:"child-component"},this.props.children)))}}he.propTypes={label:PropTypes.string,labelStyle:PropTypes.oneOf(["inline","block"])},he.defaultProps={labelStyle:"inline"};var me=o(23606),ge=o(76197);const ye={add(e,t){return bubEvents.track("Ratings","Rated",{label:e,value:t})},remove(e,t){return bubEvents.track("Ratings","Unrated",{label:e,value:t})}};class be extends React.PureComponent{constructor(e){super(e),this.handleRating=this.handleRating.bind(this),this.onRate=this.onRate.bind(this)}handleRating(e){if(e.rating>=4){const e=!0,t=_.get(this.props.book,"bookListSlug");this.props.onRateCallback(this.props.book),ge.t.toggleCheckbox(this.props.book.id,e,t)}return this.props.onRateCallback(this.props.book)}onRate(e){return e===this.props.book.usersRating&&(e=0),0===e?ye.remove(this.props.ratingSource,this.props.book.id):ye.add(this.props.ratingSource,this.props.book.id),this.props.cameFromSearch&&bubEvents.track("Book","Rated",{label:"Book Origin",value:"Search"}),re.Z.rateBook(this.props.book,e,this.props.currentUserId).then(this.handleRating)}render(){return React.createElement("div",{className:"rate-book-vc"},React.createElement(me.g,{annotate:this.props.annotate,interactive:this.props.interactive,size:"large",rating:this.props.book.usersRating,onRate:this.onRate,orientAnnotation:this.props.windowMatchesXs?"bottom":"left"}))}}be.propTypes={book:x._.book.isRequired,currentUserId:PropTypes.number,annotate:PropTypes.bool,interactive:PropTypes.bool,cameFromSearch:PropTypes.bool,onRateCallback:PropTypes.func,ratingSource:PropTypes.string,windowMatchesXs:PropTypes.bool},be.defaultProps={annotate:!0,interactive:!0,cameFromSearch:!1,currentUserId:null,onRateCallback:_.noop,windowMatchesXs:!1};const ke=(0,s.$j)(((e,t)=>{const o=n.G.getSelector(e),s=a.h.getSelector(e);return{book:o.getBookForId(t.bookId),cameFromSearch:s.bookFromSearchResult,currentUserId:T.I.currentUserId()}}))((0,U.$)(be));class Te extends React.PureComponent{render(){return React.createElement("div",{id:"rate-book-form",className:"rate-book-form"},React.createElement(he,{label:"Your Rating",labelStyle:"inline"},React.createElement("div",{className:"reactions-wrapper"},React.createElement("div",{className:"rate-book-vc-wrapper"},React.createElement(ke,{bookId:this.props.bookId,onRateCallback:this.props.onRate,annotate:!this.props.windowMatchesXs,ratingSource:this.props.ratingSource})))))}}Te.propTypes={bookId:PropTypes.number.isRequired,onRate:PropTypes.func,ratingSource:PropTypes.string},Te.defaultProps={onRate:_.noop};const Se=(0,U.$)(Te);var _e=o(97426),fe=o(6055);const Ee={add(e,t){return bubEvents.track("Reactions","Added",{label:e,value:t})},remove(e,t){return bubEvents.track("Reactions","Removed",{label:e,value:t})}};class Re extends React.PureComponent{constructor(e){super(e),this.handleReaction=this.handleReaction.bind(this)}handleReaction(){let e=null;const t=this.props.reaction;return this.props.active?(Ee.remove(t.displayName,this.props.bookId),e=r.M.delete({bookId:this.props.bookId,reactionId:t.id,userId:this.props.userId})):(Ee.add(t.displayName,this.props.bookId),e=r.M.create({bookId:this.props.bookId,reactionId:t.id,bookListSlug:this.props.bookListSlug})),e.then((()=>this.props.onReaction({bookId:this.props.bookId,reactionId:t.id})))}render(){return React.createElement(_e.B,{className:`book-reaction-${this.props.reaction.internalName}`,label:this.props.reaction.displayName,active:this.props.active,handleClick:this.handleReaction})}}Re.propTypes={bookId:PropTypes.number.isRequired,bookListSlug:PropTypes.string,userId:PropTypes.number,reaction:x._.reaction,onReaction:PropTypes.func,active:PropTypes.bool},Re.defaultProps={onReaction:_.noop};const Pe=(0,s.$j)(((e,t)=>({active:!!fe.v.getSelector(e).getBookReaction(t.userId,t.bookId,t.reaction.id),reaction:t.reaction})))(Re);class Ce extends React.Component{constructor(e){super(e),this.state={showAllReactions:!1},this.onShowMore=this.onShowMore.bind(this),this.reactionsToShow=this.reactionsToShow.bind(this)}componentDidMount(){r.M.getBookReactions(this.props.userId,this.props.bookId)}onShowMore(){bubEvents.track("Reactions","Show More"),this.setState({showAllReactions:!0})}getInitReactions(){return _.take(this.props.reactions,this.reactionsToShow())}getReactions(){const e=this.getInitReactions();return _.concat(e,_.difference(this.props.reactions,e))}reactionsToShow(){return this.props.windowMatchesXs?5:30}renderReactions(){let e=this.getReactions();return this.state.showAllReactions||(e=this.getInitReactions()),e=_.map(e,(e=>React.createElement(Pe,{key:e.id,reaction:e,userId:this.props.userId,bookId:this.props.bookId,bookListSlug:this.props.bookListSlug,onReaction:this.props.onReaction}))),React.createElement("div",{className:"book-reactions"},e)}renderShowMoreButton(){return this.state.showAllReactions||this.props.reactions.length<=this.reactionsToShow()?null:React.createElement("div",{className:"show-more-reactions"},React.createElement(B.G,{label:"Show More",bubStyle:"lava",renderAs:"link",onClick:this.onShowMore,icon:React.createElement(W.J,{name:"arrow_down"})}))}render(){return React.createElement("div",{className:"book-reactions-vc"},this.renderReactions(),this.renderShowMoreButton())}}Ce.propTypes={bookId:PropTypes.number.isRequired,bookListSlug:PropTypes.string,userId:PropTypes.number,reactions:x._.reactions,onReaction:PropTypes.func},Ce.defaultProps={userId:void 0,reactions:[],onReaction:_.noop};const Ie=(0,s.$j)((e=>({reactions:fe.v.getSelector(e).reactions})))((0,U.$)(Ce));class Oe extends React.PureComponent{render(){return React.createElement("div",{className:"book-reactions-form"},React.createElement(he,{label:"What did you like about this book?",labelStyle:"block"},React.createElement(Ie,{bookId:this.props.bookId,bookListSlug:this.props.bookListSlug,userId:this.props.userId,onReaction:this.props.onReaction})))}}Oe.propTypes={bookId:PropTypes.number.isRequired,bookListSlug:PropTypes.string,userId:PropTypes.number.isRequired,onReaction:PropTypes.func},Oe.defaultProps={onReaction:_.noop};const ve=Oe;var Be=o(15758),we=o(10141),Le=o(16174),Ae=o(66227),Ne=o(85689),Me=o(77381),De=o(74718);class Fe extends React.Component{constructor(e){super(e),this.state={focused:!1},this.focusOnInput=this.focusOnInput.bind(this),this.openMentionModal=this.openMentionModal.bind(this),this.closeMentionModal=this.closeMentionModal.bind(this),this.onInputBlur=this.onInputBlur.bind(this),this.onInputFocus=this.onInputFocus.bind(this),this.onInputChange=this.onInputChange.bind(this),this.onInputKeyDown=this.onInputKeyDown.bind(this),this.onChange=this.onChange.bind(this),this.onClick=this.onClick.bind(this)}componentDidMount(){this.props.scrollOnFocus&&De.c.matchesXs()&&$(window).scrollTop($(this.textareaChild()).offset().top-50),this.focusOnInput()}componentDidUpdate(){_.defer((()=>{this.focusOnInput()}))}onChange(e){this.props.onFormChanged({name:this.props.name,value:e})}onClick(){return Le.Q.setCursorIndex(this.cursorIndex())}onInputBlur(e){const t=e.target.value;return this.setState({focused:!1}),Le.Q.setCursorIndex(this.cursorIndex()),this.props.onBlur?this.props.onBlur(e):this.props.validateOnBlur?this.onChange(t):null}onInputChange(e){this.onChange(e.value)}onInputFocus(e){return this.props.onFocus?this.props.onFocus(e):null}onInputKeyDown(e){const t=_.range(37,41);return _.inRange(e.keyCode,t)?Le.Q.setCursorIndex(this.cursorIndex()):null}focusOnInput(){if("test"!==window.bubEnv&&this.props.isActive&&this.props.isFocused&&!this.state.focused){const e=this.props.cursorIndex;this.cursorIndex()!==e&&this.textareaChild().setSelectionRange(e,e),this.setState({focused:!0}),this.textareaChild().focus()}}inputProps(){const e=this.props.classes||[];return null!=this.props.errorMessages&&this.props.errorMessages.length&&e.push("required-notice"),"iPhone/iPod"===BrowserDetect.OS&&e.push("safari-mobile"),this.props.isActive&&e.push("active"),{inputId:this.props.textAreaId,name:this.props.name,className:e.join(" "),inputWrapperClassName:e.join(" "),inputType:"textarea",onChange:this.onInputChange,validateOnBlur:!1,type:"text",placeholder:this.props.placeholder,onBlur:this.onInputBlur,onFocus:this.onInputFocus,onKeyDown:this.onInputKeyDown,onClick:this.onClick,value:this.props.value,ref:e=>{this.textInput=e},autoFocus:this.props.isFocused,elementOnly:!0}}openMentionModal(e){this.setState({focused:!1}),Le.Q.setCursorIndex(this.cursorIndex()),Le.Q.setActiveMentionModal(this.props.formId),Le.Q.showMentionModal(e)}closeMentionModal(){Le.Q.hideMentionModal()}textareaChild(){return this.textInput.textInput}cursorIndex(){return this.textareaChild().selectionStart}renderMentionControls(){const e=React.createElement("span",{key:"profile-mention",className:"mention-button-wrapper profile-mention-btn"},React.createElement(B.G,{bubStyle:"stone",renderAs:"link",tooltipText:"Mention user",tooltipPlacement:"top",onClick:()=>this.openMentionModal(l.t.PROFILE_MODAL),icon:React.createElement(W.J,{name:"user_plus",className:"user-plus-icon"}),ariaLabel:"Mention user"})),t=[React.createElement("span",{key:"book-mention",className:"mention-button-wrapper book-mention-btn"},React.createElement(B.G,{bubStyle:"stone",renderAs:"link",tooltipText:"Mention book",tooltipPlacement:"top",onClick:()=>this.openMentionModal(l.t.BOOK_MODAL),icon:React.createElement(W.J,{name:"book",className:"book-icon"})}))];return this.props.profileMentionsEnabled&&t.unshift(e),this.props.isActive?React.createElement("div",{className:"mention-trigger-wrapper"},React.createElement("div",{className:"mention-trigger"},t)):null}render(){return React.createElement(Ne.X,{name:this.props.name,label:this.props.label,errorMessages:this.props.errorMessages,hasChanged:this.props.hasChanged,inputWrapperClassName:this.props.classes},React.createElement("div",{className:"mentionable-input"},React.createElement(Me.I,this.inputProps()),this.renderMentionControls()))}}Fe.propTypes={value:PropTypes.string,errorMessages:PropTypes.array,validateOnBlur:PropTypes.bool,profileMentionsEnabled:PropTypes.bool,isActive:PropTypes.bool,isFocused:PropTypes.bool,placeholder:PropTypes.string,formId:PropTypes.oneOfType([PropTypes.string,PropTypes.number]).isRequired,name:PropTypes.string,label:PropTypes.string,hasChanged:PropTypes.bool,classes:PropTypes.array,onFocus:PropTypes.func,onBlur:PropTypes.func,onFormChanged:PropTypes.func,textAreaId:PropTypes.string,scrollOnFocus:PropTypes.bool,cursorIndex:PropTypes.number},Fe.defaultProps={value:"",errorMessages:[],validateOnBlur:!1,profileMentionsEnabled:!0,placeholder:"Write a comment...",textAreaId:null,scrollOnFocus:!0};const xe=(0,s.$j)(((e,t)=>{const o=c.c.getSelector(e),s=l.t.getSelector(e),r=o.getFormData(t.formId),i=null!=r&&null!=r[t.name]?r[t.name]:{};return{cursorIndex:s.cursorIndex,hasChanged:i.hasChanged,errorMessages:i.errorMessages,value:i.value}}))(Fe);var Ue=o(65123);class He extends React.PureComponent{constructor(e){super(e),this.onKeyDown=this.onKeyDown.bind(this)}onKeyDown(e){e.keyCode!==Ue.R.ENTER&&e.keyCode!==Ue.R.SPACE_BAR||(e.preventDefault(),this.props.onClick())}render(){return React.createElement("div",{className:"bub-text-area inactive",onClick:this.props.onClick,onKeyDown:this.onKeyDown,role:"button",tabIndex:"0"},this.props.children)}}He.propTypes={onClick:PropTypes.func.isRequired};var $e=o(76189),Ke=o(83842),ze=o(75073),je=o(7238);class Ge extends React.Component{constructor(e){super(e),this.onSubmit=this.onSubmit.bind(this),this.handleChange=this.handleChange.bind(this),this.onKeyDown=this.onKeyDown.bind(this)}handleChange(e){this.props.onChange(e.value)}onSubmit(){this.debouncedSearch.textInput.blur(),$(this.resultsContainer).scrollTop(0),this.props.onSubmit()}onKeyDown(e){"Enter"===e.key&&this.onSubmit()}searchRenderHelper(){const e={autoFocus:this.props.autoFocus,onChange:this.handleChange,className:"form-control bub-search",name:"bub-search",placeholder:this.props.placeholder,ref:e=>{this.debouncedSearch=e},value:this.props.searchValue||"",inputWrapperClassName:"bub-search-input",onKeyDown:this.onKeyDown};let t=React.createElement(Me.I,e);if(this.props.onSubmit){let o;o=this.props.windowMatchesXs?React.createElement(B.G,{onClick:this.onSubmit,bubStyle:"lava",full:!0,icon:React.createElement(W.J,{name:"search",className:"search-icon"})}):React.createElement(B.G,{onClick:this.onSubmit,label:"Search",full:!0,bubStyle:"lava"}),t=React.createElement("div",null,React.createElement("div",{className:"col-xs-10 input-wrapper"},React.createElement(Me.I,e)),React.createElement("div",{className:"col-xs-2 search-wrapper"}," ",o," "))}return React.createElement("div",{className:"bub-search"},t,React.createElement("div",{className:"clearfix"}),this.renderSearchResults())}renderSearchResults(){return this.props.noResultsFound?React.createElement("div",null,React.createElement("div",{className:"no-results"},"No results found"),React.createElement("div",{className:"results-actions"},this.props.reportLink)):this.props.resultsCollection?React.createElement("div",{className:"results",ref:e=>{this.resultsContainer=e}},this.props.resultsCollection,React.createElement(je.n,{show:this.props.showLoadMore,isLoading:this.props.isLoading,loadMore:this.props.onLoadMore}),this.props.reportLink):this.props.isFailed?React.createElement("p",null,"Sorry! This feature is not working at this time. Please try again later. "):this.props.isLoading?React.createElement(N.m,null):null}render(){return React.createElement("div",null,this.searchRenderHelper())}}Ge.propTypes={autoFocus:PropTypes.bool,noResultsFound:PropTypes.bool,onChange:PropTypes.func,onLoadMore:PropTypes.func,onSubmit:PropTypes.func,placeholder:PropTypes.string,reportLink:PropTypes.node,resultsCollection:PropTypes.object,showLoadMore:PropTypes.bool,searchValue:PropTypes.string,isLoading:PropTypes.bool,isFailed:PropTypes.bool},Ge.defaultProps={searchValue:""};const qe=(0,U.$)(Ge);class Ve extends React.Component{constructor(e){super(e),this.handleOnChange=this.handleOnChange.bind(this),this.loadMoreSearchResults=this.loadMoreSearchResults.bind(this),this.onSubmit=this.onSubmit.bind(this),this.debouncedSearchProfiles=_.debounce(this.searchProfiles,200)}handleOnChange(e){const t={size:15,search:e};return ze.d.setProfileSearchQuery(t.search),this.debouncedSearchProfiles(t)}onSubmit(){this.debouncedSearchProfiles.cancel();const e={size:15,search:this.props.profileSearchQuery};return ze.d.setProfileSearchQuery(e.search),this.searchProfiles(e)}loadMoreSearchResults(){const e={search:this.props.profileSearchQuery,from:this.props.profileCollectionLength,size:15};return ze.d.searchProfiles(e,this.props.relationType)}noResultsFound(){return this.props.isCollectionLoaded&&0===this.props.profileCollectionLength}searchProfiles(e){return ze.d.searchProfiles(e,this.props.relationType)}renderSearchProfiles(){let e;return this.props.typeahead||(e=this.onSubmit),React.createElement(qe,{autoFocus:this.props.autoFocus,placeholder:"Search for a user...",noResultsFound:this.noResultsFound(),onChange:this.handleOnChange,resultsCollection:this.props.resultsCollection,showLoadMore:this.props.moreProfileFollowsExist||!1,onLoadMore:this.loadMoreSearchResults,onSubmit:e,searchValue:this.props.profileSearchQuery,isLoading:this.props.isCollectionLoading,isFailed:this.props.isCollectionFailed})}render(){return React.createElement("div",null,this.renderSearchProfiles())}}Ve.propTypes={profileSearchQuery:PropTypes.string,profileCollectionLength:PropTypes.number,relationType:PropTypes.string,isCollectionLoaded:PropTypes.bool,typeahead:PropTypes.bool,autoFocus:PropTypes.bool,resultsCollection:PropTypes.object,moreProfileFollowsExist:PropTypes.bool,isCollectionLoading:PropTypes.bool,isCollectionFailed:PropTypes.bool},Ve.defaultProps={typeahead:!0};const We=(0,s.$j)(((e,t)=>{const o=p.C.getSelector(e);return{isCollectionLoaded:o.isCollectionLoaded(t.relationType),profileCollectionLength:o.getProfileCollection(t.relationType).length,moreProfileFollowsExist:o.getMoreProfileFollowsExist(t.relationType),isCollectionLoading:o.isCollectionLoading(t.relationType),isCollectionFailed:o.isCollectionFailed(t.relationType),profileSearchQuery:o.profileSearchQuery}}))(Ve),Ye={reportBookChange(e){return(0,S.t)({method:"POST",url:this._path("report_book_change"),data:{book_id:e.bookId,partner_id:e.partnerId,change_request:e.changeRequest,comment:e.comment,release_date:e.releaseDate}})},batchReportBookChange(e){return(0,S.t)({method:"POST",url:this._path("batch_report_book_change"),dataType:"json",contentType:"application/json",data:JSON.stringify({requests:_.map(e,(e=>({book_id:e.bookId,partner_id:e.partnerId,change_request:e.changeRequest,comment:e.comment,release_date:e.releaseDate})))})})},getBookChangeRequests(){return(0,S.t)({method:"GET",url:this._path("")})},_path(e){return`/book_change_requests/${e}`}},Qe="bookChangeRequest",Je=(0,h.hp)(Qe,["SET_ACTIVE_BOOK_ID","SET_ACTIVE_MODAL","GET_BOOK_CHANGE_REQUESTS_SUCCESS","SET_LAST_BOOK_CHANGE_REQUEST","ADD_BOOK_CHANGE_REQUEST"]);(0,h.fn)(Qe,(0,u.Uy)(((e,t)=>{switch(t.type){case Je.SET_ACTIVE_BOOK_ID:return e.activeBookId=t.payload.bookId,e;case Je.SET_ACTIVE_MODAL:return e.activeModal=t.payload.modal,e;case Je.GET_BOOK_CHANGE_REQUESTS_SUCCESS:return e.bookChangeRequests=t.payload.data,e;case Je.SET_LAST_BOOK_CHANGE_REQUEST:return e.lastBookChangeRequest=t.payload.changeRequest,e;case Je.ADD_BOOK_CHANGE_REQUEST:return e.bookChangeRequests=_.concat(e.bookChangeRequests,t.payload.changeRequestData),e;default:return e}}),{activeBookId:null,activeModal:null,bookChangeRequests:[],lastBookChangeRequest:null}));const Ze=e=>e[Qe],Xe=(0,d.P1)(Ze,(e=>t=>_(e.bookChangeRequests).filter((e=>e.book_id===t)).map("change_request").value())),et={actionTypes:Je,getSelector:e=>{const t={getBookChangeRequestsByBookId:t=>Xe(e)(t)};return{...Ze(e),...t}},BOOK_CHANGE_REQUEST_FORM:"bookChangeRequestForm",BOOK_CHANGE_REQUEST_CONFIRMATION:"bookChangeRequestConfirmation"},tt=new class{constructor(){this.getBookChangeRequestsSuccess=this.getBookChangeRequestsSuccess.bind(this)}setActiveBookId(e){h.tO.dispatch({type:et.actionTypes.SET_ACTIVE_BOOK_ID,payload:{bookId:e}})}setActiveModal(e){h.tO.dispatch({type:et.actionTypes.SET_ACTIVE_MODAL,payload:{modal:e}})}setLastBookChangeRequest(e){h.tO.dispatch({type:et.actionTypes.SET_LAST_BOOK_CHANGE_REQUEST,payload:{changeRequest:e}})}addBookChangeRequest(e){h.tO.dispatch({type:et.actionTypes.ADD_BOOK_CHANGE_REQUEST,payload:{changeRequestData:e}})}reportBookChangeRequest(e){const t={bookId:e.bookId,partnerId:e.partnerId,changeRequest:e.changeRequest,comment:e.comment,releaseDate:e.releaseDate};return Ye.reportBookChange(t)}getBookChangeRequests(){return Ye.getBookChangeRequests().then(this.getBookChangeRequestsSuccess.bind(this))}getBookChangeRequestsSuccess(e){const t={data:e};return h.tO.dispatch({type:et.actionTypes.GET_BOOK_CHANGE_REQUESTS_SUCCESS,payload:t}),t}};var ot=o(96486),st=o.n(ot),rt=o(44837),it=o(45781);const at={removeExtraNewlines(e){return null==e&&(e=""),e.replace(/(\n){2,}/g,"\n\n").replace(/(\n)*$/g,"")},linkifyAndTruncateUrls(e,t){return null==e&&(e=""),(t?it.Z:rt.Z)(e,{target:(e,t)=>"url"===t&&"_blank",format:(e,t)=>("url"===t&&e.length>40&&(e=st().truncate(e,{length:43})),e)})},stripTags(e){return null==e&&(e=""),$("<p>").html(e).text()},format(e,t,o=450,s=!1){let r;null==e&&(e="");let i=this.removeExtraNewlines(this.linkifyAndTruncateUrls(e,s));if(t){if(e.length>o){const t=e.substr(0,250);r=Math.max(t.lastIndexOf(" "),t.lastIndexOf("\n")),i=this.linkifyAndTruncateUrls(e.substr(0,r),s)}if(i.split("\n").length-1>3){r=i.indexOf("\n");for(let e=1;e<=3;e+=1)r=i.indexOf("\n",r+1);i=i.substr(0,r)}}return i},willTruncate(e,t=450){return null==e&&(e=""),e.length>t||this.removeExtraNewlines(e).split("\n").length-1>3},indefiniteArticleFor(e){return st().some(["a","e","i","o","u"],(t=>e.toLowerCase()[0]===t))?"an":"a"}},nt={validateUrl(e,t,o){if(!e.length)return null;if(!e.startsWith("https://")&&!e.startsWith("http://"))return"Retailer link must begin with http:// or https://";const s=new RegExp(`https?://(${t.join("|")})`);return e.match(s)?null:1===t.length?`This isn't a link we recognize. The retailer link needs to contain: ${t[0]}`:`This isn't a link we recognize. Please confirm you've entered a direct link to ${at.indefiniteArticleFor(o)} ${o} ebook and re-enter it above.`}};function lt(){return lt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},lt.apply(this,arguments)}const pt=["www.amazon.com","www.amazon.co.uk","www.amazon.ca","www.amazon.com.au"];class ct extends React.Component{constructor(e){super(e),this.formValues={},this.state={displayRetailerLink:!0,errorMessage:""},this.handleFormSubmit=this.handleFormSubmit.bind(this),this.onFormChanged=this.onFormChanged.bind(this),this.onSkipRetailerLinkClicked=this.onSkipRetailerLinkClicked.bind(this)}componentDidMount(){we.i.setValidationSettings({form_data:this.validationSettings(),form_input_id:this.props.formId}),we.i.validateAndTouchAllInputs(this.props.formId)}handleFormSubmit(){if(we.i.validateAndTouchAllInputs(this.props.formId),this.props.isValid){const e={changeRequest:this.props.changeRequestType,comment:`Author: "${this.props.formData["missing-book-author"].value}" \n Title: "${this.props.formData["missing-book-title"].value}" \n Retailer Link: "${this.props.formData["missing-book-retailer-link"].value}"`};tt.reportBookChangeRequest(e).then(this.props.onSubmitCallback),this.formValues={},we.i.clearForm(this.props.formId),we.i.validateAndTouchAllInputs(this.props.formId)}else this.state.displayRetailerLink&&this.setState({displayRetailerLink:!1,errorMessage:"Please provide additional information to help us find the book or author you're looking for."});return null}onFormChanged(e){return this.formValues[e.name]=e.value,this.props.hasValidationSettings||we.i.setValidationSettings({form_data:this.validationSettings(),form_input_id:this.props.formId}),we.i.formChanged({form_input_id:this.props.formId,form_data:e})}onSkipRetailerLinkClicked(){this.setState({displayRetailerLink:!1})}validationSettings(){return{"missing-book-title":[{validator:e=>_.some(e.value)||_.some(this.formValues["missing-book-author"])||this.validateRetailerLink(this.formValues["missing-book-retailer-link"])}],"missing-book-author":[{validator:e=>_.some(e.value)||_.some(this.formValues["missing-book-title"])||this.validateRetailerLink(this.formValues["missing-book-retailer-link"])}],"missing-book-retailer-link":[{validator:e=>this.validateRetailerLink(e.value)||_.some(this.formValues["missing-book-title"])||_.some(this.formValues["missing-book-author"])}]}}validateRetailerLink(e){return!_.isEmpty(e)&&null===nt.validateUrl(e,pt,"retailer")}renderRetailerLinkField(){return this.state.displayRetailerLink?React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"missing-book-retailer-link"},"Book URL (Apple Books, Amazon, etc.)"),React.createElement(Me.I,lt({inputId:"missing-book-retailer-link",type:"text",name:"missing-book-retailer-link",inputWrapperClassName:"book-retailer-link-input",placeholder:"Enter ebook retailer link, e.g. amazon.com/book-title/dp/B00â¦",onChange:this.onFormChanged,autocomplete:"off"},this.props.formData["missing-book-retailer-link"]))):null}renderSkipRetailerLinkButton(){return this.state.displayRetailerLink?React.createElement("div",null,React.createElement(B.G,{onClick:this.onSkipRetailerLinkClicked,label:"Don't have a URL?",renderAs:"link",bubStyle:"stone",hoverBubStyle:"midnight",skinny:!0,dangerouslySkipTitleCase:!0,fullHeight:!0})):null}renderTitleAuthorFields(){return this.state.displayRetailerLink?null:React.createElement(React.Fragment,null,React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"title"},"Book Title"),React.createElement(Me.I,lt({type:"text",name:"missing-book-title",inputWrapperClassName:"book-title-input",placeholder:"Enter missing book title",onChange:this.onFormChanged,autocomplete:"off"},this.props.formData["missing-book-title"]))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"author"},"Book Author"),React.createElement(Me.I,lt({type:"text",name:"missing-book-author",inputWrapperClassName:"author-input",placeholder:"Enter missing author",onChange:this.onFormChanged,autocomplete:"off"},this.props.formData["missing-book-author"]))))}render(){return React.createElement("div",{id:"add-missing-book"},React.createElement("div",{className:"add-missing-book-hint"},this.props.text),React.createElement("div",{className:"add-missing-book-hint"},this.state.errorMessage),React.createElement("form",{action:"#",onSubmit:this.handleFormSubmit},this.renderRetailerLinkField(),this.renderTitleAuthorFields(),React.createElement("div",{className:"missing-book-submit-container"},React.createElement(B.G,{disabled:!this.props.isValid&&(!this.state.displayRetailerLink||_.isEmpty(this.props.formData["missing-book-retailer-link"])),onClick:this.handleFormSubmit,label:"Submit",bubStyle:"lava"}),this.renderSkipRetailerLinkButton())))}}ct.propTypes={formData:PropTypes.object,formIsValid:PropTypes.bool,formValues:PropTypes.object,hasValidationSettings:PropTypes.bool,onSubmitCallback:PropTypes.func,text:PropTypes.node,onFormSubmit:PropTypes.func,modal:PropTypes.bool,changeRequestType:PropTypes.string,formId:PropTypes.string,isValid:PropTypes.bool},ct.defaultProps={formData:{},changeRequestType:"missing_book",formId:"missing-book-form-id",onSubmitCallback:_.noop};const dt=(0,s.$j)(((e,t)=>{const o=c.c.getSelector(e);return t=_.merge({},ct.defaultProps,t),{formData:o.getFormData(t.formId),formValues:o.getFormValues(t.formId),hasValidationSettings:o.getHasValidationSettings(t.formId),isValid:o.getIsValid(t.formId)}}))(ct),ut="bookSearch",ht=(0,h.hp)(ut,["QUERY_UPDATED","SEARCH_RESULTS_SUCCESS","UPDATE_SUCCESS","DISMISS_BOOKMARKS_ALERT","TOGGLE_REFINE_MODAL"]);(0,h.fn)(ut,(0,u.Uy)(((e,t)=>{switch(t.type){case ht.DISMISS_BOOKMARKS_ALERT:return _.assignIn(e,{isBookmarksAlertDismissed:!0});case ht.TOGGLE_REFINE_MODAL:return _.isBoolean(t.payload.toggleModalValue)?_.assignIn(e,{modalToggled:t.payload.toggleModalValue}):_.assignIn(e,{modalToggled:!e.modalToggled});case ht.QUERY_UPDATED:return _.assignIn(e,{query:t.payload.query,currentPage:_.parseInt(t.payload.query.page)||e.currentPage});case ht.SEARCH_RESULTS_SUCCESS:return _.assignIn(e,{isLoadingResults:!1,query:t.payload.query||e.query,pagingSize:t.payload.pagingSize||e.pagingSize,totalResultsCount:t.payload.totalResultsCount||e.totalResultsCount,userHasAnyBookmarks:t.payload.userHasAnyBookmarks,pagedBookIds:_.assignIn(e.pagedBookIds,{[e.currentPage]:_.map(t.payload.books,"id")}),promotedBookIds:_.map(t.payload.promotedBooks,"id"),hidePromotedBooks:t.payload.hidePromotedBooks});case ht.UPDATE_SUCCESS:return _.assignIn(e,{totalResultsCount:t.payload.totalResultsCount||e.totalResultsCount,pagedBookIds:_.assignIn(e.pagedBookIds,{[e.currentPage]:_.map(t.payload.books,"id")}),promotedBookIds:_.map(t.payload.promotedBooks,"id"),hidePromotedBooks:t.payload.hidePromotedBooks});default:return e}}),{isLoadingResults:!0,pagedBookIds:{},promotedBookIds:[],hidePromotedBooks:void 0,pagingSize:0,query:{},currentPage:1,totalResultsCount:0,userHasAnyBookmarks:!1,lastBookmarkedBookId:void 0,isBookmarksAlertDismissed:!1,modalToggled:!1}));const mt=e=>e[ut],gt=(0,d.P1)(mt,(e=>e.pagedBookIds[e.currentPage]||[])),yt=(0,d.P1)(mt,(e=>memoize((t=>(t-1)*e.pagingSize<e.totalResultsCount)))),bt={actionTypes:ht,getSelector:e=>{const t={currentBookIds:_.partial(gt,e),doesPageHaveBooks:t=>yt(e)(t)};return{...mt(e),...t}}},kt="book-search-wishlist-cta";var Tt=o(88485);const St={getSearchResults(e){return(0,S.t)({url:this._url(e.path,"init.json"),data:this._searchParams(e)})},getMoreSearchResults(e){return(0,S.t)({url:this._url(e.path,"more.json"),data:this._searchParams(e)})},_searchParams(e){return{search:e.search,page:e.page,tags:e.tags,authors:e.authors,deal_types:e.dealTypes,lower_release_date_limit:e.lowerReleaseDateLimit,upper_release_date_limit:e.upperReleaseDateLimit,results_per_page:e.resultsPerPage}},_url(e,t){return _.isEmpty(e)?(0,Tt.F)("www",`/search/${t}`):(0,Tt.F)("www",e)}};var _t=o(43912);const ft="searchFacets",Et=(0,h.hp)(ft,["ADD_FACETS"]);(0,h.fn)(ft,(0,u.Uy)(((e,t)=>t.type===Et.ADD_FACETS?_.assignIn(e,{facets:t.payload.facets}):e),{facets:[]}));const Rt=e=>e[ft],Pt={actionTypes:Et,getSelector:e=>({...Rt(e)}),NEW_RELEASE_HASH:{"Last 30 Days":{lower:"30",upper:"0"},"Last 90 Days":{lower:"90",upper:"0"},"Coming Soon":{lower:"0",upper:"60"}}},Ct=new class{addFacets(e){h.tO.dispatch({type:Pt.actionTypes.ADD_FACETS,payload:{facets:e}})}},It=new class{dismissBookmarksAlert(){h.tO.dispatch({type:bt.actionTypes.DISMISS_BOOKMARKS_ALERT,payload:{}})}toggleRefineModal(e){h.tO.dispatch({type:bt.actionTypes.TOGGLE_REFINE_MODAL,payload:{toggleModalValue:e}})}initialSearchResultsFetch(e){h.tO.dispatch({type:bt.actionTypes.QUERY_UPDATED,payload:{query:e}}),St.getSearchResults(e).then((t=>(bubEvents.track("Book","Search",{label:"Query",value:e.search,page:e.page,totalResults:t.books.length}),bubEvents.track("Book","Search",{label:"Promoted Books Query",value:e.search,totalResults:t.promotedBooks.length}),this.initialSearchResultsSuccess(t))))}initialSearchResultsSuccess(e){Ct.addFacets(e.facets),_t.$.setMessages(e.flashes),re.Z.addBooks({books:e.books}),re.Z.addBooks({books:e.promotedBooks}),h.tO.dispatch({type:bt.actionTypes.SEARCH_RESULTS_SUCCESS,payload:e}),e.wishlistNotificationViewed?$e.c.notificationViewed({id:kt}):$e.c.showNotification({id:kt})}queryUpdated(e){return h.tO.dispatch({type:bt.actionTypes.QUERY_UPDATED,payload:{query:e}}),St.getMoreSearchResults(e).then(this.queryUpdatedSuccess)}queryUpdatedSuccess(e){Ct.addFacets(e.facets),re.Z.addBooks({books:e.books}),re.Z.addBooks({books:e.promotedBooks}),h.tO.dispatch({type:bt.actionTypes.UPDATE_SUCCESS,payload:e})}searchBooks(e,t,o){return e.page||(e.page=1),ue.t.setCollectionStatus({[t]:"loading"}),1===e.page&&ue.t.addSuggestionCollection({[t]:[]}),St.getSearchResults(e).then((s=>(e.page>1?(this.queryUpdatedSuccess(s),ue.t.appendSuggestionCollection({relationType:t,bookIds:_.map(s.books,"id")})):(this.initialSearchResultsSuccess(s),ue.t.addSuggestionCollection({[t]:_.map(s.books,"id")})),ue.t.setCollectionStatus({[t]:"loaded"}),bubEvents.track("Book","Search",{label:"Query",value:e.search,page:e.page,relationType:t,totalResults:s.books.length}),o?o():null)),(()=>{ue.t.setCollectionStatus({[t]:"failed"})}))}};class Ot extends React.PureComponent{render(){return React.createElement("div",{className:"book-mention-suggestion"},React.createElement("img",{className:"book-cover",src:this.props.book.coverUrl,alt:"book cover"}),React.createElement("div",{className:"book-title"},this.props.book.title),React.createElement("div",{className:"book-authors"},this.props.book.authors))}}Ot.propTypes={book:x._.book};class vt extends React.PureComponent{render(){return React.createElement("button",{className:"mention-suggestion","aria-label":this.props.label,onClick:()=>this.props.onClick(this.props.result.id)},React.createElement("div",{className:"suggestion-wrapper"},React.createElement("div",{className:"component-wrapper"},React.createElement(this.props.component,_.omit(this.props,["component","label","onClick"]))),React.createElement("div",{className:"plus"},"+")))}}function Bt(){return Bt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},Bt.apply(this,arguments)}vt.propTypes={onClick:PropTypes.func,label:PropTypes.string.isRequired,result:PropTypes.object};class wt extends React.Component{renderBooks(){let e=_.omit(this.props,"books");const t=this.props.books;return _.isEmpty(t)?null:t.map((t=>(e=_.merge({},e,{book:t}),React.createElement(vt,Bt({component:Ot,label:`${t.title} by ${t.authors}`,result:t,key:t.id},e)))))}render(){return React.createElement("div",{className:"profile-collection"},this.renderBooks())}}wt.propTypes={books:x._.books,onClick:PropTypes.func.isRequired},wt.defaultProps={books:[]};var Lt=o(36289);class At extends React.Component{constructor(e){super(e),this.state={page:1,reportMissingBook:!1},this.handleOnChange=this.handleOnChange.bind(this),this.onSubmit=this.onSubmit.bind(this),this.loadMoreSearchResults=this.loadMoreSearchResults.bind(this),this.handleReportMissingBook=this.handleReportMissingBook.bind(this),this.reportMissingBookLink=this.reportMissingBookLink.bind(this)}handleOnChange(e){ue.t.setSearchQuery(e)}handleReportMissingBook(e){this.setState({reportMissingBook:e}),this.props.reportMissingBook(e)}onSubmit(){this.setState({page:1});const e={search:this.props.searchSuggestionQuery,page:1};return It.searchBooks(e,this.props.relationType)}loadMoreSearchResults(){const e=this.state.page+1;this.setState({page:e});const t={search:this.props.searchSuggestionQuery,page:e};return It.searchBooks(t,this.props.relationType)}noResultsFound(){return this.props.isCollectionLoaded&&0===this.props.collectionLength}reportMissingBookLink(){return!_.isEmpty(this.props.books)||this.noResultsFound()?React.createElement("span",{className:"report-missing-book"},React.createElement(B.G,{bubStyle:"lava",renderAs:"link",onClick:this.handleReportMissingBook.bind(null,!0),label:"I can't find the book I'm looking for"})):null}renderBookListItemCollection(){return this.props.books.length?React.createElement(wt,{onClick:this.props.onResultClick,books:this.props.books}):null}renderSearch(){const e=this.props.typeahead?null:this.onSubmit,t=this.props.noPlaceholder?"":"Search books...";return this.state.reportMissingBook?React.createElement(dt,{text:React.createElement("span",null,"Please tell us what book you were trying to find. ",React.createElement("b",null,"We will notify you once the book has been added to our database, so that you may recommend it.")),onSubmitCallback:this.handleReportMissingBook.bind(null,!1)}):React.createElement(qe,{autoFocus:!0,noResultsFound:this.noResultsFound(),placeholder:t,onChange:this.handleOnChange,resultsCollection:this.renderBookListItemCollection(),showLoadMore:this.props.moreSuggestionsExist,onLoadMore:this.loadMoreSearchResults,onSubmit:e,reportLink:this.reportMissingBookLink(),searchValue:this.props.searchSuggestionQuery,isLoading:this.props.isCollectionLoading,isFailed:this.props.isCollectionFailed})}render(){return React.createElement("div",{className:"mention-search"},this.renderSearch())}}At.propTypes={collectionLength:PropTypes.number,isCollectionLoading:PropTypes.bool,isCollectionLoaded:PropTypes.bool,isCollectionFailed:PropTypes.bool,moreSuggestionsExist:PropTypes.bool,reportMissingBook:PropTypes.func,relationType:PropTypes.string,searchSuggestionQuery:PropTypes.string,noPlaceholder:PropTypes.bool,typeahead:PropTypes.bool,books:x._.books,onResultClick:PropTypes.func},At.defaultProps={collectionLength:void 0,isCollectionLoading:!1,isCollectionLoaded:!1,isCollectionFailed:!1,moreSuggestionsExist:!1,reportMissingBook:_.noop,relationType:null,searchSuggestionQuery:"",noPlaceholder:!1,typeahead:!1,books:[],onResultClick:_.noop};const Nt=(0,s.$j)(((e,t)=>{const o=Lt.t.getSelector(e),s=bt.getSelector(e);return{isCollectionLoaded:o.isCollectionLoaded(t.relationType),isCollectionFailed:o.isCollectionFailed(t.relationType),collectionLength:o.getSuggestionCollection(t.relationType).length,isCollectionLoading:o.isCollectionLoading(t.relationType),searchSuggestionQuery:o.searchQuery,moreSuggestionsExist:s.doesPageHaveBooks(s.currentPage)}}))(At);var Mt=o(353);function Dt(){return Dt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},Dt.apply(this,arguments)}class Ft extends React.Component{renderSearchSuggestions(){let e=_.omit(this.props,"profiles");return this.props.profiles.map((t=>{const o=_.merge({},t,{profileUrl:null}),s=t.name||t.username;return e=_.merge({},e,{profile:o}),React.createElement(vt,Dt({component:Mt.m,label:t.authorId?s:`${s} (author)`,result:t,size:this.props.windowMatchesXs?"small":"medium",key:t.id,secondaryInfo:"username"},e))}))}render(){return React.createElement("div",{className:"profile-collection"},this.renderSearchSuggestions())}}Ft.propTypes={profiles:x._.profiles};const xt=(0,U.$)(Ft);var Ut=o(92694),Ht=o(29908);class $t extends React.Component{constructor(e){super(e),this.mentionSelected=this.mentionSelected.bind(this),this.profileMentionSelected=this.profileMentionSelected.bind(this),this.bookMentionSelected=this.bookMentionSelected.bind(this)}componentDidMount(){$e.c.getNotificationView({id:"mention-help"})}profileMentionSelected(e){Le.Q.setSelectedProfileId(e).then((()=>this.mentionSelected(Ht.H.profileMentionMarkup(this.props.profileMentioned))))}bookMentionSelected(e){Le.Q.addBookMention(this.props.formId,e).then((()=>this.props.showMentionHelp?Le.Q.showMentionModal(l.t.BOOK_MENTION_TRAINING):this.mentionSelected(Ht.H.bookMentionMarkup(this.props.bookMentioned))))}mentionSelected(e){let t="";const o=this.props.formData&&this.props.formData[this.props.name];void 0!==o&&null!=o&&o.value&&(t=this.props.formData[this.props.name].value);const s=Ht.H.insertMention(e,t,this.props.cursorIndex);return Le.Q.setCursorIndex(this.props.cursorIndex+e.length+1),Le.Q.hideMentionModal(),this.props.handleMention(s)}modalHeaderRenderHelper(){let e;return this.props.mentionType===l.t.PROFILE_MODAL?e="Find profiles to mention":this.props.mentionType===l.t.BOOK_MODAL&&(e="Find books to mention"),e}searchRenderHelper(){if(!this.props.mentionHelpLoaded)return React.createElement(N.m,null);let e;return this.props.mentionType===l.t.PROFILE_MODAL?e=React.createElement(We,{relationType:"mentionResults",autoFocus:!0,typeahead:!1,resultsCollection:this.profileResultsCollectionRenderHelper()}):this.props.mentionType===l.t.BOOK_MODAL?e=React.createElement(Nt,{relationType:"mentionResults",typeahead:!1,onResultClick:this.bookMentionSelected,books:this.props.books}):this.props.mentionType===l.t.BOOK_MENTION_TRAINING&&(e=this.mentionTrainingRenderHelper()),React.createElement("div",{className:"mention-search"},e)}mentionTrainingRenderHelper(){const e=this.props.bookMentioned;return React.createElement("div",{className:"mention-training"},React.createElement("h4",null,"Quick note about mentions"),React.createElement("div",null,"Before you publish your post, your inline mention will look like this:"),React.createElement("div",{className:"slug"},"[",e.slug,"]"),React.createElement("div",null,"Once you publish your post, that same mention will look like this:"),React.createElement("div",{className:"title"},e.title),React.createElement("div",{className:"btn-wrapper"},React.createElement(B.G,{bubStyle:"lava",onClick:()=>this.mentionTrainingOnClick(e),label:"Got It"})))}mentionTrainingOnClick(e){return $e.c.createNotificationView({id:"mention-help"}).then((()=>this.mentionSelected(Ht.H.bookMentionMarkup(e))))}profileResultsCollectionRenderHelper(){return this.props.profiles.length?React.createElement(xt,{onClick:this.profileMentionSelected,profiles:this.props.profiles}):null}render(){return this.props.modal&&this.props.activeMentionModal?React.createElement(Ke.a,{headerDismissButton:!1,headerCloseButton:!0,title:this.modalHeaderRenderHelper(),show:this.props.activeMentionModal,onHide:Le.Q.hideMentionModal,onExited:this.props.onExited},this.searchRenderHelper()):this.props.modal?null:this.searchRenderHelper()}}$t.propTypes={activeMentionModal:PropTypes.bool,books:x._.books,profileMentioned:x._.profile,bookMentioned:x._.book,cursorIndex:PropTypes.number,formData:PropTypes.object,formId:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),handleMention:PropTypes.func,modal:PropTypes.bool,mentionType:PropTypes.string,name:PropTypes.string,onExited:PropTypes.func,profiles:PropTypes.array,showMentionHelp:PropTypes.bool,mentionHelpLoaded:PropTypes.bool},$t.defaultProps={modal:!0,mentionHelpLoaded:!1};const Kt=(0,s.$j)(((e,t)=>{const o=n.G.getSelector(e),s=Lt.t.getSelector(e),r=l.t.getSelector(e),i=c.c.getSelector(e),a=p.C.getSelector(e),d=Ut.N.getSelector(e);return{profiles:a.getProfileCollection("mentionResults"),books:o.getBooksForIds(s.getSuggestionCollection("mentionResults")),formData:i.getFormData(t.formId),activeMentionModal:r.showMentionModal()&&r.activeMentionModal===t.formId,cursorIndex:r.cursorIndex,mentionType:r.mentionType,showMentionHelp:d.showNotification("mention-help"),mentionHelpLoaded:d.notificationLoaded("mention-help"),profileMentioned:a.getProfile(r.selectedProfileId),bookMentioned:o.getBookForId(r.selectedBookId)}}))($t);class zt extends React.Component{deleteBookStory(){i.H.deleteConfirmStep()}renderDeleteButton(){return this.props.bookStoryId?React.createElement("span",{className:"delete-button"},React.createElement(B.G,{renderAs:"link",icon:React.createElement(W.J,{name:"trash-o"}),onClick:this.deleteBookStory,label:"Delete",bubStyle:"stone"})):null}renderPostButton(){return React.createElement("div",{className:"post-button"},React.createElement(ne.Q,{isLoading:this.props.isLoading,loadingText:this.props.loadingText,isDisabled:!this.props.isValid,onClick:this.props.onPost,bubStyle:"lava"},this.props.buttonText))}render(){return React.createElement("div",{className:"book-story-form-buttons-vc"},this.renderDeleteButton(),React.createElement("div",{className:"pull-right"},this.renderPostButton()))}}zt.propTypes={onPost:PropTypes.func.isRequired,isLoading:PropTypes.bool.isRequired,buttonText:PropTypes.string.isRequired,loadingText:PropTypes.string.isRequired,isValid:PropTypes.bool,bookStoryId:PropTypes.number,isValidOverride:PropTypes.bool},zt.defaultProps={isValid:!1,bookStoryId:null,isValidOverride:!0};const jt=(0,s.$j)(((e,t)=>{const o=c.c.getSelector(e),s=l.t.getSelector(e),r=a.h.getSelector(e),i=t.isValidOverride&&s.featuredBookMentionId[t.formId]&&o.getIsValid(t.formId);return{bookStoryId:r.activeBookStoryId,isValid:i}}))(zt);var Gt=o(5700);class qt extends React.Component{constructor(e){super(e),this.state={expanded:!1},this.onFormChanged=this.onFormChanged.bind(this),this.handleOnHide=this.handleOnHide.bind(this),this.refocus=this.refocus.bind(this),this.handleMention=this.handleMention.bind(this),this.hideMentions=this.hideMentions.bind(this),this.validateForm=this.validateForm.bind(this),this.postBookStory=this.postBookStory.bind(this)}componentDidMount(){return this.props.defer,_.defer(this.validateForm)}handleMention(e){return this.refocus(),this.onFormChanged({name:this.inputName(),value:e})}handleOnHide(){Le.Q.hideMentionModal()}onFormChanged(e){we.i.formChanged({form_data:e,form_input_id:this.props.formId})}validateForm(){we.i.setValidationSettings({form_data:this.validationSettings(),form_input_id:this.props.formId}),we.i.validateForm(this.props.formId)}refocus(){return i.H.activeBookStoryForm(this.props.formId),this.setState({expanded:!0}),i.H.focusBookStoryForm(this.props.formId)}inputName(){return"book_story[text]"}hideMentions(){Le.Q.hideMentionModal()}removeFocus(){return i.H.focusBookStoryForm(!1)}validationSettings(){return this.props.overrideValidationSettings?this.props.overrideValidationSettings:{"book_story[text]":Gt.z.userPostValidationSettings()}}postBookStory(){return this.props.onPost()}bubTextAreaRenderHelper(){const e="What did you think of this book?",t=this.props.textContent;return this.state.expanded||!_.isEmpty(t)||this.props.focusBookStoryForm?React.createElement(xe,{textAreaId:this.props.textAreaId,isActive:this.props.activeBookStoryForm,isFocused:this.props.focusBookStoryForm,onFocus:this.refocus,onFormChanged:this.onFormChanged,onBlur:this.removeFocus,name:"book_story[text]",classes:["book-story-text"],placeholder:e,profileMentionsEnabled:!0,formId:this.props.formId,scrollOnFocus:!1}):React.createElement(He,{onClick:()=>this.refocus()},e)}buttonsRenderHelper(){let e=this.props.buttonText,t=this.props.loadingText;return this.props.isEditing&&(e="Update",t="Updating"),React.createElement(jt,{onPost:this.postBookStory,onClose:()=>i.H.resetRecommendBookFlow(this.props.formId),isLoading:this.props.isLoading,formId:this.props.formId,buttonText:e,loadingText:t,isValidOverride:this.props.isValid})}renderMentionsInput(){return React.createElement("div",null,React.createElement("div",{className:"back-btn"},React.createElement(B.G,{bubStyle:"lava",renderAs:"link",onClick:this.hideMentions,label:"< Back"})),React.createElement(Kt,{name:this.inputName(),formId:this.props.formId,modal:!1,handleMention:this.handleMention}))}renderStoryForm(){return React.createElement("div",{className:"book-story-form-wrapper"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12 book-story-form-body"},this.bubTextAreaRenderHelper(),this.props.children,this.buttonsRenderHelper())))}render(){return this.props.show?this.props.activeMentionModal?this.renderMentionsInput():this.renderStoryForm():null}}qt.propTypes={activeBookStoryForm:PropTypes.bool,activeMentionModal:PropTypes.bool,bookId:PropTypes.number,focusBookStoryForm:PropTypes.bool,formId:PropTypes.oneOfType([PropTypes.string,PropTypes.number]).isRequired,onPost:PropTypes.func.isRequired,overrideValidationSettings:PropTypes.object,show:PropTypes.bool,defer:PropTypes.bool,buttonText:PropTypes.string,loadingText:PropTypes.string,isValid:PropTypes.bool,isEditing:PropTypes.bool,isLoading:PropTypes.bool,textAreaId:PropTypes.string,textContent:PropTypes.string},qt.defaultProps={activeBookStoryForm:!1,activeMentionModal:!1,defer:!1,focusBookStoryForm:!1,formId:"default",buttonText:"Share",loadingText:"Sharing",show:!0,textAreaId:null};const Vt=(0,s.$j)(((e,t)=>{const o=c.c.getSelector(e),s=l.t.getSelector(e),r=a.h.getSelector(e),i=n.G.getSelector(e),p=_.merge({},qt.defaultProps,t),d=r.getBookStoryForId(r.activeBookStoryId),u=r.updatingBookStory||r.getBookStoryState({bookId:p.bookId,bookStoryId:_.get(d,"id")})===a.h.PENDING,h=o.getIsValid(p.formId),m=_.get(o.getFormValues(p.formId),"book_story[text]");return{bookId:s.getFeaturedBookMentionId(p.formId),book:i.getBookForId(s.getFeaturedBookMentionId(p.formId)),activeMentionModal:s.showMentionModal()&&s.activeMentionModal===p.formId,focusBookStoryForm:r.focusBookStoryForm===p.formId,activeBookStoryForm:r.activeBookStoryForm===p.formId,isEditing:r.isEditingBookStory(_.get(d,"id")),isLoading:u,isValid:h,textContent:m}}))(qt);function Wt(){return Wt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},Wt.apply(this,arguments)}class Yt extends React.PureComponent{constructor(e){super(e),this.onShare=this.onShare.bind(this),this.onShared=this.onShared.bind(this),this.createOrUpdateBookStory=this.createOrUpdateBookStory.bind(this),this.hasSiblingWisdom=this.hasSiblingWisdom.bind(this),this.hasText=this.hasText.bind(this)}onShare(){this.createOrUpdateBookStory(this.onShared)}onShared(){return Le.Q.clearBookMentions(this.props.formId),this.props.onShared({bookId:this.props.featuredBook.id})}trackReviewSteps({category:e,action:t,label:o,value:s},r){bubEvents.track(e,t,{label:o,value:s}),r.call(this)}hasText(){return!_.isEmpty(_.get(this.props.formValues,this.inputName()))}hasSiblingWisdom(){const e=_.get(this.props.featuredBook,"usersRating")>0,t=!_.isEmpty(this.props.bookReactions),o=_.get(this.props.bookRecommendation,"isRecommended",!1);return e||t||o}createOrUpdateBookStory(e){const t=!this.hasText()&&!this.hasSiblingWisdom();if(!this.props.isEditing&&t)return i.H.resetRecommendBookFlow(this.props.formId);if(t&&this.props.isEditing)return i.H.deleteConfirmStep();if(we.i.validateAndTouchAllInputs(),this.props.formValid){if(this.props.isEditing&&this.props.activeBookStory.bookStoryCommentId){const e=_.merge(this.bookStoryParams(),{id:this.props.activeBookStory.bookStoryCommentId});return i.H.editBookStoryComment(e).then((()=>{this.onShared()}))}return i.H.createBookStory(this.bookStoryParams(),e)}return null}bookStoryParams(){const e={text:{value:this.props.formData[this.inputName()].value}};return _.merge(e,{book_id:this.props.featuredBookId,bookListSlug:this.props.featuredBook.bookListSlug})}inputName(){return"book_story[text]"}renderReviewWithBook(){const e={onPost:()=>{this.trackReviewSteps({category:"Review Modal",action:"Navigate",label:"Review Step",value:"Post"},this.onShare)}};return React.createElement(Vt,Wt({formId:this.props.formId,bookId:this.props.featuredBookId,buttonText:this.props.buttonText,defer:this.props.defer},e))}renderAuthModal(){return this.props.showAuthModal?React.createElement(Ae.P,null):null}renderReviewForm(){return"share"===this.props.reviewType?this.renderReviewWithBook():null}render(){return React.createElement("div",{className:"review-form-vc"},this.renderAuthModal(),this.renderReviewForm())}}Yt.propTypes={activeBookStory:PropTypes.object,bookReactions:x._.reactions,bookRecommendation:x._.bookRecommendation,buttonText:PropTypes.string,currentUserId:PropTypes.number,defer:PropTypes.bool,featuredBook:PropTypes.object,featuredBookId:PropTypes.number,formId:PropTypes.string,formValid:PropTypes.bool,isEditing:PropTypes.bool,isLoading:PropTypes.bool,onShared:PropTypes.func,reviewType:PropTypes.string,showAuthModal:PropTypes.bool,formValues:PropTypes.object,formData:PropTypes.object},Yt.defaultProps={bookReactions:[],bookRecommendation:{},currentUserId:void 0,defer:!1,featuredBook:{},featuredBookId:void 0,formValid:!1,isLoading:!1,isEditing:!1,onShared:void 0,reviewType:void 0,showAuthModal:!1};const Qt=(0,s.$j)(((e,t)=>{const o=a.h.getSelector(e),s=n.G.getSelector(e),r=l.t.getSelector(e),i=c.c.getSelector(e),p=fe.v.getSelector(e),d=te.R.getSelector(e),u=r.getFeaturedBookMentionId(t.formId),h=o.getBookStoryForId(o.activeBookStoryId),m=T.I.currentUserId();return{featuredBookId:u,activeBookStory:h,featuredBook:s.getBookForId(u),formData:i.getFormData(t.formId),formValues:i.getFormValues(t.formId),formValid:i.getIsValid(t.formId),isLoading:o.getBookStoryState({bookId:u})===a.h.PENDING,isEditing:o.isEditingBookStory(_.get(h,"id")),bookReactions:p.getBookReactions(m,u),bookRecommendation:d.getBookRecommendation(m,u)}}))(Yt);var Jt=o(94935);const Zt={recommend(e){return bubEvents.track("Recommendations","Recommended",{value:e})},unrecommend(e){return bubEvents.track("Recommendations","Unrecommended",{value:e})}};class Xt extends React.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}componentDidMount(){_.defer((()=>ge.t.getBookRecommendation(this.props.bookId)))}onChange(e){return this.props.toggling?null:(e?Zt.recommend(this.props.bookId):Zt.unrecommend(this.props.bookId),ge.t.toggleCheckbox(this.props.bookId,e,this.props.bookListSlug))}render(){return React.createElement("div",{className:"recommend-checkbox-vc"},React.createElement(Jt.r,{disabled:this.props.toggling,label:"I recommend this book",selected:this.props.selected,changeSelection:this.onChange}))}}Xt.propTypes={bookId:PropTypes.number,bookListSlug:PropTypes.string,selected:PropTypes.bool,toggling:PropTypes.bool},Xt.defaultProps={bookId:void 0,bookListSlug:void 0,selected:!1,toggling:!1};const eo=(0,s.$j)(((e,t)=>{const o=te.R.getSelector(e),s=T.I.currentUserId(),r=o.getBookRecommendation(s,t.bookId);return{selected:_.get(r,"isRecommended"),toggling:o.isToggling(t.bookId)}}))(Xt);var to=o(71044),oo=o.n(to);function so(){return so=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},so.apply(this,arguments)}class ro extends React.PureComponent{constructor(e){super(e),this.onShared=this.onShared.bind(this)}componentDidMount(){_.defer((()=>_.get(this.props.currentUserProfile,"authorId")?i.H.createBookStoryPermission(this.props.featuredBookId).then((()=>{i.H.prepEdit(this.props.formId,this.props.featuredBookId)})).catch(_.noop):i.H.prepEdit(this.props.formId,this.props.featuredBookId)))}onShared(e){return this.props.onWisdomAdded(e),!this.props.activeBookStory||this.props.isEditing?i.H.resetRecommendBookFlow(this.props.formId):this.isAuthorNotRecommending()?i.H.recommendationReminderStep():v.setAutoFollowAuthors().then((()=>this.props.isRecommended&&_.isNil(this.props.autoFollowAuthorsPreference)?i.H.autoFollowPromptStep():i.H.autoFollowAuthorsStep()))}onSelectDifferentBook(){return bubEvents.track("Review Modal","Navigate",{label:"Select a different book"}),i.H.bookFromSearchResult(!1),i.H.setReviewDataLoaded(!1),ue.t.setSearchQuery(""),i.H.searchRecommendedBookStep()}isAuthorNotRecommending(){return this.props.currentUserProfile.authorId&&(this.props.activeBookStory.rating>=4||0===this.props.activeBookStory.rating||_.isNil(this.props.activeBookStory.rating))&&!this.props.isRecommended}renderBackButton(){return this.props.cameFromSearch?React.createElement("span",{className:"back-button"},React.createElement(B.G,{onClick:this.onSelectDifferentBook,bubStyle:"lava",renderAs:"link",label:"< Select a different book"})):null}renderBookRecommendationForm(){return React.createElement(he,null,React.createElement(eo,{bookId:this.props.featuredBook.id,bookListSlug:this.props.featuredBook.bookListSlug}))}renderRatingsAndReactions(){return this.props.featuredBook?React.createElement("div",null,React.createElement(Se,{bookId:this.props.featuredBook.id,onRate:this.props.onWisdomAdded,ratingSource:"modal"}),this.renderBookRecommendationForm(),React.createElement(ve,{bookId:this.props.featuredBook.id,bookListSlug:this.props.featuredBook.bookListSlug,userId:this.props.currentUserId,onReaction:this.props.onWisdomAdded})):null}renderForm(){const e=React.createElement("em",null,_.get(this.props.featuredBook,"title")),t=React.createElement("h3",{className:"prompt"},"Share a review of ",e);let o;return this.props.displaySavedMessage&&this.props.book.usersRating&&(o=React.createElement("div",{className:"rating-saved-message"},React.createElement(W.J,{className:"check-icon",name:"check"})," Thanks! Your rating has been saved.")),React.createElement("div",{className:"review-step-vc"},o,this.renderBackButton(),t,this.renderRatingsAndReactions(),React.createElement("div",{className:"review-header"},"Write a review (optional):"),React.createElement(Qt,so({defer:!0,reviewType:"share",onShared:this.onShared},this.props)))}renderPermissionDenied(){return React.createElement("div",null,this.renderBackButton(),React.createElement("div",{className:"clearfix"}),React.createElement("div",{className:"no-permission"},React.createElement(Be.F,{ctaStyle:"column",headerText:"Sorry! You can't write a review of your own book.",border:!1,imageUrl:oo()})))}render(){return!this.props.isLoaded||this.props.authorFollowPreferenceLoading?React.createElement(N.m,null):this.props.hasPermission?this.renderForm():this.renderPermissionDenied()}}ro.propTypes={activeBookStory:PropTypes.object,autoFollowAuthorsPreference:PropTypes.oneOf(["enabled","disabled"]),book:x._.book,cameFromSearch:PropTypes.bool,currentUserId:PropTypes.number,currentUserProfile:PropTypes.object,displaySavedMessage:PropTypes.bool,featuredBook:x._.book,featuredBookId:PropTypes.number,formId:PropTypes.string,isEditing:PropTypes.bool,isLoaded:PropTypes.bool,onWisdomAdded:PropTypes.func,hasPermission:PropTypes.bool,isRecommended:PropTypes.bool,authorFollowPreferenceLoading:PropTypes.bool},ro.defaultProps={activeBookStory:void 0,book:void 0,cameFromSearch:!1,currentUserId:void 0,displaySavedMessage:!1,featuredBook:void 0,featuredBookId:void 0,formId:void 0,isEditing:!1,isLoaded:!1,onWisdomAdded:_.noop};const io=(0,s.$j)(((e,t)=>{const o=te.R.getSelector(e),s=a.h.getSelector(e),r=n.G.getSelector(e),i=l.t.getSelector(e),p=O.getSelector(e),c=i.getFeaturedBookMentionId(t.formId),d=s.getBookStoryForId(s.activeBookStoryId),u=o.getBookRecommendation(t.currentUserId,c);return{featuredBookId:c,activeBookStory:d,featuredBook:r.getBookForId(c),isLoaded:s.reviewDataLoaded,authorFollowPreferenceLoading:"loading"===p.getFeaturePreferenceLoadingState("autoFollowAuthors"),isEditing:s.isEditingBookStory(_.get(d,"id")),isRecommended:_.get(u,"isRecommended"),cameFromSearch:s.bookFromSearchResult,book:r.getBookForId(c),hasPermission:s.getPermission(c),autoFollowAuthorsPreference:p.getFeaturePreference("autoFollowAuthors")}}))(ro);class ao extends React.PureComponent{componentDidMount(){bubEvents.track("Recommendation Reminder Modal","Remind Author to Recommend")}onAdjustReview(){return bubEvents.track("Recommendation Reminder Modal","Adust Review"),i.H.selectedRecommendedBookStep()}onPostWithoutRecommending(){return bubEvents.track("Recommendation Reminder Modal","Post Review Without Recommendation"),i.H.autoFollowAuthorsStep()}render(){return React.createElement("div",{className:"recommend-reminder-vc"},React.createElement("h3",{className:"no-rec-headline"},"Looks like this is not a recommendation."),React.createElement("p",{className:"no-rec-text"},"Only recommendations are shared with followers to keep our community positive. If you wish to recommend this book, adjust your review."),React.createElement("div",{className:"buttons"},React.createElement("div",{className:"adjust-review-button"},React.createElement(B.G,{onClick:this.onAdjustReview,bubStyle:"mist",icon:React.createElement(W.J,{name:"arrow_left",className:"chevron-left"}),label:"Adjust My Review"})),React.createElement("div",{className:"post-button"},React.createElement(B.G,{bubStyle:"lava",onClick:this.onPostWithoutRecommending,label:"Post without recommending"}))))}}const no={add_book:"Pending Addition",cover_out_of_date:"Pending Cover Change",duplicate:"Pending Removal",incorrect_authors:"Pending Author Change",incorrect_release_date:"Pending Release Date Change",missing_book:"Missing Book",not_available:"Pending Removal",not_my_book:"Pending Removal",other:"Pending Request",update_description:"Pending Description Change",update_retailer_links:"Pending Retailer Link Change",update_title:"Pending Title Change"},lo={add_book:"<p>We are currently reviewing this book before adding it. If this book has not been added to your profile after one week, please let us know!</p>",add_book_to_profile:"<p>We are currently confirming this book is authored by you before adding it to your profile. If this book has not been added to your profile after one week, please let us know!</p>",cover_out_of_date:"<p>We are in the process of updating this book cover. If the cover has not be updated after a couple days, please let us know!</p>",duplicate:"<p>We are currently reviewing this book before removing it. If this book has not been removed from your profile after one week, please let us know!</p>",duplicate_request:"<p>This request has already been made. If it has been more than a week and the issue hasn't been addressed, please let us know!</p>",incorrect_authors:"<p>We are currently confirming the author(s) before changing it. If it has not been updated after one week, please let us know!</p>",incorrect_release_date:"<p>We are currently confirming the updated release date before changing it. If the released date has not been updated after one week, please let us know!</p>",not_available:"<p>We are currently reviewing this book before removing it. If this book has not been removed from your profile after one week, please let us know!</p>",not_my_book:"<p>We are currently reviewing this book before removing it. If this book has not been removed from your profile after one week, please let us know!</p>",other:"<p>We're looking into your request, you should hear back in the next three business days.</p>",update_description:"<p>We are currently confirming the description before changing it. If it has not been updated after one week, please let us know!</p>",update_retailer_links:"<p>We are currently confirming the retailer links before changing them. If they have not been updated after one week, please let us know!</p>",update_title:"<p>We are currently confirming the title before changing it. If it has not been updated after one week, please let us know!</p>"},po={getConfirmationMsg(e,t){const o={add_book:"<p>We are currently reviewing this book before adding it. If this book has not been added to your profile after one week, please let us know!</p>",add_book_to_profile:`<p>Weâll add <i>${t}</i> to your profile once we confirm it was authored by you. If it is not updated within a week, please let us know!</p>`,cover_out_of_date:`<p>Weâll update the cover for <i>${t}</i>. This may happen automatically or take several days depending on the book. If it is not updated within a week, please let us know!</p>`,duplicate:`<p>We'll remove <i>${t}</i> from your Author Profile after we confirm it is a duplicate. If you still see it on your profile after one week, please let us know!</p>`,duplicate_request:"<p>This request has already been made. If it has been more than a week and the issue hasn't been addressed, please let us know!</p>",incorrect_authors:`<p>We'll update the author(s) for <i>${t}</i> after we confirm the authorship. If you don't see a change after one week and you haven't heard from us, please let us know!</p>`,incorrect_release_date:`<p>We'll update the release date for <i>${t}</i> after we confirm the new release date. If the date hasn't changed after one week and you haven't heard from us, please let us know!</p>`,missing_book:"<p>Thank you for your submission, please check back later!</p>",not_available:`<p>We'll remove <i>${t}</i> from our site after we confirm it is not available for purchase on a major retailer. If youâre still seeing it listed on our site in one week, please let us know!`,not_my_book:`<p>We'll remove <i>${t}</i> from your Author Profile after we confirm it is not yours. If you still see it on your profile after one week, please let us know!</p>`,other:"<p>We're looking into your request, you should hear back in the next three business days.</p>",update_description:`<p>Weâll update the description for <i>${t}</i>.  If it is not updated within a week, please let us know!</p>`,update_retailer_links:`<p>Weâll update the retailer links for <i>${t}</i>.  If they're not updated within a week, please let us know!</p>`,update_title:`<p>Weâll update the title for <i>${t}</i>.  If it is not updated within a week, please let us know!</p>`};return o[e]?o[e]:null},allDescriptions(e){const t=[];return _.forEach(e,(e=>{_.includes(t,lo[e])||t.push(lo[e])})),t.join("")},allStatuses(e){const t=[];return _.forEach(e,(e=>{_.includes(t,no[e])||t.push(no[e])})),t.join(", ")}};class co extends React.PureComponent{constructor(e){super(e),this.state={showConfirmation:!1},this.onSubmitCallback=this.onSubmitCallback.bind(this)}onSubmitCallback(){this.setState({showConfirmation:!0})}renderForm(){return this.state.showConfirmation?React.createElement("div",{className:"missing-book-info-msg"},React.createElement("span",{dangerouslySetInnerHTML:{__html:po.getConfirmationMsg("missing_book")}})):React.createElement(dt,{onSubmitCallback:this.onSubmitCallback})}render(){const e=this.state.showConfirmation?"Missing Book Reported":"Report Missing Book";return React.createElement("div",{className:"missing-book-step"},React.createElement("div",null,React.createElement("span",{className:"back-button"},React.createElement(B.G,{onClick:i.H.searchRecommendedBookStep.bind(i.H),bubStyle:"lava",renderAs:"link",label:"< Back to Search "})),React.createElement("h3",{className:"missing-book-info-header"},e),this.renderForm()))}}class uo extends React.PureComponent{constructor(e){super(e),this.onMissingBookSelected=this.onMissingBookSelected.bind(this),this.onFeaturedBookSelected=this.onFeaturedBookSelected.bind(this)}onMissingBookSelected(){Le.Q.featureBookMention(this.props.formId,null),i.H.activeBookStoryForm(this.props.formId),i.H.focusBookStoryForm(!1),i.H.shareMissingBookStep()}onFeaturedBookSelected(e){Le.Q.featureBookMention(this.props.formId,e),ue.t.setSearchQuery(""),this.props.searchSelectionAction?this.props.searchSelectionAction():i.H.selectedRecommendedBookStep(),i.H.activeBookStoryForm(this.props.formId),i.H.bookFromSearchResult(!0)}render(){return React.createElement("div",null,React.createElement("h3",{className:"search-title"},"Add a Book"),React.createElement("p",{className:"search-instructions"}," Search by book title or author:"),React.createElement(Nt,{noPlaceholder:!0,relationType:"featuredResults",reportMissingBook:this.onMissingBookSelected,onResultClick:this.onFeaturedBookSelected,books:this.props.books}))}}uo.propTypes={formId:PropTypes.string,books:x._.books,searchSelectionAction:PropTypes.func},uo.defaultProps={formId:null,books:[]};const ho=(0,s.$j)((e=>{const t=n.G.getSelector(e),o=Lt.t.getSelector(e);return{books:t.getBooksForIds(o.getSuggestionCollection("featuredResults"))}}))(uo);class mo extends React.PureComponent{constructor(e){super(e),this.handleBookStoryDelete=this.handleBookStoryDelete.bind(this),this.onCancel=this.onCancel.bind(this)}componentDidMount(){$(document).scrollTop(0)}handleBookStoryDelete(){const e=T.I.currentUserId(),t=this.props.book.id;i.H.deleteBookStory(e,t,this.props.bookStoryId).then((()=>{i.H.resetRecommendBookFlow(this.props.formId),this.props.onDelete({bookId:t})}))}onCancel(){return this.props.previousStep?i.H.setRecommendationStep(this.props.previousStep):i.H.resetRecommendBookFlow(this.props.formId)}renderBook(){return React.createElement("div",{className:"delete-cover-wrapper"},React.createElement(le.y,{coverUrl:_.get(this.props.book,"coverUrl",X()),bookTitle:_.get(this.props.book,"title"),bookAuthor:_.get(this.props.book,"authors"),bookClassName:"col-xs-12"}),this.renderRating())}renderBookDeleteText(){const e=_.get(this.props.book,"title");return React.createElement("div",{className:"delete-text"},"Are you sure you want to delete your review of ",React.createElement("i",null,e),"?")}renderRating(){return React.createElement("div",{className:"ratings-wrapper"},React.createElement(me.g,{size:"large",rating:this.props.book.usersRating}))}render(){return React.createElement("div",{className:"delete-book-story-vc"},React.createElement("div",{className:"delete-book-prompt"},this.renderBook(),this.renderBookDeleteText()),React.createElement("div",{className:"delete-book-story-buttons"},React.createElement("div",{className:"delete-cancel-btn"},React.createElement(B.G,{label:"Cancel",onClick:this.onCancel})),React.createElement("div",{className:"delete-confirm-btn"},React.createElement(ne.Q,{label:"Delete My Review",onClick:this.handleBookStoryDelete,isLoading:this.props.isLoading,loadingText:"Deleting",bubStyle:"lava"}))))}}mo.propTypes={formId:PropTypes.oneOfType([PropTypes.string,PropTypes.number]).isRequired,previousStep:PropTypes.string,book:x._.book,bookStoryId:PropTypes.number.isRequired,isLoading:PropTypes.bool,onDelete:PropTypes.func},mo.defaultProps={isLoading:!1,onDelete:_.noop};const go=(0,s.$j)(((e,t)=>{const o=a.h.getSelector(e);return{isLoading:o.getBookStoryState({bookStoryId:t.bookStoryId})===a.h.PENDING,previousStep:o.previousRecommendationStep}}))(mo);class yo extends React.PureComponent{constructor(e){super(e),this.handleBookStoryClose=this.handleBookStoryClose.bind(this),this.onCancel=this.onCancel.bind(this)}handleBookStoryClose(){i.H.resetRecommendBookFlow(this.props.formId)}onCancel(){return this.props.previousStep?i.H.setRecommendationStep(this.props.previousStep):i.H.resetRecommendBookFlow(this.props.formId)}render(){return React.createElement("div",{className:"confirm-close-book-story-vc",id:"confirm-close-book-story"},React.createElement("div",{className:"confirm-close-book-story-header"},React.createElement(W.J,{name:"exclamation-circle",className:"exclamation-circle-icon"}),React.createElement("h3",{className:"title"},"Are you sure?")),React.createElement("p",{className:"confirm-close-book-story-description"},"Any changes you made will not be saved if you close this window."),React.createElement("div",{className:"confirm-close-book-story-buttons"},React.createElement("div",{className:"confirm-close-cancel-btn"},React.createElement(B.G,{label:"Cancel",onClick:this.onCancel})),React.createElement("div",{className:"confirm-close-confirm-btn"},React.createElement(B.G,{bubStyle:"lava",label:"Yes, Close.",onClick:this.handleBookStoryClose}))))}}yo.propTypes={formId:PropTypes.oneOfType([PropTypes.string,PropTypes.number]).isRequired,previousStep:PropTypes.string};const bo=yo;var ko=o(65710);function To(){return To=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},To.apply(this,arguments)}class So extends React.PureComponent{constructor(e){super(e),this.isDismissible=this.isDismissible.bind(this),this.onClose=this.onClose.bind(this)}componentDidMount(){r.M.getReactions()}onClose(){const e=_.get(this.props.formValues,"book_story[text]"),t=!_.isEmpty(e),o=_.get(this.props,"bookStoryEditing.text")!==e,s=this.props.recommendationStep,r="recommendation"===s||"missing"===s;bubEvents.track("Review Modal","Navigate",{label:`${_.capitalize(s)} Step`,value:"Close",willShowDiscard:r}),t&&o&&r?i.H.closeConfirmStep():i.H.resetRecommendBookFlow(this.props.formId)}bookmarkRenderHelper(){return React.createElement(de,To({onClose:this.onClose},this.props))}reviewRenderHelper(){return React.createElement(io,this.props)}searchRenderHelper(){return React.createElement(ho,this.props)}missingBookRenderHelper(){return React.createElement(co,this.props)}recommendReminderHelper(){return React.createElement(ao,this.props)}autoFollowPromptHelper(){return React.createElement(w,null)}autoFollowAuthorsHelper(){return React.createElement(se,{bookStory:this.props.activeBookStory})}deleteConfirmRenderHelper(){return React.createElement(go,{formId:this.props.formId,book:this.props.featuredBook,bookStoryId:this.props.bookStoryId,onDelete:this.props.onWisdomAdded})}closeConfirmRenderHelper(){return React.createElement(bo,{formId:this.props.formId,book:this.props.featuredBook,previousStep:this.props.previousStep})}recommendationStepRenderHelper(){switch(this.props.recommendationStep){case"search":default:return this.searchRenderHelper();case"bookmark":return this.bookmarkRenderHelper();case"recommendation":return this.reviewRenderHelper();case"missing":return this.missingBookRenderHelper();case"recommendation-reminder":return this.recommendReminderHelper();case"auto-follow-prompt":return this.autoFollowPromptHelper();case"auto-follow-authors":return this.autoFollowAuthorsHelper();case"delete-confirm":return this.deleteConfirmRenderHelper();case"close-confirm":return this.closeConfirmRenderHelper()}}isDismissible(){return!_.includes(["delete-confirm","close-confirm"],this.props.recommendationStep)}renderModelessClose(){return this.props.isFullWidth&&this.isDismissible()?React.createElement("div",{className:"modeless-dismiss-button"},React.createElement(ko.O,{size:"large",onClick:this.onClose})):null}render(){return React.createElement("div",{className:"recommend-book-vc "+(this.props.isFullWidth?"mobile-form":"")},this.renderModelessClose(),React.createElement("div",null,this.recommendationStepRenderHelper()))}}So.propTypes={defaultList:PropTypes.string,featuredBookId:PropTypes.number,formId:PropTypes.string,formValid:PropTypes.bool,formValues:PropTypes.object,isLoading:PropTypes.bool,recommendationStep:PropTypes.string,featuredBook:PropTypes.object,currentUserProfile:x._.profile,activeBookStory:PropTypes.object,showAuthModal:PropTypes.bool,noSummary:PropTypes.bool,onWisdomAdded:PropTypes.func,bookStoryId:PropTypes.number,isFullWidth:PropTypes.bool,previousStep:PropTypes.string,searchSelectionAction:PropTypes.func},So.defaultProps={isLoading:!1,showAuthModal:!1,noSummary:!1,onWisdomAdded:void 0};const _o=(0,s.$j)(((e,t)=>{const o=a.h.getSelector(e),s=n.G.getSelector(e),r=l.t.getSelector(e),i=p.C.getSelector(e),d=c.c.getSelector(e),u=(e=>{const t={isOpen:t=>b(e)(t),areAnyOpen:_.partial(k,e)};return{...y(e),...t}})(e),h=r.getFeaturedBookMentionId(t.formId),m=o.activeBookStoryId;return{featuredBookId:h,activeBookStory:o.getBookStoryForId(m),bookStoryId:m,featuredBook:s.getBookForId(h),recommendationStep:o.recommendationStep,currentUserProfile:i.getCurrentUserProfile(),formData:d.getFormData(t.formId),formValid:d.getIsValid(t.formId),formValues:d.getFormValues(t.formId),showAuthModal:u.isOpen("bub-auth-modal"),currentUserId:T.I.currentUserId(),isLoaded:o.reviewDataLoaded,previousStep:o.previousRecommendationStep}}))((0,U.$)(So));_o.trackingName="Recommend Book Modal"},43371:function(e,t,o){"use strict";o.d(t,{M:function(){return r}});var s=o(71407);const r={getWishlistSuggestions(){return(0,s.t)({method:"GET",url:this._path("book_suggestions")})},getCategoryRecommendations(e){return(0,s.t)({method:"GET",url:this._path("category_recommendations"),data:{category_id:e}})},getBlogPost(e){return(0,s.t)({method:"GET",url:this._path(`blog_posts/${e}`)})},getBlogPostsForCategories(e,t){return(0,s.t)({method:"GET",url:this._path("blog_posts/recommended_for_categories"),data:{category_ids:e,limit:t}})},getMissedDeals(){return(0,s.t)({method:"GET",url:this._path("missed_deals")})},getMostWishedForBooks(){return(0,s.t)({method:"GET",url:this._path("most_wished_for_books")})},getSpotlightBook(){return(0,s.t)({method:"GET",url:this._path("spotlight_book")})},getBooksForCategoryGroup(e){return(0,s.t)({method:"GET",url:this._path(`category_group_books/${e}`)})},_path(e){return`/wishlist_api/${e}`}}},75820:function(e,t,o){"use strict";o.d(t,{fn:function(){return p},hp:function(){return a},tO:function(){return l},zj:function(){return n}});var s=o(14890);const r={noop:(e={})=>e},i=e=>{const t=(0,s.UY)(_.merge({},r,e));return(e,o)=>("DANGEROUSLY_RESET_APP"===o.type&&(e=void 0),t(e,o))},a=(e,t)=>{const o=_(e).chain().upperCase().replace(" ","_"),s=_.reduce(t,((e,t)=>_.merge(e,{[t]:`${o}/${t}`})),{});let r=s;return"test"!==window.bubEnv&&"development"!==window.bubEnv||(r=new Proxy(s,{get(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t];throw new Error(`Invalid actionType: ${t}.`)}})),r},n=(e,t)=>_.split(t,"/",1)[0]===_(e).upperCase().replace(" ","_"),l=(e=>{const t=(0,s.MT)(i(),{},"development"===window.bubEnv&&_.has(window,"__REDUX_DEVTOOLS_EXTENSION__")?window.__REDUX_DEVTOOLS_EXTENSION__():_.noop());return t.injectedReducers={},t.injectReducer=(e,o)=>{t.injectedReducers[e]=o,t.replaceReducer(i(t.injectedReducers))},t.reset=()=>{"test"===window.bubEnv&&t.dispatch({type:"DANGEROUSLY_RESET_APP"})},t})(),p=l.injectReducer},27783:function(e,t,o){"use strict";o.d(t,{E:function(){return p}});var s=o(75820),r=o(48049),i=o(92613),a=o(87679),n=o(26076),l=o(9971);const p=new class{initialBooksForListFetch(e,t,o){s.tO.dispatch({type:i.C.actionTypes.INITIAL_BOOKS_FOR_LIST_FETCH,payload:{listSlug:e}}),"uncategorized"===e?this.fetchUncategorizedBooks(t):void 0===t?r.$.getBooks({listSlug:e}).then(this.initialBooksForListSuccess):r.$.fetchBooksForPage({list_slug:e,page:t,sort:o}).then(this.initialBooksForListSuccess)}fetchUncategorizedBooks(e){return r.$.getUncategorizedBooks({page:e}).then((e=>{this.initialBooksForListSuccess(_.merge(e,{listSlug:"uncategorized"}))}))}fetchUncategorizedBooksForPage(e){return s.tO.dispatch({type:i.C.actionTypes.FETCH_BOOKS_FOR_PAGE,payload:e}),r.$.getUncategorizedBooks(e).then(this.fetchBooksForPageSuccess)}initialBooksForListSuccess(e){return a.Z.addBooks({books:e.books,page:e.page}),n.t.initialBooksForListSuccess(e),s.tO.dispatch({type:i.C.actionTypes.INITIAL_BOOKS_FOR_LIST_SUCCESS,payload:e})}fetchBooksForPage(e){return s.tO.dispatch({type:i.C.actionTypes.FETCH_BOOKS_FOR_PAGE,payload:e}),r.$.fetchBooksForPage(e).then(this.fetchBooksForPageSuccess),e.list_slug}fetchBooksForPageSuccess(e){return a.Z.addBooks({books:e.books,page:e.page}),n.t.fetchBooksForPageSuccess(e),s.tO.dispatch({type:i.C.actionTypes.FETCH_BOOKS_FOR_PAGE_SUCCESS,payload:e})}movedBookToList(e){return s.tO.dispatch({type:i.C.actionTypes.MOVED_BOOK_TO_LIST,payload:e})}removedBookFromList(e){return s.tO.dispatch({type:i.C.actionTypes.REMOVED_BOOK_FROM_LIST,payload:e})}setAdditionalBookListData(e){return s.tO.dispatch({type:i.C.actionTypes.SET_ADDITIONAL_BOOK_LIST_DATA,payload:{additionalBookListData:e}})}initBookListCounts(){this.setAdditionalBookListData(l.I.getUserStoreData().user.bookListCounts)}}},57997:function(e,t,o){"use strict";o.d(t,{H:function(){return ee}});var s=o(28628),r=o(84860);const i={createBookStory(e){return s.B.request({method:"POST",url:"/book_stories/",data:JSON.stringify({book_story:e})})},getBookStory(e){return s.B.request({method:"GET",url:`/book_stories/v2/${e}`})},deleteBookStory(e){return s.B.request({method:"DELETE",url:`/book_stories/v2/${e}`})},likeBookStory(e){return s.B.request({method:"POST",url:`/book_stories/${e.bookStoryId}/like`})},unlikeBookStory(e){return s.B.request({method:"DELETE",url:`/book_stories/${e.bookStoryId}/like`})},listBookStoryLikes(e){return s.B.request({method:"GET",url:`/book_stories/${e.bookStoryId}/likes`,data:_.pick(e,["page"])})},listBookStoryFeed(e){switch(e.feedType){case r.h.AUTHORED_BOOKS_FEED_TYPE:return this.bookStoryRecommendationAuthoredBooksFeed(e);case r.h.AUTHOR_AUTHORED_BOOKS_FEED_TYPE:return this.bookStoryRecommendationAuthorAuthoredBooksFeed(e);case r.h.BOOK_FEED_TYPE:return this.listBookStoryBookFeed(e);case r.h.SOCIAL_FEED_TYPE:default:return this.listBookStorySocialFeed(e)}},listBookStoryBookFeed(e){return s.B.request({method:"GET",url:`/book_stories/book_feed/${e.book_id}`,data:_.pick(e,["before_book_story_id","limit"]),cache:!1})},bookStoryRecommendationAuthoredBooksFeed(e){return s.B.request({method:"GET",url:"/book_stories/authored_books_feed",data:_.pick(e,"before_book_story_id","limit"),cache:!1})},bookStoryRecommendationAuthorAuthoredBooksFeed(e){return s.B.request({method:"GET",url:"/book_stories/author_authored_books_feed",data:_.pick(e,"before_book_story_id","limit"),cache:!1})},listBookStorySocialFeed(e){return s.B.request({method:"GET",url:"/book_stories/feed",data:{filters:e.filters?e.filters.join(","):[],page:e.page},cache:!1})},listBookStoriesForUser(e,t){return s.B.request({method:"GET",url:`/profile/${e}/book_stories`,data:_.pick(t,"before_book_story_id","book_id","tag_ids"),cache:!1})},listBookStoriesForUserForBook(e){return s.B.request({method:"GET",url:`/book_stories/book/${e}`,cache:!1})},autoFollowAuthors(e){return s.B.request({method:"POST",url:`/book_stories/v2/${e}/auto_follow`})},suggestedRecommenders(e,t){return s.B.request({method:"GET",url:`/book_stories/v2/${e}/suggested_recommenders`,data:_.pick(t,["limit"])})}},a={createBookStoryComment(e){return s.B.request({method:"POST",url:"/book_story_comments/",data:JSON.stringify({book_story_comment:e})})},editBookStoryComment(e){return s.B.request({method:"PATCH",url:`/book_story_comments/${e.id}`,data:JSON.stringify({book_story_comment:e})})},listBookStoryComments(e){const t={book_story_id:e.bookStoryId,before_id:e.beforeId,limit:e.limit};return s.B.request({method:"GET",url:"/book_story_comments/",data:t})},deleteBookStoryComment(e){return s.B.request({method:"DELETE",url:`/book_story_comments/${e.bookStoryCommentId}`})}};var n=o(6846),l=o(10141),p=o(75073);const c={likeBookStoryComment(e){return s.B.request({method:"POST",url:`/story_comments/${e.bookStoryCommentId}/like`})},unlikeBookStoryComment(e){return s.B.request({method:"DELETE",url:`/story_comments/${e.bookStoryCommentId}/like`})},listBookStoryCommentLikes(e){return s.B.request({method:"GET",url:`/story_comments/${e.bookStoryCommentId}/likes`,data:_.pick(e,["page"])})}};var d=o(68697),u=o(93513),h=o(75820);const m="likes",g=(0,h.hp)(m,["BOOK_STORY_COMMENT_LIKED","BOOK_STORY_COMMENT_UNLIKED","SET_ACTIVE_BOOK_STORY_COMMENT_LIKE","POPULATE_BOOK_STORY_COMMENT_LIKES","SET_ACTIVE_BOOK_STORY_LIKE","PENDING_LIKE_STATUS","BOOK_STORY_LIKED","BOOK_STORY_UNLIKED","POPULATE_BOOK_STORY_LIKES","CLEAR_BOOK_STORY_LIKES","CLEAR_BOOK_STORY_COMMENT_LIKES","SET_BOOK_STORIES","SET_BOOK_STORIES_LIST","ADD_BOOK_STORY_COMMENTS","ADD_BOOK_STORIES","ADD_BOOK_STORIES_TO_LIST"]),y=(e,t)=>(_.forEach(t,(t=>{e.bookStoryCommentsMap=_.merge(e.bookStoriesMap,{[t.id]:_.pick(t,"isLiked","likeCount")})})),e);(0,h.fn)(m,(0,u.Uy)(((e,t)=>{switch(t.type){case g.BOOK_STORY_COMMENT_LIKED:{const o={[t.payload.bookStoryCommentId]:{isLiked:!0,isLoading:!1,likeCount:_.get(e.bookStoryCommentsMap[t.payload.bookStoryCommentId],"likeCount",0)+1}};return e.bookStoryCommentsMap=_.merge(e.bookStoryCommentsMap,o),e}case g.BOOK_STORY_COMMENT_UNLIKED:{const o={[t.payload.bookStoryCommentId]:{isLiked:!1,isLoading:!1,likeCount:e.bookStoryCommentsMap[t.payload.bookStoryCommentId].likeCount-1}};return e.bookStoryCommentsMap=_.merge(e.bookStoryCommentsMap,o),e}case g.SET_ACTIVE_BOOK_STORY_COMMENT_LIKE:return e.activeBookStoryCommentLike=_.get(t.payload,"bookStoryCommentId"),e;case g.POPULATE_BOOK_STORY_COMMENT_LIKES:{const o=t.payload.bookStoryCommentId;return void 0===e.bookStoryCommentLikesMap[o]&&(e.bookStoryCommentLikesMap[o]=[]),e.bookStoryCommentLikesMap[o]=_.uniqBy(e.bookStoryCommentLikesMap[o].concat(t.payload.likes),"id"),e.bookStoryCommentLikesPageMap[o]=t.payload.page,e}case g.SET_ACTIVE_BOOK_STORY_LIKE:return e.activeBookStoryLike=t.payload.bookStoryId,e;case g.PENDING_LIKE_STATUS:return _.set(e.bookStoriesMap,[t.payload.bookStoryId,"isLoading"],!0),e;case g.BOOK_STORY_LIKED:{const o={[t.payload.bookStoryId]:{isLoading:!1,isLiked:!0,likeCount:_.get(e.bookStoriesMap[t.payload.bookStoryId],"likeCount",0)+1}};return e.bookStoriesMap=_.merge(e.bookStoriesMap,o),e}case g.BOOK_STORY_UNLIKED:{const o={[t.payload.bookStoryId]:{isLiked:!1,isLoading:!1,likeCount:e.bookStoriesMap[t.payload.bookStoryId].likeCount-1}};return e.bookStoriesMap=_.merge(e.bookStoriesMap,o),e}case g.POPULATE_BOOK_STORY_LIKES:{const o=t.payload.bookStoryId;return void 0===e.bookStoryLikesMap[o]&&(e.bookStoryLikesMap[o]=[]),e.bookStoryLikesMap[o]=_.uniqBy(e.bookStoryLikesMap[o].concat(t.payload.likes),"id"),e.bookStoryLikesPageMap[o]=t.payload.page,e}case g.CLEAR_BOOK_STORY_LIKES:return e.bookStoryLikesMap[t.payload.bookStoryId]=[],e.bookStoryLikesPageMap[t.payload.bookStoryId]=0,e;case g.CLEAR_BOOK_STORY_COMMENT_LIKES:return e.bookStoryCommentLikesMap[t.payload.bookStoryCommentId]=[],e.bookStoryCommentLikesPageMap[t.payload.bookStoryCommentId]=0,e;case g.SET_BOOK_STORIES:case g.SET_BOOK_STORIES_LIST:case g.ADD_BOOK_STORIES:case g.ADD_BOOK_STORIES_TO_LIST:return((e,t)=>(((e,t)=>{_.forEach(t,(t=>{e.bookStoriesMap=_.merge(e.bookStoriesMap,{[t.id]:_.pick(t,"isLiked","likeCount")})}))})(e,t),_.forEach(t,(t=>y(e,t.bookStoryComments))),e))(e,t.payload.bookStories);case g.ADD_BOOK_STORY_COMMENTS:return y(e,t.payload.bookStoryComments);default:return e}}),{bookStoriesMap:{},bookStoryLikesMap:{},bookStoryLikesPageMap:{},bookStoryCommentsMap:{},bookStoryCommentLikesMap:{},bookStoryCommentLikesPageMap:{}}));const b=e=>e[m],k=(0,d.P1)(b,(e=>memoize((t=>t.bookStoryId?_.get(e.bookStoriesMap[t.bookStoryId],"isLiked",!1):!!t.bookStoryCommentId&&_.get(e.bookStoryCommentsMap[t.bookStoryCommentId],"isLiked",!1))))),T=(0,d.P1)(b,(e=>memoize((t=>t.bookStoryId?_.get(e.bookStoriesMap[t.bookStoryId],"likeCount"):t.bookStoryCommentId?_.get(e.bookStoryCommentsMap[t.bookStoryCommentId],"likeCount"):0)))),S=(0,d.P1)(b,(e=>memoize((t=>!!t.bookStoryId&&_.get(e.bookStoriesMap[t.bookStoryId],"isLoading"))))),f=(0,d.P1)(b,(e=>memoize((t=>e.activeBookStoryCommentLike===t.bookStoryCommentId)))),E=(0,d.P1)(b,(e=>memoize((t=>e.bookStoryCommentLikesMap[t])))),R=(0,d.P1)(b,(e=>memoize((t=>{const o=e.bookStoryCommentLikesMap[t];return _.map(o,"profile.id")})))),P=(0,d.P1)(b,(e=>memoize((t=>e.bookStoryCommentLikesPageMap[t]||0)))),C=(0,d.P1)(b,(e=>memoize((t=>e.bookStoryLikesMap[t])))),I=(0,d.P1)(b,(e=>memoize((t=>e.bookStoryLikesPageMap[t]||0)))),O=(0,d.P1)(b,(e=>memoize((t=>e.activeBookStoryLike===t)))),v={actionTypes:g,getSelector:e=>{const t={isLiked:t=>k(e)(t),likeCount:t=>T(e)(t),isLoading:t=>S(e)(t),isActiveBookStoryCommentLike:t=>f(e)(t),getBookStoryCommentLikes:t=>E(e)(t),getBookStoryCommentLikeProfileIds:t=>R(e)(t),getBookStoryCommentLikesPage:t=>P(e)(t),getBookStoryLikes:t=>C(e)(t),getBookStoryLikesPage:t=>I(e)(t),isActiveBookStoryLike:t=>O(e)(t)};return{...b(e),...t}}},B=new class{setBookStories(e){return h.tO.dispatch({type:v.actionTypes.SET_BOOK_STORIES,payload:{bookStories:e}}),e}setBookStoriesList(e){return h.tO.dispatch({type:v.actionTypes.SET_BOOK_STORIES_LIST,payload:e}),e}addBookStories(e){return h.tO.dispatch({type:v.actionTypes.ADD_BOOK_STORIES,payload:{bookStories:e}}),e}addBookStoriesToList(e){return h.tO.dispatch({type:v.actionTypes.ADD_BOOK_STORIES_TO_LIST,payload:e}),e}addBookStoryComments(e){return h.tO.dispatch({type:v.actionTypes.ADD_BOOK_STORY_COMMENTS,payload:e}),e}bookStoryCommentLiked(e){return h.tO.dispatch({type:v.actionTypes.BOOK_STORY_COMMENT_LIKED,payload:e}),e}bookStoryCommentUnliked(e){return h.tO.dispatch({type:v.actionTypes.BOOK_STORY_COMMENT_UNLIKED,payload:e}),e}setActiveBookStoryCommentLike(e){return h.tO.dispatch({type:v.actionTypes.SET_ACTIVE_BOOK_STORY_COMMENT_LIKE,payload:e}),e}populateBookStoryCommentLikes(e){return h.tO.dispatch({type:v.actionTypes.POPULATE_BOOK_STORY_COMMENT_LIKES,payload:e}),e}pendingLikeStatus(e){return h.tO.dispatch({type:v.actionTypes.PENDING_LIKE_STATUS,payload:{bookStoryId:e}}),e}bookStoryLiked(e){return h.tO.dispatch({type:v.actionTypes.BOOK_STORY_LIKED,payload:{bookStoryId:e}}),e}setActiveBookStoryLike(e){return h.tO.dispatch({type:v.actionTypes.SET_ACTIVE_BOOK_STORY_LIKE,payload:{bookStoryId:e}}),e}populateBookStoryLikes(e){return h.tO.dispatch({type:v.actionTypes.POPULATE_BOOK_STORY_LIKES,payload:e}),e}bookStoryUnliked(e){return h.tO.dispatch({type:v.actionTypes.BOOK_STORY_UNLIKED,payload:{bookStoryId:e}}),e}clearBookStoryLikes(e){return h.tO.dispatch({type:v.actionTypes.CLEAR_BOOK_STORY_LIKES,payload:{bookStoryId:e}}),e}clearBookStoryCommentLikes(e){return h.tO.dispatch({type:v.actionTypes.CLEAR_BOOK_STORY_COMMENT_LIKES,payload:{bookStoryCommentId:e}}),e}likeBookStoryComment(e){return c.likeBookStoryComment(e).then((()=>{this.bookStoryCommentLiked(e)}))}unlikeBookStoryComment(e){return c.unlikeBookStoryComment(e).then((()=>{this.bookStoryCommentUnliked(e)}))}listBookStoryCommentLikes(e){return p.d.setCollectionStatus({storyCommentLikes:"loading"}),c.listBookStoryCommentLikes(e).then((t=>{p.d.addProfileCollection({storyCommentLikes:{profiles:_.map(t.likes,"profile")}}),this.populateBookStoryCommentLikes(_.merge(t,e)),p.d.setCollectionMetadata({storyCommentLikes:t})}))}likeBookStory(e){return i.likeBookStory({bookStoryId:e}).then((()=>{this.bookStoryLiked(e)}))}unlikeBookStory(e){return i.unlikeBookStory({bookStoryId:e}).then((()=>{this.bookStoryUnliked(e)}))}listBookStoryLikes(e){return p.d.setCollectionStatus({bookStoryLikes:"loading"}),i.listBookStoryLikes(e).then((t=>{p.d.addProfileCollection({bookStoryLikes:{profiles:_.map(t.likes,"profile")}}),this.populateBookStoryLikes(_.merge(t,e)),p.d.setCollectionMetadata({bookStoryLikes:t})}))}toggleBookStoryLike(e,t){return this.pendingLikeStatus(e),this.toggleLike(e,t)}toggleLike(e,t){return t?this.unlikeBookStory(e):this.likeBookStory(e)}},w={add(){return bubEvents.track("Comments","Added")},edit(){return bubEvents.track("Comments","Edited")},delete(){return bubEvents.track("Comments","Deleted")}},L="bookStoryComments",A=(0,h.hp)(L,["CREATING_BOOK_STORY_COMMENT","BOOK_STORY_COMMENT_CREATED","BOOK_STORY_COMMENT_FAILED","SET_ACTIVE_BOOK_STORY_COMMENT","SET_FOCUSED_BOOK_STORY_COMMENT","SET_ACTIVE_EDIT_BOOK_STORY_COMMENT","SET_FOCUSED_EDIT_BOOK_STORY_COMMENT","ADD_BOOK_STORY_COMMENTS","SET_BOOK_STORIES","SET_BOOK_STORIES_LIST","ADD_BOOK_STORIES","BOOK_STORY_COMMENT_EDITED","BOOK_STORY_COMMENT_DELETED","EDITING_BOOK_STORY_COMMENT"]),N="pending",M=(e,t)=>(e.bookStoryComments=_.merge(e.bookStoryComments,_.keyBy(t,"id")),_.forEach(t,(t=>{void 0===e.bookStoryCommentsMap[t.book_story_id]&&(e.bookStoryCommentsMap[t.book_story_id]={}),e.bookStoryCommentsMap[t.book_story_id][t.id]=t})),e);(0,h.fn)(L,(0,u.Uy)(((e,t)=>{switch(t.type){case A.CREATING_BOOK_STORY_COMMENT:return e.pendingBookStoryComments[t.payload.bookStoryId]=N,e;case A.BOOK_STORY_COMMENT_CREATED:return _.unset(e,["pendingBookStoryComments",t.payload.bookStoryId]),M(e,[t.payload]),e.bookStoryCommentCountsMap[t.payload.book_story_id]+=1,e.activeBookStoryComment=null,e;case A.BOOK_STORY_COMMENT_FAILED:return _.unset(e,["pendingBookStoryComments",t.payload.bookStoryId]),e;case A.SET_ACTIVE_BOOK_STORY_COMMENT:return e.activeBookStoryComment=t.payload.bookStoryId,e;case A.SET_FOCUSED_BOOK_STORY_COMMENT:return e.focusedBookStoryComment=t.payload.bookStoryId,e;case A.SET_ACTIVE_EDIT_BOOK_STORY_COMMENT:return e.activeEditBookStoryComment=t.payload.bookStoryCommentId,e;case A.SET_FOCUSED_EDIT_BOOK_STORY_COMMENT:return e.focusedEditBookStoryComment=t.payload.bookStoryCommentId,e;case A.ADD_BOOK_STORY_COMMENTS:return M(e,t.payload.bookStoryComments);case A.SET_BOOK_STORIES:case A.SET_BOOK_STORIES_LIST:case A.ADD_BOOK_STORIES:return((e,t)=>(_.forEach(t,(t=>{M(e,t.bookStoryComments),e.bookStoryCommentCountsMap[t.id]=t.bookStoryCommentCount})),e))(e,t.payload.bookStories);case A.BOOK_STORY_COMMENT_EDITED:return e.editingBookStoryComment=null,M(e,[t.payload]);case A.BOOK_STORY_COMMENT_DELETED:return _.unset(e,["bookStoryCommentsMap",t.payload.bookStoryId,t.payload.bookStoryCommentId]),e.bookStoryCommentCountsMap[t.payload.bookStoryId]-=1,e;case A.EDITING_BOOK_STORY_COMMENT:return e.editingBookStoryComment=t.payload.bookStoryCommentId,e;default:return e}}),{pendingBookStoryComments:{},activeBookStoryComment:null,focusedBookStoryComment:null,bookStoryComments:{},bookStoryCommentsMap:{},bookStoryCommentCountsMap:{},editingBookStoryComment:null}));const D=e=>e[L],F=(0,d.P1)(D,(e=>memoize((t=>void 0!==e.bookStoryCommentsMap[t]?_.sortBy(_.values(e.bookStoryCommentsMap[t]),"createdAt"):[])))),x=(0,d.P1)(D,(e=>memoize((t=>e.bookStoryComments[t])))),U=(0,d.P1)(D,(e=>memoize((t=>e.pendingBookStoryComments[t]===N)))),H=(0,d.P1)(D,(e=>memoize((t=>e.bookStoryCommentCountsMap[t])))),$=(0,d.P1)(D,(e=>memoize((t=>e.editingBookStoryComment===t)))),K={actionTypes:A,getSelector:e=>{const t={getBookStoryComments:t=>F(e)(t),getBookStoryComment:t=>x(e)(t),isPending:t=>U(e)(t),getBookStoryCommentCount:t=>H(e)(t),isEditingBookStoryComment:t=>$(e)(t)};return{...D(e),...t}},PENDING:N},z=new class{setBookStories(e){return h.tO.dispatch({type:K.actionTypes.SET_BOOK_STORIES,payload:{bookStories:e}}),e}setBookStoriesList(e){return h.tO.dispatch({type:K.actionTypes.SET_BOOK_STORIES_LIST,payload:e}),e}addBookStories(e){return h.tO.dispatch({type:K.actionTypes.ADD_BOOK_STORIES,payload:{bookStories:e}}),e}addBookStoryComments(e){return B.addBookStoryComments(e),h.tO.dispatch({type:K.actionTypes.ADD_BOOK_STORY_COMMENTS,payload:e}),e}creatingBookStoryComment(e){return h.tO.dispatch({type:K.actionTypes.CREATING_BOOK_STORY_COMMENT,payload:{bookStoryId:e}}),e}bookStoryCommentCreated(e){return h.tO.dispatch({type:K.actionTypes.BOOK_STORY_COMMENT_CREATED,payload:e}),e}bookStoryCommentFailed(e){return h.tO.dispatch({type:K.actionTypes.BOOK_STORY_COMMENT_FAILED,payload:e}),e}setActiveBookStoryComment(e){return h.tO.dispatch({type:K.actionTypes.SET_ACTIVE_BOOK_STORY_COMMENT,payload:{bookStoryId:e}}),e}setFocusedBookStoryComment(e){return h.tO.dispatch({type:K.actionTypes.SET_FOCUSED_BOOK_STORY_COMMENT,payload:{bookStoryId:e}}),e}setActiveEditBookStoryComment(e){return h.tO.dispatch({type:K.actionTypes.SET_ACTIVE_EDIT_BOOK_STORY_COMMENT,payload:{bookStoryCommentId:e}}),e}setFocusedEditBookStoryComment(e){return h.tO.dispatch({type:K.actionTypes.SET_FOCUSED_EDIT_BOOK_STORY_COMMENT,payload:{bookStoryCommentId:e}}),e}bookStoryCommentDeleted(e){return h.tO.dispatch({type:K.actionTypes.BOOK_STORY_COMMENT_DELETED,payload:e}),e}editingBookStoryComment(e){return h.tO.dispatch({type:K.actionTypes.EDITING_BOOK_STORY_COMMENT,payload:{bookStoryCommentId:e}}),e}createBookStoryComment(e){const t=e.book_story_id;return this.creatingBookStoryComment(e),w.add(),a.createBookStoryComment(e).then((e=>{this.bookStoryCommentCreated(_.merge(e,{bookStoryId:t})),l.i.clearForm(t),l.i.validateForm(t)}),(e=>{409===e.status&&this.bookStoryCommentFailed({bookStoryId:t})}))}editBookStoryComment(e){return w.edit(),a.editBookStoryComment(e).then((e=>{h.tO.dispatch({type:K.actionTypes.BOOK_STORY_COMMENT_EDITED,payload:e})}))}loadMoreComments(e,t){return a.listBookStoryComments(e).then((e=>{t(),this.addBookStoryComments(e);const o=_.map(e.bookStoryComments,"profile");return p.d.addProfiles({profiles:o})}))}deleteBookStoryComment(e,t){return w.delete(),a.deleteBookStoryComment(e).then((()=>{t(),this.bookStoryCommentDeleted(e)}))}};var j=o(16174),G=o(9052),q=o(95130),V=o(76197),W=o(87679);const Y=new class{syncDelete(e,t,o){return ee.bookStoryDeleted(o),t&&(V.t.clearBookRecommendation({userId:e,bookId:t}),q.M.clearBookReactions({userId:e,bookId:t}),W.Z.ratedBook({rating:0,bookId:t})),!0}};var Q=o(51321),J=o(29908),Z=o(9971);const X={add(e){return bubEvents.track("Text Reviews","Book story created with text",{value:e})}},ee=new class{constructor(){this.searchRecommendedBookStep=this.searchRecommendedBookStep.bind(this),this.resetRecommendBookFlow=this.resetRecommendBookFlow.bind(this)}ratedBook(e){return h.tO.dispatch({type:r.h.actionTypes.RATED_BOOK,payload:e})}setBookStories(e){return B.setBookStories(e),z.setBookStories(e),h.tO.dispatch({type:r.h.actionTypes.SET_BOOK_STORIES,payload:{bookStories:e}})}setBookStoriesList(e){return B.setBookStoriesList(e),z.setBookStoriesList(e),h.tO.dispatch({type:r.h.actionTypes.SET_BOOK_STORIES_LIST,payload:e})}addBookStories(e){return B.addBookStories(e),z.addBookStories(e),h.tO.dispatch({type:r.h.actionTypes.ADD_BOOK_STORIES,payload:{bookStories:e}})}addBookStoriesToList(e){return B.addBookStoriesToList(e),h.tO.dispatch({type:r.h.actionTypes.ADD_BOOK_STORIES_TO_LIST,payload:e})}setMoreBookStoriesExist(e){return h.tO.dispatch({type:r.h.actionTypes.SET_MORE_BOOK_STORIES_EXIST,payload:{hasMoreBookStories:e}})}setPaginationData(e){return h.tO.dispatch({type:r.h.actionTypes.SET_PAGINATION_DATA,payload:e})}setTimestamps(e){return h.tO.dispatch({type:r.h.actionTypes.SET_TIMESTAMPS,payload:e})}setMoreCollectionBookStoriesExist(e){return h.tO.dispatch({type:r.h.actionTypes.SET_MORE_COLLECTION_BOOK_STORIES_EXIST,payload:e})}setLoadingMore(e){return h.tO.dispatch({type:r.h.actionTypes.SET_LOADING_MORE,payload:{loadingMore:e}})}setBookStoryCreating(e){return h.tO.dispatch({type:r.h.actionTypes.SET_BOOK_STORY_CREATING,payload:{bookId:e}})}setBookStoryDeleting(e){return h.tO.dispatch({type:r.h.actionTypes.SET_BOOK_STORY_DELETING,payload:{bookStoryId:e}})}bookStoryFailed(e){return h.tO.dispatch({type:r.h.actionTypes.BOOK_STORY_FAILED,payload:{bookId:e}})}setActiveBookId(e){return h.tO.dispatch({type:r.h.actionTypes.SET_ACTIVE_BOOK_ID,payload:{bookId:e}})}focusBookStoryForm(e){return h.tO.dispatch({type:r.h.actionTypes.FOCUS_BOOK_STORY_FORM,payload:{flag:e}})}activeBookStoryForm(e){return h.tO.dispatch({type:r.h.actionTypes.ACTIVE_BOOK_STORY_FORM,payload:{flag:e}})}editingBookStory(e){return h.tO.dispatch({type:r.h.actionTypes.EDITING_BOOK_STORY,payload:{bookStoryId:e}})}updatingBookStory(e){return h.tO.dispatch({type:r.h.actionTypes.UPDATING_BOOK_STORY,payload:{flag:e}})}bookStoryEdited(e){return h.tO.dispatch({type:r.h.actionTypes.BOOK_STORY_EDITED,payload:e})}setRecommendationStep(e){return h.tO.dispatch({type:r.h.actionTypes.SET_RECOMMENDATION_STEP,payload:{step:e}})}setPreviousRecommendationStep(e){return h.tO.dispatch({type:r.h.actionTypes.SET_PREVIOUS_RECOMMENDATION_STEP,payload:{step:e}})}setActiveBookStoryId(e){return h.tO.dispatch({type:r.h.actionTypes.SET_ACTIVE_BOOK_STORY_ID,payload:{bookStoryId:e}})}setReviewDataLoaded(e){return h.tO.dispatch({type:r.h.actionTypes.SET_REVIEW_DATA_LOADED,payload:{flag:e}})}bookFromSearchResult(e){return h.tO.dispatch({type:r.h.actionTypes.BOOK_FROM_SEARCH_RESULT,payload:{flag:e}})}setCollectionStatus(e){const[t,o]=_(e).toPairs().head();return h.tO.dispatch({type:r.h.actionTypes.SET_COLLECTION_STATUS,payload:{feedType:t,status:o}})}permissionDenied(e){return h.tO.dispatch({type:r.h.actionTypes.PERMISSION_DENIED,payload:{bookId:e}})}bookStoryCreated(e){return p.d.bookStoryCreated(),h.tO.dispatch({type:r.h.actionTypes.BOOK_STORY_CREATED,payload:{bookStory:e}})}bookStoryDeleted(e){return p.d.bookStoryDeleted(),h.tO.dispatch({type:r.h.actionTypes.BOOK_STORY_DELETED,payload:{bookStoryId:e}})}createBookStory(e,t){const o=e["book_story[book_id]"]||e.book_id,s=_.get(e,"bookListSlug");return this.setBookStoryCreating(o),_.get(e.text,"value")&&X.add(o),i.createBookStory(e).then((e=>(p.d.addProfiles({profiles:[e.profile]}),this.bookStoryCreated(_.merge(e,{bookId:o})),this.setActiveBookId(o),l.i.clearForm(),this.setActiveBookStoryId(_.get(e,"id")),W.Z.movedBookToList({bookId:o,prevListSlug:s,newListSlug:"finished"}),t())),(e=>{409===e.status&&this.bookStoryFailed(o)}))}createBookStoryPermission(e){const t={book_id:e,permission_only:!0};return i.createBookStory(t).catch((t=>{if(403===t.status)throw this.setReviewDataLoaded(!0),this.permissionDenied(e),t}))}deleteBookStory(e,t,o){return this.setBookStoryDeleting(o),i.deleteBookStory(o).then((()=>Y.syncDelete(e,t,o)))}editBookStoryComment(e){return this.updatingBookStory(!0),a.editBookStoryComment(e).then((e=>{this.bookStoryEdited(e),this.updatingBookStory(!1),z.editingBookStoryComment(null)}))}getBookStory(e){return this.setCollectionStatus({[`book-story-${e}`]:"loading"}),i.getBookStory(e).then((t=>(this.setBookStories(t.bookStories),this.setBookStoriesRelatedData(t),this.setCollectionStatus({[`book-story-${e}`]:"loaded"}),t)))}listBookStories(e){return this.setCollectionStatus({[e.feedType]:"loading"}),i.listBookStoryFeed(e).then((t=>{this.setBookStories(t.bookStories),this.setBookStoriesRelatedData(t),this.setCollectionStatus({[e.feedType]:"loaded"})}))}listBookStoriesOfType(e){return this.setCollectionStatus({[e.listType]:"loading"}),i.listBookStoryFeed(e).then((t=>{this.setBookStoriesRelatedData(t),this.setMoreCollectionBookStoriesExist({listType:e.listType,hasMoreBookStories:t.hasMoreBookStories}),this.setBookStoriesList({listType:e.listType,bookStories:t.bookStories}),this.setCollectionStatus({[e.listType]:"loaded"}),this.setPaginationData(t),this.setTimestamps(t)}))}listBookStoriesForUser(e){return this.setCollectionStatus({[e.listType]:"loading"}),n.H.getRecommendations(e.userId).then((t=>{this.setBookStoriesRelatedData(t),this.setBookStoriesList({listType:e.listType,bookStories:t.bookStories}),this.setCollectionStatus({[e.listType]:"loaded"})}))}autoFollowAuthors(e,t){return p.d.setCollectionStatus({[e]:"loading"}),i.autoFollowAuthors(t).then((t=>(p.d.setProfileCollection({[e]:{profiles:t.profiles}}),t)))}suggestedRecommenders(e,t,o){return p.d.setCollectionStatus({[e]:"loading"}),i.suggestedRecommenders(t,o).then((t=>(p.d.setProfileCollection({[e]:{profiles:t.profiles}}),t)))}shareMissingBookStep(){return this.setRecommendationStep("missing")}bookmarkStep(){return this.setRecommendationStep("bookmark")}searchRecommendedBookStep(){return this.setRecommendationStep("search")}selectedRecommendedBookStep(){return this.setRecommendationStep("recommendation")}recommendationReminderStep(){return this.setRecommendationStep("recommendation-reminder")}autoFollowPromptStep(){return this.setRecommendationStep("auto-follow-prompt")}autoFollowAuthorsStep(){return this.setRecommendationStep("auto-follow-authors")}deleteConfirmStep(){return this.setRecommendationStep("delete-confirm")}closeConfirmStep(){return this.setRecommendationStep("close-confirm")}clearRecommendBookFlow(e){return l.i.clearForm(e),l.i.validateForm(e),this.editingBookStory(!1),j.Q.removeFeaturedBookMention(e),G.t.setSearchQuery(""),G.t.setCollectionStatus({featuredResults:null}),G.t.addSuggestionCollection({featuredResults:[]}),this.setReviewDataLoaded(!1),this.bookFromSearchResult(!1)}resetRecommendBookFlow(e){return this.activeBookStoryForm(null),this.setActiveBookStoryId(null),this.setPreviousRecommendationStep(null),this.searchRecommendedBookStep(),this.clearRecommendBookFlow(e),Q.P.hide()}loadBookStoryIntoForm(e,t){const o=J.H.syntaxToMentionRenderHelper(e.text,e.profileMentions,e.bookMentions)||"",s={name:"book_story[text]",mentions:e.profileMentions+e.bookMentions,value:o};return l.i.formChanged({form_input_id:t,form_data:s}),j.Q.setCursorIndex(s.value.length),this.setActiveBookStoryId(e.id),this.addBookStories([e]),this.editingBookStory(e.id),this.activeBookStoryForm(t)}prepEdit(e,t){return t?(q.M.getBookReactions(Z.I.currentUserId(),t),this.selectedRecommendedBookStep(),i.listBookStoriesForUserForBook(t).then((t=>{if(_.get(t.bookStories,"length")>0){const o=t.bookStories[0];this.loadBookStoryIntoForm(o,e)}return this.setReviewDataLoaded(!0)}))):this.setReviewDataLoaded(!0)}loadMoreBookStories(e){return this.setLoadingMore(!0),e=_.merge({before_book_story_id:e.beforeId},e),i.listBookStoryFeed(e).then(this.loadMoreBookStoriesSuccess.bind(this))}loadMoreBookStoriesOfType(e){return this.setCollectionStatus({[e.listType]:"loading-more"}),e=_.merge({before_book_story_id:e.beforeId},e),i.listBookStoryFeed(e).then((t=>{this.setCollectionStatus({[e.listType]:"loaded"}),this.setBookStoriesRelatedData(t),this.setMoreCollectionBookStoriesExist({listType:e.listType,hasMoreBookStories:t.hasMoreBookStories}),this.addBookStoriesToList({listType:e.listType,bookStories:t.bookStories})}))}loadMoreBookStoriesSuccess(e){return this.setLoadingMore(!1),this.setBookStoriesRelatedData(e),this.addBookStories(e.bookStories)}setBookStoriesAndRelatedData(e){return this.setBookStoriesRelatedData(e),this.setBookStories(e.bookStories)}addBookStoriesAndRelatedData(e){return this.setBookStoriesRelatedData(e),this.addBookStories(e.bookStories)}setBookStoriesRelatedData(e){const t=_.map(e.bookStories,"book"),o=_.map(e.bookStories,(e=>{const t=_.map(e.bookStoryComments,"profile");return[e.profile,t]}));W.Z.addBooks({books:t}),this.setMoreBookStoriesExist(e.hasMoreBookStories);const s=_(e.bookStories).flatMap("bookReactions").compact().value();q.M.storeBookReactions({bookReactions:s});const r=_(e.bookStories).flatMap("bookRecommendation").compact().value();return V.t.storeBookRecommendations({bookRecommendations:r}),p.d.addProfiles({profiles:_.flattenDeep(o)}),o}}},87679:function(e,t,o){"use strict";o.d(t,{Z:function(){return g}});var s=o(15176),r=o(71407);const i={reportDataIssues(e,t){return(0,r.t)({method:"POST",url:this._path("report-data-issues"),data:{book_id:e,book_change_requests:JSON.stringify(t)}})},fetchBook(e){return(0,r.t)({url:`/book_page_api/books/${e.bookId}`,method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},data:{custom_source:e.customSource}})},fetchBookBySlug(e){return(0,r.t)({url:`/book_page_api/books?slug=${e.slug}`,method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}})},fetchSimilarlyTaggedBooks(e){return(0,r.t)({url:`/book_page_api/books/${e.bookId}/similarly_tagged_books`,method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}})},_path(e){return`/books/${e}`}};var a=o(48049);const n={rateBook(e){return(0,r.t)({method:"POST",url:this._path("rate-book"),data:{book_id:e.bookId,rating:e.rating}})},_path(e){return`/settings/ratings/${e}`}},l={getAvailabilities(e,t={}){const o=_.merge({},{bookId:e},t);return(0,r.t)({method:"GET",url:"/availabilities",data:_.mapKeys(o,((e,t)=>_.snakeCase(t)))})}};var p=o(53893),c=o(27783),d=o(57997),u=o(26076),h=o(31563),m=o(75820);const g=new class{constructor(){this.authorsBooksSuccess=this.authorsBooksSuccess.bind(this)}addBooks(e){m.tO.dispatch({type:h.G.actionTypes.ADD_BOOKS,payload:e})}addAuthorBooks(e){m.tO.dispatch({type:h.G.actionTypes.ADD_AUTHOR_BOOKS,payload:e})}addAvailabilities(e){m.tO.dispatch({type:h.G.actionTypes.ADD_AVAILABILITIES,payload:e})}appendBook(e){m.tO.dispatch({type:h.G.actionTypes.APPEND_BOOK,payload:{book:e}})}setActiveBookId(e){m.tO.dispatch({type:h.G.actionTypes.SET_ACTIVE_BOOK_ID,payload:{bookId:e}})}setAuthorBooksStatus(e){m.tO.dispatch({type:h.G.actionTypes.SET_AUTHOR_BOOKS_STATUS,payload:{data:e}})}setAuthorBooksIds(e){m.tO.dispatch({type:h.G.actionTypes.SET_AUTHOR_BOOKS_IDS,payload:e})}setLoading(e){m.tO.dispatch({type:h.G.actionTypes.SET_LOADING,payload:e})}movedBookToList(e){m.tO.dispatch({type:h.G.actionTypes.MOVED_BOOK_TO_LIST,payload:e}),_.get(e,"prevListSlug")!==_.get(e,"newListSlug")&&(c.E.movedBookToList(e),u.t.movedBookToList(e))}ratedBook(e){return m.tO.dispatch({type:h.G.actionTypes.RATED_BOOK,payload:e}),d.H.ratedBook(e),e}removedBookFromList(e){m.tO.dispatch({type:h.G.actionTypes.REMOVED_BOOK_FROM_LIST,payload:e}),c.E.removedBookFromList(e),u.t.removedBookFromList(e)}setRatingState(e){m.tO.dispatch({type:h.G.actionTypes.SET_RATING_STATE,payload:{book:e}})}authorsBooksFetch(e,t,o){this.setAuthorBooksStatus({id:t,isLoading:!0}),p.S.getAuthorsBooks({authorId:t,page:e,sortBy:o}).then(_.partial(this.authorsBooksSuccess,t))}authorsBooksSuccess(e,t){const o=_.merge({id:e},t);return this.addBooks({books:t.books}),this.addAuthorBooks(o),this.setAuthorBooksStatus({id:e,isLoading:!1,hasMore:t.hasMore,page:t.currentPage}),o}fetchBook(e,t){return i.fetchBook({bookId:e,customSource:t}).then((e=>(this.addBooks({books:[e]}),e)))}fetchSimilarlyTaggedBooksForBook(e){return i.fetchSimilarlyTaggedBooks({bookId:e})}getAvailabilities(e,t={}){return l.getAvailabilities(e,t).then(this.addAvailabilities)}moveBookToList(e,t,o={}){if(e.bookListSlug===t)return new s.ZP.Promise((t=>{this.setLoading({bookId:e.id,status:"updated"}),t()}));this.setLoading({bookId:e.id,status:"updating"});const r={bookId:e.id,fromList:e.bookListSlug,listSlug:t,pageNumber:e.page,reference:o};return a.$.moveBookToList(r).then((()=>{this.movedBookToList({bookId:e.id,prevListSlug:e.bookListSlug,newListSlug:t})}))}loadMoreAuthorBooks(e,t,o){return e+=1,this.authorsBooksFetch(e,t,o),this.setAuthorBooksStatus({id:t,page:e}),e}loadSortedAuthorBooks(e,t){const o=e.target.value;return this.setAuthorBooksStatus({id:t,sortBy:o,page:1}),this.setAuthorBooksIds({id:t,bookIds:[]}),this.authorsBooksFetch(1,t,o)}moveBooksToList(e,t){_.forEach(e,(e=>{this.setLoading({bookId:e.id,status:"updating"})}));const o={bookIds:_.map(e,"id"),listSlug:t};return a.$.moveBooksToList(o).then((()=>(_.forEach(e,(e=>{this.movedBookToList({bookId:e.id,prevListSlug:e.bookListSlug,newListSlug:t})})),e)))}rateBook(e,t,o){const s={bookId:e.id,rating:t,userId:o};return this.setLoading({bookId:e.id,status:"updating"}),n.rateBook(s).then((()=>(t>0&&this.movedBookToList({bookId:e.id,prevListSlug:e.bookListSlug,newListSlug:"finished"}),this.ratedBook(s))))}removeBookFromList(e,t){const o={bookId:e.id,listSlug:t};return this.setLoading({bookId:e.id,status:"removing"}),a.$.removeBook(o).then((()=>{this.removedBookFromList(o)}))}}},46078:function(e,t,o){"use strict";o.d(t,{l:function(){return l}});var s=o(75820),r=o(9971),i=o(55278),a=o(71407);const n={request({data:e,authToken:t,method:o,url:s}){return(0,a.t)({url:s,accepts:"application/json",method:o,data:e,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","X-CSRF-Token":t}})},signIn(e){const t=e.credentials.remember_me;return this.request({url:e.url,method:"POST",authToken:e.authToken,data:{"user[email_address]":e.credentials.email_address,"user[password]":e.credentials.password,"user[remember_me]":t,"g-recaptcha-response":e.gRecaptchaResponse}})},signUp(e){const t=e.credentials.subscribe_me;return this.request({url:e.url,method:"POST",authToken:e.authToken,data:{"user[email_address]":e.credentials.email_address,"user[password]":e.credentials.password,"user[subscribe_me]":t,"g-recaptcha-response":e.gRecaptchaResponse,recaptcha_v3_token:e.recaptchaV3Token}})},sendMagicLink(e){return this.request({url:"/magic_link",method:"POST",authToken:e.authToken,data:{email_address:e.emailAddress,"g-recaptcha-response":e.gRecaptchaResponse}})},authToken(){return(0,a.t)({url:"/form_auth_token",method:"GET"})}},l=new class{resetErrorMessages(e){s.tO.dispatch({type:i.L.actionTypes.RESET_ERROR,payload:e})}setIsAuthenticated(e){s.tO.dispatch({type:i.L.actionTypes.SET_IS_AUTHENTICATED,payload:e})}setIsSubmitted(e){s.tO.dispatch({type:i.L.actionTypes.SET_IS_SUBMITTED,payload:e})}setAuthenticityToken(){return n.authToken().then(this.storeAuthToken)}signIn(e,t){return _.merge(e,{authToken:r.I.csrfToken()}),n.signIn(e).then(this.authenticateSuccess).then(t).catch(this.authenticateError)}sendMagicLink(e){return _.merge(e,{authToken:r.I.csrfToken()}),n.sendMagicLink(e).then((e=>{window.location=e.location})).catch(this.authenticateError)}signUp(e,t){return _.merge(e,{authToken:r.I.csrfToken()}),n.signUp(e).then(this.authenticateSuccess).then(t).catch(this.authenticateError)}storeAuthToken(e){s.tO.dispatch({type:i.L.actionTypes.SET_AUTHENTICITY_TOKEN,payload:e})}authenticateSuccess(e){s.tO.dispatch({type:i.L.actionTypes.AUTHENTICATE_SUCCESS,payload:e})}authenticateError(e){s.tO.dispatch({type:i.L.actionTypes.AUTHENTICATE_ERROR,payload:e.responseJSON||e.responseText})}}},43912:function(e,t,o){"use strict";o.d(t,{$:function(){return i}});var s=o(75820),r=o(53593);const i=new class{setMessages(e){s.tO.dispatch({type:r._.actionTypes.SET_MESSAGES,payload:{messages:e}})}removeMessage(e){s.tO.dispatch({type:r._.actionTypes.REMOVE_MESSAGE,payload:{index:e}})}}},10141:function(e,t,o){"use strict";o.d(t,{i:function(){return i}});var s=o(75820),r=o(5449);const i=new class{formChanged(e){s.tO.dispatch({type:r.c.actionTypes.FORM_CHANGED,payload:e})}clearForm(e){s.tO.dispatch({type:r.c.actionTypes.CLEAR_FORM,payload:{formId:e}})}setFormState(e){s.tO.dispatch({type:r.c.actionTypes.SET_FORM_STATE,payload:e})}validateForm(e){s.tO.dispatch({type:r.c.actionTypes.VALIDATE_FORM,payload:{formId:e}})}setValidationSettings(e){s.tO.dispatch({type:r.c.actionTypes.SET_VALIDATION_SETTINGS,payload:e})}validateAndTouchAllInputs(e){s.tO.dispatch({type:r.c.actionTypes.VALIDATE_AND_TOUCH_ALL_INPUTS,payload:e})}setErrorMessage(e){s.tO.dispatch({type:r.c.actionTypes.SET_ERROR_MESSAGE,payload:e})}}},16174:function(e,t,o){"use strict";o.d(t,{Q:function(){return a}});var s=o(15176),r=o(75820),i=o(49065);const a=new class{addBookMention(e,t){return new s.ZP.Promise((o=>{r.tO.dispatch({type:i.t.actionTypes.ADD_BOOK_MENTION,payload:{formId:e,id:t}}),o()}))}clearBookMentions(e){return r.tO.dispatch({type:i.t.actionTypes.CLEAR_BOOK_MENTIONS,payload:{formId:e}}),e}featureBookMention(e,t){return r.tO.dispatch({type:i.t.actionTypes.FEATURE_BOOK_MENTION,payload:{formId:e,id:t}}),{formId:e,id:t}}removeFeaturedBookMention(e){return r.tO.dispatch({type:i.t.actionTypes.REMOVE_FEATURED_BOOK_MENTION,payload:{formId:e}}),e}setActiveMentionModal(e){return r.tO.dispatch({type:i.t.actionTypes.SET_ACTIVE_MENTION_MODAL,payload:{id:e}}),e}showMentionModal(e){r.tO.dispatch({type:i.t.actionTypes.SHOW_MENTION_MODAL,payload:{mentionType:e}})}hideMentionModal(){r.tO.dispatch({type:i.t.actionTypes.HIDE_MENTION_MODAL,payload:{}})}setCursorIndex(e){r.tO.dispatch({type:i.t.actionTypes.SET_CURSOR_INDEX,payload:{index:e}})}setSelectedProfileId(e){return new s.ZP.Promise((t=>{r.tO.dispatch({type:i.t.actionTypes.SET_SELECTED_PROFILE_ID,payload:{profileId:e}}),t()}))}}},76189:function(e,t,o){"use strict";o.d(t,{c:function(){return p}});var s=o(71407),r=o(88485),i=o(9971);const a={show(e){return this.request({method:"GET",url:this._url(e.id)})},create(e){return this.request({method:"POST",url:this._url(""),data:JSON.stringify({id:e.id})})},request(e={}){return(0,s.t)(_.merge(e,{crossDomain:!0,xhrFields:{withCredentials:!0},headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-Token":i.I.csrfToken()}}))},_url(e){return(0,r.F)("www",`/notification_views/${e}`)}};var n=o(75820),l=o(92694);const p=new class{notificationViewed(e){n.tO.dispatch({type:l.N.actionTypes.NOTIFICATION_VIEWED,payload:{id:e.id}})}showNotification(e){n.tO.dispatch({type:l.N.actionTypes.SHOW_NOTIFICATION,payload:{id:e.id}})}notificationLoaded(e){n.tO.dispatch({type:l.N.actionTypes.NOTIFICATION_LOADED,payload:{id:e}})}createNotificationView(e){return a.create(e).then((()=>{this.notificationViewed(e)}))}getNotificationView(e){return a.show(e).then((t=>{this.notificationLoaded(e.id),t?this.notificationViewed(e):this.showNotification(e)}))}}},51321:function(e,t,o){"use strict";o.d(t,{P:function(){return a}});var s=o(74718),r=o(75820),i=o(91013);const a=new class{constructor(){this.set=this.set.bind(this)}show(e){return r.tO.dispatch({type:i.I.actionTypes.SHOW,payload:{force:e}})}hide(){return r.tO.dispatch({type:i.I.actionTypes.HIDE,payload:{}})}set(e,t){const o={classString:e,propsToRenderWith:t,trackingName:_.get(e,"trackingName")};return _.isNil(o.trackingName)&&console.error("Modal components need a trackingName attribute"),r.tO.dispatch({type:i.I.actionTypes.SET,payload:{data:o}})}setAndForceShow(e,t){this.setAndShow(e,t,!0)}setAndShow(e,t,o=!1){return this.set(e,t),this.show(o)}showResponsively(e,t,o,r){return void 0===r&&(r=s.c.matchesXs),this.set(r()?t:e,_.assign(o,{isFullWidth:r()})),this.show()}freezeBodyScrolling(){document.body.style.top=`-${window.scrollY}px`,document.body.style.overflowY="scroll",document.body.style.position="fixed",document.body.style.width="100%"}unfreezeBodyScrolling(){document.body.style.position="",document.body.style.top=""}}},9052:function(e,t,o){"use strict";o.d(t,{t:function(){return i}});var s=o(75820),r=o(36289);const i=new class{addSuggestionCollection(e){s.tO.dispatch({type:r.t.actionTypes.ADD_SUGGESTION_COLLECTION,payload:e})}appendSuggestionCollection(e){s.tO.dispatch({type:r.t.actionTypes.APPEND_SUGGESTION_COLLECTION,payload:e})}setCollectionStatus(e){s.tO.dispatch({type:r.t.actionTypes.SET_COLLECTION_STATUS,payload:{collectionStatus:e}})}setSearchQuery(e){s.tO.dispatch({type:r.t.actionTypes.SET_SEARCH_QUERY,payload:{query:e}})}}},85924:function(e,t,o){"use strict";o.d(t,{Z:function(){return g}});var s=o(88251),r=o(75820),i=o(91013);class a extends React.Component{shouldComponentUpdate(e){const t=this.props.show!==e.show||this.props.isFullWidth!==e.isFullWidth,o=_.get(this.props.overlay,"trackingName"),s=_.get(e.overlay,"trackingName"),r=o&&s&&s!==o;return!this.props.show||t||r}componentDidUpdate(e,t){this.isBecomingFullWidth(e,this.props)?($(".page-footer").hide(),$(".overlay-vc-modeless-children").css({height:"0",overflow:"hidden"}),$(document).scrollTop(0)):this.isLeavingFullWidth(e,this.props)&&($(".page-footer").show(),$(".overlay-vc-modeless-children").css({height:"inherit",overflow:"inherit"}),_.delay((()=>{$(document).scrollTop(t)}),150))}getSnapshotBeforeUpdate(){return $(document).scrollTop()}isBecomingFullWidth(e,t){return t.isFullWidth&&!e.isFullWidth}isLeavingFullWidth(e,t){return!t.isFullWidth&&e.isFullWidth}render(){let e;return this.props.show&&(e=React.createElement(this.props.overlay.classString,this.props.overlay.propsToRenderWith,this.props.overlay.propsToRenderWith?this.props.overlay.propsToRenderWith.children:null)),React.createElement("div",null,e,React.createElement("div",{className:"overlay-vc-modeless-children"},this.props.children))}}a.propTypes={children:PropTypes.node,isFullWidth:PropTypes.bool,overlay:PropTypes.object,show:PropTypes.bool},a.defaultProps={children:null,isFullWidth:!1,overlay:null,show:!1};const n=(0,s.$j)((e=>{const t=i.I.getSelector(e);return{overlay:t.component,show:t.show,isFullWidth:t.isFullWidth}}))(a);var l=o(43912),p=o(53593),c=o(33024);class d extends React.Component{constructor(e){super(e),this.onFlashRemoved=this.onFlashRemoved.bind(this)}componentDidMount(){const e=_.map($(".hidden-alert"),(e=>{const t=e.innerText.replace("Ã","").trim();return{timeout:_.parseInt(e.dataset.timeout)||4e3,level:e.dataset.level,text:t,dismissable:!0}}));_.defer((()=>{l.$.setMessages(e)}))}onFlashRemoved(e){l.$.removeMessage(e)}render(){return React.createElement(c.b,{messages:this.props.messages,onFlashRemoved:this.onFlashRemoved,bubStyle:this.props.bubStyle})}}d.propTypes={bubStyle:PropTypes.string,messages:PropTypes.arrayOf(PropTypes.shape({level:PropTypes.string,title:PropTypes.string,text:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),urlText:PropTypes.string,url:PropTypes.string,imgUrl:PropTypes.string,clickable:PropTypes.bool,dismissable:PropTypes.bool,timeout:PropTypes.number})).isRequired};const u=(0,s.$j)((e=>({messages:p._.getSelector(e).messages})))(d);var h=/Edge?\/(1{2}[4-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Firefox\/(1{2}[5-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Chrom(ium|e)\/(109|1[1-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Maci.+ Version\/(15\.([6-9]|\d{2,})|(1[6-9]|[2-9]\d|\d{3,})\.\d+)([,.]\d+|)( Mobile\/\w+|) Safari\/|Chrome.+OPR\/([1-9]\d{2}|\d{4,})\.\d+\.\d+|(CPU[ +]OS|iPhone[ +]OS|CPU[ +]iPhone|CPU IPhone OS|CPU iPad OS)[ +]+(15[._]([6-9]|\d{2,})|(1[6-9]|[2-9]\d|\d{3,})[._]\d+)([._]\d+|)|Opera Mini|Android:?[ /-](1{2}[7-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Mobile Safari.+OPR\/(7[3-9]|[89]\d|\d{3,})\.\d+\.\d+|Android.+Firefox\/(1{2}[7-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+Chrom(ium|e)\/(1{2}[7-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+(UC? ?Browser|UCWEB|U3)[ /]?(15\.([5-9]|\d{2,})|(1[6-9]|[2-9]\d|\d{3,})\.\d+)\.\d+|SamsungBrowser\/(2[1-9]|[3-9]\d|\d{3,})\.\d+|Android.+MQ{2}Browser\/(13(\.([1-9]|\d{2,})|)|(1[4-9]|[2-9]\d|\d{3,})(\.\d+|))(\.\d+|)|K[Aa][Ii]OS\/(2\.([5-9]|\d{2,})|([3-9]|\d{2,})\.\d+)(\.\d+|)/;class m extends React.Component{constructor(e){super(e);let t=!1;new RegExp(h).test(window.navigator.userAgent)||(t=!0),this.state={hasError:!1,unsupportedBrowser:t}}static getDerivedStateFromError(){return{hasError:!0}}errorTitle(){return this.state.unsupportedBrowser?"Great books are timeless, web browsers are not.":"Something's wrong..."}errorText(){return this.state.unsupportedBrowser?React.createElement(React.Fragment,null,"Something has broken on this page. Unfortunately, it looks like your browser is out of date. We do our best to support a wide variety of browsers and devices, but BookBub works best in a modern browser. For help upgrading, check out",React.createElement("a",{href:"https://browsehappy.com/"}," https://browsehappy.com/"),"."):React.createElement(React.Fragment,null,"We seem to have broken something. You can use your browser's back button to try what you were doing again, or go back to our",React.createElement("a",{href:"/launch"}," homepage "),"to start over.  If you're stuck, please",React.createElement("a",{href:"/contact/new"}," contact us "),"for help.")}render(){return this.state.hasError?React.createElement("div",{className:"error-boundary"},React.createElement("div",{className:"error-info-container"},React.createElement("h1",{className:"error-title"},this.errorTitle()),React.createElement("p",{className:"error-text"},this.errorText()))):this.props.children}}function g(e,t={}){return class extends React.Component{renderApp(){return React.createElement(React.Fragment,null,React.createElement(u,null),React.createElement(e,this.props))}renderOverlay(){return t.hideOverlay?this.renderApp():React.createElement(n,null,this.renderApp())}render(){return React.createElement(m,{ignoreBrowserWarning:t.ignoreBrowserWarning},React.createElement(s.zt,{store:r.tO},this.renderOverlay()))}}}},76397:function(e,t,o){"use strict";o.d(t,{_:function(){return Oe}});const s={status:PropTypes.string,variants:PropTypes.array,ctr:PropTypes.number,isCpc:PropTypes.bool,impressionsServed:PropTypes.number,uniqueClicks:PropTypes.number,editPath:PropTypes.string,stateChangePath:PropTypes.string,clonePath:PropTypes.string,name:PropTypes.string,showPath:PropTypes.string,restartPath:PropTypes.string,updatePath:PropTypes.string,isContinuous:PropTypes.bool,effectiveCpm:PropTypes.number,imageUrl:PropTypes.string},r=PropTypes.shape(s),i={adId:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),name:PropTypes.string,clickthroughUrl:PropTypes.string,regions:PropTypes.arrayOf(PropTypes.number).isRequired,retailers:PropTypes.arrayOf(PropTypes.number).isRequired,isOn:PropTypes.bool,isCustomLink:PropTypes.bool,availabilities:PropTypes.arrayOf(PropTypes.shape({regionId:PropTypes.number.isRequired,retailerId:PropTypes.number.isRequired}))},a=PropTypes.shape(i),n=PropTypes.arrayOf(a),l={authoredBy:PropTypes.string,coverUrl:PropTypes.string,id:PropTypes.number,listingPrice:PropTypes.string,narratedBy:PropTypes.string,runTime:PropTypes.string,title:PropTypes.string,url:PropTypes.string},p=PropTypes.shape(l),c={listingPrice:PropTypes.string,discountPrice:PropTypes.string,discountPercent:PropTypes.string},d=PropTypes.shape(c),u={id:PropTypes.number,name:PropTypes.string,imageUrl:PropTypes.string,defaultImage:PropTypes.oneOfType([PropTypes.string,PropTypes.bool]),biography:PropTypes.string,slug:PropTypes.string,followersCount:PropTypes.number,isUserFollowing:PropTypes.bool,isClaimed:PropTypes.bool,hasSimilarAuthors:PropTypes.bool,bookCovers:PropTypes.arrayOf(PropTypes.shape({slug:PropTypes.string,coverImageUrl:PropTypes.string})),tags:PropTypes.arrayOf(PropTypes.shape({id:PropTypes.number,displayName:PropTypes.string})),profileId:PropTypes.number,verified:PropTypes.bool},h=PropTypes.shape(u),m=PropTypes.arrayOf(h),g={displayOrder:PropTypes.number,retailerName:PropTypes.string,url:PropTypes.string,targetUrl:PropTypes.string,retailerId:PropTypes.number,regionId:PropTypes.number},y=PropTypes.shape(g),b=PropTypes.arrayOf(y),k={id:PropTypes.number,name:PropTypes.string,slug:PropTypes.string},T=PropTypes.shape(k),S={id:PropTypes.number,name:PropTypes.string,slug:PropTypes.string},_=PropTypes.shape(S),f={id:PropTypes.number,name:PropTypes.string,slug:PropTypes.string},E=PropTypes.shape(f);var R=o(99082);const P={id:PropTypes.number,title:PropTypes.string,blogContributor:T,blogCategories:PropTypes.arrayOf(_),blogTags:PropTypes.arrayOf(E),description:PropTypes.string,categories:PropTypes.arrayOf(PropTypes.string),featuredImageUrl:PropTypes.string,publicationDate:PropTypes.string,updatedAt:PropTypes.string,content:PropTypes.string,url:PropTypes.string,universalUrl:PropTypes.string,siteFeaturedImageUrl:PropTypes.string,socialSharingDetails:R.D,longStoryShort:PropTypes.shape({title:PropTypes.string,img:PropTypes.string}),relatedCategories:PropTypes.arrayOf(PropTypes.shape({id:PropTypes.number,display_name:PropTypes.string,category_page_path:PropTypes.string}))},C=PropTypes.shape(P);var I=o(61825),O=o(70123);const v=PropTypes.arrayOf(I.s),B={key:PropTypes.number,slug:PropTypes.string,coverImageUrl:PropTypes.string},w=PropTypes.shape(B),L=PropTypes.arrayOf(w),A={id:PropTypes.number,introContent:PropTypes.string,books:v},N=PropTypes.shape(A),M={id:PropTypes.number,userId:PropTypes.number,bookId:PropTypes.number,isRecommended:PropTypes.bool},D=PropTypes.shape(M),F={author:h,authorClaimUrl:PropTypes.string,authorId:PropTypes.number,biography:PropTypes.string,defaultImage:PropTypes.oneOfType([PropTypes.string,PropTypes.bool]),displayName:PropTypes.string,followerCount:PropTypes.number,followingCount:PropTypes.number,id:PropTypes.number,imageUrl:PropTypes.string,isFollowing:PropTypes.bool,manageBooksUrl:PropTypes.string,name:PropTypes.string,penNameLinks:PropTypes.string,postCount:PropTypes.number,profileUrl:PropTypes.string,slug:PropTypes.string,state:PropTypes.string,tagline:PropTypes.string,userId:PropTypes.number,username:PropTypes.string},x=PropTypes.shape(F),U={id:PropTypes.number,bookId:PropTypes.number,userId:PropTypes.number,reactionId:PropTypes.number,reaction:PropTypes.string},H=PropTypes.shape(U),$={autoCreated:PropTypes.bool,book:I.s,bookMentions:PropTypes.array,bookReactions:PropTypes.arrayOf(H),bookRecommendation:D,bookStoryCommentCount:PropTypes.number,bookStoryCommentId:PropTypes.number,bookStoryComments:PropTypes.array,bookStoryUrl:PropTypes.string,createdAt:PropTypes.string,editedAt:PropTypes.string,hasReactions:PropTypes.bool,id:PropTypes.number,isLiked:PropTypes.bool,likeCount:PropTypes.number,profile:x,profileMentions:PropTypes.array,rating:PropTypes.number,state:PropTypes.string,text:PropTypes.string,scheduledFor:PropTypes.string},K=PropTypes.shape($),z=PropTypes.arrayOf(K);var j=o(79209);const G={id:PropTypes.number,name:PropTypes.string,displayOrder:PropTypes.number,bookCategories:PropTypes.arrayOf(j.W),slug:PropTypes.string},q=PropTypes.shape(G),V=PropTypes.shape({contactType:PropTypes.string,defaultImage:PropTypes.oneOfType([PropTypes.string,PropTypes.bool]),emailAddress:PropTypes.string,id:PropTypes.number,imageUrl:PropTypes.string,name:PropTypes.string,userId:PropTypes.number}),W={price:PropTypes.shape({displayName:PropTypes.string,internalName:PropTypes.string,type:PropTypes.oneOf(["radio","checkbox"]),defaultOrder:PropTypes.number,options:PropTypes.array}),categories:PropTypes.shape({displayName:PropTypes.string,internalName:PropTypes.string,type:PropTypes.oneOf(["radio","checkbox"]),defaultOrder:PropTypes.number,options:PropTypes.array}),retailers:PropTypes.shape({displayName:PropTypes.string,internalName:PropTypes.string,type:PropTypes.oneOf(["radio","checkbox"]),defaultOrder:PropTypes.number,options:PropTypes.array}),collections:PropTypes.shape({displayName:PropTypes.string,internalName:PropTypes.string,type:PropTypes.oneOf(["radio","checkbox"]),defaultOrder:PropTypes.number,options:PropTypes.array})},Y=PropTypes.shape(W),Q={display_payment_module:PropTypes.bool,id:PropTypes.number,number:PropTypes.string,division_reference:PropTypes.string,reference:PropTypes.string,amount_due:PropTypes.string,total:PropTypes.string,subtotal:PropTypes.string,tax:PropTypes.string,amount_paid:PropTypes.string,partner_name:PropTypes.string,company:PropTypes.string,issue_date:PropTypes.string,due_date:PropTypes.string,billing_address:PropTypes.string,invoice_lines:PropTypes.arrayOf(PropTypes.shape({id:PropTypes.number,rate:PropTypes.string,quantity:PropTypes.number,total:PropTypes.string,description_header:PropTypes.string,description_subheader:PropTypes.string,description_subheader_details:PropTypes.string})),client_view_url:PropTypes.string,use_freshbooks_link:PropTypes.bool,notes:PropTypes.string,terms:PropTypes.string,product:PropTypes.string},J=PropTypes.shape(Q),Z={totalEstimatedSales:PropTypes.number,affiliatizedBookmarks:PropTypes.number,affiliatizedRetailerClicks:PropTypes.number,subscriberCount:PropTypes.number,salesFlagged:PropTypes.bool},X=PropTypes.shape(Z),ee={blurb:PropTypes.string,bookAuthors:PropTypes.string,bookCoverUrl:PropTypes.string,bookReleaseDate:PropTypes.string,bookTitle:PropTypes.string,requestedBookCategory:PropTypes.string,approvedBookCategory:PropTypes.string,billingState:PropTypes.string,createdAt:PropTypes.string,displayStatus:PropTypes.string,editorialState:PropTypes.string,id:PropTypes.number,mailingDate:PropTypes.string,mailingState:PropTypes.string,expectedFee:PropTypes.string,actualFee:PropTypes.string,submittedPrice:PropTypes.string,partnerSubmittedPageCount:PropTypes.number,promotionResults:X},te=PropTypes.shape(ee),oe={status:PropTypes.number,code:PropTypes.string,title:PropTypes.string,detail:PropTypes.string},se=PropTypes.shape(oe),re={book:I.s,promotionDate:PropTypes.string,promotionStatus:PropTypes.string},ie=PropTypes.shape(re),ae={url:PropTypes.string,text:PropTypes.string},ne={text:PropTypes.string,onClick:PropTypes.func,isActive:PropTypes.func},le=PropTypes.shape(ae),pe=PropTypes.shape(ne),ce=PropTypes.arrayOf(x),de={id:PropTypes.number,displayName:PropTypes.string,internalName:PropTypes.string},ue=PropTypes.shape(de),he=PropTypes.arrayOf(ue),me={displayName:PropTypes.string,displayOrder:PropTypes.number,id:PropTypes.number,internalName:PropTypes.string},ge=PropTypes.shape(me),ye={description:PropTypes.string,displayOrder:PropTypes.number,id:PropTypes.number,icon:PropTypes.string,internalName:PropTypes.string},be=PropTypes.shape(ye),ke={description:PropTypes.string,displayName:PropTypes.string,displayOrder:PropTypes.number,id:PropTypes.number,internalName:PropTypes.string},Te=PropTypes.shape(ke),Se={description:PropTypes.string,displayName:PropTypes.string,displayOrder:PropTypes.number,id:PropTypes.number,icon:PropTypes.string,internalName:PropTypes.string},_e=PropTypes.shape(Se),fe={id:PropTypes.number,displayName:PropTypes.string,seoName:PropTypes.string,regionId:PropTypes.number},Ee=PropTypes.shape(fe);var Re=o(50483);const Pe={displayName:PropTypes.string,id:PropTypes.number,categoryLandingPagePath:PropTypes.string,searchPagePath:PropTypes.string,authorPagePath:PropTypes.string},Ce=PropTypes.shape(Pe),Ie=PropTypes.arrayOf(Ce),Oe={adCampaign:r,adVariant:a,adVariants:n,audiobook:p,audiobookPrice:d,author:h,authors:m,availabilities:b,availability:y,blogPost:C,blogTag:E,book:I.s,bookCardCompactVertical:O.$,books:v,bookCover:w,bookCovers:L,bookListicle:N,bookRecommendation:D,bookStories:z,bookStory:K,category:j.W,categoryGroup:q,contact:V,dealsFilterOptions:Y,invoice:J,newReleasePromotion:te,paymentMethodError:se,pdCtaPromotion:ie,pdProductHeaderLink:le,pdProductHeaderButton:pe,profile:x,profiles:ce,promotionResults:X,reaction:ue,reactions:he,readingFormat:ge,readingAlertType:be,readingPace:Te,readingPersona:_e,retailer:Ee,slidingCarousel:Re.s,socialSharingDetails:R.D,tag:Ce,tags:Ie}},18674:function(e,t,o){"use strict";o.d(t,{E:function(){return E}});var s=o(94184),r=o.n(s),i=o(98753),a=o(83141),n=o(96772),l=o(21453),p=o(49734),c=o(88251),d=o(87679),u=o(4598),h=o(88426),m=o(92613),g=o(31563),y=o(9971),b=o(76397);class k extends React.Component{constructor(e){super(e),this.onButtonClick=this.onButtonClick.bind(this)}onButtonClick(){const e=this.props.book.bookListSlug;return e?d.Z.removeBookFromList(this.props.book,e).then((()=>{h.f.remove(this.props.book,e,this.props.trackingId)})):d.Z.moveBookToList(this.props.book,"wanted").then((()=>{h.f.add(this.props.book,"wanted",this.props.trackingId)}))}render(){return this.props.userAuthed&&this.props.bookDataEnabled?React.createElement(u.e,{onList:this.props.onList,onClick:this.onButtonClick,alignIcon:"center",bubStyle:"white",renderAs:"button",size:"medium",iconOnly:!0}):null}}k.propTypes={book:b._.book,bookDataEnabled:PropTypes.bool,onList:PropTypes.bool,trackingId:PropTypes.string,userAuthed:PropTypes.bool},k.defaultProps={onList:!1,userAuthed:!1};const T=(0,c.$j)(((e,t)=>{const o=m.C.getSelector(e),s=g.G.getSelector(e).getBookForId(t.bookId);return{book:s,bookDataEnabled:y.I.bookDataEnabled(),onList:!!o.getListForSlug(_.get(s,"bookListSlug")),userAuthed:y.I.isAuthed()}}))(k);var S=o(45527),f=o(76167);class E extends React.Component{renderBookmarkButtonAsLink(){return this.props.showBookmarkButtonAsLink?React.createElement("div",{className:r()("book-card-cta",{skinny:!0})},React.createElement(S.e,{bookId:this.props.book.id,renderAs:"link",bubStyle:"lava",noPadding:!0,skinny:!0,textSize:"medium",labelLength:"medium",trackingLabel:this.props.trackingLabel})):null}renderBookBadge(){return this.props.hideBookBadge?null:React.createElement(f.t,{compact:!0,bookListSlug:this.props.book.bookListSlug})}renderPrice(){return this.props.showDealPrice&&this.props.book.dealPrice?React.createElement("div",{className:"book-card-price"},React.createElement(p.z,{dealPrice:this.props.book.dealPrice,retailPrice:this.props.book.retailPrice,size:"small"})):null}renderButtonIcon(){return"bookmark"===this.props.buttonType?React.createElement(T,{bookId:this.props.book.id,trackingId:this.props.trackingId}):"plus"===this.props.buttonType?React.createElement(n.r,{className:"book-card-plus",onClick:this.props.onButtonClick},React.createElement(a.J,{name:"plus"})):"x"===this.props.buttonType?React.createElement(n.r,{className:"book-card-x",onClick:this.props.onButtonClick},React.createElement(a.J,{name:"x"})):React.createElement(n.r,{className:"book-card-arrow-right",href:this.props.book.url},React.createElement(a.J,{name:"arrow_right"}))}render(){const e="none"===this.props.buttonType?null:React.createElement("div",{className:"book-card-button-buffer"}),t="none"===this.props.buttonType?null:React.createElement("div",{className:"book-card-button"},this.renderButtonIcon()),o=this.props.linkToBookPage?"a":"div";return React.createElement("div",{className:r()("book-card-compact-horizontal",this.props.size),"data-testid":`book-card-compact-horizontal-${this.props.book.id}`},React.createElement(o,{href:this.props.linkToBookPage?this.props.book.url:null,className:"book-card-info"},React.createElement("div",{className:"book-card-cover-image"},React.createElement(l.y,{bookBadge:this.renderBookBadge(),href:this.props.bookCoverLinkable?this.props.book.url:null,coverUrl:this.props.book.coverUrl,bookTitle:this.props.book.title,bookAuthor:this.props.book.authors})),React.createElement("div",{className:"book-info-tile-wrapper"},React.createElement("div",{className:"book-card-info-tile"},React.createElement(i.p,{book:this.props.book,size:"large"===this.props.size?"medium":this.props.size,hideRating:this.props.hideRating,wrapTitle:this.props.wrapTitle,titleLinkable:this.props.titleLinkable,authorsLinkable:!1,metadata:this.props.metadata})),this.renderBookmarkButtonAsLink(),this.renderPrice(),this.props.cardCta),e),t)}}E.propTypes={book:b._.book.isRequired,buttonType:PropTypes.oneOf(["bookmark","arrow","plus","x","none"]),hideRating:PropTypes.bool,linkToBookPage:PropTypes.bool,onButtonClick:PropTypes.func,metadata:PropTypes.string,trackingId:PropTypes.string,size:PropTypes.oneOf(["small","medium","large"]),showBookmarkButtonAsLink:PropTypes.bool,trackingLabel:PropTypes.string,wrapTitle:PropTypes.bool,titleLinkable:PropTypes.bool,bookCoverLinkable:PropTypes.bool,showDealPrice:PropTypes.bool,cardCta:PropTypes.node,hideBookBadge:PropTypes.bool},E.defaultProps={buttonType:"arrow",hideRating:!0,linkToBookPage:!0,onButtonClick:_.noop,metadata:null,size:"medium",wrapTitle:!1,titleLinkable:!1,showBookmarkButtonAsLink:!1,bookCoverLinkable:!1,showDealPrice:!1,cardCta:null,hideBookBadge:!1}},98753:function(e,t,o){"use strict";o.d(t,{p:function(){return c}});var s=o(94184),r=o.n(s),i=o(48433),a=o(76397),n=o(23606),l=o(17474);const p={small:1.2*18,medium:1.2*18,large:1.3*24,xlarge:36.4,xxlarge:44.2,xxxlarge:57.2};class c extends React.PureComponent{constructor(e){super(e),this.titleRef=React.createRef()}componentDidMount(){this.truncate()}componentDidUpdate(){this.truncate()}ratingSize(){switch(this.props.size){case"medium":return"small";case"small":return"xsmall";default:return"medium"}}maxTitleHeight(){const e=p[this.props.size];return Math.ceil(e*this.props.maxTitleLines)+4}truncate(){this.props.wrapTitle&&this.props.maxTitleLines&&(0,i.Z)(this.titleRef.current,this.maxTitleHeight(),{character:"â¦"})}renderTitle(){const e=this.props.wrapTitle?"wrap":"ellipsis",t=this.props.bookHref||this.props.book.url;if(this.props.titleLinkable){const o=React.createElement("a",{ref:this.titleRef,onClick:this.props.onBookClick,href:t,className:r()("book-info-title",e)},this.props.book.title);return this.props.wrapWithHeadingTag?React.createElement(this.props.wrapWithHeadingTag,null,o):o}const o=this.props.wrapWithHeadingTag?this.props.wrapWithHeadingTag:"div";return React.createElement(o,{ref:this.titleRef,className:r()("book-info-title",e)},this.props.book.title)}renderAuthors(){return this.props.authorsLinkable?React.createElement("span",{dangerouslySetInnerHTML:{__html:this.props.book.authorsLinks}}):React.createElement("span",null,this.props.book.authors)}renderRating(){return this.props.hideRating||this.props.book.ratingsCount<this.props.ratingsCountCutoff?null:React.createElement("div",{className:"book-info-average-rating"},React.createElement(n.g,{showRatingsCount:!0,ratingsCount:this.props.book.ratingsCount,size:this.ratingSize(),rating:this.props.book.averageRating,bubStyle:"lava",onClick:this.props.onRatingClick,clickable:this.props.clickableRatings}))}renderMetadata(){return this.props.metadata?React.createElement("div",{className:"book-info-metadata"},React.createElement("span",null,this.props.metadata)):null}render(){const e="small"===this.props.size||"medium"===this.props.size?"small":"medium";return React.createElement("div",{className:r()("book-info-tile",this.props.size),"data-testid":"book-info-tile"},this.renderTitle(),React.createElement("div",{className:"book-info-authors"},React.createElement(l.r,{size:e,purpose:"secondary"},this.renderAuthors())),this.renderRating(),this.renderMetadata())}}c.propTypes={authorsLinkable:PropTypes.bool,book:a._.book.isRequired,bookHref:PropTypes.string,clickableRatings:PropTypes.bool,hideRating:PropTypes.bool,maxTitleLines:PropTypes.number,onBookClick:PropTypes.func,onRatingClick:PropTypes.func,metadata:PropTypes.string,ratingsCountCutoff:PropTypes.number,size:PropTypes.oneOf(["small","medium","large","xlarge","xxlarge","xxxlarge"]),titleLinkable:PropTypes.bool,wrapTitle:PropTypes.bool,wrapWithHeadingTag:PropTypes.oneOf(["h1","h2"])},c.defaultProps={authorsLinkable:!0,hideRating:!1,ratingsCountCutoff:100,metadata:null,size:"medium",titleLinkable:!0,wrapTitle:!0}},83842:function(e,t,o){"use strict";o.d(t,{a:function(){return i}});var s=o(54728);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},r.apply(this,arguments)}class i extends React.Component{render(){if(!this.props.show)return null;const e=[this.props.className,"book-story-interactions-modal"].join(" ");return React.createElement(s.O,r({headerDismissButton:!0,title:"",show:this.props.show},_.omit(this.props,_.keys(i.propTypes)),{animation:"test"!==window.bubEnv,onHide:this.props.onHide,className:e,hideClose:!0,label:this.props.closeText}),this.props.children)}}i.propTypes={onHide:PropTypes.func.isRequired,children:PropTypes.object,className:PropTypes.string,closeText:PropTypes.string,show:PropTypes.bool},i.defaultProps={closeText:"Done"}},86376:function(e,t,o){"use strict";o.d(t,{P:function(){return i}});var s=o(88485);function r(e){switch(e){case"red":return"#F44336";case"black":return"#162127";default:return"#fff"}}function i({color:e,width:t,height:o}){return React.createElement("a",{href:(0,s.F)("www","/")},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Bookbub Logo",role:"img","aria-labelledby":"bb-logo-title",viewBox:"0 0 630.07 122.53",width:t,height:o,id:"bookbub-logo"},React.createElement("path",{fill:r(e),d:"M0 120.51V6.43h38.82q17.59 0 27.51 7t9.93 19.59a24.59 24.59 0 0 1-5.81 16.16 31.89 31.89 0 0 1-15.65 10v.23q12.09 1.55 19.22 9a25.63 25.63 0 0 1 7.13 18.45q0 15.34-11 24.49T40.7 120.5zm22.08-97.1v29.91h12q8.91 0 14-4.22t5-11.9q0-13.79-19.69-13.79zm0 47v33.17h15.18q9.76 0 15.19-4.5t5.42-12.48q0-16.2-21.39-16.2zM88.53 80.29q0-20 11.78-31.58t31.95-11.59q19.45 0 30.73 11.35t11.27 30.43q0 19.84-11.66 31.74t-31.58 11.9q-19.53 0-31-11.43T88.53 80.29zm21.85-.33q0 25.65 21.31 25.65 20.57.02 20.57-26.25 0-25.4-20.64-25.4-10.08 0-15.66 6.94t-5.58 19.06zM182.59 80.29q0-20 11.78-31.58t31.89-11.59q19.45 0 30.73 11.35t11.27 30.43q0 19.84-11.66 31.74t-31.58 11.9q-19.53 0-31-11.43t-11.43-30.82zm21.86-.33q0 25.65 21.31 25.65 20.5.02 20.5-26.25 0-25.4-20.58-25.4-10.08 0-15.66 6.94t-5.57 19.06zM357.68 120.51h-26.73l-28.91-40.06h-.23v40.07h-21.63V-.04h21.62v76.69h.23l27.23-37.59h26.1l-31.7 38.6zM367.26 120.51V6.43h38.83q17.59 0 27.51 7T443.52 33a24.59 24.59 0 0 1-5.81 16.16 31.89 31.89 0 0 1-15.65 10v.23q12.09 1.55 19.22 9a25.63 25.63 0 0 1 7.13 18.45q0 15.34-11 24.49t-29.45 9.15zm22-97.1v29.91h12q8.91 0 14-4.22t5-11.9q0-13.79-19.69-13.79zm0 47v33.17h15.19q9.76 0 15.19-4.5t5.42-12.48q0-16.2-21.39-16.2zM533.69 120.51h-21.55v-12.55h-.39q-9 14.57-25 14.57-28.6 0-28.6-34.41V39.06h21.62v46.81q0 19.76 15.35 19.76a15.53 15.53 0 0 0 12.24-5.39q4.73-5.39 4.73-14.45V39.06h21.54zM569.85 110.36v10.15h-21.59V-.04h21.62v52h.23q9.45-14.8 27-14.8 15.5 0 24.26 10.85t8.76 29.53q0 20.38-10 32.7t-26.7 12.32q-15.27 0-23.25-12.17zm-.31-24.64a20.35 20.35 0 0 0 5.19 14.18 16.82 16.82 0 0 0 13 5.73 17.28 17.28 0 0 0 14.8-7.36q5.35-7.36 5.35-20.69 0-11.08-4.88-17.36t-13.74-6.26a17.93 17.93 0 0 0-14.14 6.35q-5.54 6.36-5.54 16.2z"}),React.createElement("title",{id:"bb-logo-title"},"View BookBub Homepage")))}i.propTypes={width:PropTypes.string,height:PropTypes.string,color:PropTypes.oneOf(["red","black","white"])},i.defaultProps={width:"100%",height:"100%",color:"red"}},4598:function(e,t,o){"use strict";o.d(t,{e:function(){return l}});var s=o(64538),r=o(28312),i=o(83141),a=o(30845);class n extends React.PureComponent{label(){return this.props.iconOnly?null:this.props.onList?this.savedLabel():this.saveLabel()}saveLabel(){return{short:"Save",medium:a.F1.primaryActionLabel,long:a.F1.primaryActionLabel}[this.props.labelLength]}savedLabel(){return{short:"Saved",medium:this.props.onListLabel,long:this.props.onListLabel}[this.props.labelLength]}bubStyle(){let e;return this.props.bubStyle?e=this.props.bubStyle:this.props.onList||"link"===this.props.renderAs?e="lava":void 0===this.props.bubStyle&&(e="white"),e}render(){let e,t;return(this.props.icon||this.props.iconOnly||"link"===this.props.renderAs)&&(t=React.createElement(i.J,{name:"ribbon_filled",size:"16px"}),e=this.props.onList?React.createElement(i.J,{name:"ribbon_filled",size:"16px"}):React.createElement(i.J,{name:"ribbon_unfilled",size:"16px"})),React.createElement("span",{className:`bookmark-button bookmark-button-book-${this.props.bookId}`},React.createElement(r.G,{active:this.props.onList,label:this.label(),activeIcon:t,hoverIcon:t,icon:e,tooltipText:this.props.tooltipText,bubStyle:this.bubStyle(),full:this.props.full,skinny:this.props.skinny,renderAs:this.props.renderAs,onClick:this.props.onClick,size:this.props.textSize,noPadding:this.props.noPadding,ariaLabel:this.props.onList?"Book already added to book list. Change book list.":"Add this book to wishlist."}))}}n.propTypes={bookId:PropTypes.number,onList:PropTypes.bool,onListLabel:PropTypes.string,onClick:PropTypes.func,bubStyle:PropTypes.string,renderAs:PropTypes.string,tooltipText:PropTypes.string,full:PropTypes.bool,skinny:PropTypes.bool,icon:PropTypes.bool,iconOnly:PropTypes.bool,textSize:PropTypes.oneOf(["small","medium","large"]),labelLength:PropTypes.oneOf(["short","medium","long"]),noPadding:PropTypes.bool},n.defaultProps={onList:!1,onListLabel:void 0,icon:!1,iconOnly:!1,full:!1,skinny:!1,renderAs:"button",labelLength:"long"};const l=(0,s.$)(n)},28312:function(e,t,o){"use strict";o.d(t,{G:function(){return p}});var s=o(94184),r=o.n(s),i=o(11184),a=o.n(i),n=o(60979),l=o(9763);class p extends React.PureComponent{constructor(e){super(e),this.state={hover:!1},this.onClick=this.onClick.bind(this),this.onHover=this.onHover.bind(this),this.onLeave=this.onLeave.bind(this)}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}onClick(e){this._isMounted&&this.setState({hover:!1}),this.props.onClick&&this.props.onClick(e)}onHover(){this.setState({hover:!0})}onLeave(){this.setState({hover:!1})}tooltipHelper(e){return this.props.tooltipText?React.createElement(l.L,{tooltipText:this.props.tooltipText,tooltipPlacement:this.props.tooltipPlacement,showOnMobile:!1,delay:200},e):e}renderIcon(e){if(this.props.alignIcon!==e)return null;const t=this.state.hover&&this.props.hoverIcon&&BrowserAbilities.hoverEnabled()?this.props.hoverIcon:this.props.icon;if(!t)return null;const o=`icon-${this.props.alignIcon}`;return React.createElement("div",{className:r()("icon",o)},t)}renderText(){let e=this.state.hover&&this.props.hoverLabel&&BrowserAbilities.hoverEnabled()?this.props.hoverLabel:this.props.label;return e?(_.isString(e)&&!this.props.dangerouslySkipTitleCase&&(e=a().titleCase(e)),React.createElement("div",{className:"text"},e)):null}render(){const e=this.state.hover?"hover":"",t=this.props.active?"active":"inactive",o=this.props.full?"full":"",s=this.props.skinny?"skinny":"",i=this.props.disabled?"disabled":"",a=this.props.fullHeight?"full-height":"",l=this.props.noPadding?"no-padding":"",p=this.state.hover&&this.props.hoverBubStyle&&BrowserAbilities.hoverEnabled()?this.props.hoverBubStyle:this.props.bubStyle,c=r()("bub-button",t,e,p,this.props.renderAs,o,s,this.props.size,i,a,l);let d;return d=this.props.href?React.createElement("a",{disabled:i,onClick:this.onClick,href:this.props.href,target:this.props.target,className:c,onMouseOver:this.onHover,onMouseOut:this.onLeave,onFocus:this.onHover,onBlur:this.onLeave,ref:n.S,"aria-label":this.props.ariaLabel,id:this.props.id},this.renderIcon("left-inline"),this.renderIcon("left"),this.renderText(),this.renderIcon("right"),this.renderIcon("inline")):React.createElement("button",{type:this.props.type,disabled:this.props.disabled,onClick:this.onClick,className:c,onMouseOver:this.onHover,onMouseOut:this.onLeave,onFocus:this.onHover,onBlur:this.onLeave,ref:n.S,"aria-label":this.props.ariaLabel,id:this.props.id},this.renderIcon("left-inline"),this.renderIcon("left"),this.renderText(),this.renderIcon("right"),this.renderIcon("inline")),this.tooltipHelper(d)}}p.propTypes={active:PropTypes.bool,bubStyle:PropTypes.oneOf(["sea","stone","mist","lava","white","midnight","transparent","lava-white"]),renderAs:PropTypes.oneOf(["button","link"]),full:PropTypes.bool,skinny:PropTypes.bool,icon:PropTypes.object,id:PropTypes.string,alignIcon:PropTypes.oneOf(["right","left","inline","left-inline"]),hoverIcon:PropTypes.object,hoverBubStyle:PropTypes.oneOf(["sea","stone","mist","lava","white","midnight","transparent","lava-white"]),href:PropTypes.string,label:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),hoverLabel:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),onClick:PropTypes.func,tooltipText:PropTypes.string,tooltipPlacement:PropTypes.string,size:PropTypes.oneOf(["small","medium","large"]),disabled:PropTypes.bool,fullHeight:PropTypes.bool,noPadding:PropTypes.bool,ariaLabel:PropTypes.string,target:PropTypes.string,type:PropTypes.oneOf(["submit","button"]),dangerouslySkipTitleCase:PropTypes.bool},p.defaultProps={bubStyle:"mist",size:"medium",renderAs:"button",alignIcon:"left",fullHeight:!1,noPadding:!1,ariaLabel:null,type:"button"}},94935:function(e,t,o){"use strict";o.d(t,{r:function(){return n}});var s=o(94184),r=o.n(s),i=o(65123),a=o(83141);class n extends React.Component{constructor(e){super(e),this.parameterizedLabel=this.parameterizedLabel.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.toggleSelect=this.toggleSelect.bind(this)}onKeyDown(e){e.keyCode===i.R.SPACE_BAR&&(e.preventDefault(),this.toggleSelect(e))}toggleSelect(e){return this.props.selected&&e.currentTarget&&!e.keyCode&&e.currentTarget.blur(),this.props.changeSelection(!this.props.selected)}ariaLabel(){return _.isString(this.props.label)?null:this.props.ariaLabel}parameterizedLabel(){return _.isString(this.props.label)?_.kebabCase(this.props.label):null}renderCheckbox(){return React.createElement(a.J,{className:"bub-checkbox-icon",name:this.props.icon})}render(){const e=this.props.selected?"active":"",t=this.props.disabled?"disabled":"",o=this.props.hovered?"hovered":"",s=this.props.small?"small":"",i=this.props.alignStart?"alignStart":"";let a=null,n=null;return this.props.label&&(a=React.createElement("div",{className:"bub-checkbox-label",onClick:this.toggleSelect,id:this.parameterizedLabel()},this.props.label)),this.props.subLabel&&(n=React.createElement("span",{className:"bub-checkbox-sublabel"}," ",this.props.subLabel)),React.createElement("div",{className:r()("bub-checkbox-group",i)},React.createElement("div",{role:"checkbox",tabIndex:this.props.overrideTabIndex?"-1":"0",id:this.props.id,"aria-labelledby":this.parameterizedLabel(),"aria-label":this.ariaLabel(),"aria-checked":this.props.selected,className:r()("bub-checkbox",e,t,o,s,this.props.bubStyle),onClick:this.toggleSelect,onKeyDown:this.onKeyDown},this.renderCheckbox()),a,n)}}n.propTypes={ariaLabel:PropTypes.string,alignStart:PropTypes.bool,changeSelection:PropTypes.func.isRequired,disabled:PropTypes.bool,label:PropTypes.oneOfType([PropTypes.string,PropTypes.element]),subLabel:PropTypes.oneOfType([PropTypes.string,PropTypes.element]),selected:PropTypes.bool,hovered:PropTypes.bool,id:PropTypes.string,small:PropTypes.bool,overrideTabIndex:PropTypes.bool,bubStyle:PropTypes.oneOf(["sea","lava"]),icon:PropTypes.oneOf(["check","minus"])},n.defaultProps={alignStart:!1,selected:!1,hovered:!1,small:!1,overrideTabIndex:!1,bubStyle:"lava",icon:"check"}},15758:function(e,t,o){"use strict";o.d(t,{F:function(){return n}});var s=o(28312),r=o(65710),i=o(64538);class a extends React.PureComponent{borderStyle(){return this.props.border?"":"no-border"}ctaStyle(){let e=this.props.ctaStyle;return e="responsive"===this.props.ctaStyle?this.props.windowMatchesXs?"column":"cta-row":this.props.ctaStyle,"row"===e&&(e="cta-row"),e}heightStyle(){return this.props.fullHeight?"cta-full-height":""}renderPrimaryButton(){return this.props.buttonText?React.createElement("span",{className:"primary"},React.createElement(s.G,{bubStyle:this.props.bubStyle,href:this.props.buttonUrl,onClick:this.props.buttonClick,label:this.props.buttonText,size:this.props.size})):null}renderSecondaryButton(){return this.props.secondaryButtonText?React.createElement("span",{className:"secondary"},React.createElement(s.G,{bubStyle:this.props.bubStyle,renderAs:"link",noPadding:!0,href:this.props.secondaryButtonUrl,onClick:this.props.secondaryButtonClick,label:this.props.secondaryButtonText})):null}renderButton(){return this.props.buttonText||this.props.secondaryButtonText?React.createElement("div",{className:"cta-button"},this.renderPrimaryButton(),this.renderSecondaryButton()):null}renderXToClose(){return this.props.xToClose?React.createElement("div",{className:"cta-hide"},React.createElement(r.O,{dark:"pistachio"===this.props.ctaStyle,onClick:this.props.onDismissClick})):null}renderImage(){return this.props.imageUrl?React.createElement("div",{className:"cta-image-wrapper"},React.createElement("img",{className:`cta-image cta-image-${this.props.size}`,src:this.props.imageUrl,alt:""})):null}render(){return React.createElement("div",{className:`bub-cta ${this.ctaStyle()} ${this.borderStyle()} ${this.heightStyle()} cta-${this.props.size}`,"data-testid":"bub-cta"},this.renderXToClose(),React.createElement("div",{className:"cta-panel-inner"},this.renderImage(),React.createElement("div",{className:"cta-contents"},React.createElement("div",{className:`bub-cta-header ${this.props.size}`},this.props.headerText),React.createElement("div",{className:`bub-cta-subheader ${this.props.size}`},this.props.subheaderText),React.createElement("span",{className:"children"},this.props.children),this.renderButton(),this.props.disclaimerText?React.createElement("div",{className:"disclaimer-text","data-testid":"bub-cta-disclaimer-text"},this.props.disclaimerText):null)))}}a.propTypes={headerText:PropTypes.oneOfType([PropTypes.object,PropTypes.string]),subheaderText:PropTypes.oneOfType([PropTypes.object,PropTypes.string]),buttonUrl:PropTypes.string,buttonText:PropTypes.string,buttonClick:PropTypes.func,imageUrl:PropTypes.string,size:PropTypes.oneOf(["small","medium","large"]),children:PropTypes.oneOfType([PropTypes.element,PropTypes.string]),ctaStyle:PropTypes.oneOf(["hero","column","column-lg","row","responsive","pistachio"]),xToClose:PropTypes.bool,border:PropTypes.bool,onDismissClick:PropTypes.func,secondaryButtonText:PropTypes.string,secondaryButtonUrl:PropTypes.string,secondaryButtonClick:PropTypes.func,fullHeight:PropTypes.bool,bubStyle:PropTypes.string,disclaimerText:PropTypes.string},a.defaultProps={xToClose:!1,border:!0,ctaStyle:"responsive",size:"medium",fullHeight:!1,bubStyle:"lava"};const n=(0,i.$)(a)},65710:function(e,t,o){"use strict";o.d(t,{O:function(){return s}});class s extends React.PureComponent{render(){const e=React.createElement("i",null,String.fromCharCode(215)),t=["bub-dismiss-button",this.props.size,this.props.dark?"dark":"",this.props.noPadding?"no-padding":""].join(" ");return React.createElement("div",{className:t,tabIndex:"0",role:"button",onClick:this.props.onClick,"aria-label":"dismiss"},e)}}s.propTypes={onClick:PropTypes.func.isRequired,size:PropTypes.oneOf(["small","medium","large"]),dark:PropTypes.bool,noPadding:PropTypes.bool},s.defaultProps={size:"medium"}},26693:function(e,t,o){"use strict";function s(e){const t=_.compact(e.messages);return React.createElement("div",{className:`${e.className} bub-forms-error-messages`,"data-testid":"error-messages"},_.map(t,(e=>React.createElement("div",{key:e,className:"validation-message"},e))))}o.d(t,{X:function(){return s}}),s.propTypes={messages:PropTypes.array,className:PropTypes.string},s.defaultProps={messages:[],className:""}},7520:function(e,t,o){"use strict";o.d(t,{II:function(){return u.I}});class s extends React.Component{constructor(e){super(e),this.handleChange=this.handleChange.bind(this)}handleChange(e){let t=[].concat(this.props.value||[]);return e.target.checked?this.isChecked()||t.push(this.props.option):t=_.difference(t,[this.props.option]),this.props.onChange({name:this.props.name,value:t})}isChecked(){return _.includes(this.props.value,this.props.option)}render(){return React.createElement("input",{type:"checkbox",checked:this.isChecked(),name:this.props.name,value:this.props.option,onChange:this.handleChange,id:this.props.id})}}s.propTypes={name:PropTypes.string.isRequired,onChange:PropTypes.func,option:PropTypes.oneOfType([PropTypes.string,PropTypes.number,PropTypes.bool]),value:PropTypes.array,id:PropTypes.string};var r=o(85689);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},i.apply(this,arguments)}class a extends React.Component{constructor(e){super(e),this.handleInputChange=this.handleInputChange.bind(this),this.handleInputBlur=this.handleInputBlur.bind(this),this.handleInputFocus=this.handleInputFocus.bind(this)}handleInputChange(e,t=!0){const o=String(this.maskedInputValue(e.target.value)).replace(/,/g,"");return this.props.onChange({name:this.props.name,value:o,preventValidation:t})}handleInputBlur(e){this.handleInputChange(e,!1);const t=String(this.maskedInputValue(e.target.value)).replace(/,/g,"");this.props.onBlur({name:this.props.name,value:t})}handleInputFocus(e){const t=String(this.maskedInputValue(e.target.value)).replace(/,/g,"");this.props.onFocus({name:this.props.name,value:t,target:e.target})}maskedInputValue(e){const t=e.match(/\d/g)||[];return this.props.allowDecimals?(0===t.length&&t.unshift("00"),t.splice(t.length-2,0,"."),Number(t.join("")).toFixed(2)):t.join("").replace(/0*(\d+)/g,"$1").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}renderInput(){const e=this.maskedInputValue(this.props.value.toString());return React.createElement("div",{className:"formsy-currency-input"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-addon",id:"currency-symbol"},this.props.currencySymbol),React.createElement("input",i({disabled:this.props.disabled,name:this.props.name,"aria-label":this.props.label,className:"currency-form-control form-control",type:"text"},_.pick(this.props,"label","placeholder"),{value:e,onChange:this.handleInputChange,onBlur:this.handleInputBlur,onFocus:this.handleInputFocus})),this.renderCurrencyPer()))}renderCurrencyPer(){return this.props.currencyPer?React.createElement("span",{className:"input-group-addon currency-per"},this.props.currencyPer):""}render(){return this.props.elementOnly?this.renderInput():React.createElement(r.X,{name:this.props.name,label:this.props.label,errorMessages:this.props.errorMessages,hasChanged:this.props.hasChanged,inputWrapperClassName:this.props.inputWrapperClassName,horizontal:this.props.horizontal},this.renderInput())}}a.propTypes={name:PropTypes.string.isRequired,currencySymbol:PropTypes.string,elementOnly:PropTypes.bool,hasChanged:PropTypes.bool,onChange:PropTypes.func,onBlur:PropTypes.func,onFocus:PropTypes.func,placeholder:PropTypes.string,value:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),inputWrapperClassName:PropTypes.string,currencyPer:PropTypes.string,horizontal:PropTypes.bool,allowDecimals:PropTypes.bool,errorMessages:PropTypes.array,label:PropTypes.string,disabled:PropTypes.bool},a.defaultProps={currencySymbol:"$",elementOnly:!1,onBlur:_.noop,onFocus:_.noop,placeholder:"0.00",value:"",horizontal:!0,allowDecimals:!0,disabled:!1};var n=o(9198),l=o.n(n),p=o(30381),c=o.n(p);class d extends React.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){this.props.onChange(this.dateToMoment(e))}dateToMoment(e){return e?c()(e):null}momentToDate(e){return e?e.toDate():null}renderInput(){return React.createElement(l(),{id:this.props.id,weekStart:"0",className:this.props.inputClassName,dateFormat:this.props.unicodeDateFormat,selected:this.momentToDate(this.props.value),onChange:this.onChange,minDate:this.momentToDate(this.props.minDate),maxDate:this.momentToDate(this.props.maxDate),placeholderText:this.props.placeholderText,name:this.props.name,autoComplete:this.props.autoComplete,disabled:this.props.disabled})}render(){return this.props.elementOnly?React.createElement("div",{className:"formsy-datepicker input-group"},this.renderInput()):React.createElement(r.X,{name:this.props.name,label:this.props.label,errorMessages:this.props.errorMessages,hasChanged:this.props.hasChanged,inputWrapperClassName:this.props.inputWrapperClassName},this.renderInput())}}d.propTypes={name:PropTypes.string.isRequired,onChange:PropTypes.func.isRequired,value:PropTypes.object,elementOnly:PropTypes.bool,hasChanged:PropTypes.bool,inputWrapperClassName:PropTypes.string,minDate:PropTypes.object,maxDate:PropTypes.object,unicodeDateFormat:PropTypes.string,placeholderText:PropTypes.string,inputClassName:PropTypes.string,errorMessages:PropTypes.array,label:PropTypes.string,id:PropTypes.string,autoComplete:PropTypes.string,disabled:PropTypes.bool},d.defaultProps={elementOnly:!1,minDate:c()(),maxDate:c()().add(1,"year"),unicodeDateFormat:"MM/dd/yy",placeholderText:"",inputClassName:"form-control",id:null,disabled:!1},o(26693);var u=o(77381);class h extends React.Component{renderRadioButtonWithChildren(){return React.createElement(React.Fragment,null,this.renderRadioButton(),React.createElement("div",{className:"bub-radio-button-child-node"},this.props.childNode))}renderRadioButton(){const e=this.props.selected?"active":"",t=this.props.disabled?"disabled":"",o=this.props.disabled&&!this.props.selected?"inactive-disabled":"",s=this.props.padding||"compact",r=this.props.onKeyDown?_.partial(this.props.onKeyDown,this.props.id):_.noop;return React.createElement("div",{className:`bub-radio-button radio-button-${this.props.id} ${t} ${s} ${this.props.alignment} ${this.props.bubStyle}`,onClick:_.partial(this.props.onSelect,this.props.id),onKeyDown:r,key:this.props.id,role:"radio","aria-checked":this.props.selected,tabIndex:this.props.tabIndex,ref:this.props.buttonRef},React.createElement("div",{className:`bub-radio-button-label ${o}`},React.createElement("span",{className:"bub-radio-button-label-text"},this.props.label)),React.createElement("div",{className:`bub-radio-button-circle ${this.props.size} ${this.props.alignment} ${e} ${o} ${this.props.bubStyle}`}),this.props.subLabel?React.createElement("div",{className:"sub-label"},this.props.subLabel):null)}render(){return this.props.childNode&&this.props.selected?this.renderRadioButtonWithChildren():this.renderRadioButton()}}h.propTypes={alignment:PropTypes.string,buttonRef:PropTypes.object,disabled:PropTypes.bool,id:PropTypes.oneOfType([PropTypes.string,PropTypes.number]).isRequired,label:PropTypes.oneOfType([PropTypes.string,PropTypes.node]).isRequired,onKeyDown:PropTypes.func,onSelect:PropTypes.func.isRequired,padding:PropTypes.oneOf(["compact","medium","full"]),selected:PropTypes.bool,size:PropTypes.string,subLabel:PropTypes.string,tabIndex:PropTypes.string,bubStyle:PropTypes.oneOf(["sea","lava"]),childNode:PropTypes.node},h.defaultProps={disabled:!1,selected:!1,size:"small",alignment:"left",padding:"full",subLabel:null,tabIndex:"-1",bubStyle:"lava",childNode:void 0};class m extends React.Component{constructor(e){super(e),this.changeRadio=this.changeRadio.bind(this)}changeRadio(e){return this.props.onChange({name:this.props.name,value:e})}render(){const e=_.map(this.props.options,((e,t)=>{const o=e.value===this.props.value;let s=[];if(this.props.isToggleLabel){const e=o?"selected-label":null;s=_.compact([e,"toggle-label"]).join(" ")}return"inline"===this.props.type?React.createElement("label",{className:`radio-inline ${s}`,key:t},React.createElement("input",{name:this.props.name,checked:o,type:"radio",value:e.value,onChange:()=>this.changeRadio(e.value)}),React.createElement("span",null,e.label)):React.createElement("div",{key:t,className:s},React.createElement(h,{id:t,label:e.label,selected:o,onSelect:()=>this.changeRadio(e.value),padding:"compact",subLabel:e.subLabel,disabled:this.props.disabled,bubStyle:"sea"}))}));return React.createElement(r.X,{name:this.props.name,label:this.props.label,errorMessages:this.props.errorMessages,hasChanged:this.props.hasChanged,inputWrapperClassName:this.props.inputWrapperClassName,horizontal:this.props.horizontal},e)}}m.propTypes={name:PropTypes.string.isRequired,options:PropTypes.array.isRequired,label:PropTypes.string,hasChanged:PropTypes.bool,onChange:PropTypes.func,type:PropTypes.oneOf(["inline","stacked"]),value:PropTypes.string,isToggleLabel:PropTypes.bool,errorMessages:PropTypes.array,inputWrapperClassName:PropTypes.string,horizontal:PropTypes.bool,disabled:PropTypes.bool},m.defaultProps={value:"",isToggleLabel:!1,horizontal:!0,disabled:!1};class g extends React.Component{constructor(e){super(e),this.handleChange=this.handleChange.bind(this)}handleChange(e){return this.props.onChange({name:this.props.name,value:e.target.value})}renderOptions(){return _.map(this.props.options,((e,t)=>React.createElement("option",{key:t,value:e.value},e.label)))}render(){return React.createElement("select",{className:"form-control",name:this.props.name,value:this.props.value||"",onChange:this.handleChange},this.renderOptions())}}g.propTypes={name:PropTypes.string.isRequired,onChange:PropTypes.func,value:PropTypes.oneOfType([PropTypes.string,PropTypes.number,PropTypes.bool]),options:PropTypes.array}},77381:function(e,t,o){"use strict";o.d(t,{I:function(){return l}});var s=o(3682),r=o(94184),i=o.n(r),a=o(85689),n=o(26693);class l extends React.Component{static renderAddonText(e){return e?React.createElement("span",{className:"input-group-addon"},e):null}constructor(e){super(e),this.onInputChange=this.onInputChange.bind(this),this.onInputBlur=this.onInputBlur.bind(this),this.onInputFocus=this.onInputFocus.bind(this),this.onInputKeyDown=this.onInputKeyDown.bind(this),this.onClick=this.onClick.bind(this)}componentDidMount(){(0,s.Z)(this.textInput),this.textInput.style.resize="none"}onInputChange(e){const t=e.target.value;return this.props.onChange({name:this.props.name,value:t})}onInputBlur(e){const t=e.target.value;return this.props.onBlur?this.props.onBlur(e):this.props.validateOnBlur?this.props.onChange({name:this.props.name,value:t}):null}onInputFocus(e){return this.props.onFocus&&this.props.onFocus(e),null}onInputKeyDown(e){return this.props.onKeyDown?this.props.onKeyDown(e):null}onClick(e){return this.props.onClick?this.props.onClick(e):null}renderErrorMessages(){return this.props.withErrors&&!_.isEmpty(this.props.errorMessages)?React.createElement(n.X,{messages:this.props.errorMessages}):null}renderInput(){const e=this.props.fullHeight?"full-height":"",t=["form-control",e];_.isEmpty(_.compact(this.props.errorMessages))||t.push("required-notice"),this.props.withBorderRadius&&t.push("with-border-radius");const o={autoComplete:this.props.autocomplete,"aria-label":this.props.label?void 0:this.props.ariaLabel||this.props.name,className:t.join(" "),name:this.props.name,onChange:this.onInputChange,onBlur:this.onInputBlur,onFocus:this.onInputFocus,onKeyDown:this.onInputKeyDown,onClick:this.onClick,value:this.props.value,placeholder:this.props.placeholder,ref:e=>{this.textInput=e},autoFocus:this.props.shouldFocus,type:this.props.type,readOnly:this.props.readOnly,required:this.props.required,disabled:this.props.disabled,id:this.props.inputId};let s;s="textarea"===this.props.inputType?React.createElement("textarea",o):React.createElement("input",o);const r=l.renderAddonText(this.props.leftAddonNode||this.props.leftAddonText),a=l.renderAddonText(this.props.rightAddonNode||this.props.rightAddonText);return React.createElement("div",{className:i()("input-group","form-input",e)},r,s,this.renderErrorMessages(),a)}render(){return this.props.elementOnly?this.renderInput():React.createElement(a.X,{name:this.props.name,label:this.props.label,rightLabel:this.props.rightLabel,horizontal:this.props.horizontal,errorMessages:this.props.errorMessages,hasChanged:this.props.hasChanged,inputWrapperClassName:this.props.inputWrapperClassName,className:this.props.rowClassName,required:this.props.required},this.renderInput())}}l.propTypes={ariaLabel:PropTypes.string,inputId:PropTypes.string,name:PropTypes.string.isRequired,label:PropTypes.string,rightLabel:PropTypes.string,onChange:PropTypes.func.isRequired,onKeyDown:PropTypes.func,elementOnly:PropTypes.bool,withErrors:PropTypes.bool,errorMessages:PropTypes.array,hasChanged:PropTypes.bool,required:PropTypes.bool,value:PropTypes.string,validateOnBlur:PropTypes.bool,inputWrapperClassName:PropTypes.string,rowClassName:PropTypes.string,horizontal:PropTypes.bool,leftAddonText:PropTypes.string,rightAddonText:PropTypes.string,readOnly:PropTypes.bool,inputType:PropTypes.string,leftAddonNode:PropTypes.node,rightAddonNode:PropTypes.node,placeholder:PropTypes.string,type:PropTypes.string,onBlur:PropTypes.func,onFocus:PropTypes.func,onClick:PropTypes.func,autocomplete:PropTypes.string,shouldFocus:PropTypes.bool,disabled:PropTypes.bool,fullHeight:PropTypes.bool,withBorderRadius:PropTypes.bool},l.defaultProps={inputId:null,value:"",rightLabel:"",elementOnly:!1,withErrors:!1,errorMessages:[],validateOnBlur:!1,placeholder:"",required:!1,type:"text",horizontal:!0,leftAddonText:"",rightAddonText:"",readOnly:!1,inputType:"input",leftAddonNode:null,rightAddonNode:null,fullHeight:!1,withBorderRadius:!1}},85689:function(e,t,o){"use strict";o.d(t,{X:function(){return a}});var s=o(94184),r=o.n(s),i=o(26693);class a extends React.Component{labelRenderHelper(){const e=r()("control-label",{required:this.props.required,"col-sm-3":this.props.horizontal,"col-xs-6":!this.props.horizontal});return this.props.label?React.createElement("label",{className:e,htmlFor:this.props.name},this.props.label):null}renderRightLabel(){return!this.props.rightLabel||this.props.horizontal?null:React.createElement("label",{className:"col-xs-6 pull-right right-label",htmlFor:this.props.name},this.props.rightLabel)}renderErrorMessages(){return this.props.noErrorMessages||_.isEmpty(this.props.errorMessages)||!this.props.hasChanged?null:React.createElement(i.X,{messages:this.props.errorMessages})}render(){let e="col-sm-12";this.props.label&&this.props.horizontal&&(e="col-sm-9");const t=r()("form-group","row",_.kebabCase(this.props.name),{hide:this.props.hideRow},this.props.className);return React.createElement("div",{className:t},this.labelRenderHelper(),this.renderRightLabel(),React.createElement("div",{className:r()(e,this.props.inputWrapperClassName)},this.props.children,this.renderErrorMessages()))}}a.propTypes={label:PropTypes.node,rightLabel:PropTypes.string,name:PropTypes.string.isRequired,errorMessages:PropTypes.array,hasChanged:PropTypes.bool,hideRow:PropTypes.bool,inputWrapperClassName:PropTypes.oneOfType([PropTypes.string,PropTypes.array,PropTypes.object]),noErrorMessages:PropTypes.bool,className:PropTypes.oneOfType([PropTypes.string,PropTypes.array,PropTypes.object]),required:PropTypes.bool,horizontal:PropTypes.bool},a.defaultProps={errorMessages:[],noErrorMessages:!1,required:!1,horizontal:!0}},76530:function(e,t,o){"use strict";o.d(t,{m:function(){return r}});var s=o(83141);class r extends React.PureComponent{renderLoader(){return React.createElement(s.J,{name:"loading",size:this.props.size,ariaLabel:"loading"})}render(){return React.createElement("div",{className:"bub-loader"},this.renderLoader())}}r.propTypes={size:PropTypes.string},r.defaultProps={size:"48px"}},78405:function(e,t,o){"use strict";o.d(t,{Q:function(){return i}});var s=o(28312),r=o(83141);function i(e){return e.isLoading?React.createElement(s.G,{disabled:!0,bubStyle:e.bubStyle,label:e.loadingText,full:e.full,ariaLabel:"Loading...",icon:React.createElement(r.J,{name:"loading"}),renderAs:e.renderAs,size:e.size,id:e.id}):React.createElement(s.G,{onClick:e.onClick,disabled:e.isDisabled,bubStyle:e.bubStyle,label:e.label||e.children,full:e.full,active:e.active,hoverLabel:e.hoverLabel,hoverIcon:e.hoverIcon,icon:e.icon,tooltipText:e.tooltipText,tooltipPlacement:e.tooltipPlacement,href:e.href,ariaLabel:e.ariaLabel,renderAs:e.renderAs,size:e.size,id:e.id})}i.propTypes={active:PropTypes.bool,bubStyle:PropTypes.oneOf(["sea","stone","mist","lava","midnight","transparent","lava-white","white"]),renderAs:PropTypes.oneOf(["button","link"]),full:PropTypes.bool,icon:PropTypes.object,hoverIcon:PropTypes.object,href:PropTypes.string,label:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),hoverLabel:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),onClick:PropTypes.func,tooltipText:PropTypes.string,tooltipPlacement:PropTypes.string,ariaLabel:PropTypes.string,isLoading:PropTypes.bool,loadingText:PropTypes.string,isDisabled:PropTypes.bool,size:PropTypes.oneOf(["small","medium","large"]),id:PropTypes.string},i.defaultProps={bubStyle:"sea",full:!1,href:void 0,isDisabled:!1,isLoading:!1,loadingText:void 0,ariaLabel:null,renderAs:"button"}},54728:function(e,t,o){"use strict";o.d(t,{O:function(){return c}});var s=o(94184),r=o.n(s),i=o(88368),a=o(28312),n=o(65710),l=o(69188);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},p.apply(this,arguments)}o(32238),i.Z.propTypes.bsSize._values.push("medium","md"),i.Z.Dialog.propTypes.bsSize._values.push("medium","md");class c extends React.Component{constructor(e){super(e),this.onHide=this.onHide.bind(this),this.backdrop=this.backdrop.bind(this)}componentDidMount(){const e=document.querySelector('[aria-hidden="true"][role="dialog"]');e&&e.setAttribute("aria-hidden","false")}componentWillUnmount(){this.onExit()}onEnter(){l.x.onModalOpen()}onExit(){l.x.onModalHide()}onHide(){this.onExit(),this.props.onHide()}enableAnimation(){return"test"!==window.bubEnv&&this.props.animation}backdropClass(){return this.props.opaqueBackdrop?"bub-modal-opaque-backdrop":""}backdrop(){return this.props.isDismissible?this.props.backdrop:"static"}renderHeaderCloseButton(){return this.props.isDismissible?this.props.headerCloseButton?React.createElement("div",{className:"modal-close-button"},React.createElement(a.G,{bubStyle:"mist",onClick:this.onHide,label:this.props.label})):this.props.headerDismissButton?React.createElement("div",{className:"dismiss-button-wrapper"},React.createElement(n.O,{onClick:this.onHide,size:"large",noPadding:"unstyled"===this.props.modalStyle||"full-screen"===this.props.modalStyle})):null:null}renderHeaderContent(){if(this.props.headerContent){const e=this.props.centerHeaderContent&&!this.props.headerCloseButton&&!this.props.headerDismissButton;return React.createElement(i.Z.Header,{className:r()("modal-header-with-content",{"close-header":this.props.headerCloseButton,"dismiss-header":this.props.headerDismissButton,"center-header":e})},React.createElement("div",{className:r()("header-content",{"use-default-style":this.props.useDefaultHeaderStyle})},this.props.headerContent),this.renderHeaderCloseButton())}const e=!this.props.isDismissible||!this.props.headerCloseButton&&!this.props.headerDismissButton;return _.isEmpty(this.props.title)&&e?null:React.createElement(i.Z.Header,{className:r()({"close-header":this.props.headerCloseButton,"dismiss-header":this.props.headerDismissButton})},React.createElement("div",{className:"title-wrapper"},React.createElement(i.Z.Title,null,this.props.title)),this.renderHeaderCloseButton())}renderBody(){return React.createElement(i.Z.Body,null,this.props.children)}renderClose(){return this.props.hideClose?null:React.createElement("div",{className:"close-container"},React.createElement("button",{className:"close-link",onClick:this.onHide},this.props.closeCaption))}render(){return React.createElement(i.Z,p({},_.omit(this.props,_.keys(c.propTypes)),{show:this.props.show,backdrop:this.backdrop(),backdropClassName:r()(this.backdropClass(),this.props.modalStyle),onEnter:this.onEnter,onExit:this.onExit,onHide:this.onHide,animation:this.enableAnimation(),dialogClassName:r()("bub-modal",this.props.dialogClassName,this.props.modalStyle),enforceFocus:this.props.enforceFocus}),this.renderHeaderContent(),this.renderBody(),this.renderClose())}}c.propTypes={onHide:PropTypes.func,show:PropTypes.bool,dialogClassName:PropTypes.string,title:PropTypes.string,hideClose:PropTypes.bool,animation:PropTypes.bool,children:PropTypes.node,headerContent:PropTypes.node,closeCaption:PropTypes.string,headerCloseButton:PropTypes.bool,headerDismissButton:PropTypes.bool,label:PropTypes.string,backdrop:PropTypes.oneOfType([PropTypes.bool,PropTypes.string]),opaqueBackdrop:PropTypes.bool,isDismissible:PropTypes.bool,enforceFocus:PropTypes.bool,modalStyle:PropTypes.oneOf(["default","unstyled","full-screen"]),useDefaultHeaderStyle:PropTypes.bool,centerHeaderContent:PropTypes.bool},c.defaultProps={animation:!1,closeCaption:"close",label:"Done",headerCloseButton:!1,hideClose:!1,show:!1,onHide:_.noop,dialogClassName:void 0,title:void 0,children:void 0,headerContent:void 0,backdrop:!0,opaqueBackdrop:!1,headerDismissButton:!1,isDismissible:!0,enforceFocus:!0,modalStyle:"default"},c.trackingName="Bub Modal"},97426:function(e,t,o){"use strict";o.d(t,{B:function(){return i}});var s=o(94184),r=o.n(s);class i extends React.PureComponent{constructor(e){super(e),this.state={hovered:!1},this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onClick=this.onClick.bind(this)}onMouseOver(){this.setState({hovered:!0})}onMouseOut(){this.setState({hovered:!1})}onClick(e){this.props.handleClick(e)}renderIcon(){const e=this.state.hovered&&this.props.hoverIcon||this.props.active&&this.props.hoverIcon?this.props.hoverIcon:this.props.icon;return e?React.createElement("div",{className:r()("icon",{left:"left"===this.props.alignIcon&&!this.props.iconOnly,right:"right"===this.props.alignIcon&&!this.props.iconOnly})},e):null}renderLabel(){return this.props.iconOnly?null:this.props.label}render(){const e=r()("bub-pill",this.props.size,this.props.bubStyle,{"display-only":this.props.displayOnly},{active:this.props.active&&!this.props.displayOnly},{hover:this.state.hovered&&!this.props.displayOnly},this.props.className);return this.props.displayOnly?React.createElement("div",{"data-testid":"display-only-bub-pill",className:e},this.props.label):"link"===this.props.type?React.createElement("a",{className:e,onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut,onFocus:this.onMouseOver,onBlur:this.onMouseOut,href:this.props.href,"aria-label":this.props.ariaLabel},"left"===this.props.alignIcon?this.renderIcon():null,this.renderLabel(),"right"===this.props.alignIcon?this.renderIcon():null):React.createElement("button",{className:e,onClick:this.onClick,onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut,onFocus:this.onMouseOver,onBlur:this.onMouseOut,"aria-label":this.props.ariaLabel},"left"===this.props.alignIcon?this.renderIcon():null,this.renderLabel(),"right"!==this.props.alignIcon||this.props.iconOnly?null:this.renderIcon())}}i.propTypes={active:PropTypes.bool,displayOnly:PropTypes.bool,href:PropTypes.string,size:PropTypes.oneOf(["small","medium","large"]),label:PropTypes.string,handleClick:PropTypes.func,type:PropTypes.oneOf(["button","link"]),bubStyle:PropTypes.oneOf(["midnight","lava"]),className:PropTypes.string,alignIcon:PropTypes.oneOf(["left","right"]),icon:PropTypes.object,hoverIcon:PropTypes.object,iconOnly:PropTypes.bool,ariaLabel:PropTypes.string},i.defaultProps={active:!1,displayOnly:!1,label:"",size:"medium",handleClick:_.noop,type:"button",bubStyle:"lava",className:"",alignIcon:"left",iconOnly:!1,ariaLabel:null}},66227:function(e,t,o){"use strict";o.d(t,{P:function(){return I}});var s=o(51321),r=o(88251),i=o(94184),a=o.n(i),n=o(28312),l=o(77381),p=o(26455);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},c.apply(this,arguments)}class d extends React.Component{constructor(e){super(e),this.state={recaptchaEnabled:!1,recaptchaV2Token:null,recaptchaV3Token:void 0},this.onSubmit=this.onSubmit.bind(this),this.onSubmitCaptcha=this.onSubmitCaptcha.bind(this),this.captchaButtonId="bub-auth-form-button",this.captchaFormId="bub-auth-form",this.onInitCaptchaV2=this.onInitCaptchaV2.bind(this),this.onInitCaptchaV3=this.onInitCaptchaV3.bind(this)}onSubmit(e){return e.preventDefault(),null==this.props.onSubmit||this.state.recaptchaEnabled?null:this.props.onSubmit(this.state.recaptchaV2Token,this.state.recaptchaV3Token)}onSubmitCaptcha(e){this.props.isValid&&this.props.onSubmit(e,this.state.recaptchaV3Token),this.setState({recaptchaEnabled:!1,recaptchaV2Token:e})}onInitCaptchaV2(){this.setState({recaptchaEnabled:!0})}onInitCaptchaV3(e){this.setState({recaptchaV3Token:e})}renderCaptcha(){return React.createElement(p.R,{captchaButtonId:this.captchaButtonId,captchaFormId:this.captchaFormId,onSubmit:this.onSubmitCaptcha,onInit:this.onInitCaptchaV2,endpoint:this.props.recaptchaV2Endpoint,loadV3:!0,action:"bub_auth_form",onInitV3:this.onInitCaptchaV3})}render(){const e=_.map(this.props.errorMessages,((e,t)=>React.createElement("div",{key:`error-${t}`},e)));return React.createElement("div",{className:"bub-auth-form"},React.createElement("form",{className:"form signin",id:this.captchaFormId,"aria-label":`${this.props.buttonLabel} form`},React.createElement("div",{className:"row error-message"},e),React.createElement("fieldset",null,React.createElement("div",{className:"row"},React.createElement(l.I,c({className:"_field col-sm-12",type:"email",id:"email_address",name:"email_address",placeholder:"Email",onChange:this.props.onFormChanged,elementOnly:!0,shouldFocus:!0,required:!0},this.props.formData.email_address))),React.createElement("div",{className:"row"},React.createElement(l.I,c({className:"_field col-sm-12",type:"password",id:"password",name:"password",placeholder:"Password",onChange:this.props.onFormChanged,elementOnly:!0,required:!0},this.props.formData.password))),this.props.children,this.renderCaptcha(),React.createElement("div",{className:"row signin-button"},React.createElement(n.G,{onClick:this.onSubmit,disabled:!this.props.isValid||this.props.isSubmitted||this.props.isAuthenticated,label:this.props.buttonLabel,bubStyle:"lava",full:!0,id:this.captchaButtonId})))))}}d.propTypes={buttonLabel:PropTypes.string.isRequired,formData:PropTypes.object.isRequired,onSubmit:PropTypes.func.isRequired,onFormChanged:PropTypes.func.isRequired,errorMessages:PropTypes.array,isAuthenticated:PropTypes.bool,isSubmitted:PropTypes.bool,isValid:PropTypes.bool,recaptchaV2Endpoint:PropTypes.string},d.defaultProps={errorMessages:[],isAuthenticated:!1,isSubmitted:!1,isValid:!0};var u=o(10850),h=o(94935);class m extends React.Component{constructor(e){super(e),this.trackingLabel="bub_auth_modal_sign_in",this.formName="remember_me",this.state={isChecked:!1},this.handleChangeSelection=this.handleChangeSelection.bind(this)}handleChangeSelection(){const e=!this.state.isChecked;let t=!1;return this.setState((e=>({isChecked:!e.isChecked}))),e&&(t=!0),this.props.onFormChanged({name:this.formName,value:t})}renderBubAuthForm(){return this.props.expanded?React.createElement(d,{buttonLabel:"Sign In",errorMessages:this.props.errorMessages,formData:this.props.formData,isSubmitted:this.props.isSubmitted,isValid:this.props.isValid,onFormChanged:this.props.onFormChanged,onSubmit:this.props.onSubmit,recaptchaV2Endpoint:this.props.recaptchaV2Endpoint},React.createElement("div",{className:"row checkbox-and-link"},React.createElement("div",{className:"checkbox-label stay-signed-in"},React.createElement(h.r,{selected:this.state.isChecked,label:"Stay Signed In",changeSelection:this.handleChangeSelection,small:!0})),React.createElement("div",{className:"password-help"},React.createElement("a",{className:"password-help-link",href:this.props.passwordHelpUrl},"Password trouble?")))):null}renderHelpMessage(){return!this.props.displaySignInText||_.isNil(this.props.signInHelpMessageAction)?null:React.createElement("div",{className:"sign-in-help-message"},"Sign in to your account to ",this.props.signInHelpMessageAction,".")}renderSignInPrompts(){return React.createElement("div",{className:a()("row",{"reset-fieldset":this.props.expanded})},React.createElement(u.Z,{emailLabel:"Sign In with Email",googleOnly:this.props.expanded,onContinueWithEmail:this.props.onContinueWithEmail,returnImmediately:!0,trackingLabel:this.trackingLabel,googleButtonColor:"light",googleBorder:!0}))}render(){return React.createElement("div",{className:"sign-in-form","data-testid":"bub-signin-form"},this.renderHelpMessage(),React.createElement("div",{className:"sign-in-form-body"},this.renderBubAuthForm(),this.renderSignInPrompts()))}}m.propTypes={displaySignInText:PropTypes.bool,errorMessages:PropTypes.array,expanded:PropTypes.bool,formData:PropTypes.object.isRequired,isSubmitted:PropTypes.bool,isValid:PropTypes.bool,onContinueWithEmail:PropTypes.func,onFormChanged:PropTypes.func.isRequired,onSubmit:PropTypes.func.isRequired,passwordHelpUrl:PropTypes.string.isRequired,recaptchaV2Endpoint:PropTypes.string,signInHelpMessageAction:PropTypes.string};class g extends React.Component{constructor(e){super(e),this.trackingLabel="bub_auth_modal_sign_up",this.formName="subscribe_me",this.state={isChecked:!0},this.handleChangeSelection=this.handleChangeSelection.bind(this)}handleChangeSelection(){const e=!this.state.isChecked;let t=!1;return this.setState((e=>({isChecked:!e.isChecked}))),e&&(t=!0),this.props.onFormChanged({name:this.formName,value:t})}renderBubAuthForm(){return this.props.expanded?React.createElement(d,{buttonLabel:"Sign Up",errorMessages:this.props.errorMessages,formData:this.props.formData,isSubmitted:this.props.isSubmitted,isValid:this.props.isValid,onFormChanged:this.props.onFormChanged,onSubmit:this.props.onSubmit,recaptchaV2Endpoint:this.props.recaptchaV2Endpoint},React.createElement("div",{className:"row subscribe-me"},React.createElement(h.r,{selected:this.state.isChecked,label:"Send me daily deals on bestselling ebooks!",changeSelection:this.handleChangeSelection,small:!0}))):null}renderHelpMessage(){return React.createElement("div",{className:"sign-up-help"},"Sign up to keep up with your favorite authors and get great deals on bestselling ebooks.")}renderRecaptchaTerms(){return this.props.expanded?React.createElement("div",{className:"recaptcha-terms row"},"This site is protected by reCAPTCHA and the Google",React.createElement("a",{href:"https://policies.google.com/privacy"}," PrivacyÂ Policy")," and",React.createElement("a",{href:"https://policies.google.com/terms"}," TermsÂ ofÂ Service")," apply."):null}renderSignInPrompts(){return React.createElement("div",{className:"row"},React.createElement(u.Z,{emailLabel:"Sign Up with Email",googleOnly:this.props.expanded,onContinueWithEmail:this.props.onContinueWithEmail,returnImmediately:!0,trackingLabel:this.trackingLabel}))}render(){return React.createElement("div",{className:"bub-sign-up-form","data-testid":"bub-signup-form"},this.renderHelpMessage(),React.createElement("div",{className:"sign-up-form-body"},this.renderBubAuthForm(),this.renderRecaptchaTerms(),this.renderSignInPrompts()))}}g.propTypes={errorMessages:PropTypes.array,expanded:PropTypes.bool,formData:PropTypes.object.isRequired,isSubmitted:PropTypes.bool,isValid:PropTypes.bool,onContinueWithEmail:PropTypes.func,onFormChanged:PropTypes.func.isRequired,onSubmit:PropTypes.func.isRequired,recaptchaV2Endpoint:PropTypes.string},g.defaultProps={errorMessages:[],isSubmitted:!1,isValid:!1};var y=o(54728),b=o(14611),k=o(10141),T=o(46078),S=o(5449),f=o(55278);class E extends React.Component{constructor(e){super(e),this.signUpTab=0,this.signInTab=1,this.state={tabs:[{key:"signup",label:"Sign Up",render:this.renderSignUpForm.bind(this),url:this.props.signupUrl,submit:this.handleSignUp.bind(this)},{key:"signin",label:"Sign In",render:this.renderSignInForm.bind(this),url:this.props.signinUrl,submit:this.handleSignIn.bind(this)}],activeTab:this.signUpTab,expanded:!1},this.handleTabClick=this.handleTabClick.bind(this),this.onSubmit=this.onSubmit.bind(this),this.continueWithEmail=this.continueWithEmail.bind(this)}componentDidMount(){k.i.setValidationSettings(this.validationSettings()),k.i.setFormState(this.props.initFormData),bubEvents.track("Prompt Modal","Open",{label:"Prompt Type",value:"Sign-up"}),this.trackSignup().show()}handleSignIn(e){return T.l.signIn(e,this.props.handleAuthenticated)}handleSignUp(e){return this.trackSignup().signup(e.credentials.email_address),T.l.signUp(e,this.props.handleAuthenticated)}handleTabClick(){T.l.resetErrorMessages(),k.i.setFormState(this.props.initFormData),this.setState((e=>({activeTab:e.activeTab===this.signUpTab?this.signInTab:this.signUpTab}))),this.state.activeTab===this.signUpTab&&this.trackSignup().show()}onSubmit(e,t){if(T.l.setIsSubmitted(!0),!t){const e=document.getElementById("recaptcha_v3_token");t=e?e.value:t}this.props.isFormValid&&this.activeTab().submit({authToken:this.props.authenticityToken,credentials:this.props.formValues,url:this.activeTab().url,gRecaptchaResponse:e,recaptchaV3Token:t}).then((()=>{T.l.setIsSubmitted(!1)}))}continueWithEmail(){this.setState({expanded:!0})}formIsExpanded(){return this.state.expanded}trackSignup(){return new b.Z("Auth Modal")}validationSettings(){return{}}activeTab(){return this.state.tabs[this.state.activeTab]}renderSignInForm(){return React.createElement(m,{displaySignInText:this.props.displaySignInText,errorMessages:this.props.authErrorMessages,expanded:this.formIsExpanded(),formData:this.props.formData,isSubmitted:this.props.authSubmitted,isValid:this.props.isFormValid,onFormChanged:k.i.formChanged,onContinueWithEmail:this.continueWithEmail,onSubmit:this.onSubmit,signInHelpMessageAction:this.props.signInHelpMessageAction,passwordHelpUrl:this.props.passwordHelpUrl,recaptchaV2Endpoint:"sessions#create"})}renderSignUpForm(){return React.createElement(g,{errorMessages:this.props.authErrorMessages,expanded:this.formIsExpanded(),formData:this.props.formData,isSubmitted:this.props.authSubmitted,isValid:this.props.isFormValid,onContinueWithEmail:this.continueWithEmail,onFormChanged:k.i.formChanged,onSubmit:this.onSubmit,recaptchaV2Endpoint:"user_signups#create_api"})}renderTabs(){return this.state.tabs.map((e=>React.createElement("div",{key:e.key,className:a()("nav-item",{active:e===this.activeTab()}),onClick:this.handleTabClick},React.createElement("div",{className:a()("tab-label",{active:e===this.activeTab()})},e.label))))}render(){return React.createElement(y.O,{onHide:this.props.handleHide,show:this.props.show,dialogClassName:"bub-auth-modal",className:"bub-auth-modal",modalStyle:"unstyled",headerDismissButton:!0,hideClose:!0,id:"bub-auth-modal"},React.createElement("div",{className:"bub-auth-modal-body"},React.createElement("div",{className:"bub-auth-modal-nav"},this.renderTabs()),React.createElement("div",{className:"active-tab-content"},this.activeTab().render())))}}E.propTypes={displaySignInText:PropTypes.bool,handleAuthenticated:PropTypes.func.isRequired,initFormData:PropTypes.shape({email_address:PropTypes.string,password:PropTypes.string,remember_me:PropTypes.bool,subscribe_me:PropTypes.bool}),passwordHelpUrl:PropTypes.string,handleHide:PropTypes.func,show:PropTypes.bool,signinUrl:PropTypes.string,signupUrl:PropTypes.string,isFormValid:PropTypes.bool,authenticityToken:PropTypes.string,formValues:PropTypes.object,authErrorMessages:PropTypes.array,formData:PropTypes.object,authSubmitted:PropTypes.bool,signInHelpMessageAction:PropTypes.string},E.defaultProps={initFormData:{email_address:"",password:"",remember_me:!1,subscribe_me:!0},passwordHelpUrl:"/users/password/new",show:!1,signinUrl:"/users/sign_in.json",signupUrl:"/user_signups/api.json"};const R=(0,r.$j)((e=>{const t=S.c.getSelector(e),o=f.L.getSelector(e);return{isFormValid:t.getIsValid(),formValues:t.getFormValues(),formData:t.getFormData(),isAuthenticated:o.isAuthenticated,authenticityToken:o.authenticityToken,authErrorMessages:o.errorMessages,authSubmitted:o.isSubmitted}}))(E);R.trackingName="Authentication Modal";var P=o(55093);class C extends React.Component{constructor(e){super(e),this.handleAuthenticated=this.handleAuthenticated.bind(this),this.handleHide=this.handleHide.bind(this)}handleAuthenticated(){this.props.query?window.location=`?${this.props.query}`:this.props.path?P.x.assign(this.props.path):window.location.reload()}handleHide(){s.P.hide()}render(){return React.createElement(R,{handleAuthenticated:this.handleAuthenticated,handleHide:this.handleHide,show:this.props.show,signInHelpMessageAction:this.props.signInHelpMessageAction,displaySignInText:this.props.displaySignInText})}}C.propTypes={displaySignInText:PropTypes.bool,signInHelpMessageAction:PropTypes.string,path:PropTypes.string,query:PropTypes.string,show:PropTypes.bool},C.defaultProps={displaySignInText:!1,path:void 0,query:void 0,show:!0,signInHelpMessageAction:null},C.trackingName="Authentication Modal";const I=C},9763:function(e,t,o){"use strict";o.d(t,{L:function(){return l}});var s=o(19728),r=o(28850),i=o(64538);class a extends React.PureComponent{hideTooltipOnMobile(){return this.props.windowMatchesXs&&!this.props.showOnMobile}renderTooltipContent(){return this.props.onShow?React.createElement(n,{onMount:this.props.onShow},this.props.tooltipText):this.props.tooltipText}render(){if(this.hideTooltipOnMobile())return this.props.children;const e=React.createElement(s.Z,{className:"tooltip",id:"bub_tooltip"},this.renderTooltipContent());return React.createElement(r.Z,{trigger:this.props.trigger,placement:this.props.tooltipPlacement,overlay:e,delay:this.props.delay},this.props.children)}}a.propTypes={children:PropTypes.node,tooltipText:PropTypes.string,tooltipPlacement:PropTypes.oneOf(["left","right","top","bottom"]),delay:PropTypes.number,onShow:PropTypes.func,trigger:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string)]),showOnMobile:PropTypes.bool},a.defaultProps={tooltipText:"",tooltipPlacement:"right",trigger:["hover","focus"],showOnMobile:!0};class n extends React.PureComponent{componentDidMount(){this.props.onMount()}render(){return this.props.children}}n.propTypes={onMount:PropTypes.func};const l=(0,i.$)(a)},21453:function(e,t,o){"use strict";o.d(t,{y:function(){return d}});var s=o(94184),r=o.n(s),i=o(38047),a=o(92564),n=o.n(a),l=o(42708);class p extends React.PureComponent{constructor(e){super(e),this.state={trackedImpression:!1},this.onChange=this.onChange.bind(this)}onChange(e){this.props.onChange(e),e&&!this.state.trackedImpression&&(this.setState({trackedImpression:!0}),this.props.onImpression())}render(){return React.createElement(l.df,{as:"div",threshold:this.props.threshold,onChange:this.onChange,className:this.props.className,"data-testid":"waypoint",fallbackInView:this.props.visibleForUnsupportedBrowsers},this.props.children)}}p.IMPRESSION_THRESHOLD=.8,p.VISIBLE_THRESHOLD=0,p.propTypes={className:PropTypes.string,visibleForUnsupportedBrowsers:PropTypes.bool,onChange:PropTypes.func,onImpression:PropTypes.func,threshold:PropTypes.number},p.defaultProps={onChange:_.noop,onImpression:_.noop,threshold:p.IMPRESSION_THRESHOLD,visibleForUnsupportedBrowsers:!1};const c={isDevelopment(){return"development"===this.getBubEnv()},isTest(){return"test"===this.getBubEnv()},getBubEnv(){return window.bubEnv}};class d extends React.PureComponent{constructor(e){super(e),this.state={isVisible:c.isTest()||!e.defer},this.onEnter=this.onEnter.bind(this)}componentDidMount(){this.props.handleCoverImageRefCallback&&this.props.handleCoverImageRefCallback(this.coverImageRef)}onEnter(e){e&&!this.state.isVisible&&this.setState({isVisible:!0})}altText(){return this.props.hideAlt?"":this.props.bookTitle?`Book cover for ${_([this.props.bookTitle,this.props.bookAuthor]).compact().join(" by ")}`:"book cover"}generateImageUrl(e){return i.J.fixedAspectRatio(this.props.coverUrl,this.props.scaledWidth,e)}renderOverlay(){return this.props.showOverlay?React.createElement("div",{"data-testid":"cover-image-overlay",className:"cover-image-overlay"}):null}renderCover(){let e=this.props.onClick;const t=window.devicePixelRatio>=2?2:1,o=this.props.scaledWidth?t:1;let s=React.createElement("img",{className:"book-cover-image",src:this.generateImageUrl(o),alt:this.altText()});return this.props.href&&(s=React.createElement("a",{className:"book-url",href:this.props.href,onClick:()=>e&&e(this.props.bookId)},s),e=_.noop),this.state.isVisible||(s=null),React.createElement("div",{className:r()("cover-image",{"clickable-cover":_.isFunction(e)}),role:e?"button":void 0,tabIndex:e?0:void 0,onClick:()=>e&&e(this.props.bookId),ref:e=>{this.coverImageRef=e},"data-testid":this.props.bookTitle?`cover-image-${this.props.bookTitle}`:"cover-image","aria-label":this.altText()},this.renderOverlay(),React.createElement("div",{className:"cover-image-wrapper"},s),this.props.bookBadge)}render(){return this.props.defer?React.createElement(p,{onChange:this.onEnter,threshold:p.VISIBLE_THRESHOLD,visibleForUnsupportedBrowsers:!0},this.renderCover()):this.renderCover()}}d.propTypes={coverUrl:PropTypes.string,bookBadge:PropTypes.node,href:PropTypes.string,onClick:PropTypes.func,scaledWidth:PropTypes.number,bookTitle:PropTypes.string,bookAuthor:PropTypes.string,bookId:PropTypes.number,handleCoverImageRefCallback:PropTypes.func,defer:PropTypes.bool,showOverlay:PropTypes.bool,hideAlt:PropTypes.bool},d.defaultProps={coverUrl:n(),defer:!0,hideAlt:!1}},49734:function(e,t,o){"use strict";o.d(t,{z:function(){return i}});var s=o(94184),r=o.n(s);class i extends React.Component{renderDisclosure(){return this.props.disclosure?React.createElement("span",{className:"available-date"},React.createElement("span",{className:r()("disclosure",`${this.props.disclosure}`)},"Available for a limited time")):null}renderDiscountPrice(){const e=this.props.dealPrice||this.props.newReleasePrice;if(_.includes(_.toLower(e),"free"))return React.createElement("span",{className:"discount-price-free"},e);const t=e.substring(0,1),o=e.substring(1);return React.createElement("span",null,React.createElement("span",{className:"sr-only discount-price-label"},"Deal Price: "),React.createElement("span",{className:"discount-price"},React.createElement("span",{className:"currency"},t),o))}renderRetailPrice(){return this.props.retailPrice?React.createElement(React.Fragment,null,React.createElement("span",{className:"sr-only original-price-label"},"Retail Price: "),React.createElement("span",{className:"original-price"},this.props.retailPrice)):null}render(){if(!this.props.dealPrice&&!this.props.newReleasePrice)return null;const e=this.props.newReleasePrice&&!this.props.dealPrice;return React.createElement("div",{className:r()("deal-price",`size-${this.props.size}`,{"new-release-price":e}),"data-testid":"deal-price"},this.renderDiscountPrice(),this.renderRetailPrice(),this.renderDisclosure())}}i.propTypes={dealPrice:PropTypes.string,retailPrice:PropTypes.string,newReleasePrice:PropTypes.string,size:PropTypes.oneOf(["small","medium","large"]),disclosure:PropTypes.oneOf(["stacked","inline"])},i.defaultProps={size:"medium"}},60979:function(e,t,o){"use strict";o.d(t,{S:function(){return i}});var s=o(23723),r=o.n(s);function i(e){"undefined"!=typeof ReactDOM&&null!=e&&(r().attach?r().attach(ReactDOM.findDOMNode(e)):r()(ReactDOM.findDOMNode(e)))}},33024:function(e,t,o){"use strict";o.d(t,{b:function(){return n}});var s=o(94184),r=o.n(s),i=o(83141),a=o(28312);class n extends React.Component{onFlashDismiss(e){this.props.onFlashRemoved(e)}alertLevel(e){return e.level?"notice"===e.level?"warning":e.level:"default"}renderImage(e){return e.imgUrl?React.createElement("img",{src:e.imgUrl,alt:"message icon"}):null}renderIcon(e){return e.icon?React.createElement(i.J,{name:e.icon.name,color:e.icon.color,size:e.icon.size}):null}renderClickableMessage(e){let t=null;void 0!==e.text&&(t=React.createElement("span",{className:"message-text"},e.text));let o=null,s=null,r=null;return void 0!==e.urlText&&void 0!==e.url&&(s=React.createElement("span",{className:"url-text"},e.urlText),r=e.url),void 0!==e.onClickText&&void 0!==e.onClick&&(s=React.createElement("span",{className:"on-click-text"},e.onClickText),o=e.onClick),React.createElement("div",{className:"clickable-area"},React.createElement("div",{className:"icon"},this.renderImage(e)||this.renderIcon(e)),React.createElement("div",null,t,React.createElement(a.G,{label:s,href:r,onClick:o,noPadding:!0,renderAs:"link",bubStyle:this.props.bubStyle})))}renderContent(e){return e.clickable||void 0===e.clickable?this.renderClickableMessage(e):e.text}render(){if(_.isEmpty(this.props.messages))return null;const e=_.map(this.props.messages,((e,t)=>{e.timeout&&setTimeout(this.onFlashDismiss.bind(this,t),e.timeout);let o=null;(void 0===e.dismissable||e.dismissable)&&(o=React.createElement("button",{className:"dismiss",onClick:this.onFlashDismiss.bind(this,t)},React.createElement(i.J,{name:"x",size:"18px"}),React.createElement("span",{className:"sr-only"},"Dismiss")));let s=null;return void 0!==e.title&&(s=React.createElement("b",null,e.title)),React.createElement("div",{key:t,className:r()("alert",`alert-${this.alertLevel(e)}`,this.props.inline?"inline":"")},React.createElement("div",{className:"alert-contents"},s,this.renderContent(e)),o)}));return React.createElement("div",{className:"flash-messages"},e)}}n.propTypes={messages:PropTypes.arrayOf(PropTypes.shape({level:PropTypes.string,title:PropTypes.string,text:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),urlText:PropTypes.string,url:PropTypes.string,imgUrl:PropTypes.string,clickable:PropTypes.bool,dismissable:PropTypes.bool,timeout:PropTypes.number,icon:PropTypes.shape({name:PropTypes.string,color:PropTypes.string,size:PropTypes.string}),onClick:PropTypes.func,onClickText:PropTypes.oneOfType([PropTypes.string,PropTypes.object])})).isRequired,onFlashRemoved:PropTypes.func.isRequired,inline:PropTypes.bool,bubStyle:PropTypes.oneOf(["sea","lava"])},n.defaultProps={inline:!1,bubStyle:"lava"}},29537:function(e,t,o){"use strict";o.d(t,{O:function(){return l}});var s=o(94184),r=o.n(s),i=o(9971),a=o(64098),n=o.n(a);class l extends React.PureComponent{constructor(e){super(e),this.onClick=this.onClick.bind(this)}onClick(){bubEvents.track("Google Oauth","Authenticate",{label:"location",value:this.props.trackingLabel}),this.props.onClick&&this.props.onClick()}queryString(){let e=[`return_to=${_.head(_.split(window.location.href,"?"))}`];return this.props.returnAfterOnboarding&&e.push("return_after_onboarding=true"),this.props.returnImmediately&&e.push("return_to_referer=true"),this.props.referralCode&&e.push(`referral_code=${this.props.referralCode}`),this.props.region&&e.push(`region=${this.props.region}`),this.props.countryCode&&e.push(`country_code=${this.props.countryCode}`),this.props.wishlistableBookId&&e.push(`wishlistable_book_id=${this.props.wishlistableBookId}`),this.props.redirectToBookPage&&e.push(`redirect_to_book_page=${this.props.redirectToBookPage}`),this.props.autoBookmark&&e.push(`auto_bookmark=${this.props.autoBookmark}`),e=e.concat(this.additionalOauthParams()),_.isEmpty(e)?"":`?${_.join(e,"&")}`}additionalOauthParams(){const e=this.props.additionalOauthParams;if(_.isEmpty(e))return[];const t=_.map(_.keys(e),(t=>{const o=_.toString(_.get(e,t));return""===o?null:`${t}=${o}`}));return _.compact(t)}renderLogo(){return React.createElement("div",{className:"logo-container"},React.createElement("img",{src:n(),className:`oauth-logo ${this.props.iconSize}`,alt:"Google Oauth Sign In"}))}renderLabel(){return React.createElement("div",null,"Continue with Google")}renderPlaceholder(){return React.createElement("div",{className:"placeholder"})}render(){return React.createElement("form",{action:`/auth/google_oauth2${this.queryString()}`,method:"post",className:r()("google-oauth-form",{"full-height":this.props.fullHeight})},React.createElement("input",{type:"hidden",name:"authenticity_token",value:i.I.csrfToken()}),React.createElement("button",{type:"submit",className:r()("google-oauth-button",{"full-height":this.props.fullHeight}),onClick:this.onClick},this.renderLogo(),this.renderLabel(),this.renderPlaceholder()))}}l.propTypes={additionalOauthParams:PropTypes.object,countryCode:PropTypes.string,onClick:PropTypes.func,region:PropTypes.string,referralCode:PropTypes.string,returnAfterOnboarding:PropTypes.bool,returnImmediately:PropTypes.bool,trackingLabel:PropTypes.string,wishlistableBookId:PropTypes.string,redirectToBookPage:PropTypes.bool,autoBookmark:PropTypes.bool,fullHeight:PropTypes.bool,iconSize:PropTypes.oneOf(["medium","large"])},l.defaultProps={returnAfterOnboarding:!1,returnImmediately:!1,fullHeight:!1,iconSize:"medium"}},83141:function(e,t,o){"use strict";o.d(t,{J:function(){return i}});var s=o(94184),r=o.n(s);class i extends React.PureComponent{render(){const e=`bb_icon_${this.props.name}`;return React.createElement("svg",{className:r()(this.props.color,"svg-icon",this.props.className),width:"1em",height:"1em",fontSize:this.props.size,"data-testid":e,"aria-label":this.props.ariaLabel},React.createElement("use",{xlinkHref:`#${e}`}))}}i.propTypes={name:PropTypes.string,className:PropTypes.string,color:PropTypes.oneOf(["red-100","red-110","teal-100","navy-100","grey-100","grey-70","grey-50","grey-30","grey-15","white","navy-70","secondary-lightgreen-100"]),size:PropTypes.string,ariaLabel:PropTypes.string}},96772:function(e,t,o){"use strict";o.d(t,{r:function(){return i}});var s=o(94184),r=o.n(s);class i extends React.PureComponent{isButton(){return _.isEmpty(this.props.href)}render(){const e=r()(this.props.className,this.props.bubStyle);if(this.isButton()){const t=r()(e,"link-component");return React.createElement("button",{"aria-label":this.props.ariaLabel,type:this.props.type,onClick:this.props.onClick,className:t,id:this.props.id,disabled:this.props.disabled,data:this.props.data,"data-id":this.props.dataId,"aria-hidden":this.props.ariaHidden},this.props.children)}const t=r()(e,"raw-link");return React.createElement("a",{"aria-label":this.props.ariaLabel,id:this.props.id,onClick:this.props.onClick,href:this.props.href,className:t,target:this.props.target,rel:this.props.rel,role:this.props.role},this.props.children)}}i.propTypes={ariaLabel:PropTypes.string,className:PropTypes.string,onClick:PropTypes.func,href:PropTypes.string,target:PropTypes.string,id:PropTypes.string,data:PropTypes.any,dataId:PropTypes.any,disabled:PropTypes.bool,type:PropTypes.string,ariaHidden:PropTypes.string,role:PropTypes.string,rel:PropTypes.string,bubStyle:PropTypes.oneOf(["sea","lava","grey"])},i.defaultProps={ariaLabel:null,bubStyle:"lava",type:"button"}},7238:function(e,t,o){"use strict";o.d(t,{n:function(){return r}});var s=o(28312);class r extends React.PureComponent{render(){if(!this.props.show)return null;const e=this.props.isLoading?"Loading...":this.props.caption;return React.createElement("div",{className:"load-more"},React.createElement(s.G,{disabled:this.props.isLoading,onClick:this.props.loadMore,label:e,bubStyle:this.props.bubStyle}))}}r.propTypes={loadMore:PropTypes.func.isRequired,show:PropTypes.bool,isLoading:PropTypes.bool,caption:PropTypes.string,bubStyle:PropTypes.string},r.defaultProps={show:!0,isLoading:!1,caption:"Load More",bubStyle:"lava"}},17474:function(e,t,o){"use strict";o.d(t,{r:function(){return i}});var s=o(94184),r=o.n(s);class i extends React.PureComponent{render(){return React.createElement("div",{className:r()("person-name",this.props.textOverflow,this.props.purpose,this.props.size),"data-testid":"person-name"},this.props.children)}}i.propTypes={children:PropTypes.node,purpose:PropTypes.oneOf(["header","primary","secondary"]),size:PropTypes.oneOf(["xsmall","small","medium","large","xlarge"]),textOverflow:PropTypes.oneOf(["wrap","ellipsis"])},i.defaultProps={purpose:"primary",size:"medium",textOverflow:"ellipsis"}},89219:function(e,t,o){"use strict";o.d(t,{m:function(){return l}});var s=o(94184),r=o.n(s),i=o(6588),a=o.n(i),n=o(96772);class l extends React.Component{constructor(e){super(e),this.state={errored:!1},this.handleOnError=this.handleOnError.bind(this)}handleOnError(){return this.setState({errored:!0})}scaleProfileImage(e){let t=e,o=200;switch(this.props.size){case"large":o=170;break;case"medium":o=145;break;case"small":o=60;break;case"xsmall":o=45;break;case"xxsmall":o=35}if(this.props.zoom){const e=/(.*image\/upload\/.*)(c_.*?)([,|/].*)/;t=t.match(e)?t.replace(e,"$1c_thumb$3"):t.replace("image/upload/","image/upload/c_thumb,")}const s=2*o,r=/(.*image\/upload\/.*)(w_.*?)([,|/].*)/,i=/(.*image\/upload\/.*)(h_.*?)([,|/].*)/;return t.match(r)&&t.match(i)?t.replace(r,`$1w_${s}$3`).replace(i,`$1h_${s}$3`):t.replace("image/upload/",`image/upload/w_${s},h_${s},`)}renderImage(){const e=this.state.errored?a():_.get(this.props.profile,"imageUrl")||a(),t=_.get(this.props.profile,"defaultImage"),o=React.createElement("div",{className:r()("profile-image",this.props.size)},React.createElement("img",{src:this.scaleProfileImage(e),onError:this.handleOnError,alt:this.props.profile.name?`Profile avatar for ${this.props.profile.name}`:"profile avatar",className:r()(t)}));return this.props.hyperlink&&this.props.customHref?React.createElement(n.r,{href:this.props.customHref},o):this.props.hyperlink&&this.props.profile.profileUrl?React.createElement(n.r,{href:this.props.profile.profileUrl},o):_.isUndefined(this.props.onClick)?o:React.createElement(n.r,{onClick:this.props.onClick},o)}render(){return this.renderImage()}}l.propTypes={hyperlink:PropTypes.bool,profile:PropTypes.object,size:PropTypes.oneOf(["xxsmall","xsmall","small","medium","large","full"]),zoom:PropTypes.bool,onClick:PropTypes.func,customHref:PropTypes.string},l.defaultProps={hyperlink:!0,zoom:!1,onClick:void 0}},353:function(e,t,o){"use strict";o.d(t,{m:function(){return g}});var s=o(94184),r=o.n(s),i=o(11184),a=o.n(i);class n extends React.PureComponent{render(){return React.createElement("div",{"data-testid":"author-pill",className:"author-pill"},"Author")}}var l=o(17474),p=o(76397),c=o(9763),d=o(83141);class u extends React.PureComponent{renderLock(){return React.createElement("span",{"data-testid":"private-profile-icon",className:"private-profile-icon"},React.createElement(d.J,{name:"lock"}))}render(){return this.props.profile.private?this.props.hideTooltip?this.renderLock():React.createElement(c.L,{tooltipText:"Private Profile"},this.renderLock()):null}}u.propTypes={profile:p._.profile.isRequired,hideTooltip:PropTypes.bool};var h=o(89219);const m={numberWithCommas(e){return _.isNaN(e)?null:e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}};class g extends React.Component{renderProfileNameInfo(){const e=this.props.profile.authorId&&this.props.renderAuthorPill?React.createElement("div",{className:"author-pill-wrapper"},React.createElement(n,null)):null,t=this.props.profile.private?React.createElement("div",{className:"lock"},React.createElement(u,{profile:this.props.profile})):null;let o=this.props.profile.name;return this.props.linkToProfile&&this.props.profile.profileUrl&&(o=React.createElement("a",{href:this.props.profile.profileUrl,onClick:this.props.onProfileClick},this.props.profile.name)),React.createElement("div",{"data-testid":"profile-tile-person-name-info",className:"profile-name-info "+(this.props.wrapAuthorPill?"wrap-author-pill":"")},React.createElement("div",{className:"profile-name-inline"},React.createElement("div",{"data-testid":"profile-tile-person-name-wrapper",className:"person-name-wrapper"},React.createElement(l.r,{purpose:"primary",size:this.props.size,textOverflow:this.props.wrapText?"wrap":"ellipsis"},o)),t),e)}renderSecondaryInfo(){let e;switch(this.props.secondaryInfo){case"username":if(this.props.profile.username){let t=`@${this.props.profile.username}`;this.props.linkToProfile&&this.props.profile.profileUrl&&(t=React.createElement("a",{className:"username",onClick:this.props.onProfileClick,href:this.props.profile.profileUrl},`@${this.props.profile.username}`)),e=t}break;case"followerCount":_.isNil(this.props.profile.followerCount)||(e=`${m.numberWithCommas(this.props.profile.followerCount)} ${a().pluralize(this.props.profile.followerCount,"Follower")}`);break;case"recommended":e="recommended:";break;case"reviewed":e="reviewed:";break;case"category":if(!_.isNil(this.props.profile.author)&&!_.isEmpty(this.props.profile.author.tags)){e=this.props.profile.author.tags[0].displayName;break}e=null;break;default:e=null}return e?React.createElement("div",{"data-testid":"profile-tile-secondary-info",className:r()("secondary-info",{"no-wrap":!this.props.wrapText})},e):null}render(){const e="small"===this.props.size?"xsmall":"small";return React.createElement("div",{"data-testid":`profile-tile-${this.props.profile.id}`,className:r()("profile-tile",this.props.size,{bordered:this.props.borderedProfileImage})},React.createElement("div",{className:"profile-image-wrapper"},React.createElement(h.m,{profile:this.props.profile,size:e,hyperlink:this.props.linkToProfile})),React.createElement("div",{className:"profile-details-wrapper"},this.renderProfileNameInfo(),this.renderSecondaryInfo()))}}g.propTypes={linkToProfile:PropTypes.bool,profile:p._.profile.isRequired,secondaryInfo:PropTypes.oneOf(["username","followerCount","recommended","reviewed","category"]),size:PropTypes.oneOf(["small","medium"]),wrapAuthorPill:PropTypes.bool,wrapText:PropTypes.bool,borderedProfileImage:PropTypes.bool,renderAuthorPill:PropTypes.bool,onProfileClick:PropTypes.func},g.defaultProps={linkToProfile:!0,wrapAuthorPill:!1,wrapText:!1,borderedProfileImage:!1,renderAuthorPill:!0,size:"medium"}},26455:function(e,t,o){"use strict";o.d(t,{R:function(){return r}});class s extends React.PureComponent{componentDidMount(){this.props.loadV3&&window.loadRecaptchaV3(this.props.action,this.props.onInitV3),window.loadRecaptchaV2({buttonId:this.props.captchaButtonId,formId:this.props.captchaFormId,endpoint:this.props.endpoint,onSubmit:this.props.onSubmit,initCallback:this.props.onInit,trackingFunc:this.props.preSubmit})}render(){return React.createElement(React.Fragment,null,React.createElement("input",{type:"hidden",name:"recaptcha_v3_token",id:"recaptcha_v3_token","data-testid":"recaptcha_v3_token"}),React.createElement("input",{type:"hidden",name:"g-recaptcha-response",onChange:this.props.onChange}))}}s.propTypes={captchaButtonId:PropTypes.string,captchaFormId:PropTypes.string,endpoint:PropTypes.string,onChange:PropTypes.func,onInit:PropTypes.func,onSubmit:PropTypes.func,preSubmit:PropTypes.func,loadV3:PropTypes.bool,onInitV3:PropTypes.func,action:PropTypes.string};const r=s},64538:function(e,t,o){"use strict";o.d(t,{$:function(){return i}});var s=o(74718);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},r.apply(this,arguments)}function i(e){class t extends React.Component{constructor(e){super(e),this.state=this.getDimensions(),this.getDimensions=this.getDimensions.bind(this),this.updateDimensions=this.updateDimensions.bind(this)}componentDidMount(){this.updateDimensions(),window.addEventListener("resize",this.updateDimensions)}componentWillUnmount(){window.removeEventListener("resize",this.updateDimensions)}getDimensions(){return{wide:!s.c.matchesXs(),windowMatchesXs:s.c.matchesXs(),windowMatchesSm:s.c.matchesSm(),windowMatchesMd:s.c.matchesMd(),windowMatchesLg:s.c.matchesLg()}}updateDimensions(){this.setState(this.getDimensions())}render(){return React.createElement(e,r({},this.props,this.state))}}const o=e.displayName||e.name||"Container";return t.displayName=`Resizable${o}`,t.componentPropTypes=e.propTypes||{},t.componentDefaultProps=e.defaultProps||{},t}},76167:function(e,t,o){"use strict";o.d(t,{t:function(){return n}});var s=o(30845),r=o(43194),i=o(68140),a=o.n(i);class n extends React.PureComponent{renderCompactRibbon(){return React.createElement("div",{className:"ribbon-book-list-badge compact"},React.createElement(r.n,{svgSrc:a(),size:"26"}))}renderRibbon(e){return React.createElement("div",{"data-testid":"ribbon-book-list-badge",className:"ribbon-book-list-badge full-size"},React.createElement("div",{className:"ribbon-book-list-badge-inner"},React.createElement("span",{className:"ribbon-book-list-badge-text"},e.onListLabel)),React.createElement("span",{className:"ribbon-book-list-badge-text"},e.onListLabel))}render(){const e=_.get(s.Tq,this.props.bookListSlug);return e?this.props.compact?this.renderCompactRibbon(e):this.renderRibbon(e):null}}n.propTypes={bookListSlug:PropTypes.string,compact:PropTypes.bool},n.defaultProps={compact:!1}},10850:function(e,t,o){"use strict";o.d(t,{Z:function(){return l}});var s=o(28312),r=o(29537),i=o(64538),a=o(9971);class n extends React.PureComponent{render(){return this.props.googleOnly?React.createElement("div",{className:"sign-in-prompts"},React.createElement("div",{className:"prompt-divider"},"or"),React.createElement(r.O,{additionalOauthParams:this.props.additionalOauthParams,countryCode:a.I.getCountryCode(),onClick:this.props.googleOnClick,referralCode:this.props.referralCode,region:a.I.getSignupRegion(),returnAfterOnboarding:this.props.returnAfterOnboarding,returnImmediately:this.props.returnImmediately,trackingLabel:this.props.trackingLabel})):React.createElement("div",{className:"sign-in-prompts"},React.createElement(s.G,{onClick:this.props.onContinueWithEmail,label:this.props.emailLabel,bubStyle:"lava",dangerouslySkipTitleCase:!0,full:!0}),React.createElement("div",{className:"prompt-divider"},"or"),React.createElement(r.O,{additionalOauthParams:this.props.additionalOauthParams,countryCode:a.I.getCountryCode(),onClick:this.props.googleOnClick,referralCode:this.props.referralCode,region:a.I.getSignupRegion(),returnAfterOnboarding:this.props.returnAfterOnboarding,returnImmediately:this.props.returnImmediately,trackingLabel:this.props.trackingLabel}))}}n.propTypes={additionalOauthParams:PropTypes.object,emailLabel:PropTypes.string,googleOnClick:PropTypes.func,googleOnly:PropTypes.bool,onContinueWithEmail:PropTypes.func,referralCode:PropTypes.string,returnAfterOnboarding:PropTypes.bool,returnImmediately:PropTypes.bool,trackingLabel:PropTypes.string},n.defaultProps={emailLabel:"Sign In with Email"};const l=(0,i.$)(n)},23606:function(e,t,o){"use strict";o.d(t,{g:function(){return l}});var s=o(11184),r=o.n(s),i=o(60979),a=o(83141);const n={xsmall:14,small:17,medium:20,large:26};class l extends React.Component{constructor(e){super(e),this.state={rating:null},this.getContainerWidth=this.getContainerWidth.bind(this),this.getActiveStarsWidth=this.getActiveStarsWidth.bind(this),this.handleStarMouseEnter=this.handleStarMouseEnter.bind(this),this.handleStarClick=this.handleStarClick.bind(this),this.handleContainerMouseLeave=this.handleContainerMouseLeave.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.orientationClassname=this.orientationClassname.bind(this)}handleContainerMouseLeave(){return BrowserAbilities.hoverEnabled()?this.setState({rating:null}):null}handleKeyPress(e){return"Enter"!==e.key&&" "!==e.key||this.handleStarClick(e)}handleStarMouseEnter(e){return BrowserAbilities.hoverEnabled()?this.setState({rating:e}):null}handleStarClick(e){return this.props.onRate(e)}getContainerWidth(){return 5*n[this.props.size]}getRating(){return this.state.rating||this.props.rating}getFriendlyRating(){switch(this.getRating()){case 1:return"Bad";case 2:return"Disappointing";case 3:return"Okay";case 4:return"Good";case 5:return"Excellent";default:return"Empty"}}getActiveStarsWidth(){return this.getRating()/5*this.getContainerWidth()}orientationClassname(){return`orient-${this.props.orientAnnotation}`}isClickable(){return this.props.clickable?"clickable":""}renderStar(e,t){const o=_.toString(n[this.props.size]),s=this.props.interactive?"interactive":"",l=e+1,p=t?null:`Rate book ${l} ${r().pluralize(l,"star","stars")}`,c=t?null:React.createElement("span",{className:"sr-only"},`${l} ${r().pluralize(l,"star","stars")}`);return React.createElement("button",{className:`star-rate-trigger ${s}`,"data-rating":l,"aria-label":p,"aria-pressed":t?null:l===this.getRating(),tabIndex:t||!this.props.interactive?"-1":"0",onMouseEnter:this.props.interactive?_.partial(this.handleStarMouseEnter,l):null,onClick:this.props.interactive?_.partial(this.handleStarClick,l):null,onKeyPress:this.props.interactive?this.handleKeyPress:null,ref:i.S,key:e,"data-interactive":s},c,React.createElement(a.J,{name:"star",className:`star ${s} ${this.isClickable()}`,size:o}))}renderStars(e){return _.times(5,(t=>this.renderStar(t,e)))}renderAnnotation(){return this.props.annotate?React.createElement("span",{className:"annotation "+(this.getRating()>0?"":"invisible"),"data-testid":"star-rating-annotation"},this.getFriendlyRating()):null}renderRatingCount(){return!this.props.showRatingsCount||_.isNil(this.props.ratingsCount)?null:React.createElement("span",{className:`review-count ${this.props.size} ${this.isClickable()}`,"data-testid":"star-rating-review-count",onClick:this.props.onClick},`${this.props.ratingsCount>0?this.props.ratingsCount.toLocaleString("en"):"no ratings"}`)}render(){const e=this.getRating();return React.createElement("div",{className:`bub-rating-stars ${this.orientationClassname()} ${this.props.size}`,"data-testid":"star-rating-tile"},"left"===this.props.orientAnnotation&&this.renderAnnotation(),React.createElement("div",{className:`stars ${this.isClickable()}`,onClick:this.props.onClick,onMouseLeave:this.props.interactive?this.handleContainerMouseLeave:null,style:{width:this.getContainerWidth()}},this.renderStars(),React.createElement("div",{className:"active","data-active-rating":e,style:{width:this.getActiveStarsWidth()},"data-testid":"active-star-rating"},this.renderStars(!0))),this.renderRatingCount(),"bottom"===this.props.orientAnnotation&&this.renderAnnotation())}}l.propTypes={clickable:PropTypes.bool,interactive:PropTypes.bool,onRate:PropTypes.func,rating:PropTypes.number,size:PropTypes.oneOf(["xsmall","small","medium","large"]),annotate:PropTypes.bool,orientAnnotation:PropTypes.oneOf(["left","bottom"]),showRatingsCount:PropTypes.bool,ratingsCount:PropTypes.number,onClick:PropTypes.func},l.defaultProps={interactive:!1,rating:0,size:"medium",onRate:_.noop,annotate:!1,orientAnnotation:"left",showRatingsCount:!1}},43194:function(e,t,o){"use strict";o.d(t,{n:function(){return i}});var s=o(94184),r=o.n(s);function i({svgSrc:e,className:t,color:o,size:s}){return React.createElement("svg",{className:r()(o,"svg",t),width:"1em",height:"1em",dangerouslySetInnerHTML:{__html:e},fontSize:s})}i.propTypes={svgSrc:PropTypes.any,className:PropTypes.string,color:PropTypes.oneOf(["red-100","red-110","teal-100","navy-100","grey-100","grey-70","grey-50","grey-30","grey-15","white","navy-70","secondary-indigo-100","secondary-indigo-20"]),size:PropTypes.string}},30845:function(e,t,o){"use strict";o.d(t,{EG:function(){return a},F1:function(){return s},JR:function(){return r},Tq:function(){return p},Wz:function(){return i},xD:function(){return n},yY:function(){return c}});const s={name:"Wishlist",description:"Wishlist",dropdownItemLabel:"Save to Wishlist",dropdownItemIcon:null,internalName:"want_to_read",nextActionSlug:"owned",onListLabel:"On wishlist",onListIcon:"check",primaryActionLabel:"Save to Wishlist",slug:"wanted",headerNavLabel:"Wishlist"},r={name:"Owned",description:"I own it",dropdownItemLabel:"I own it",dropdownItemIcon:null,internalName:"owned",nextActionSlug:"finished",onListLabel:"Owned",onListIcon:null,primaryActionLabel:"Add to Owned",slug:"owned",headerNavLabel:"Owned List"},i={name:"Reading",description:"Currently reading",dropdownItemLabel:"Currently reading",dropdownItemIcon:null,internalName:"currently_reading",nextActionSlug:"finished",onListLabel:"Reading",onListIcon:null,primaryActionLabel:"Mark as Reading",slug:"reading",headerNavLabel:"Currently Reading"},a={name:"Finished",description:"I've finished it",dropdownItemLabel:"I've finished it",dropdownItemIcon:null,internalName:"completed",nextActionSlug:null,onListLabel:"Finished",onListIcon:null,primaryActionLabel:"Mark Finished",slug:"finished",headerNavLabel:"Finished List"},n=[s,r,i,a,{name:"Not Interested",description:"I'm not interested",dropdownItemLabel:"I'm not interested",dropdownItemIcon:"ban",internalName:"not_interested",nextActionSlug:null,onListLabel:"Not interested",onListIcon:null,primaryActionLabel:"I'm not interested",slug:"not-interested",headerNavLabel:"Not Interested List"},{name:"Skipped",description:"I skipped it",dropdownItemLabel:"I skipped it",dropdownItemIcon:null,internalName:"skipped",nextActionSlug:null,onListLabel:"Skipped",onListIcon:null,primaryActionLabel:"Add to Skipped",slug:"skipped",headerNavLabel:"Skipped List"}],l=[s,r,i,a],p=_.keyBy(l,(e=>e.slug)),c={DEFAULT_LIST_SLUG:"wanted",DEFAULT_LIST_SORT_WISHLIST:"deals_first",DEFAULT_LIST_SORT_ALL:"desc"}},88426:function(e,t,o){"use strict";o.d(t,{f:function(){return s}});const s={add(e,t,o){return bubEvents.track("Bookmarks","Add",this.bookmarkAttributes(e,t,o))},move(e,t,o){return bubEvents.track("Bookmarks","Move",this.bookmarkAttributes(e,t,o))},remove(e,t,o){return bubEvents.track("Bookmarks","Remove",this.bookmarkAttributes(e,t,o))},addAll(e,t,o){_.forEach(e,(e=>this.add(e,t,o)))},autoAdd(e){return bubEvents.track("Bookmarks","Add",this.bookmarkAttributes(e,"wanted",this.QUERY_PARAM_ID))},bookmarkAttributes(e,t,o){return{label:o,value:t,bookId:e.id,displayedAsDeal:!_.isNil(e.dealPrice)}},DROPDOWN_TRACKING_ID:"bookmark dropdown",EXPIRED_DEAL_TRACKING_ID:"expired deal",MODAL_TRACKING_ID:"bookmark modal",SEARCH_MODAL_TRACKING_ID:"bookmark search modal",BUTTON_TRACKING_ID:"bookmark button link",QUERY_PARAM_ID:"bookmark query param",DID_USER_PURCHASE_SKIPPED_MODAL:"bookmark skipped modal",DID_USER_PURCHASE_OWNED_MODAL:"bookmark owned modal",NAV_SEARCH_TYPEAHEAD:"search typeahead",SUGGESTED_BOOKS_CAROUSEL:"bookmark from suggested books carousel",CATEGORY_LANDING_PAGE_MOST_WISHLISTED_CAROUSEL:"bookmark from most wishlisted carousel on category landing page",WISHLIST_LANDING_PAGE_BLOG_CAROUSEL:"bookmark from blog post carousel on wishlist landing page",WISHLIST_LANDING_PAGE_MISSED_DEALS_CAROUSEL:"bookmark from missed deals carousel on wishlist landing page",WISHLIST_LANDING_PAGE_SEARCH_TYPEAHED:"wishlist landing page search typeahead",WISHLIST_LANDING_PAGE_MOST_WISHED_GRID:"bookmark from most wished in your categories grid on wishlist landing page",WISHLIST_LANDING_PAGE_CATEGORY_GROUPS:"bookmark from category groups on wishlist landing page",ONBOARDING_CATEGORY_RECOMMENDATION_CAROUSEL:"bookmark from category recommendation carousel on wishlist onboarding step"}},14611:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});class s{constructor(e,t={}){this.category="Site Conversion",this.trackingProps=_.merge({label:e},t)}pageLoad(e={}){const t=_.merge(this.trackingProps,e);bubEvents.track(this.category,"Page Load",t)}show(e={}){const t=_.merge(this.trackingProps,e);bubEvents.track(this.category,"Show",t)}signup(e,t={}){const o=_.merge(this.trackingProps,{value:e},t);bubEvents.track(this.category,"Submit",o)}dismiss(e={}){const t=_.merge(this.trackingProps,e);bubEvents.track(this.category,"Dismiss",t)}loginClick(e={}){const t=_.merge(this.trackingProps,e);bubEvents.track(this.category,"Login Click",t)}}},61825:function(e,t,o){"use strict";o.d(t,{s:function(){return a}});var s=o(79209),r=o(99082);const i={authors:PropTypes.string,authorsLinks:PropTypes.string,averageRating:PropTypes.number,bookListSlug:PropTypes.string,ratingsCount:PropTypes.number,coverUrl:PropTypes.string,dealPrice:PropTypes.string,retailPrice:PropTypes.string,id:PropTypes.number,releaseDate:PropTypes.string,slug:PropTypes.string,title:PropTypes.string,url:PropTypes.string,usersRating:PropTypes.number,recentNewRelease:PropTypes.bool,blurb:PropTypes.string,blurbDate:PropTypes.string,description:PropTypes.string,mailingCategory:s.W,userSubscribedCategory:s.W,editoriallyTaggedCategory:s.W,socialSharingDetails:r.D},a=PropTypes.shape(i)},79209:function(e,t,o){"use strict";o.d(t,{W:function(){return r}});const s={id:PropTypes.number,tagIds:PropTypes.arrayOf(PropTypes.number),seoName:PropTypes.string,displayName:PropTypes.string,internalName:PropTypes.string,dealsPagePath:PropTypes.string,categoryPagePath:PropTypes.string,description:PropTypes.string,similarCategories:PropTypes.arrayOf(PropTypes.string)},r=PropTypes.shape(s)},99082:function(e,t,o){"use strict";o.d(t,{D:function(){return r}});const s={facebook:PropTypes.shape({shareLink:PropTypes.string}),twitter:PropTypes.shape({shareLink:PropTypes.string}),pinterest:PropTypes.shape({shareLink:PropTypes.string,message:PropTypes.string,imageUrl:PropTypes.string}),email:PropTypes.shape({shareLink:PropTypes.string,message:PropTypes.string}),link:PropTypes.shape({shareLink:PropTypes.string})},r=PropTypes.shape(s)},92613:function(e,t,o){"use strict";o.d(t,{C:function(){return T}});var s=o(68697),r=o(93513),i=o(75820);const a={bookLists:o(30845).xD,bookListLoadingStores:{}},n="bookLists",l=(0,i.hp)(n,["INITIAL_BOOKS_FOR_LIST_FETCH","INITIAL_BOOKS_FOR_LIST_SUCCESS","FETCH_BOOKS_FOR_PAGE","FETCH_BOOKS_FOR_PAGE_SUCCESS","MOVED_BOOK_TO_LIST","REMOVED_BOOK_FROM_LIST","SET_ADDITIONAL_BOOK_LIST_DATA"]),p=(e,t)=>_.merge(e,{bookListLoadingStores:{[t]:{isLoadingBooks:!0}}});(0,i.fn)(n,(0,r.Uy)(((e,t)=>{switch(t.type){case l.INITIAL_BOOKS_FOR_LIST_FETCH:return p(e,t.payload.listSlug);case l.INITIAL_BOOKS_FOR_LIST_SUCCESS:return _.merge(e,{bookListLoadingStores:{[t.payload.listSlug]:{didInitialLoad:!0,isLoadingBooks:!1}}});case l.FETCH_BOOKS_FOR_PAGE:return p(e,t.payload.listSlug);case l.FETCH_BOOKS_FOR_PAGE_SUCCESS:return _.merge(e,{bookListLoadingStores:{[t.payload.listSlug]:{isLoadingBooks:!1}}});case l.MOVED_BOOK_TO_LIST:{if(t.payload.prevListSlug){const o=t.payload.prevListSlug,s=_.find(e.bookLists,{slug:o});s&&(s.collectionCount=Math.max(0,s.collectionCount-1))}const o=t.payload.newListSlug,s=_.find(e.bookLists,{slug:o});return s&&(s.collectionCount=(s.collectionCount||0)+1),e}case l.REMOVED_BOOK_FROM_LIST:{const o=t.payload.listSlug,s=_.find(e.bookLists,{slug:o});return s&&(s.collectionCount=Math.max(0,s.collectionCount-1)),e}case l.SET_ADDITIONAL_BOOK_LIST_DATA:return _.forEach(t.payload.additionalBookListData,(t=>{_.find(e.bookLists,{internalName:t.internalName}).collectionCount=t.collectionCount})),e;default:return e}}),a));const c=e=>e[n],d=(0,s.P1)(c,(e=>memoize((t=>_(e.bookLists).map("slug").includes(_.get(t,"bookListSlug")))))),u=(0,s.P1)(c,(e=>memoize((t=>_.find(e.bookLists,{slug:t}))))),h=(0,s.P1)(c,(e=>memoize((t=>_.find(e.bookLists,{slug:t}).collectionCount)))),m=(0,s.P1)(c,(e=>memoize((t=>{const o=e.bookListLoadingStores[t];return void 0!==o&&null!=o&&!!o.isLoadingBooks})))),g=(0,s.P1)(c,(e=>_(e.bookLists).map((e=>[e.internalName,e.collectionCount])).fromPairs().value())),y=(0,s.P1)(c,(e=>_.reject(e.bookLists,["internalName","skipped"]))),b=(0,s.P1)(c,(e=>_(e.bookLists).reject(["internalName","skipped"]).reject(["internalName","not_interested"]).value())),k=(0,s.P1)(c,(e=>memoize(((t,o)=>{let s=e.bookLists;t||(s=_.reject(e.bookLists,["internalName","skipped"]));const[r,i]=_.partition(s,(e=>e.slug!==o));return _.concat(i,r)})))),T={actionTypes:l,getSelector:e=>{const t={isOnList:t=>d(e)(t),getListForSlug:t=>u(e)(t),getBookCountForList:t=>h(e)(t),isListLoadingBooks:t=>m(e)(t),getBookListsWithoutSkipped:_.partial(y,e),getBookListsForApp:_.partial(b,e),getBookListsForDropdown:(t,o)=>k(e)(t,o),getBookListCountMappings:_.partial(g,e)};return{...c(e),...t}}}},84860:function(e,t,o){"use strict";o.d(t,{h:function(){return w}});var s=o(68697),r=o(93513),i=o(75820);const a="bookStories",n=(0,i.hp)(a,["RATED_BOOK","SET_ACTIVE_BOOK_ID","CLEAR_BOOK_STORIES","SET_BOOK_STORIES","SET_BOOK_STORIES_LIST","ADD_BOOK_STORIES","ADD_BOOK_STORIES_TO_LIST","SET_BOOK_STORY_CREATING","SET_BOOK_STORY_DELETING","BOOK_STORY_FAILED","BOOK_STORY_CREATED","BOOK_STORY_DELETED","SET_LOADING_MORE","SET_MORE_BOOK_STORIES_EXIST","SET_MORE_COLLECTION_BOOK_STORIES_EXIST","FOCUS_BOOK_STORY_FORM","ACTIVE_BOOK_STORY_FORM","EDITING_BOOK_STORY","BOOK_STORY_EDITED","SET_RECOMMENDATION_STEP","SET_PREVIOUS_RECOMMENDATION_STEP","SET_ACTIVE_BOOK_STORY_ID","SET_REVIEW_DATA_LOADED","BOOK_FROM_SEARCH_RESULT","UPDATING_BOOK_STORY","SET_COLLECTION_STATUS","PERMISSION_DENIED","SET_PAGINATION_DATA","SET_TIMESTAMPS"]),l={PENDING:"pending",DENIED:"denied",SEARCH:"search",LOADED:"loaded",LOADING:"loading",LOADING_MORE:"loading-more",RECOMMEND_BOOK_MODAL:"recommend-book",SEE_REVIEW:"see-review",AUTHORED_BOOKS_FEED_TYPE:"authored_books",AUTHORED_BOOKS_FEED_PAGE_SIZE:20,AUTHOR_AUTHORED_BOOKS_FEED_TYPE:"author_authored_books",SOCIAL_FEED_TYPE:"social_feed",BOOK_FEED_TYPE:"book_feed"};(0,i.fn)(a,(0,r.Uy)(((e,t)=>{switch(t.type){case n.RATED_BOOK:{const o=_.find(e.bookStories,(e=>_.get(e,"book.id")===t.payload.bookId&&e.profile.userId===t.payload.userId));return o&&(o.rating=t.payload.rating,_.merge(e.bookStoriesMap,_.keyBy([o],"id"))),e}case n.BOOK_FROM_SEARCH_RESULT:return e.bookFromSearchResult=t.payload.flag,e;case n.UPDATING_BOOK_STORY:return e.updatingBookStory=t.payload.flag,e;case n.EDITING_BOOK_STORY:return e.editingBookStory=t.payload.bookStoryId,e;case n.FOCUS_BOOK_STORY_FORM:return e.focusBookStoryForm=t.payload.flag,e;case n.ACTIVE_BOOK_STORY_FORM:return e.activeBookStoryForm=t.payload.flag,e;case n.SET_ACTIVE_BOOK_ID:return e.activeBookId=t.payload.bookId,e;case n.CLEAR_BOOK_STORIES:return e.bookStories=[],e;case n.ADD_BOOK_STORIES:return _.merge(e.bookStoriesMap,_.keyBy(t.payload.bookStories,"id")),e.bookStories=_.uniqBy(e.bookStories.concat(t.payload.bookStories),"id"),e;case n.ADD_BOOK_STORIES_TO_LIST:{const o=t.payload.listType,s=t.payload.bookStories;return _.merge(e.bookStoriesMap,_.keyBy(s,"id")),e.bookStories=_.uniqBy(e.bookStories.concat(s),"id"),e.bookStoriesListsMap[o]=_.union(e.bookStoriesListsMap[o],_.map(s,"id")),e}case n.SET_BOOK_STORIES:return _.merge(e.bookStoriesMap,_.keyBy(t.payload.bookStories,"id")),e.bookStories=t.payload.bookStories,e;case n.SET_BOOK_STORIES_LIST:{const o=t.payload.listType,s=t.payload.bookStories;return _.merge(e.bookStoriesMap,_.keyBy(s,"id")),e.bookStoriesListsMap[o]=_.map(s,"id"),e}case n.SET_BOOK_STORY_CREATING:return e.pendingCreates[t.payload.bookId||0]=l.PENDING,e;case n.SET_BOOK_STORY_DELETING:return e.pendingDeletes[t.payload.bookStoryId]=l.PENDING,e;case n.BOOK_STORY_FAILED:return _.unset(e,["pendingCreates",t.payload.bookId||0]),e;case n.BOOK_STORY_CREATED:{const o=t.payload.bookStory;return _.unset(e,["pendingCreates",o.bookId||0]),_.merge(e.bookStoriesMap,_.keyBy([o],"id")),e.bookStories.unshift(o),e}case n.BOOK_STORY_DELETED:{const o=t.payload.bookStoryId;return _.unset(e,["pendingDeletes",o]),_.unset(e,["bookStoriesMap",o]),e.deletedBookStoryIds=e.deletedBookStoryIds.concat(o),e.bookStories=_.reject(e.bookStories,(e=>e.id===o)),e}case n.BOOK_STORY_EDITED:{const o=_.find(e.bookStories,{bookStoryCommentId:t.payload.id});return o.text=t.payload.text,o.editedAt=t.payload.editedAt,o.profileMentions=t.payload.profileMentions,o.bookMentions=t.payload.bookMentions,_.merge(e.bookStoriesMap,_.keyBy([o],"id")),e}case n.SET_LOADING_MORE:return e.isLoadingMoreBookStories=t.payload.loadingMore,e;case n.SET_MORE_BOOK_STORIES_EXIST:return e.moreBookStoriesExist=t.payload.hasMoreBookStories,e;case n.SET_MORE_COLLECTION_BOOK_STORIES_EXIST:return e.moreCollectionBookStoriesExist[t.payload.listType]=t.payload.hasMoreBookStories,e;case n.SET_RECOMMENDATION_STEP:return e.recommendationStep!==t.payload.step&&"search"!==e.recommendationStep&&(e.previousRecommendationStep=e.recommendationStep),e.recommendationStep=t.payload.step,e;case n.SET_PREVIOUS_RECOMMENDATION_STEP:return e.previousRecommendationStep=t.payload.step,e;case n.SET_ACTIVE_BOOK_STORY_ID:return e.activeBookStoryId=t.payload.bookStoryId,e;case n.SET_REVIEW_DATA_LOADED:return e.reviewDataLoaded=t.payload.flag,e;case n.SET_COLLECTION_STATUS:return e.collectionStatus[t.payload.feedType]=t.payload.status,e;case n.PERMISSION_DENIED:return e.permissionStatus[t.payload.bookId]=l.DENIED,e;case n.SET_PAGINATION_DATA:return e.currentPage=t.payload.page,e.hasMoreBookStories=t.payload.hasMoreBookStories,e;case n.SET_TIMESTAMPS:return e.mostRecentDealRecTimestamp=t.payload.mostRecentDealRecTimestamp,e;default:return e}}),{bookStoriesMap:{},bookStoriesListsMap:{},bookStories:[],pendingCreates:{},pendingDeletes:{},deletedBookStoryIds:[],collectionStatus:{},moreCollectionBookStoriesExist:{},activeBookId:null,focusBookStoryForm:null,activeBookStoryForm:null,editingBookStory:null,isLoadingMoreBookStories:!1,recommendationStep:"search",previousRecommendationStep:null,activeBookStoryId:null,reviewDataLoaded:!1,bookFromSearchResult:!1,updatingBookStory:!1,permissionStatus:{}}));const p=e=>e[a],c=(0,s.P1)(p,(e=>memoize((t=>e.editingBookStory===t)))),d=(0,s.P1)(p,(e=>memoize((t=>_.map(t,(t=>e.bookStoriesMap[t])))))),u=(0,s.P1)((e=>p(e).bookStoriesListsMap),(e=>memoize((t=>e[t])))),h=(0,s.P1)((e=>p(e).bookStoriesListsMap),(e=>p(e).bookStoriesMap),((e,t)=>memoize((o=>_(e[o]).map((e=>t[e])).compact().uniqBy("id").value())))),m=(0,s.P1)(h,(e=>memoize(((t,o)=>_.reject(e(t),{profile:{userId:o}}))))),g=(0,s.P1)(p,(e=>memoize((t=>_.get(e.moreCollectionBookStoriesExist,t)||!1)))),y=(0,s.P1)(p,(e=>memoize((t=>e.pendingCreates[t.bookId||0]||e.pendingDeletes[t.bookStoryId])))),b=(0,s.P1)(p,(e=>memoize((t=>e.activeBookStoryLike===t)))),k=(0,s.P1)(p,(e=>_.uniqBy(e.bookStories,"id"))),T=(0,s.P1)(p,(e=>_.map(_.uniqBy(e.bookStories,"id"),"id"))),S=(0,s.P1)(p,(e=>memoize((t=>_(e.bookStories).uniqBy("id").partition((e=>e.profile.userId===t)).flatten().value())))),f=(0,s.P1)(p,(e=>memoize((t=>e.bookStoryLikesMap[t])))),E=(0,s.P1)(p,(e=>memoize((t=>_.filter(e.bookStories,(e=>e.profile.userId===t)))))),R=(0,s.P1)(p,(e=>memoize((t=>e.collectionStatus[t]===l.LOADED)))),P=(0,s.P1)(p,(e=>memoize((t=>e.collectionStatus[t]===l.LOADING_MORE)))),C=(0,s.P1)(p,(e=>memoize((t=>e.collectionStatus[t]===l.LOADING)))),I=(0,s.P1)(p,(e=>memoize((t=>e.permissionStatus[t]!==l.DENIED)))),O=(0,s.P1)(p,(e=>memoize((t=>_.includes(e.deletedBookStoryIds,t))))),v=(0,s.P1)(p,(e=>memoize((t=>e.bookStoriesMap[t])))),B=(0,s.P1)(h,(e=>memoize(((t,o)=>_.take(_.uniqBy(e(t),"profile.id"),o))))),w=_.merge({actionTypes:n,getSelector:e=>{const t={isEditingBookStory:t=>c(e)(t),getBookStoriesForIds:t=>d(e)(t),getBookStoriesList:t=>h(e)(t),getBookStoryIdsList:t=>u(e)(t),doMoreCollectionBookStoriesExist:t=>g(e)(t),getBookStoryState:t=>y(e)(t),isActiveBookStoryLike:t=>b(e)(t),getUserSortedBookStories:t=>S(e)(t),getBookStoryLikes:t=>f(e)(t),getBookStoriesForUser:t=>E(e)(t),isCollectionLoaded:t=>R(e)(t),isCollectionLoadingMore:t=>P(e)(t),isCollectionLoading:t=>C(e)(t),getPermission:t=>I(e)(t),getBookStoryDeleted:t=>O(e)(t),getBookStories:_.partial(k,e),getBookStoriesIds:_.partial(T,e),getBookStoryForId:t=>v(e)(t),getOtherUserBookStories:(t,o)=>m(e)(t,o),getBookStoriesWithUniqueProfiles:(t,o)=>B(e)(t,o)};return{...p(e),...t}}},l)},31563:function(e,t,o){"use strict";o.d(t,{G:function(){return B}});var s=o(68697),r=o(93513),i=o(75820);const a="books",n=(0,i.hp)(a,["ADD_AVAILABILITIES","ADD_BOOKS","ADD_AUTHOR_BOOKS","APPEND_BOOK","MOVED_BOOK_TO_LIST","RATED_BOOK","REMOVED_BOOK_FROM_LIST","SET_ACTIVE_BOOK_ID","SET_AUTHOR_BOOKS_IDS","SET_LOADING","SET_AUTHOR_BOOKS_STATUS","SET_RATING_STATE"]),l=function(e,t){if(_.isArray(e))return t};(0,i.fn)(a,(0,r.Uy)(((e,t)=>{switch(t.type){case n.ADD_AVAILABILITIES:{const o=e.books[t.payload.bookId];return o.availabilities=t.payload.availabilities,o.availabilitiesLoaded=!0,e}case n.ADD_BOOKS:return e.booksOrdered=e.booksOrdered.concat(t.payload.books),_.mergeWith(e.books,_.keyBy(t.payload.books,"id"),l),_.merge(e.ratingState,_.keyBy(_.filter(t.payload.books,"usersRating"),"id")),_.forEach(t.payload.books,(t=>{delete e.books[t.id].status})),e;case n.ADD_AUTHOR_BOOKS:return e.authorsBooks[t.payload.id]=_.union(e.authorsBooks[t.payload.id],_.map(t.payload.books,"id")),e;case n.APPEND_BOOK:return o=[...e.booksOrdered,t.payload.book],s=t.payload.book.page_number,o.booksOrdered=_.map(s,(e=>_.merge(e,{page:undefined}))),o.books=_.keyBy(o.booksOrdered,"id"),e;case n.MOVED_BOOK_TO_LIST:{const o=e.books[t.payload.bookId];return void 0===o||(o.bookListSlug=t.payload.newListSlug,o.status="updated"),e}case n.RATED_BOOK:{const o=e.books[t.payload.bookId]||e.removedBooks[t.payload.bookId];return o?(0===t.payload.rating?o.usersRating=null:o.usersRating=t.payload.rating,o.status="updated",e):e}case n.REMOVED_BOOK_FROM_LIST:{const o=e.books[t.payload.bookId];return o?(o.bookListSlug=null,o.status="removed",e):e}case n.SET_ACTIVE_BOOK_ID:return _.assignIn(e,{activeBookId:t.payload.bookId});case n.SET_AUTHOR_BOOKS_IDS:return _.assignIn(e,{authorsBooks:{[t.payload.id]:t.payload.bookIds}});case n.SET_LOADING:return _.merge(e,{books:{[t.payload.bookId]:{status:t.payload.status}}});case n.SET_AUTHOR_BOOKS_STATUS:return _.assignIn(e,{authorBooksStatus:_.merge(e.authorsBooksStatus,_.keyBy([t.payload.data],"id"))});case n.SET_RATING_STATE:return _.assignIn(e,{ratingState:{[t.payload.book.id]:t.payload.book}});default:return e}var o,s}),{activeBookId:null,activeDealsModal:null,books:{},booksOrdered:[],ratingState:{},removedBooks:{},authorsBooks:{},authorsBooksStatus:{}}));const p=e=>e[a],c=(0,s.P1)(p,(e=>memoize((t=>e.books[t]||e.removedBooks[t])))),d=(0,s.P1)(p,(e=>memoize((t=>_.find(e.books,{slug:t}))))),u=(0,s.P1)(p,(e=>memoize((t=>_.find(e.books,(e=>e.slug===t||e.requestedSlug===t)))))),h=(0,s.P1)((e=>p(e).books),(e=>memoize((t=>_.at(e,t))))),m=(0,s.P1)(p,(e=>memoize((t=>{const o=_.keyBy(_.filter(e.books,(e=>e.bookListSlug===t)),"id");return _.filter(e.booksOrdered,(e=>o[e.id]))})))),g=(0,s.P1)(p,(e=>_.values(e.books))),y=(0,s.P1)(p,(e=>_(e.books).keys().map(_.toInteger).value())),b=(0,s.P1)(p,(e=>memoize((t=>e.authorsBooks[t]||[])))),k=(0,s.P1)(p,(e=>memoize((t=>_.get(e.authorsBooksStatus,`[${t}].hasMore`,!1))))),T=(0,s.P1)(p,(e=>memoize((t=>_.get(e.authorsBooksStatus,`[${t}].isLoading`,!1))))),S=(0,s.P1)(p,(e=>memoize((t=>_.get(e.authorsBooksStatus,`[${t}].page`,0))))),f=(0,s.P1)(p,(e=>memoize((t=>_.get(e.authorsBooksStatus,`[${t}].sortBy`,null))))),E=(0,s.P1)(p,h,((e,t)=>memoize((e=>{const o=t(e);return _.map(o,(e=>({display:`${e.title} by ${e.authors}`,type:"book",id:String(e.id)})))})))),R=(0,s.P1)(p,(e=>memoize((t=>!!t&&"updating"===_.get(e.books,`[${t.id}].status`))))),P=(0,s.P1)(p,(e=>memoize((t=>!!t&&"removing"===_.get(e.books,`[${t.id}].status`))))),C=(0,s.P1)(p,h,((e,t)=>memoize(((e,o)=>{const s=_.filter(t(e),"dealPrice");return o?_.take(s,o):s})))),I=(0,s.P1)(p,h,((e,t)=>memoize(((e,o)=>{const s=_.filter(t(e),["dealPrice",null]);return o?_.take(s,o):s})))),O=(0,s.P1)(p,C,((e,t)=>memoize((e=>_.size(t(e)))))),v=(0,s.P1)((e=>p(e).ratingState),(e=>memoize((t=>e[t])))),B={actionTypes:n,getSelector:e=>{const t={getBookForId:t=>c(e)(t),getBookForSlug:t=>d(e)(t),getBookForRequestedSlug:t=>u(e)(t),getBooks:_.partial(g,e),getBookIds:_.partial(y,e),getBooksForAuthor:t=>b(e)(t),getBooksForIds:t=>h(e)(t),getBooksForList:t=>m(e)(t),getDealsForIds:(t,o)=>C(e)(t,o),getNonDealsForIds:(t,o)=>I(e)(t,o),getTotalDealCountForIds:t=>O(e)(t),getAuthorBooksHasMore:t=>k(e)(t),getAuthorBooksIsLoading:t=>T(e)(t),getAuthorBooksPage:t=>S(e)(t),getAuthorBooksSortBy:t=>f(e)(t),getSuggestions:t=>E(e)(t),isRemoving:t=>P(e)(t),hasRated:t=>v(e)(t),isUpdating:t=>R(e)(t)};return{...p(e),...t}}}},55278:function(e,t,o){"use strict";o.d(t,{L:function(){return p}});var s=o(93513),r=o(75820);const i={authenticityToken:o(9971).I.csrfToken(),errorMessages:null,isAuthenticated:!1,isSubmitted:!1,settingsLinks:null},a="bubAuth",n=(0,r.hp)(a,["AUTHENTICATE_ERROR","AUTHENTICATE_SUCCESS","RESET_ERROR","SET_AUTHENTICITY_TOKEN","SET_IS_AUTHENTICATED","SET_IS_SUBMITTED","USER_AUTHENTICATED"]);(0,r.fn)(a,(0,s.Uy)(((e,t)=>{switch(t.type){case n.AUTHENTICATE_ERROR:{const o=_.isArray(t.payload.error)?t.payload.error:[t.payload.error];return _.assignIn(e,{errorMessages:o,isAuthenticated:!1,isSubmitted:!1})}case n.AUTHENTICATE_SUCCESS:return _.assignIn(e,{errorMessages:null,isAuthenticated:!0,isSubmitted:!1});case n.RESET_ERROR:return _.assignIn(e,{errorMessages:null});case n.SET_AUTHENTICITY_TOKEN:return _.assignIn(e,{authenticityToken:t.payload.token});case n.SET_IS_AUTHENTICATED:return _.assignIn(e,{isAuthenticated:t.payload.isAuthenticated});case n.SET_IS_SUBMITTED:return _.assignIn(e,{isSubmitted:t.payload.isSubmitted});default:return e}}),i));const l=e=>e[a],p={actionTypes:n,getSelector:e=>({...l(e)})}},53593:function(e,t,o){"use strict";o.d(t,{_:function(){return l}});var s=o(93513),r=o(75820);const i="flashMessage",a=(0,r.hp)(i,["SET_MESSAGES","REMOVE_MESSAGE"]);(0,r.fn)(i,(0,s.Uy)(((e,t)=>{switch(t.type){case a.SET_MESSAGES:return _.assignIn(e,{messages:t.payload.messages});case a.REMOVE_MESSAGE:return e.messages=_.filter(e.messages,((e,o)=>o!==t.payload.index)),e;default:return e}}),{messages:[]}));const n=e=>e[i],l={actionTypes:a,getSelector:e=>({...n(e)})}},5449:function(e,t,o){"use strict";o.d(t,{c:function(){return m}});var s=o(68697),r=o(93513),i=o(75820);const a="form",n=(0,i.hp)(a,["FORM_CHANGED","CLEAR_FORM","SET_FORM_STATE","SET_VALIDATION_SETTINGS","VALIDATE_FORM","VALIDATE_AND_TOUCH_ALL_INPUTS","SET_ERROR_MESSAGE"]),l=function(e,t){const o=function(e,t){const o=e.validationSettings[t]||{},s={};return _.forEach(o,((e,t)=>{s[t]={}})),_.merge(e,{formDataHash:{[t]:s}})}(e,t);let s=!0;const r=function(e,t){const o=e.formDataHash[t];let s={};return _.forEach(o,((e,t)=>{s=_.assignIn(s,{[t]:_.assignIn(_.omit(e,["errorMessages"]),{errorMessages:[]})})})),_.assignIn(e,{formDataHash:_.assignIn(_.omit(e.formDataHash,t),{[t]:s})})}(o,t),i=r.validationSettings[t]||{};let a=r.formDataHash[t];return _.forEach(a,((e,t)=>{const o=i[t],r=[];_.forEach(o,(t=>{t.validator(e,t)||(s=!1,r.push(t.errorMessage))})),a=_.assignIn(a,{[t]:_.assignIn(_.omit(e,"errorMessages"),{errorMessages:r})})})),_.merge(r,{isValid:{[t]:s},formDataHash:{[t]:a}})};(0,i.fn)(a,(0,r.Uy)(((e,t)=>{let o,s,r;switch((0,i.zj)(a,t.type)&&(o=_.get(t.payload,"form_input_id")||_.get(t.payload,"formId")||e.formId,s=_.get(t.payload,"formData")||_.get(t.payload,"form_data")||t.payload,r=_.get(s,o)||s),t.type){case n.FORM_CHANGED:return l(_.merge(e,{formDataHash:{[o]:{[r.name]:{errorMessages:[],hasChanged:!0,mentions:r.mentions,validationData:r.validationData,value:r.value}}}}),o);case n.CLEAR_FORM:return _.assignIn(e,{formDataHash:_.omit(e.formDataHash,o),isValid:_.omit(e.isValid,o)});case n.SET_FORM_STATE:{let t={};return _.forEach(r,((e,o)=>{t=_.merge(t,{[o]:{value:e}})})),l(_.merge(e,{formDataHash:{[o]:t}}),o)}case n.SET_VALIDATION_SETTINGS:return _.merge(e,{validationSettings:{[o]:r}});case n.VALIDATE_FORM:return l(e,o);case n.VALIDATE_AND_TOUCH_ALL_INPUTS:return function(e,t){const o=e.formDataHash[t];let s={};return _.forEach(o,((e,t)=>{s=_.assignIn(s,{[t]:_.assignIn(_.omit(e,"hasChanged"),{hasChanged:!0})})})),_.assignIn(e,{formDataHash:_.assignIn(_.omit(e.formDataHash,t),{[t]:s})})}(l(e,o),o);case n.SET_ERROR_MESSAGE:return _.merge(_.omit(e,[["formDataHash",o,r.name,"errorMessages"]]),{formDataHash:{[o]:{[r.name]:{errorMessages:[r.errorMessage]}}}});default:return e}}),{formId:"default",formDataHash:{default:{}},isValid:{default:!0},validationSettings:{}}));const p=e=>e[a],c=(0,s.P1)(p,(e=>memoize((t=>{const o=t||e.formId;return _.size(e.validationSettings[o])>0})))),d=(0,s.P1)(p,(e=>memoize((t=>{const o=t||e.formId;return e.formDataHash[o]})))),u=(0,s.P1)(p,(e=>memoize((t=>{const o=t||e.formId;return _.omit(_.mapValues(e.formDataHash[o],"value"),_.isUndefined)})))),h=(0,s.P1)(p,(e=>memoize((t=>{const o=t||e.formId;return e.isValid[o]})))),m={actionTypes:n,getSelector:e=>{const t={getHasValidationSettings:t=>c(e)(t),getFormData:t=>d(e)(t),getFormValues:t=>u(e)(t),getIsValid:t=>h(e)(t)};return{...p(e),...t}}}},49065:function(e,t,o){"use strict";o.d(t,{t:function(){return u}});var s=o(68697),r=o(93513),i=o(75820);const a="mentions",n=(0,i.hp)(a,["ADD_BOOK_MENTION","CLEAR_BOOK_MENTIONS","FEATURE_BOOK_MENTION","REMOVE_FEATURED_BOOK_MENTION","SHOW_MENTION_MODAL","SET_ACTIVE_MENTION_MODAL","HIDE_MENTION_MODAL","SET_CURSOR_INDEX","SET_SELECTED_PROFILE_ID"]),l=function(e,t){const o=e.bookMentions[t.formId]||[],s=0===o.length?t.id:e.featuredBookMentionId[t.formId];return _.merge(e,{selectedBookId:t.id,bookMentions:{[t.formId]:_.concat([t.id],o)},featuredBookMentionId:{[t.formId]:s}})};(0,i.fn)(a,(0,r.Uy)(((e,t)=>{switch(t.type){case n.ADD_BOOK_MENTION:return l(e,t.payload);case n.CLEAR_BOOK_MENTIONS:return _.unset(e,["bookMentions",t.payload.formId]),e;case n.FEATURE_BOOK_MENTION:return _.merge(l(e,t.payload),{featuredBookMentionId:{[t.payload.formId]:t.payload.id}});case n.REMOVE_FEATURED_BOOK_MENTION:return _.unset(e,["featuredBookMentionId",t.payload.formId]),e;case n.SHOW_MENTION_MODAL:return _.merge(e,{mentionType:t.payload.mentionType});case n.SET_ACTIVE_MENTION_MODAL:return _.merge(e,{activeMentionModal:t.payload.id});case n.HIDE_MENTION_MODAL:return _.set(e,["mentionType"],null);case n.SET_CURSOR_INDEX:return _.merge(e,{cursorIndex:t.payload.index});case n.SET_SELECTED_PROFILE_ID:return _.merge(e,{selectedProfileId:t.payload.profileId});default:return e}}),{bookMentions:{},featuredBookMentionId:{},mentionType:null,cursorIndex:0,selectedProfileId:null,selectedBookId:null}));const p=e=>e[a],c=(0,s.P1)(p,(e=>void 0!==e.mentionType&&null!=e.mentionType)),d=(0,s.P1)(p,(e=>memoize((t=>e.featuredBookMentionId[t])))),u={actionTypes:n,getSelector:e=>{const t={showMentionModal:_.partial(c,e),getFeaturedBookMentionId:t=>d(e)(t)};return{...p(e),...t}},PROFILE_MODAL:"profileModal",BOOK_MODAL:"bookModal",BOOK_MENTION_TRAINING:"bookMentionTraining"}},92694:function(e,t,o){"use strict";o.d(t,{N:function(){return d}});var s=o(68697),r=o(93513),i=o(75820);const a="notificationViews",n=(0,i.hp)(a,["SHOW_NOTIFICATION","NOTIFICATION_VIEWED","NOTIFICATION_LOADED"]);(0,i.fn)(a,(0,r.Uy)(((e,t)=>{switch(t.type){case n.SHOW_NOTIFICATION:return _.merge(e,{showNotifications:e.showNotifications.concat([t.payload.id])});case n.NOTIFICATION_VIEWED:return _.set(e,"showNotifications",_.without(e.showNotifications,t.payload.id));case n.NOTIFICATION_LOADED:return _.merge(e,{loadedNotifications:{[t.payload.id]:!0}});default:return e}}),{showNotifications:[],loadedNotifications:{}}));const l=e=>e[a],p=(0,s.P1)(l,(e=>memoize((t=>_.includes(e.showNotifications,t))))),c=(0,s.P1)(l,(e=>memoize((t=>e.loadedNotifications[t])))),d={actionTypes:n,getSelector:e=>{const t={showNotification:t=>p(e)(t),notificationLoaded:t=>c(e)(t)};return{...l(e),...t}}}},91013:function(e,t,o){"use strict";o.d(t,{I:function(){return l}});var s=o(93513),r=o(75820);const i="overlay",a=(0,r.hp)(i,["SET","SHOW","HIDE"]);(0,r.fn)(i,(0,s.Uy)(((e,t)=>{switch(t.type){case a.SET:return _.assignIn(e,{component:t.payload.data,isFullWidth:_.get(t.payload.data.propsToRenderWith,"isFullWidth",!1)});case a.SHOW:return bubEvents.track("Modal","Open",{label:`${e.component.trackingName}`,value:_.get(e.component,"propsToRenderWith.formId")}),_.assignIn(e,{show:!!t.payload.force||!e.show});case a.HIDE:return e.show?(bubEvents.track("Modal","Close",{label:`${e.component.trackingName}`,value:_.get(e.component,"propsToRenderWith.formId")}),_.assignIn(e,{show:!e.show,isFullWidth:!1})):e;default:return e}}),{component:null,show:!1,isFullWidth:!1}));const n=e=>e[i],l={actionTypes:a,getSelector:e=>({...n(e)})}},36289:function(e,t,o){"use strict";o.d(t,{t:function(){return h}});var s=o(68697),r=o(93513),i=o(75820);const a="suggestions",n=(0,i.hp)(a,["ADD_SUGGESTION_COLLECTION","APPEND_SUGGESTION_COLLECTION","SET_SEARCH_QUERY","SET_COLLECTION_STATUS"]);(0,i.fn)(a,(0,r.Uy)(((e,t)=>{switch(t.type){case n.ADD_SUGGESTION_COLLECTION:{const o=_.keys(t.payload)[0],s=_.values(t.payload)[0];return _.merge(e,{searchCollection:{[o]:s}})}case n.APPEND_SUGGESTION_COLLECTION:return _.merge(e,{searchCollection:{[t.payload.relationType]:t.payload.bookIds}});case n.SET_SEARCH_QUERY:return _.merge(e,{searchQuery:t.payload.query});case n.SET_COLLECTION_STATUS:return _.merge(e,{collectionStatus:t.payload.collectionStatus});default:return e}}),{collectionStatus:{},searchQuery:null,searchCollection:{}}));const l=e=>e[a],p=(0,s.P1)(l,(e=>memoize((t=>e.searchCollection[t]||[])))),c=(0,s.P1)(l,(e=>memoize((t=>"failed"===e.collectionStatus[t])))),d=(0,s.P1)(l,(e=>memoize((t=>"loaded"===e.collectionStatus[t])))),u=(0,s.P1)(l,(e=>memoize((t=>"loading"===e.collectionStatus[t])))),h={actionTypes:n,getSelector:e=>{const t={getSuggestionCollection:t=>p(e)(t),isCollectionFailed:t=>c(e)(t),isCollectionLoaded:t=>d(e)(t),isCollectionLoading:t=>u(e)(t)};return{...l(e),...t}}}},53893:function(e,t,o){"use strict";o.d(t,{S:function(){return r}});var s=o(71407);const r={fetchAuthorsForBook({bookId:e}){return(0,s.t)({url:`/book_page_api/books/${e}/authors`,method:"GET"})},getAuthorsBooks(e){return(0,s.t)({url:this._path(`${e.authorId}/books.json`),data:{page:e.page,sort_by:e.sortBy}})},getAuthorsSearchableOptions(e){return(0,s.t)({url:this._path("searchable_options"),data:{term:e}})},removeAuthorSuggestion(e){return(0,s.t)({url:`/settings/authors/${e}/remove_suggestion`,method:"PUT"})},similarAuthors(e){return(0,s.t)({url:this._path(`${e}/similar_authors.json`)})},loadPreviouslyUsedAuthors(e){return(0,s.t)({url:this._path("previously_used"),method:"GET",data:{lookback_days:e}})},loadAuthors(e){return(0,s.t)({url:this._path("bulk_show"),method:"GET",data:{ids:e}})},loadRelatedAuthors(e,t,o){return(0,s.t)({url:this._path("related"),method:"GET",data:{book_id:e,prev_targets:t,chosen_targets:o}})},_path(e){return`/authors/${e}`}}},48049:function(e,t,o){"use strict";o.d(t,{$:function(){return r}});var s=o(71407);const r={initBookmarks(e,t=!1){return(0,s.t)({url:this._path("init.json"),data:{list:e.list,page:e.page||1,sort:e.sort,show_book_availabilities:t}})},fetchBooksForPage(e){return(0,s.t)({url:this._path("get-books.json"),data:{list_slug:e.list_slug,page:e.page,sort:e.sort}})},getUncategorizedBooks(e){return(0,s.t)({url:this._path("get_uncategorized_books"),data:{page:e.page}})},getBooks(e){return(0,s.t)({url:this._path("get-books.json"),data:{book_ids:e.bookIds,list_slug:e.listSlug}})},removeBook(e){return(0,s.t)({method:"POST",url:this._path("remove-book"),data:{book_id:e.bookId,list_slug:e.listSlug,page_number:e.pageNumber}})},moveBookToList(e){return(0,s.t)({method:"POST",url:this._path("move-book"),data:{book_id:e.bookId,from_list:e.fromList,list_slug:e.listSlug,reference:e.reference,page_number:e.pageNumber}})},moveBooksToList(e){return(0,s.t)({method:"POST",url:this._path("move-books"),data:{book_ids:e.bookIds,list_slug:e.listSlug}})},fetchNextBookForPage(e,t){return(0,s.t)({url:this._path(`list/${e}/page/${t}/next_book`)})},_path(e){return`/bookmarks/${e}`}}},71407:function(e,t,o){"use strict";o.d(t,{t:function(){return n}});var s=o(57632),r=o(15176),i=o(92204),a=o(55093);window.ajaxCallStack=[],window.printAjaxCallStack=()=>window.ajaxCallStack.join("\n"),window.ajaxRequests={};const n=e=>{const t=a.x.queryParams;if("region_f"in t){const o=e.data&&"region_f"in e.data?e.data.region_f:t.region_f;e.data=_.merge({},e.data,{region_f:o})}const o=e.headers||{};e.headers=_.merge(o,{"X-Requested-With":"XMLHttpRequest"});const n=JSON.stringify(e),l=(0,s.Z)();let p;return window.ajaxCallStack.push(n),window.ajaxRequests[l]=n,p=window.killAjax&&"test"===window.bubEnv?new r.ZP.Promise(_.noop):(0,i.a)((()=>$.ajax(e)),l),p}},74718:function(e,t,o){"use strict";o.d(t,{c:function(){return s}});const s={matchesXs(){return window.matchMedia("(max-width: 767px)").matches},matchesSm(){return window.matchMedia("(max-width: 991px)").matches},matchesMd(){return window.matchMedia("(max-width: 1199px)").matches},matchesLg(){return window.matchMedia("(max-width: 5000px)").matches}}},49987:function(e,t,o){"use strict";o.d(t,{a:function(){return s}});const s={getOptimizedImage:(e,t=null,o=!0)=>{const s=["https://bookbub-res.cloudinary.com/image/upload"],r=[];return o&&r.push(["q_auto","f_auto"]),t&&r.push(t),_.isEmpty(r)||s.push(_.join(r,",")),_.join(_.concat(s,e),"/")},getCloudinarySlug:e=>{const t=e.match(/https?:\/\/(?:bookbub-)?res.cloudinary.com\/(?:bookbub\/)?image\/upload\/(?:.*\/)?(v\d+\/.*)/);return t?t[1]:null}}},38047:function(e,t,o){"use strict";o.d(t,{J:function(){return s}});const s={fixedAspectRatio:(e,t,o=1)=>{if(!_.includes(e,"cloudinary"))return e;const s=e.split("/"),r=t?`,c_scale,w_${t}`:"";return s[_.indexOf(s,"upload")+1]=`t_ci_ar_6:9_padded,f_auto,q_auto,dpr_${o}${r}`,s.join("/")}}},9971:function(e,t,o){"use strict";o.d(t,{I:function(){return s}});const s=new class{constructor(){const e=$("#user-store-data").attr("data")||JSON.stringify({}),t=$("#affiliate-data").attr("data")||JSON.stringify({});this.userStoreData=JSON.parse(e),this.pageAffiliate=JSON.parse(t),this.token=$('meta[name="csrf-token"]').attr("content"),this.settings={}}bookDataEnabled(){return this.getFeatures().bookDataEnabled}isBookDataEnabledForCountry(e){return"us"===e}captchaSitekey(){return _.get(this.getUserStoreData().captcha,"sitekey","")}captchaV3Sitekey(){return _.get(this.getUserStoreData().captchaV3,"sitekey","")}countryCodeIsUs(){return"us"===_.get(this.getUser(),"countryCode")}csrfToken(){return this.token}currentUserId(){return this.currentUserExists()?this.getUser().userId:null}currentUserEmailAddress(){return this.currentUserExists()?this.getUser().emailAddress:null}currentUserExists(){return!_.isNil(this.getUser())}getAffiliateData(){return _.isEmpty(this.getUserStoreData().affiliate)?this.pageAffiliate:this.getUserStoreData().affiliate}getCountryCode(){return _.get(this.getUser(),"countryCode")}getSignupRegion(){return _.get(this.getUser(),"signupRegion")}getFeatures(){return this.getUserStoreData().features||{}}getPartner(){return this.getUserStoreData().partner}getInactivePartner(){return this.getUserStoreData().inactivePartner}getRegionId(){return _.get(this.getUser(),"regionId")}getRetailerIds(){return _.get(this.getUser(),"retailerIds")}getSetting(e){return void 0!==this.settings[e]&&null!=this.settings[e]||(this.settings[e]=_.get(this.getUserStoreData().userSettings,e)),this.settings[e]}getUser(){return this.getUserStoreData().user}getUserStoreData(){return this.userStoreData}hasAccount(){return _.get(this.getUserStoreData(),"user.hasAccount",!1)}isAuthed(){return this.currentUserExists()&&(this.isLoggedInWithPassword()||this.isTokened())}isLoggedInUser(e){return!_.isNil(this.currentUserId())&&e===this.currentUserId()}isLoggedInWithPassword(){return!!this.currentUserExists()&&this.getUser().loggedIn}isTokened(){return this.getUser().tokened}signedUpRecently(){return _.get(this.getUserStoreData(),"user.signedUpRecently",!1)}showCaptcha(e,t){if("v3"===e)return _.get(this.getUserStoreData().captchaV3,"show",!1);const o=_.get(this.getUserStoreData().captcha,"show",!1),s=_.get(this.getUserStoreData().captcha,"endpoints",[]);return o&&_.includes(s,t)}}},88485:function(e,t,o){"use strict";o.d(t,{F:function(){return s}});const s=(e,t)=>{const o=window.location.hostname,s=window.location.protocol,r=window.location.port;let i=`${s}\\\\${e}.${o.split(".").slice(1).join(".")}`;return r&&(i=`${i}:${r}`),`${i}${t}`}},92204:function(e,t,o){"use strict";o.d(t,{a:function(){return r}});var s=o(15176);const r=(e,t)=>new s.ZP.Promise(((o,s)=>{if(window.randomAjaxDelays&&"production"!==window.bubEnv)return _.delay((()=>{const r=e();return r?r.then(o,(e=>s(_.merge(e,{requestId:t})))):null}),500*Math.random()+200);const r=e();return r?r.then(o,(e=>s(_.merge(e,{requestId:t})))):null}));void 0===window.rsvpErrorHandlerRegistered&&(s.ZP.on("error",(e=>{if(window.silenceAjaxErrors)return;if(403===e.status)return;const t=window.ajaxRequests[e.requestId];"error"===$.type(e)?"test"!==window.bubEnv&&(e=e.stack):e=JSON.stringify(e),e=`message: ${e} \n\n request: ${t}`,console.error(e)})),window.rsvpErrorHandlerRegistered=!0)},65123:function(e,t,o){"use strict";o.d(t,{R:function(){return s}});const s={ENTER:13,SPACE_BAR:32,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40}},55093:function(e,t,o){"use strict";o.d(t,{x:function(){return i}});var s=o(55648),r=o(17563);const i=new class{constructor(){this.history=this.createHistory(),this.unlisteners=[]}get queryParams(){return this.getQueryParams()}getQueryParams(){return r.parse(this.queryString)}get queryString(){return this.history.location.search}get path(){return this.history.location.pathname}get hash(){return this.history.location.hash}get protocol(){return window.location.protocol}get hostname(){return window.location.hostname}routeParams(e){return e.match(this.path)||{}}listen(e){const t=this.history.listen(e);return this.unlisteners.push(t),t}unlistenAll(){this.unlisteners.forEach((e=>e())),this.unlisteners=[]}reset(){this.unlistenAll(),this.history=this.createHistory()}assign(e){window.location.assign(e)}locationHash(){return this.hash}createHistory(){return(0,s.lX)()}previousInternalPath(){let e=null,t=document.referrer;return t&&(t=new URL(t),this.path!==t.pathname&&this.hostname===t.hostname&&(e=t.pathname)),e}getPageFromQuery(){const e=this.queryParams||{};return e?(e.page=_.parseInt(e.page),_.isFinite(e.page)||(e.page=1)):e.page=1,e.page}updateQueryParam(e,t){const o=this.queryParams||{};return o[e]=t,this.history.replace(`${this.path}?${r.stringify(o,{arrayFormat:"comma"})}`)}removeQueryParam(e){const t=this.queryParams||{};_.has(t,e)&&(_.unset(t,e),this.history.replace(`${this.path}?${r.stringify(t)}`))}appNavigate(e){this.recordScrollPosition(),this.history.push(e)}appBack(){window.history.length<=1?this.history.push("/webview/home"):this.history.back()}recordScrollPosition(){this.history.replace(this.history.location,{scrollPosition:window.scrollY})}getPreviousScrollPosition(){return(this.history.location.state||{}).scrollPosition}}},29908:function(e,t,o){"use strict";o.d(t,{H:function(){return s}});const s={insertMention(e,t,o){return[t.slice(0,o),e," ",t.slice(o)].join("")},profileMentionMarkup(e){return e.authorId?`[author:${e.slug}]`:`@${e.username}`},bookMentionMarkup(e){return`[book:${e.slug}]`},renderHelper(e,t,o,s){if(e&&(t||o)){t=t||[],o=o||[];const r=[],i=this.markupFormat(),a=_.keyBy(t,(e=>e.position))||{},n=_.keyBy(o,(e=>e.position))||{},l=e=>r.push(e),p=(e,t,o,s,i)=>r.push(i),c=(e,t,o)=>{const r=a[e]||{},i=n[e]||{};return s(o,r.profile,i.book)||t};return this.iterateMentionsMarkup(e,i,l,p,c),r.join("")}return e},syntaxToMentionRenderHelper(e,t,o){return this.renderHelper(e,t,o,((e,t,o)=>"profile"===e&&t?this.profileMentionMarkup(t):!("book"!==e||!o)&&this.bookMentionMarkup(o)))},textAsMarkupRenderHelper(e,t,o){return this.renderHelper(e,t,o,((e,t,o)=>{if("profile"===e&&t){const e=t.profileUrl,o=t.displayName;return"hidden"===t.state?o:`<a class='user-mention' id='mention-${t.id}' href='${e}'>${o}</a>`}if("book"===e&&o){const t=o.url,s=o.title;return`<a class='${e}-mention' id='mention-${o.id}' href='${t}'>${s}</a>`}return!1}))},suggestionToText(e){return`@[](${e.type}:${e.id})`},textToMentions(e){const t=[],o=this.markupFormat();return this.iterateMentionsMarkup(e,o,(e=>e),((e,s,r,i,a,n,l)=>t.push({markup:o,index:s,indexInPlainText:r,id:i,display:a,type:n,lastMentionEndIndex:l})),((e,t)=>t)),t},markupFormat(){return"@[](__type__:__id__)"},mentionRegexHelper(e){const t=`(?:^|\\s)(${e}([^${e}${this.claimedMentionTriggers().join("")}]*))$`;return new RegExp(t)},claimedMentionTriggers(){return["@","\\*"]},insertProfileMentionAtCursor(e,t,o,s){const r=`@${o}`,i=e.slice(0,s-r.length),a=(i+r).length;return[i,t," ",e.slice(a)].join("")},iterateMentionsMarkup(e,t,o,s,r){const i=this.markupToRegex(t),a=this.getPositionOfCapturingGroup(t,"display"),n=this.getPositionOfCapturingGroup(t,"id"),l=this.getPositionOfCapturingGroup(t,"type");let p,c=0,d=0;for(;null!==(p=i.exec(e));){const t=p[n+1];let u=p[a+1];const h=null!==l?p[l+1]:null;r&&(u=r(t,u,h));const m=e.substring(c,p.index);o(m,c,d),d+=m.length,s(p[0],p.index,d,t,u,h,c),d+=u.length,c=i.lastIndex}c<e.length&&o(e.substring(c),c,d)},escapeRegex(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},markupToRegex(e,t){let o=this.escapeRegex(e);return o=o.replace("__display__","(.+?)"),o=o.replace("__id__","(.+?)"),o=o.replace("__type__","(.+?)"),t&&(o+="$"),new RegExp(o,"g")},getPositionOfCapturingGroup(e,t){if("id"!==t&&"display"!==t&&"type"!==t)throw new Error("parameterName must be 'id', 'display', or 'type'");let o=e.indexOf("__display__"),s=e.indexOf("__id__"),r=e.indexOf("__type__");if(o<0&&(o=null),s<0&&(s=null),r<0&&(r=null),null===o&&null===s)throw new Error(`The markup \`${e}\` must contain at least one of the placeholders \`__id__\` or \`__display__\``);if(null===r&&"type"===t)return null;const i=[o,s,r].sort(((e,t)=>(e=null===e?Number.MAX_VALUE:e)-(null===t?Number.MAX_VALUE:t)));return null===o&&(o=s),null===s&&(s=o),"id"===t?i.indexOf(s):"display"===t?i.indexOf(o):"type"===t?null===r?null:i.indexOf(r):null}}},70136:function(e,t,o){"use strict";function s(e,t){var o;o=()=>function(e,t){const o=document.querySelector(e);if(o){const e=_.isFunction(t)?t():t;ReactDOM.render(e,o)}}(e,t),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o,{once:!0}):o()}o.d(t,{L:function(){return s}})},99668:function(){"development"===window.bubEnv&&$("body").show()},28628:function(e,t,o){"use strict";o.d(t,{B:function(){return n}});var s=o(71407),r={data(){return JSON.parse($("#config-store-data").attr("data"))}};const i=new class{getConfigData(){return r.data()}getTaftBaseUri(){return this.getConfigData().taftBaseUri}getIrisBaseUri(){return this.getConfigData().irisBaseUri}getBraintreeDisabled(){return this.getConfigData().braintreeDisabled}getDisplayAdsEnabled(){return this.getConfigData().displayAdsEnabled}getPartnerContactUrl(){return this.getConfigData().partnerContactUrl}getBillingFaqUrl(){return this.getConfigData().billingFaqUrl}getSocialBaseUri(){const e=window.location.host.replace("www","social-api");return`${window.location.protocol}//${e}`}};var a=o(9971);const n={baseUrl(){return i.getSocialBaseUri()},request(e={}){return e.url=this.baseUrl()+e.url,(0,s.t)(_.merge(e,{crossDomain:!0,xhrFields:{withCredentials:!0},headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-Token":a.I.csrfToken()}}))}}},5700:function(e,t,o){"use strict";o.d(t,{z:function(){return l}});var s=o(30381),r=o.n(s),i=o(96486),a=o.n(i);const n=/^(([^<>()[\]|\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,l={isNotEmpty(e){return!a().isEmpty(e.value)},isUrl(e){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)|\/|\?)*)?$/i.test(e.value)},isNotBookbub(e){return!/bookbub/i.test(e.value)},isInRange(e,t){if(t.ignoreEmpty&&a().isEmpty(e.value))return!0;const o=t.min||0,s=t.max||1e3,r=e.value||"";return r.length>=o&&r.length<=s},isBelowMaximum(e,t){const o=t.max||1e3;return(e.value||"").length<=o},isEmptyNumber(e){const t=parseFloat(e.value);return 0===t||a().isNaN(t)},isValidEmail(e){return n.test(e.value)},isRegexMatch(e,t){return!(!t.ignoreEmpty||!a().isEmpty(e.value))||!(!t||!t.regex)&&t.regex.test(e.value)},isValidDate(e){return!e.value||r()(e.value.creationData().input,e.value.creationData().format,!0).isValid()},isNotBeforeToday(e){return!e.value||!l.isValidDate(e)||e.value.isSameOrAfter(r()(),"day")},profileValidationSettings(e={}){const t={name:[{validator:this.isNotEmpty},{validator:this.isRegexMatch,regex:/^([^\s]|$)/,errorMessage:"Names cannot start with a space."},{validator:this.isRegexMatch,regex:/^((?!@).)*$/,errorMessage:"Names can't have '@' characters."},{validator:this.isBelowMaximum,max:30,errorMessage:"Names can't have more than 30 characters."}],tagline:[{validator:this.isBelowMaximum,max:150,errorMessage:"Well Said! But please make it 150 characters or fewer."}],biography:[{validator:this.isBelowMaximum,max:5e3,errorMessage:"Biographies can't have more than 5000 characters."}]},o={username:[{validator:this.isNotBookbub,errorMessage:'Please select a username that does not include "BookBub".'},{validator:this.isNotEmpty},{validator:this.isBelowMaximum,max:20,errorMessage:"Usernames can't have more than 20 characters."},{validator:this.isRegexMatch,ignoreEmpty:!0,regex:/^[A-Za-z0-9_]*$/,errorMessage:"Please only use alphanumeric characters and underscores."},{validator:this.isRegexMatch,ignoreEmpty:!0,regex:/^[A-Za-z0-9]+.*$/,errorMessage:"Please start with a letter or number."}]};return!0===e.authorOnly?t:!0===e.socialOnly?o:a().merge(t,o)},userCreationValidationSettings(e={}){const t={username:[{validator:this.isNotEmpty},{validator:this.isInRange,min:3,max:20,errorMessage:"Username should be between 3 and 20 characters long."},{validator:this.isNotBookbub,errorMessage:"Username may not contain 'bookbub'."},{validator:this.isRegexMatch,ignoreEmpty:!0,regex:/^[A-Za-z0-9_]*$/,errorMessage:"Please only use alphanumeric characters and underscores."},{validator:this.isRegexMatch,ignoreEmpty:!0,regex:/^[A-Za-z0-9]+.*$/,errorMessage:"Please start with a letter or number."}],email_address:[{validator:this.isValidEmail,errorMessage:"Please enter a valid email address."}]},o={password:[{validator:this.isRegexMatch,ignoreEmpty:!1,regex:/(?=.{8,}).*/,errorMessage:"You must enter a password. Your password must be at least 8 characters."}]};return!0===e.includePassword?a().merge({},t,o):t},userPostValidationSettings(e={}){return this.commentSharedValidationSettings(a().merge({},{max:1e4},e))},userCommentValidationSettings(e={}){return this.commentSharedValidationSettings(a().merge({},{max:1500},e))},commentSharedValidationSettings(e){const t=e.max,o=[{validator:this.isRegexMatch,regex:/^([^\s]|$)/,errorMessage:"Cannot start with a space."},{validator:this.isBelowMaximum,max:t,errorMessage:`Well Said! But please make it ${Number(t).toLocaleString()} characters or fewer.`}];return e.required?o.concat({validator:this.isNotEmpty}):o}}},45527:function(e,t,o){"use strict";o.d(t,{e:function(){return D}});var s=o(88251),r=o(87679),i=o(51321);const a="manage_book_modal";var n=o(75820),l=o(93513);const p="manageBook",c=(0,n.hp)(p,["SET_ACTIVE_BOOK","SET_ACTIVE_MODAL"]);(0,n.fn)(p,(0,l.Uy)(((e,t)=>{switch(t.type){case c.SET_ACTIVE_BOOK:return _.assignIn(e,{activeBookId:t.payload.bookId});case c.SET_ACTIVE_MODAL:return _.assignIn(e,{activeModal:t.payload.modal});default:return e}}),{activeBookId:null,activeModal:null}));const d=e=>e[p],u={actionTypes:c,getSelector:e=>({...d(e)})},h=new class{constructor(){this.setActiveModal=this.setActiveModal.bind(this),this.setActiveBook=this.setActiveBook.bind(this)}setActiveBook(e){return n.tO.dispatch({type:u.actionTypes.SET_ACTIVE_BOOK,payload:{bookId:e}}),!0}setActiveModal(e){return n.tO.dispatch({type:u.actionTypes.SET_ACTIVE_MODAL,payload:{modal:e}}),!0}manageBook(e){return this.setActiveBook(e),this.setActiveModal(a)}showBookmarkModal(e,t,o,s){h.manageBook(t);const r={bookId:t,onBookmark:o,triggerFlashMessage:s};return i.P.setAndShow(e,r)}confirmedIntentToRemoveBookmark(e){return r.Z.removeBookFromList(e,e.bookListSlug)}};var m=o(4598),g=o(66227),y=o(26076),b=o(76197),k=o(57997),T=o(31563),S=o(22430),f=o(69923),E=o(92613),R=o(78405),P=o(54728),C=o(76397),I=o(21453);class O extends React.Component{constructor(e){super(e),this.state={selectedBookListSlug:void 0},this.handleBookListChange=this.handleBookListChange.bind(this),this.handleRemoveBookFromList=this.handleRemoveBookFromList.bind(this,e.book.id),this.handleUpdateButton=this.handleUpdateButton.bind(this),this.handleOnHide=this.handleOnHide.bind(this),this.handleMoveBookToList=this.handleMoveBookToList.bind(this)}handleBookListChange(e){return this.setState({selectedBookListSlug:e.target.value})}handleMoveBookToList(){const e=this.getBookListSlug();return this.props.moveBookToList(e,this.props.book)}handleRemoveBookFromList(e){return this.props.removeFromList(e).then(this.handleOnHide)}handleUpdateButton(){this.handleMoveBookToList()}handleOnHide(){return this.props.onRequestToHide(this.props.book.bookListSlug)}getBookListSlug(){return this.state.selectedBookListSlug||this.props.book.bookListSlug||"wanted"}renderActionButtons(){return null!=this.props.book.bookListSlug?React.createElement("div",{className:"manage-book-actions"},React.createElement("span",{className:"remove-bookmark"},React.createElement(R.Q,{bubStyle:"mist",loadingText:"Removing",isLoading:this.props.isRemoving,onClick:this.handleRemoveBookFromList,full:!0},"Remove")),React.createElement("span",{className:"update"},React.createElement(R.Q,{loadingText:"Updating",isLoading:this.props.isUpdating,onClick:this.handleUpdateButton,bubStyle:"lava",full:!0},"Update"))):React.createElement("div",{className:"add-to-list"},React.createElement(R.Q,{className:"update",loadingText:"Adding",isLoading:this.props.isUpdating,onClick:this.handleUpdateButton,bubStyle:"lava",full:!0},"Add to List"))}renderBookLists(){const e=this.props.bookLists.map((e=>{const t=`book-list-${e.slug}`;return React.createElement("li",{key:e.slug},React.createElement("input",{id:t,type:"radio",name:"book-list",value:e.slug,defaultChecked:this.getBookListSlug()===e.slug,onChange:this.handleBookListChange}),React.createElement("label",{htmlFor:t},e.description))}));return React.createElement("ul",{className:"book-lists"},e)}render(){return this.props.book?React.createElement(P.O,{show:this.props.show,bsSize:"small",title:"Save to book list",onHide:this.handleOnHide},React.createElement("div",{id:"manage-book-modal"},React.createElement("div",{className:"book-cover"},React.createElement(I.y,{coverUrl:this.props.book.coverUrl,bookTitle:this.props.book.title})),this.renderBookLists(),this.renderActionButtons())):null}}O.propTypes={book:C._.book.isRequired,bookLists:PropTypes.arrayOf(PropTypes.object).isRequired,isRemoving:PropTypes.bool,isUpdating:PropTypes.bool,moveBookToList:PropTypes.func.isRequired,onRequestToHide:PropTypes.func.isRequired,removeFromList:PropTypes.func.isRequired,show:PropTypes.bool.isRequired},O.defaultProps={isUpdating:!1,isRemoving:!1};var v=o(19710),B=o(53114),w=o(88426);class L extends React.Component{constructor(e){super(e),this.handleMoveBookToList=this.handleMoveBookToList.bind(this),this.handleRemoveBookFromList=this.handleRemoveBookFromList.bind(this),this.hideManageBookModal=this.hideManageBookModal.bind(this),this.openRecommendModal=this.openRecommendModal.bind(this)}handleMoveBookToList(e,t){const o=t.bookListSlug;return r.Z.moveBookToList(t,e).then((()=>this.props.onBookmark(t))).then((()=>(this.hideManageBookModal(e),this.trackBookmark(o,e,t),this.props.fetchNextBookForPage&&null!==this.props.currentPage&&y.t.fetchNextBookForPage(o,this.props.currentPage),"finished"===e?this.props.currentProfile.authorId?k.H.createBookStoryPermission(t.id).then((()=>this.openRecommendModal(t))).catch((()=>_.noop)):this.openRecommendModal(t):null)))}handleRemoveBookFromList(e){let t=this.props.getBookForId(e);const o=t.bookListSlug,s=this.props.currentBookList.name;return h.confirmedIntentToRemoveBookmark(t).then((()=>{w.f.remove(t,o,w.f.MODAL_TRACKING_ID),h.setActiveModal(null),t=this.props.getBookForId(e),this.triggerFlashMessage(t,o,s)}))}triggerFlashMessage(e,t,o){return this.props.triggerFlashMessage?y.t.setFlashMessageData({book:e,bookListSlug:t,removedFromList:_.toLower(o)}):null}formId(e){return`bookmarked-book-${e}`}hideManageBookModal(e){return i.P.hide(),this.props.activeModal!==a||(this.props.onRequestToHide?(h.setActiveModal(null),this.props.onRequestToHide(e)):h.setActiveModal(null))}openRecommendModal(e){if(this.props.openRecommendModalStub)return this.props.openRecommendModalStub();const t=this.formId(e.id);return b.t.prepOpenRecommendBookModal(e.id,t),i.P.showResponsively(v.s,B.T,{formId:t})}trackBookmark(e,t,o){return _.isNil(e)?w.f.add(o,t,w.f.MODAL_TRACKING_ID):w.f.move(o,t,w.f.MODAL_TRACKING_ID)}render(){const e=this.props.activeBook;return null==e?null:this.props.activeBook.id===(this.props.bookId||this.props.activeBook.id)&&this.props.activeModal===a?React.createElement(O,{book:e,bookLists:this.props.bookLists,isRemoving:this.props.isRemoving,isUpdating:this.props.isUpdating,moveBookToList:this.handleMoveBookToList,onRequestToHide:this.hideManageBookModal,removeFromList:this.handleRemoveBookFromList,show:!0}):null}}L.propTypes={activeBook:C._.book,activeModal:PropTypes.string,bookId:PropTypes.number,bookLists:PropTypes.array,currentPage:PropTypes.number,fetchNextBookForPage:PropTypes.bool,isRemoving:PropTypes.bool,isUpdating:PropTypes.bool,onRequestToHide:PropTypes.func,onBookmark:PropTypes.func,currentProfile:C._.profile,openRecommendModalStub:PropTypes.func,getBookForId:PropTypes.func,triggerFlashMessage:PropTypes.bool,currentBookList:PropTypes.object},L.defaultProps={activeBook:null,activeModal:null,bookId:null,bookLists:[],currentPage:null,fetchNextBookForPage:!1,isRemoving:!1,isUpdating:!1,onRequestToHide:null,onBookmark:_.noop,triggerFlashMessage:!1},L.trackingName="Manage Book Modal";const A=(0,s.$j)((e=>{const t=u.getSelector(e),o=T.G.getSelector(e),s=S.h.getSelector(e),r=f.C.getSelector(e),i=E.C.getSelector(e),a=t.activeBookId,n=o.getBookForId(a),l=i.getBookListsWithoutSkipped();return{activeBook:n,activeModal:t.activeModal,isUpdating:o.isUpdating(n),isRemoving:o.isRemoving(n),currentPage:s.currentPage,currentProfile:r.getCurrentUserProfile(),bookLists:l,currentBookList:_.find(l,{slug:n.bookListSlug}),getBookForId:e=>o.getBookForId(e)}}))(L);var N=o(9971);class M extends React.Component{constructor(e){super(e),this.onClick=this.onClick.bind(this),this.openBookmarkModal=this.openBookmarkModal.bind(this),this.openBubReloadingAuthModal=this.openBubReloadingAuthModal.bind(this),this.handleMoveBookToWishlist=this.handleMoveBookToWishlist.bind(this)}componentDidMount(){return this.props.open?_.defer(this.openBookmarkModal):null}handleMoveBookToWishlist(e){return r.Z.moveBookToList(e,"wanted").then((()=>{this.props.onCtaClick&&this.props.onCtaClick(e);const t=this.props.trackingLabel||w.f.BUTTON_TRACKING_ID;w.f.add(e,"wanted",t)}))}handleRemoveBookFromWishlist(e){return r.Z.removeBookFromList(e,"wanted").then((()=>{const t=this.props.trackingLabel||w.f.BUTTON_TRACKING_ID;w.f.remove(e,"wanted",t)}))}onClick(){this.props.onList?this.props.useOneClickAction?this.handleRemoveBookFromWishlist(this.props.book):this.openBookmarkModal():this.props.userAuthed?this.handleMoveBookToWishlist(this.props.book):this.openBubReloadingAuthModal()}openBookmarkModal(){return h.showBookmarkModal(A,this.props.bookId,this.props.onBookmark,this.props.triggerFlashMessage)}openBubReloadingAuthModal(){let e="manage_bookmark=true";return window.location.search&&(e=`query&${window.location.search.slice(1)}`),i.P.setAndShow(g.P,{displaySignInText:!0,signInHelpMessageAction:`wishlist ${this.props.book.title}`,query:e})}render(){if(this.props.userAuthed&&!this.props.countryCodeIsUs)return null;let e;return this.props.onList&&(e=this.props.bookList.onListLabel),React.createElement("span",null,React.createElement(m.e,{bookId:this.props.bookId,onList:this.props.onList,onListLabel:e,onClick:this.onClick,labelLength:this.props.labelLength,bubStyle:this.props.bubStyle,renderAs:this.props.renderAs,full:this.props.full,skinny:this.props.skinny,icon:this.props.icon,iconOnly:this.props.iconOnly,textSize:this.props.textSize,noPadding:this.props.noPadding}))}}M.propTypes={bookId:PropTypes.number,book:C._.book,bookList:PropTypes.object,countryCodeIsUs:PropTypes.bool,userAuthed:PropTypes.bool,open:PropTypes.bool,skinny:PropTypes.bool,onList:PropTypes.bool,bubStyle:PropTypes.string,renderAs:PropTypes.string,full:PropTypes.bool,icon:PropTypes.bool,iconOnly:PropTypes.bool,onBookmark:PropTypes.func,textSize:PropTypes.oneOf(["small","medium","large"]),noPadding:PropTypes.bool,labelLength:PropTypes.oneOf(["short","medium","long"]),trackingLabel:PropTypes.string,onCtaClick:PropTypes.func,useOneClickAction:PropTypes.bool,triggerFlashMessage:PropTypes.bool},M.defaultProps={bookId:void 0,bookList:void 0,open:!1,skinny:!1,onList:!1,userAuthed:!1,onBookmark:_.noop,bubStyle:void 0,renderAs:void 0,full:void 0,icon:void 0,iconOnly:!1,triggerFlashMessage:!1};const D=(0,s.$j)(((e,t)=>{const o=E.C.getSelector(e),s=T.G.getSelector(e).getBookForId(t.bookId),r=o.getListForSlug(_.get(s,"bookListSlug"));return{countryCodeIsUs:N.I.countryCodeIsUs(),onList:!!r,bookList:r,book:s,userAuthed:N.I.isAuthed()}}))(M)},6588:function(e){e.exports="https://dzazw6ldmby07.cloudfront.net/assets/fallback/default_author_image-1def3e7ecae77a743211ff9e074ad742c9ab5b05666445cdbcc05cb9fd817c33.jpg"},64098:function(e){e.exports="https://dzazw6ldmby07.cloudfront.net/assets/features/destination_signup/google_oauth_transparent-193f0ff29d1a126f2358e1b713d83dcc121f26d0d23b0f028fa75f25d6e3cea6.png"},92564:function(e){e.exports="https://dzazw6ldmby07.cloudfront.net/assets/features/social/buzz-book-cover-coming-soon@2x-077f3d23869bdc2b15a51592bc3183d01d73df047286c9da92d11afb2a1c8cf6.jpg"},71044:function(e){e.exports="https://dzazw6ldmby07.cloudfront.net/assets/features/social/restricted-review-117a74bf089fa9e77577840056508566f7df5183b60b141e3aa973aed2bf9172.png"},46700:function(e,t,o){var s={"./af":42786,"./af.js":42786,"./ar":30867,"./ar-dz":14130,"./ar-dz.js":14130,"./ar-kw":96135,"./ar-kw.js":96135,"./ar-ly":56440,"./ar-ly.js":56440,"./ar-ma":47702,"./ar-ma.js":47702,"./ar-sa":16040,"./ar-sa.js":16040,"./ar-tn":37100,"./ar-tn.js":37100,"./ar.js":30867,"./az":31083,"./az.js":31083,"./be":9808,"./be.js":9808,"./bg":68338,"./bg.js":68338,"./bm":67438,"./bm.js":67438,"./bn":8905,"./bn-bd":76225,"./bn-bd.js":76225,"./bn.js":8905,"./bo":11560,"./bo.js":11560,"./br":1278,"./br.js":1278,"./bs":80622,"./bs.js":80622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":50877,"./cv.js":50877,"./cy":47373,"./cy.js":47373,"./da":24780,"./da.js":24780,"./de":59740,"./de-at":60217,"./de-at.js":60217,"./de-ch":60894,"./de-ch.js":60894,"./de.js":59740,"./dv":5300,"./dv.js":5300,"./el":50837,"./el.js":50837,"./en-au":78348,"./en-au.js":78348,"./en-ca":77925,"./en-ca.js":77925,"./en-gb":22243,"./en-gb.js":22243,"./en-ie":46436,"./en-ie.js":46436,"./en-il":47207,"./en-il.js":47207,"./en-in":44175,"./en-in.js":44175,"./en-nz":76319,"./en-nz.js":76319,"./en-sg":31662,"./en-sg.js":31662,"./eo":92915,"./eo.js":92915,"./es":55655,"./es-do":55251,"./es-do.js":55251,"./es-mx":96112,"./es-mx.js":96112,"./es-us":71146,"./es-us.js":71146,"./es.js":55655,"./et":5603,"./et.js":5603,"./eu":77763,"./eu.js":77763,"./fa":76959,"./fa.js":76959,"./fi":11897,"./fi.js":11897,"./fil":42549,"./fil.js":42549,"./fo":94694,"./fo.js":94694,"./fr":94470,"./fr-ca":63049,"./fr-ca.js":63049,"./fr-ch":52330,"./fr-ch.js":52330,"./fr.js":94470,"./fy":5044,"./fy.js":5044,"./ga":29295,"./ga.js":29295,"./gd":2101,"./gd.js":2101,"./gl":38794,"./gl.js":38794,"./gom-deva":27884,"./gom-deva.js":27884,"./gom-latn":23168,"./gom-latn.js":23168,"./gu":95349,"./gu.js":95349,"./he":24206,"./he.js":24206,"./hi":30094,"./hi.js":30094,"./hr":30316,"./hr.js":30316,"./hu":22138,"./hu.js":22138,"./hy-am":11423,"./hy-am.js":11423,"./id":29218,"./id.js":29218,"./is":90135,"./is.js":90135,"./it":90626,"./it-ch":10150,"./it-ch.js":10150,"./it.js":90626,"./ja":39183,"./ja.js":39183,"./jv":24286,"./jv.js":24286,"./ka":12105,"./ka.js":12105,"./kk":47772,"./kk.js":47772,"./km":18758,"./km.js":18758,"./kn":79282,"./kn.js":79282,"./ko":33730,"./ko.js":33730,"./ku":1408,"./ku.js":1408,"./ky":33291,"./ky.js":33291,"./lb":36841,"./lb.js":36841,"./lo":55466,"./lo.js":55466,"./lt":57010,"./lt.js":57010,"./lv":37595,"./lv.js":37595,"./me":39861,"./me.js":39861,"./mi":35493,"./mi.js":35493,"./mk":95966,"./mk.js":95966,"./ml":87341,"./ml.js":87341,"./mn":5115,"./mn.js":5115,"./mr":10370,"./mr.js":10370,"./ms":9847,"./ms-my":41237,"./ms-my.js":41237,"./ms.js":9847,"./mt":72126,"./mt.js":72126,"./my":56165,"./my.js":56165,"./nb":64924,"./nb.js":64924,"./ne":16744,"./ne.js":16744,"./nl":93901,"./nl-be":59814,"./nl-be.js":59814,"./nl.js":93901,"./nn":83877,"./nn.js":83877,"./oc-lnc":92135,"./oc-lnc.js":92135,"./pa-in":15858,"./pa-in.js":15858,"./pl":64495,"./pl.js":64495,"./pt":89520,"./pt-br":57971,"./pt-br.js":57971,"./pt.js":89520,"./ro":96459,"./ro.js":96459,"./ru":21793,"./ru.js":21793,"./sd":40950,"./sd.js":40950,"./se":10490,"./se.js":10490,"./si":90124,"./si.js":90124,"./sk":64249,"./sk.js":64249,"./sl":14985,"./sl.js":14985,"./sq":51104,"./sq.js":51104,"./sr":49131,"./sr-cyrl":79915,"./sr-cyrl.js":79915,"./sr.js":49131,"./ss":85893,"./ss.js":85893,"./sv":98760,"./sv.js":98760,"./sw":91172,"./sw.js":91172,"./ta":27333,"./ta.js":27333,"./te":23110,"./te.js":23110,"./tet":52095,"./tet.js":52095,"./tg":27321,"./tg.js":27321,"./th":9041,"./th.js":9041,"./tk":19005,"./tk.js":19005,"./tl-ph":75768,"./tl-ph.js":75768,"./tlh":89444,"./tlh.js":89444,"./tr":72397,"./tr.js":72397,"./tzl":28254,"./tzl.js":28254,"./tzm":51106,"./tzm-latn":30699,"./tzm-latn.js":30699,"./tzm.js":51106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":67691,"./uk.js":67691,"./ur":13795,"./ur.js":13795,"./uz":6791,"./uz-latn":60588,"./uz-latn.js":60588,"./uz.js":6791,"./vi":65666,"./vi.js":65666,"./x-pseudo":14378,"./x-pseudo.js":14378,"./yo":75805,"./yo.js":75805,"./zh-cn":83839,"./zh-cn.js":83839,"./zh-hk":55726,"./zh-hk.js":55726,"./zh-mo":99807,"./zh-mo.js":99807,"./zh-tw":74152,"./zh-tw.js":74152};function r(e){var t=i(e);return o(t)}function i(e){if(!o.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=46700},68140:function(e){e.exports='<svg viewBox="0 0 18 27" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Artboard" transform="translate(-21.000000, -586.000000)"><g id="Example-Flag" transform="translate(21.000000, 586.000000)"><g id="Group-2" fill="#FFFFFF" stroke="#FFFFFF"><path d="M17.5,17.4746961 L17.5,25.2831284 L8.97510774,20.4241026 L0.5,25.2808268 L0.5,17.4746961 L17.5,17.4746961 Z" id="Path-3"></path><rect id="Rectangle" x="0.5" y="0.5" width="17" height="20" rx="1"></rect></g><g id="Group" transform="translate(9.000000, 12.500000) rotate(90.000000) translate(-9.000000, -12.500000) translate(-1.500000, 5.500000)" fill="#DC4034"><path d="M1,0 L15.8251055,0 C16.3721467,3.43599376e-16 16.81766,0.43956302 16.8250151,0.986554747 L16.9863727,12.9865547 C16.9937983,13.5387896 16.5521432,13.992484 15.9999084,13.9999096 C15.9954269,13.9999699 15.990945,14 15.9864631,14 L1,14 C0.44771525,14 6.76353751e-17,13.5522847 0,13 L0,1 C-6.76353751e-17,0.44771525 0.44771525,1.01453063e-16 1,0 Z" id="Rectangle"></path><path d="M20.1402759,0.5 L16.4422106,7 L20.1402759,13.5 L15.6124912,13.5 C14.8738788,10.7935159 14.5,8.62715123 14.5,7 C14.5,5.37284877 14.8738788,3.20648408 15.6124912,0.5 L15.6124912,0.5 L20.1402759,0.5 Z" id="Path" stroke="#DC4034"></path></g></g></g></g></svg>'}}]);
